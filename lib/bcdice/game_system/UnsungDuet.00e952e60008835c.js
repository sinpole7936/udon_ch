(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[8317],{1952:(ge,ye,be)=>{be(5151),Opal.modules["i18n/backend/fallbacks"]=function(e){var G,n,r,_,u,f,U=e.module,L=e.class_variable_set,c=e.truthy,P=e.class_variable_get,I=e.def,q=e.send,M=e.send2,R=e.find_super,A=e.hash2,C=e.find_block_super,F=e.neqeq,j=e.thrower,E=e.return_val,B=[],N=e.nil,x=e.$$$;return G=B,f=[u=U(B[0],"I18n")].concat(G),L(f[0],"@@fallbacks",N),n=e.get_singleton_class(u),r=[n].concat(f),_=e.$r(r),I(n,"$fallbacks",function(){var y=N;return L(r[1],"@@fallbacks",c(null!=r[1].$$cvars["@@fallbacks"]?"class variable":N)&&c(y=P(r[1],"@@fallbacks",!1))?y:x(x(_("I18n"),"Locale"),"Fallbacks").$new()),c(y=_("Thread").$current()["$[]"]("i18n_fallbacks"))?y:P(r[1],"@@fallbacks",!1)}),I(n,"$fallbacks=",function(S){var y;return L(r[1],"@@fallbacks",c(S["$is_a?"](_("Array")))?x(x(_("I18n"),"Locale"),"Fallbacks").$new(S):S),y=["i18n_fallbacks",P(r[1],"@@fallbacks",!1)],q(_("Thread").$current(),"[]=",y),y[y.length-1]}),function(n,T){var S,y,w,p,_=[U(n,"Backend")].concat(T);return S=_,w=[y=U(_[0],"Fallbacks")].concat(S),p=e.$r(w),I(y,"$translate",function b(l,d,$){try{var o=j("return"),a=b.$$p||N,k=this,H=N,m=N;return b.$$p=null,null==$&&($=p("EMPTY_HASH")),c($.$fetch("fallback",!0))?c($["$[]"]("fallback_in_progress"))?M(k,R(k,"translate",b,!1,!0),"translate",[l,d,$],a):(c($["$[]"]("default"))&&(H=k["$extract_non_symbol_default!"]($)),m=$.$merge(A(["fallback_in_progress"],{fallback_in_progress:!0})),q(p("I18n").$fallbacks()["$[]"](l),"each",[],function t(D){var i=null==t.$$s?this:t.$$s;null==D&&(D=N);try{return q(i,"catch",["exception"],function v(){var s=null==v.$$s?this:v.$$s,W=N;if(W=M(s,C(s,"translate",v.$$def||t.$$def||b,!1,!1),"translate",[D,d,m],null),c(W["$nil?"]()))return N;F(l.$to_s(),D.$to_s())&&s.$on_fallback(l,D,d,$),o.$throw(W)},{$$s:i,$$ret:o})}catch(v){if(!e.rescue(v,[x(p("I18n"),"InvalidLocale")]))throw v;try{return N}finally{e.pop_exception()}}},{$$s:k}),c($["$key?"]("default"))&&c($["$[]"]("default")["$nil?"]())?N:c(H)?M(k,R(k,"translate",b,!1,!0),"translate",[l,N,$.$merge(A(["default"],{default:H}))],null):k.$throw("exception",x(p("I18n"),"MissingTranslation").$new(l,d,$))):M(k,R(k,"translate",b,!1,!0),"translate",[l,d,$],a)}catch(t){if(t===o)return t.$v;throw t}},-3),I(y,"$extract_non_symbol_default!",function(l){var $,d=N;return d=[l["$[]"]("default")].$flatten(),$=q(d,"detect",[],function(a){return null==a&&(a=N),a["$is_a?"](p("Symbol"))["$!"]()}),c($)&&l["$[]="]("default",d["$[]"](0,d.$index($))),$}),I(y,"$exists?",function b(l,d,$){try{var o=j("return"),a=b.$$p||N,k=this;return b.$$p=null,null==$&&($=p("EMPTY_HASH")),c($.$fetch("fallback",!0))?(q(p("I18n").$fallbacks()["$[]"](l),"each",[],function H(m){var t=null==H.$$s?this:H.$$s;null==m&&(m=N);try{if(!c(M(t,C(t,"exists?",H.$$def||b,!1,!1),"exists?",[m,d],null)))return N;o.$throw(!0)}catch(D){if(!e.rescue(D,[x(p("I18n"),"InvalidLocale")]))throw D;try{return N}finally{e.pop_exception()}}},{$$s:k,$$ret:o}),!1):M(k,R(k,"exists?",b,!1,!0),"exists?",[l,d,$],a)}catch(H){if(H===o)return H.$v;throw H}},-3),y.$private(),I(y,"$on_fallback",E(N))}(f[0],f)},Opal.modules["bcdice/randomizer"]=function(e){var u,h,S,y,w,p,n,T,L=e.klass,c=e.const_set,P=e.def,I=e.truthy,q=e.rb_gt,M=e.rb_plus,R=e.rb_le,A=e.send,C=e.rb_minus,F=e.eqeq,j=e.rb_times,E=e.eqeqeq,B=e.rb_ge,N=[],x=e.nil,Y=e.$$$;return u=N,n=[(0,e.module)(N[0],"BCDice")].concat(u),T=e.$r(n),h=n,y=[S=L(n[0],null,"Randomizer")].concat(h),w=e.$r(y),(p=S.$$prototype).rand_results=p.detailed_rand_results=x,c(y[0],"UPPER_LIMIT_DICE_TIMES",200),c(y[0],"UPPER_LIMIT_DICE_SIDES",1e4),c(y[0],"UPPER_LIMIT_RANDS",1e4),P(S,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),S.$attr_reader("rand_results"),S.$attr_reader("detailed_rand_results"),c(y[0],"DetailedRandResult",w("Struct").$new("kind","sides","value")),P(S,"$roll_barabara",function(l,d){var $=this;return I(q(M($.rand_results.$size(),l),w("UPPER_LIMIT_RANDS")))&&$.$raise(w("TooManyRandsError")),I(R(l,0))||I(q(l,w("UPPER_LIMIT_DICE_TIMES")))?[]:A(w("Array"),"new",[l],function o(){return(null==o.$$s?this:o.$$s).$roll_once(d)},{$$s:$})}),P(S,"$roll_sum",function(l,d){return this.$roll_barabara(l,d).$sum()}),P(S,"$roll_once",function(l){var $=x;return I(R(l,0))||I(q(l,w("UPPER_LIMIT_DICE_SIDES")))?0:($=this.$rand_inner(l),this.$push_to_detail("normal",l,$),$)}),P(S,"$roll_index",function(l){return C(this.$roll_once(l),1)}),P(S,"$roll_tens_d10",function(){var $,d=x;return d=this.$rand_inner(10),F(d,10)&&(d=0),$=j(d,10),this.$push_to_detail("tens_d10",10,$),$}),P(S,"$roll_d9",function(){var d;return d=C(this.$rand_inner(10),1),this.$push_to_detail("d9",10,d),d}),P(S,"$roll_d66",function(l){var o,$=x;return $=A(w("Array"),"new",[2],function a(){return(null==a.$$s?this:a.$$s).$roll_once(6)},{$$s:this}),E(Y(w("D66SortType"),"ASC"),o=l)?$["$sort!"]():E(Y(w("D66SortType"),"DESC"),o)&&$["$sort!"]()["$reverse!"](),M(j($["$[]"](0),10),$["$[]"](1))}),S.$private(),P(S,"$rand_inner",function(l){var $,d=this;return I(B(d.rand_results.$size(),w("UPPER_LIMIT_RANDS")))&&d.$raise(w("TooManyRandsError")),$=d.$random(l),d.rand_results["$<<"]([$,l]),$}),P(S,"$random",function(l){return M(w("Kernel").$rand(l),1)}),P(S,"$push_to_detail",function(l,d,$){var a;return a=w("DetailedRandResult").$new(l,d,$),this.detailed_rand_results.$push(a)}),L(n[0],T("StandardError"),"TooManyRandsError"),x},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var A,E,G,u,f,n,T,N,F,U=e.module,L=e.klass,c=e.def,P=e.truthy,I=e.return_val,q=[],M=e.nil;return A=q,E=F=[U(q[0],"BCDice")].concat(A),G=N=[U(F[0],"DiceTable")].concat(E),f=[u=L(N[0],null,"RollResult")].concat(G),n=e.$r(f),(T=u.$$prototype).table_name=T.value=T.body=M,c(u,"$initialize",function(_,h,S){var y=this;return y.table_name=_,y.value=h,y.body=S}),u.$attr_reader("table_name"),u.$attr_reader("value"),u.$attr_reader("body"),c(u,"$to_s",function(){var _=this;return _.table_name+"("+_.value+") \uff1e "+_.body}),c(u,"$last_body",function(){var _=this;return P(_.body["$is_a?"](n("RollResult")))?_.body.$last_body():_.body}),c(u,"$empty?",I(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var A,E,G,u,f,n,T,N,F,U=e.module,L=e.klass,c=e.truthy,P=e.def,I=e.rb_minus,q=[],M=e.nil;return A=q,E=F=[U(q[0],"BCDice")].concat(A),G=N=[U(F[0],"DiceTable")].concat(E),f=[u=L(N[0],null,"ChainTable")].concat(G),n=e.$r(f),(T=u.$$prototype).times=T.sides=T.items=T.name=M,P(u,"$initialize",function(_,h,S){var y=this,w=M;return y.name=_,y.items=S.$freeze(),w=/(\d+)D(\d+)/i.$match(h),c(w)||y.$raise(n("ArgumentError"),"Unexpected table type: "+h),y.times=w["$[]"](1).$to_i(),y.sides=w["$[]"](2).$to_i()}),P(u,"$roll",function(_){var S,y,h=this,w=M;return S=_.$roll_sum(h.times,h.sides),y=I(S,h.times),w=h.items["$[]"](y),c(w["$respond_to?"]("roll"))&&(w=w.$roll(_)),n("RollResult").$new(h.name,S,w)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var j,x,n,T,r,_,h,G,B,U=e.module,L=e.klass,c=e.hash2,P=e.defs,I=e.def,q=e.rb_plus,M=e.rb_times,R=e.rb_minus,A=[],C=e.nil;return j=A,x=B=[U(A[0],"BCDice")].concat(j),n=G=[U(B[0],"DiceTable")].concat(x),r=[T=L(G[0],null,"D66GridTable")].concat(n),_=e.$r(r),(h=T.$$prototype).name=h.items=C,P(T,"$from_i18n",function(y,w){var b=C;return b=_("I18n").$t(y,c(["locale","raise"],{locale:w,raise:!0})),this.$new(b["$[]"]("name"),b["$[]"]("items"))}),I(T,"$initialize",function(y,w){return this.name=y,this.items=w.$freeze()}),I(T,"$roll",function(y){var p,b,l,d,$;return p=y.$roll_once(6),b=y.$roll_once(6),l=q(M(p,10),b),d=R(p,1),$=R(b,1),_("RollResult").$new(this.name,l,this.items["$[]"](d)["$[]"]($))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var C,B,f,n,T,r,x,Y,j,U=e.module,L=e.klass,c=e.hash2,P=e.defs,I=e.def,M=[],R=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),C=M,B=j=[U(M[0],"BCDice")].concat(C),x=[U(j[0],"DiceTable")].concat(B),Y=e.$r(x),f=x,T=[n=L(x[0],Y("D66GridTable"),"D66HalfGridTable")].concat(f),r=e.$r(T),P(n,"$from_i18n",function(h,S){var w=R;return w=r("I18n").$t(h,c(["locale","raise"],{locale:S,raise:!0})),this.$new(w["$[]"]("name"),w["$[]"]("items_1_2_3"),w["$[]"]("items_4_5_6"))}),I(n,"$initialize",function(h,S,y){return this.name=h,this.items=[S,S,S,y,y,y].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var C,B,f,n,T,r,x,Y,j,U=e.module,L=e.klass,c=e.hash2,P=e.defs,I=e.def,M=[],R=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),C=M,B=j=[U(M[0],"BCDice")].concat(C),x=[U(j[0],"DiceTable")].concat(B),Y=e.$r(x),f=x,T=[n=L(x[0],Y("D66GridTable"),"D66OneThirdTable")].concat(f),r=e.$r(T),P(n,"$from_i18n",function(h,S){var w=R;return w=r("I18n").$t(h,c(["locale","raise"],{locale:S,raise:!0})),this.$new(w["$[]"]("name"),w["$[]"]("items_1_2"),w["$[]"]("items_3_4"),w["$[]"]("items_5_6"))}),I(n,"$initialize",function(h,S,y,w){return this.name=h,this.items=[S,S,y,y,w,w].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var B,G,r,_,h,S,y,f,x,U=e.module,L=e.klass,c=e.hash2,P=e.defs,I=e.def,q=e.eqeqeq,M=e.rb_plus,R=e.rb_times,A=e.truthy,C=[],F=e.nil,j=e.$$$;return B=C,G=x=[U(C[0],"BCDice")].concat(B),r=f=[U(x[0],"DiceTable")].concat(G),h=[_=L(f[0],null,"D66Table")].concat(r),S=e.$r(h),(y=_.$$prototype).sort_type=y.items=y.name=F,P(_,"$from_i18n",function(p,b){var $,d=F;return d=S("I18n").$t(p,c(["locale"],{locale:b})),$=S("D66SortType").$const_get(d["$[]"]("d66_sort_type")),this.$new(d["$[]"]("name"),$,d["$[]"]("items"))}),I(_,"$initialize",function(p,b,l){var d=this;return d.name=p,d.sort_type=b,d.items=l.$freeze()}),I(_,"$roll",function(p){var b=this,l=F,d=F,$=F,o=F;return l=p.$roll_barabara(2,6),q(j(S("D66SortType"),"ASC"),d=b.sort_type)?l["$sort!"]():q(j(S("D66SortType"),"DESC"),d)&&l["$sort!"]()["$reverse!"](),$=M(R(l["$[]"](0),10),l["$[]"](1)),o=A(d=b.items["$[]"]($))?d:b.items["$[]"]($.$to_s()),A(o["$respond_to?"]("roll"))&&(o=o.$roll(p)),S("RollResult").$new(b.name,$,o)}),I(_,"$choice",function(p){return S("RollResult").$new(this.name,p,this.items["$[]"](p))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var N,u,n,T,Y,U=e.module,L=e.klass,c=e.hash2,P=e.send,I=e.to_ary,q=e.rb_plus,M=e.rb_times,R=e.send2,A=e.find_super,C=e.def,j=[],E=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),N=j,u=Y=[U(j[0],"BCDice")].concat(N),n=[U(Y[0],"DiceTable")].concat(u),T=e.$r(n),C(L(n[0],T("D66Table"),"D66LeftRangeTable"),"$initialize",function S(y,w,p){var d;return S.$$p=null,d=c([],{}),P(p,"each",[],function(o){var a,m;return null==o&&(o=E),a=I(o),m=null==a[1]?E:a[1],P(null==a[0]?E:a[0],"each",[],function(D){return null==D&&(D=E),P(m,"each_with_index",[],function(v,s){var W,Q;return null==v&&(v=E),null==s&&(s=E),Q=q(M(D,10),q(s,1)),P(d,"[]=",W=[Q,v]),W[W.length-1]})})}),R(this,A(this,"initialize",S,!1,!0),"initialize",[y,w,d],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var E,Y,T,r,_,h,S,u,N,U=e.module,L=e.klass,c=e.hash2,P=e.defs,I=e.def,q=e.truthy,M=e.rb_minus,R=e.rb_plus,A=e.rb_times,C=[],F=e.nil;return E=C,Y=N=[U(C[0],"BCDice")].concat(E),T=u=[U(N[0],"DiceTable")].concat(Y),_=[r=L(u[0],null,"D66ParityTable")].concat(T),h=e.$r(_),(S=r.$$prototype).odd=S.even=S.name=F,P(r,"$from_i18n",function(w,p){var l=F;return l=h("I18n").$t(w,c(["locale","raise"],{locale:p,raise:!0})),this.$new(l["$[]"]("name"),l["$[]"]("odd"),l["$[]"]("even"))}),I(r,"$initialize",function(w,p,b){var l=this;return l.name=w,l.odd=p.$freeze(),l.even=b.$freeze()}),I(r,"$roll",function(w){var l,$,o,p=this,b=F;return b=w.$roll_once(6),l=w.$roll_once(6),$=(q(b["$odd?"]())?p.odd:p.even)["$[]"](M(l,1)),o=R(A(b,10),l),h("RollResult").$new(p.name,o,$)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var C,B,u,f,n,T,r,x,j,U=e.module,L=e.klass,c=e.def,P=e.rb_plus,I=e.rb_times,q=e.send,M=[],R=e.nil;return C=M,B=j=[U(M[0],"BCDice")].concat(C),u=x=[U(j[0],"DiceTable")].concat(B),n=[f=L(x[0],null,"D66RangeTable")].concat(u),T=e.$r(n),(r=f.$$prototype).items=r.name=R,c(f,"$initialize",function(h,S){return this.name=h,this.items=S.$freeze()}),c(f,"$roll",function(h){var y,w,p,b=R;return y=h.$roll_once(6),w=h.$roll_once(6),p=P(I(y,10),w),b=q(this.items,"find",[],function(d){return null==d&&(d=R),d["$[]"](0)["$include?"](p)}),T("RollResult").$new(this.name,p,b["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var N,u,_,p,l,d,h,S,y,w,n,Y,U=e.module,L=e.klass,c=e.const_set,P=e.send,I=e.hash2,q=e.def,M=e.eqeqeq,R=e.truthy,A=e.to_a,C=e.rb_times,F=e.rb_plus,j=[],E=e.nil;return N=j,u=Y=[U(j[0],"BCDice")].concat(N),_=n=[U(Y[0],"DiceTable")].concat(u),S=[h=L(n[0],null,"RangeTable")].concat(_),y=e.$r(S),(w=h.$$prototype).name=w.items=w.num_of_dice=w.num_of_sides=w.formatter=E,c(S[0],"RollResult",P(y("Struct"),"new",["sum","values","content","formatted"],function p(){return(null==p.$$s?this:p.$$s).$alias_method("to_s","formatted")},{$$s:h})),c(S[0],"Item",y("Struct").$new("range","content")),c(S[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),c(S[0],"DEFAULT_FORMATTER",P(h,"lambda",[],function(b,l){return null==b&&(b=E),null==l&&(l=E),b.$name()+"("+l.$sum()+") \uff1e "+l.$content()})),h.$attr_reader("name"),h.$attr_reader("num_of_dice"),h.$attr_reader("num_of_sides"),l=[p=e.get_singleton_class(h)].concat(S),d=e.$r(l),q(p,"$from_i18n",function(o,a){var m,H=E;return H=d("I18n").$t(o,I(["locale"],{locale:a})),m=P(H["$[]"]("items"),"map",[],function t(D){return null==D&&(D=E),[(null==t.$$s?this:t.$$s).$conv_string_range(D["$[]"](0)),D["$[]"](1)]},{$$s:this}),this.$new(H["$[]"]("name"),H["$[]"]("type"),m)}),q(p,"$conv_string_range",function(o){var k,a=this;return null==a.name&&(a.name=E),M(d("Integer"),k=o)?o:M(d("String"),k)?R(o["$include?"](".."))?P(d("Range"),"new",A(P(o.$split("..",2),"map",[],function H(m){return null==m&&(m=E),(null==H.$$s?this:H.$$s).$Integer(m)},{$$s:a}))):a.$Integer(o):a.$raise(d("TypeError"),a.name+": "+o+" ("+o.$class()+") must be a String or an Integer")}),q(h,"$initialize",function p(b,l,d){var a,$=p.$$p||E,o=this,k=E;return p.$$p=null,o.name=b.$freeze(),o.formatter=R(a=$)?a:y("DEFAULT_FORMATTER"),k=y("DICE_ROLL_METHOD_RE").$match(l),R(k)||o.$raise(y("ArgumentError"),o.name+": invalid dice roll method: "+l),o.num_of_dice=k["$[]"](1).$to_i(),o.num_of_sides=k["$[]"](2).$to_i(),o.$store(d)}),q(h,"$fetch",function(b){var d,l=this;return d=P(l.items,"find",[],function(o){return null==o&&(o=E),o.$range()["$include?"](b)}),R(d)||l.$raise(y("RangeError"),l.name+": value is out of range: "+b),d}),q(h,"$roll",function(b){var $,l=this,d=E,o=E;return $=(d=b.$roll_barabara(l.num_of_dice,l.num_of_sides)).$sum(),(o=y("RollResult").$new($,d,l.$fetch($).$content()))["$formatted="](l.formatter["$[]"](l,o)),o}),h.$private(),q(h,"$store",function(b){var d,$,l=this;return d=P(b,"map",[],function o(a,k){return null==a&&(a=E),null==k&&(k=E),[(null==o.$$s?this:o.$$s).$coerce_to_int_range(a),k]},{$$s:l}),$=P(d,"sort_by",[],function(a,k){return null==a&&(a=E),null==k&&(k=E),a.$min()}),l.$assert_min_sum_is_covered($),l.$assert_max_sum_is_covered($),l.$assert_no_gap_or_overlap_in_ranges($),l.items=P($,"map",[],function(a,k){return null==a&&(a=E),null==k&&(k=E),y("Item").$new(a,k.$freeze()).$freeze()}).$freeze(),l}),q(h,"$coerce_to_int_range",function(b){var d;return M(y("Integer"),d=b)?y("Range").$new(b,b):M(y("Range"),d)&&R(b.$begin()["$is_a?"](y("Integer")))&&R(b.$end()["$is_a?"](y("Integer")))?b:this.$raise(y("TypeError"),this.name+": "+b+" ("+b.$class()+") must be an Integer or a Range with Integers ")}),q(h,"$assert_min_sum_is_covered",function(b){var d,l=this,$=E;return d=l.num_of_dice,$=b.$first()["$[]"](0),R($["$include?"](d))||l.$raise(y("RangeError"),l.name+": min value ("+d+") is not covered: "+$),l}),q(h,"$assert_max_sum_is_covered",function(b){var d,l=this,$=E;return d=C(l.num_of_dice,l.num_of_sides),$=b.$last()["$[]"](0),R($["$include?"](d))||l.$raise(y("RangeError"),l.name+": max value ("+d+") is not covered: "+$),l}),q(h,"$assert_no_gap_or_overlap_in_ranges",function(b){return P(b,"each_cons",[2],function d($,o){var m,t,a=null==d.$$s?this:d.$$s,k=E,H=E;return null==a.name&&(a.name=E),null==$&&($=E),null==o&&(o=E),k=$["$[]"](0),H=o["$[]"](0),m=k.$max(),t=F(m,1),R(H["$include?"](m))&&a.$raise(y("RangeError"),a.name+": Range overlap: "+k+" and "+H),R(H["$include?"](t))?E:a.$raise(y("RangeError"),a.name+": Range gap: "+k+" and "+H)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var F,N,f,h,S,y,w,T,Y,E,U=e.module,L=e.klass,c=e.send,P=e.def,I=e.rb_minus,q=e.return_ivar,M=[],R=e.nil,A=e.$$$;return F=M,N=E=[U(M[0],"BCDice")].concat(F),f=Y=[U(E[0],"DiceTable")].concat(N),h=T=[L(Y[0],null,"SaiFicSkillTable")].concat(f),y=[S=L(T[0],null,"Category")].concat(h),w=e.$r(y),P(S,"$initialize",function(b,l,d,$){var o=this;return o.name=b,o.skills=c(l.$map(),"with_index",[2],function(k,H){return null==k&&(k=R),null==H&&(H=R),A(w("SaiFicSkillTable"),"Skill").$new(b,k,d,H,$)}),o.dice=d}),P(S,"$roll",function(b){return this.$skills()["$[]"](I(b.$roll_sum(2,6),2))}),P(S,"$to_s",q("name")),S.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var R,j,Y,T,r,u,B,C,U=e.module,L=e.klass,c=e.def,P=e.hash2,I=[],q=e.nil;return R=I,j=C=[U(I[0],"BCDice")].concat(R),Y=B=[U(C[0],"DiceTable")].concat(j),u=[L(B[0],null,"SaiFicSkillTable")].concat(Y),(r=(T=L(u[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=q,c(T,"$initialize",function(h,S,y,w,p){var b=this;return b.category_name=h,b.name=S,b.category_dice=y,b.row_dice=w,b.s_format=p}),c(T,"$to_s",function(){var h=this;return h.$format(h.s_format,P(["category_dice","row_dice","category_name","skill_name"],{category_dice:h.category_dice,row_dice:h.row_dice,category_name:h.category_name,skill_name:h.name}))}),T.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var u,r,w,p,b,l,d,h,n,U=e.module,L=e.klass,c=e.ensure_kwargs,P=e.hash2,I=e.send,M=e.defs,R=e.const_set,A=e.to_ary,C=e.def,F=e.truthy,j=e.rb_minus,E=e.rb_plus,B=e.top,N=[],x=e.nil,Y=e.$$$;return B.$require("bcdice/dice_table/sai_fic_skill_table/category"),B.$require("bcdice/dice_table/sai_fic_skill_table/skill"),u=N,r=n=[U(N[0],"BCDice")].concat(u),w=h=[U(n[0],"DiceTable")].concat(r),b=[p=L(h[0],null,"SaiFicSkillTable")].concat(w),l=e.$r(b),(d=p.$$prototype).rtt=d.rtt_format=d.rct=d.rct_format=d.rttn=d.rttn_format=d.categories=x,M(p,"$from_i18n",function(o,a,k){var H,m,t,s,v=x;return null==(H=(k=c(k)).$$smap.rtt)&&(H=x),null==(m=k.$$smap.rct)&&(m=x),null==(t=k.$$smap.rttn)&&(t=x),s=(v=l("I18n").$t("RTT",P(["locale","raise","default"],{locale:a,raise:!1,default:P([],{})})).$merge(l("I18n").$t(o,P(["locale","raise"],{locale:a,raise:!0}))))["$[]"]("items"),v=I(v,"select",[],function(Q,V){return null==Q&&(Q=x),null==V&&(V=x),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](Q)}),this.$new(s,e.to_hash(v).$merge(P(["rtt","rct","rttn"],{rtt:H,rct:m,rttn:t})))},-3),R(b[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),R(b[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),R(b[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),R(b[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),C(p,"$initialize",function(o,a){var k,H,m,t,D,i,v,s=this;return null==(k=(a=c(a)).$$smap.rtt)&&(k=x),null==(H=a.$$smap.rct)&&(H=x),null==(m=a.$$smap.rttn)&&(m=x),null==(t=a.$$smap.rtt_format)&&(t=l("DEFAULT_RTT")),null==(D=a.$$smap.rct_format)&&(D=l("DEFAULT_RCT")),null==(i=a.$$smap.rttn_format)&&(i=l("DEFAULT_RTTN")),null==(v=a.$$smap.s_format)&&(v=l("DEFAULT_S")),s.categories=I(o.$map(),"with_index",[1],function(Q,V){var ie,_e,ne;return null==Q&&(Q=x),null==V&&(V=x),_e=null==(ie=A(Q))[0]?x:ie[0],ne=null==ie[1]?x:ie[1],Y(l("SaiFicSkillTable"),"Category").$new(_e,ne,V,v)},{$$has_top_level_mlhs_arg:!0}),s.rtt=k,s.rct=H,s.rttn=m.$to_a(),s.rtt_format=t,s.rct_format=D,s.rttn_format=i},-2),R(b[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),p.$attr_reader("categories"),C(p,"$roll_command",function(o,a){var H,k=this,m=x,t=x;return F(["RTT",k.rtt]["$include?"](H=a))?k.$format_skill(k.rtt_format,k.$roll_skill(o)):F(["RCT",k.rct]["$include?"](H))?(m=k.$roll_category(o),k.$format(k.rct_format,P(["category_dice","category_name"],{category_dice:m.$dice(),category_name:m.$name()}))):F(t=l("RTTN").$index(H))||F(t=k.rttn.$index(H))?k.$format_skill(k.rttn_format,k.categories["$[]"](t).$roll(o)):x}),C(p,"$roll_category",function(o){return this.categories["$[]"](j(o.$roll_once(6),1))}),C(p,"$roll_skill",function(o){return this.$roll_category(o).$roll(o)}),C(p,"$prefixes",function(){var o=this;return E(["RTT[1-6]?","RCT",o.rtt,o.rct],o.rttn).$compact()}),p.$private(),C(p,"$format_skill",function(o,a){return this.$format(o,P(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:a.$category_dice(),row_dice:a.$row_dice(),category_name:a.$category_name(),skill_name:a.$name(),text:a.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var F,N,f,n,T,r,_,Y,E,U=e.module,L=e.klass,c=e.hash2,P=e.defs,I=e.truthy,q=e.def,M=e.rb_minus,R=[],A=e.nil;return F=R,N=E=[U(R[0],"BCDice")].concat(F),f=Y=[U(E[0],"DiceTable")].concat(N),T=[n=L(Y[0],null,"Table")].concat(f),r=e.$r(T),(_=n.$$prototype).times=_.sides=_.name=_.items=A,P(n,"$from_i18n",function(S,y){var p=A;return p=r("I18n").$t(S,c(["locale"],{locale:y})),this.$new(p["$[]"]("name"),p["$[]"]("type"),p["$[]"]("items"))}),q(n,"$initialize",function(S,y,w){var p=this,b=A;return p.name=S,p.items=w.$freeze(),b=/(\d+)D(\d+)/i.$match(y),I(b)||p.$raise(r("ArgumentError"),"Unexpected table type: "+y),p.times=b["$[]"](1).$to_i(),p.sides=b["$[]"](2).$to_i()}),q(n,"$roll",function(S){var w,y=this;return w=S.$roll_sum(y.times,y.sides),y.$choice(w)}),q(n,"$choice",function(S){var w,y=this;return w=M(S,y.times),r("RollResult").$new(y.name,S,y.items["$[]"](w))})},Opal.modules["bcdice/dice_table"]=function(e){var U=e.top;return U.$require("bcdice/dice_table/roll_result"),U.$require("bcdice/dice_table/chain_table"),U.$require("bcdice/dice_table/d66_grid_table"),U.$require("bcdice/dice_table/d66_half_grid_table"),U.$require("bcdice/dice_table/d66_one_third_table"),U.$require("bcdice/dice_table/d66_left_range_table"),U.$require("bcdice/dice_table/d66_parity_table"),U.$require("bcdice/dice_table/d66_range_table"),U.$require("bcdice/dice_table/d66_table"),U.$require("bcdice/dice_table/range_table"),U.$require("bcdice/dice_table/sai_fic_skill_table"),U.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var q,C,j,R,U=e.module,L=e.const_set,c=[];return q=c,C=R=[U(c[0],"BCDice")].concat(q),j=[U(R[0],"D66SortType")].concat(C),L(j[0],"NO_SORT","no_sort"),L(j[0],"ASC","asc"),L(j[0],"DESC","desc"),function(A,C){var j=[U(A,"RoundType")].concat(C);return L(j[0],"CEIL","ceil"),L(j[0],"FLOOR","floor"),L(j[0],"ROUND","round")}(R[0],R)},Opal.modules["bcdice/translate"]=function(e){var C,B,N,x,Y,j,U=e.module,L=e.ensure_kwargs,c=e.kwrestargs,I=e.hash2,q=e.def,M=[],R=e.nil;return C=M,B=j=[U(M[0],"BCDice")].concat(C),x=[N=U(j[0],"Translate")].concat(B),Y=e.$r(x),q(N,"$translate",function(u,f){var n,T=this;return null==T.locale&&(T.locale=R),f=L(f),n=c(f,{}),Y("I18n").$translate(u,I(["locale","raise"],{locale:T.locale,raise:!0}).$merge(e.to_hash(n)))},-2)},Opal.modules["bcdice/result"]=function(e){var N,G,x,C,j,L=e.klass,c=e.send,P=e.def,I=e.return_val,q=e.return_ivar,M=[],R=e.nil;return C=M,N=j=[(0,e.module)(M[0],"BCDice")].concat(C),[x=L(j[0],null,"Result")].concat(N),P(G=e.get_singleton_class(x),"$success",function(n){return c(this.$new(),"tap",[],function(_){var h;return null==_&&(_=R),_["$text="](n),c(_,"success=",h=[!0]),h[h.length-1]})}),P(G,"$failure",function(n){return c(this.$new(),"tap",[],function(_){var h;return null==_&&(_=R),_["$text="](n),c(_,"failure=",h=[!0]),h[h.length-1]})}),P(G,"$critical",function(n){return c(this.$new(),"tap",[],function(_){var h;return null==_&&(_=R),_["$text="](n),_["$critical="](!0),c(_,"success=",h=[!0]),h[h.length-1]})}),P(G,"$fumble",function(n){return c(this.$new(),"tap",[],function(_){var h;return null==_&&(_=R),_["$text="](n),_["$fumble="](!0),c(_,"failure=",h=[!0]),h[h.length-1]})}),P(G,"$nothing",I("nothing")),P(x,"$initialize",function(u){var f=this;return null==u&&(u=R),f.text=u,f.rands=R,f.detailed_rands=R,f.secret=!1,f.success=!1,f.failure=!1,f.critical=!1,f.fumble=!1},-1),x.$attr_accessor("text","rands","detailed_rands"),x.$attr_writer("secret","success","failure","critical","fumble"),P(x,"$secret?",q("secret")),P(x,"$success?",q("success")),P(x,"$failure?",q("failure")),P(x,"$critical?",q("critical")),P(x,"$fumble?",q("fumble")),P(x,"$condition=",function(u){return this.success=u,this.failure=u["$!"]()})},Opal.modules["racc/parser"]=function(e){var S,w,p,U=e.module,L=e.klass,c=e.truthy,P=e.const_set,I=e.defs,q=e.gvars,M=e.rb_lt,R=e.def,A=e.to_ary,C=e.send,F=e.neqeq,j=e.rb_plus,E=e.eqeq,B=e.rb_ge,N=e.rb_gt,x=e.rb_minus,Y=e.rb_le,G=e.rb_times,u=e.assign_ivar_val,n=[],T=e.$r(n),r=e.nil,_=e.$$$;return S=n,w=[U(n[0],"Racc")].concat(S),p=e.$r(w),L(w[0],p("StandardError"),"ParseError"),c(_("::","ParseError","skip_raise")?"constant":r)||P(n[0],"ParseError",_(T("Racc"),"ParseError")),function(h,S){var $,o,a,k,H,p=[U(h,"Racc")].concat(S),b=e.$r(p);return c(b("Racc_No_Extensions","skip_raise")?"constant":r)||P(p[0],"Racc_No_Extensions",!1),$=p,a=[o=L(p[0],null,"Parser")].concat($),k=e.$r(a),(H=o.$$prototype).yydebug=H.racc_debug_out=H.racc_error_status=H.racc_t=H.racc_vstack=H.racc_val=H.racc_state=H.racc_tstack=r,P(a[0],"Racc_Runtime_Version","1.4.6"),P(a[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),P(a[0],"Racc_Runtime_Core_Version_R","1.4.6"),P(a[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),P(a[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),P(a[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),P(a[0],"Racc_Runtime_Core_Version",k("Racc_Runtime_Core_Version_R")),P(a[0],"Racc_Runtime_Core_Revision",k("Racc_Runtime_Core_Revision_R")),P(a[0],"Racc_Runtime_Type","ruby"),I(k("Parser"),"$racc_runtime_type",function(){return k("Racc_Runtime_Type")}),R(o,"$_racc_setup",function(){var t,D,i=this,v=r,s=r;return null==q.stderr&&(q.stderr=r),c(_(i.$class(),"Racc_debug_parser"))||(i.yydebug=!1),c(null!=(t=i.yydebug)&&t!==r?"instance-variable":r)||(i.yydebug=!1),c(i.yydebug)&&(c(null!=(D=i.racc_debug_out)&&D!==r?"instance-variable":r)||(i.racc_debug_out=q.stderr),i.racc_debug_out=c(v=i.racc_debug_out)?v:q.stderr),s=_(i.$class(),"Racc_arg"),c(M(s.$size(),14))&&s["$[]="](13,!0),s}),R(o,"$_racc_init_sysvars",function(){var t=this;return t.racc_state=[0],t.racc_tstack=[],t.racc_vstack=[],t.racc_t=r,t.racc_val=r,t.racc_read_next=!0,t.racc_user_yyerror=!1,t.racc_error_status=0}),R(o,"$do_parse",function(){return this.$__send__(k("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),R(o,"$next_token",function(){return this.$raise(k("NotImplementedError"),this.$class()+"#next_token is not defined")}),R(o,"$_racc_do_parse_rb",function(t,D){var i,s=this,W=r,Q=r,V=r,ie=r,_e=r,ne=r,ue=r,ae=r;return i=A(t),W=null==i[0]?r:i[0],Q=null==i[1]?r:i[1],V=null==i[2]?r:i[2],ie=null==i[3]?r:i[3],_e=null==i[10]?r:i[10],s.$_racc_init_sysvars(),ne=ue=ae=r,C(s,"catch",["racc_end_parse"],function re(){var se,K,g=null==re.$$s?this:re.$$s,Z=r;for(null==g.racc_state&&(g.racc_state=r),null==g.racc_read_next&&(g.racc_read_next=r),null==g.racc_t&&(g.racc_t=r),null==g.yydebug&&(g.yydebug=r),null==g.racc_val&&(g.racc_val=r);c(!0);)for(c(ae=ie["$[]"](g.racc_state["$[]"](-1)))?(c(g.racc_read_next)&&F(g.racc_t,0)&&(K=g.$next_token(),se=A(K),ne=null==se[0]?r:se[0],g.racc_val=null==se[1]?r:se[1],g.racc_t=c(ne)?c(Z=_e["$[]"](ne))?Z:1:0,c(g.yydebug)&&g.$racc_read_token(g.racc_t,ne,g.racc_val),g.racc_read_next=!1),ae=j(ae,g.racc_t),c(B(ae,0))&&c(ue=W["$[]"](ae))&&E(Q["$[]"](ae),g.racc_state["$[]"](-1))||(ue=V["$[]"](g.racc_state["$[]"](-1)))):ue=V["$[]"](g.racc_state["$[]"](-1));c(ue=g.$_racc_evalact(ue,t)););},{$$s:s})}),R(o,"$yyparse",function(t,D){return this.$__send__(k("Racc_YY_Parse_Method"),t,D,this.$_racc_setup(),!0)}),R(o,"$_racc_yyparse_rb",function(t,D,i,v){var s,Q=this,V=r,ie=r,$e=r,_e=r,ue=r,ae=r,re=r;return s=A(i),V=null==s[0]?r:s[0],ie=null==s[1]?r:s[1],$e=null==s[2]?r:s[2],_e=null==s[3]?r:s[3],ue=null==s[10]?r:s[10],Q.$_racc_init_sysvars(),ae=r,re=r,C(Q,"catch",["racc_end_parse"],function se(){var K=null==se.$$s?this:se.$$s;for(null==K.racc_state&&(K.racc_state=r);!c(re=_e["$[]"](K.racc_state["$[]"](-1)));)for(;c(ae=K.$_racc_evalact($e["$[]"](K.racc_state["$[]"](-1)),i)););return C(t,"__send__",[D],function g(Z,X){var z=null==g.$$s?this:g.$$s,O=r,te=r;for(null==z.racc_t&&(z.racc_t=r),null==z.racc_state&&(z.racc_state=r),null==z.racc_read_next&&(z.racc_read_next=r),null==Z&&(Z=r),null==X&&(X=r),z.racc_t=c(Z)?c(O=ue["$[]"](Z))?O:1:0,z.racc_val=X,z.racc_read_next=!1,re=j(re,z.racc_t),c(B(re,0))&&c(ae=V["$[]"](re))&&E(ie["$[]"](re),z.racc_state["$[]"](-1))||(ae=$e["$[]"](z.racc_state["$[]"](-1)));c(ae=z.$_racc_evalact(ae,i)););for(;c(c(O=c(te=(re=_e["$[]"](z.racc_state["$[]"](-1)))["$!"]())?te:z.racc_read_next["$!"]())?O:z.racc_t["$=="](0));)for(c(re)&&c(re=j(re,z.racc_t))&&c(B(re,0))&&c(ae=V["$[]"](re))&&E(ie["$[]"](re),z.racc_state["$[]"](-1))||(ae=$e["$[]"](z.racc_state["$[]"](-1)));c(ae=z.$_racc_evalact(ae,i)););},{$$s:K})},{$$s:Q})}),R(o,"$_racc_evalact",function(t,D){var i,$e,s=this,W=r,Q=r,ie=r,_e=r,ne=r,ue=r;if(W=null==(i=A(D))[0]?r:i[0],Q=null==i[1]?r:i[1],ie=null==i[3]?r:i[3],$e=null==i[11]?r:i[11],_e=null==i[12]?r:i[12],c(N(t,0))&&c(M(t,$e)))c(N(s.racc_error_status,0))&&(E(s.racc_t,1)||(s.racc_error_status=x(s.racc_error_status,1))),s.racc_vstack.$push(s.racc_val),s.racc_state.$push(t),s.racc_read_next=!0,c(s.yydebug)&&(s.racc_tstack.$push(s.racc_t),s.$racc_shift(s.racc_t,s.racc_tstack,s.racc_vstack));else if(c(M(t,0))&&c(N(t,_e["$-@"]()))){if(ne=C(s,"catch",["racc_jump"],function ae(){var re=null==ae.$$s?this:ae.$$s;return null==re.racc_state&&(re.racc_state=r),re.racc_state.$push(re.$_racc_do_reduce(D,t)),!1},{$$s:s}),c(ne))switch(ne.valueOf()){case 1:return s.racc_user_yyerror=!0,_e["$-@"]();case 2:return $e;default:s.$raise("[Racc Bug] unknown jump code")}}else if(E(t,$e))c(s.yydebug)&&s.$racc_accept(),s.$throw("racc_end_parse",s.racc_vstack["$[]"](0));else{if(E(t,_e["$-@"]())){switch(s.racc_error_status.valueOf()){case 0:c(D["$[]"](21))||s.$on_error(s.racc_t,s.racc_val,s.racc_vstack);break;case 3:E(s.racc_t,0)&&s.$throw("racc_end_parse",r),s.racc_read_next=!0}for(s.racc_user_yyerror=!1,s.racc_error_status=3;c(!0)&&!(c(ue=ie["$[]"](s.racc_state["$[]"](-1)))&&(ue=j(ue,1),c(B(ue,0))&&c(t=W["$[]"](ue))&&E(Q["$[]"](ue),s.racc_state["$[]"](-1))));)c(Y(s.racc_state.$size(),1))&&s.$throw("racc_end_parse",r),s.racc_state.$pop(),s.racc_vstack.$pop(),c(s.yydebug)&&(s.racc_tstack.$pop(),s.$racc_e_pop(s.racc_state,s.racc_tstack,s.racc_vstack));return t}s.$raise("[Racc Bug] unknown action "+t.$inspect())}return c(s.yydebug)&&s.$racc_next_state(s.racc_state["$[]"](-1),s.racc_state),r}),R(o,"$_racc_do_reduce",function(t,D){var i,_e,ue,Z,X,z,ee,s=this,Q=r,V=r,ie=r,$e=r,ne=r,ae=r,re=r,se=r,K=r,g=r,O=r,te=r,J=r;return Q=null==(i=A(t))[4]?r:i[4],V=null==i[5]?r:i[5],ie=null==i[6]?r:i[6],$e=null==i[7]?r:i[7],_e=null==i[8]?r:i[8],ne=null==i[9]?r:i[9],ue=null==i[13]?r:i[13],ae=s.racc_state,re=s.racc_vstack,se=s.racc_tstack,K=G(D,-3),g=ne["$[]"](K),Z=ne["$[]"](j(K,1)),X=ne["$[]"](j(K,2)),z=[],c(s.yydebug)&&(O=se["$[]"](g["$-@"](),g)),te=re["$[]"](g["$-@"](),g),c(s.yydebug)&&se["$[]="](g["$-@"](),g,z),re["$[]="](g["$-@"](),g,z),ae["$[]="](g["$-@"](),g,z),c(ue)?re.$push(s.$__send__(X,te,re,te["$[]"](0))):re.$push(s.$__send__(X,te,re)),se.$push(Z),c(s.yydebug)&&s.$racc_reduce(O,Z,se,re),ee=x(Z,_e),c(K=$e["$[]"](ee))&&(K=j(K,ae["$[]"](-1)),c(B(K,0))&&c(J=Q["$[]"](K))&&E(V["$[]"](K),ee))?J:ie["$[]"](ee)}),R(o,"$on_error",function(t,D,i){var s,v=this;return v.$raise(k("ParseError"),v.$sprintf("\nparse error on value %s (%s)",D.$inspect(),c(s=v.$token_to_str(t))?s:"?"))}),R(o,"$yyerror",function(){return this.$throw("racc_jump",1)}),R(o,"$yyaccept",function(){return this.$throw("racc_jump",2)}),R(o,"$yyerrok",u("racc_error_status",0)),R(o,"$racc_read_token",function(t,D,i){var v=this;return v.racc_debug_out.$print("read    "),v.racc_debug_out.$print(D.$inspect(),"(",v.$racc_token2str(t),") "),v.racc_debug_out.$puts(i.$inspect()),v.racc_debug_out.$puts()}),R(o,"$racc_shift",function(t,D,i){var v=this;return v.racc_debug_out.$puts("shift   "+v.$racc_token2str(t)),v.$racc_print_stacks(D,i),v.racc_debug_out.$puts()}),R(o,"$racc_reduce",function(t,D,i,v){var s=this,W=r;return(W=s.racc_debug_out).$print("reduce "),c(t["$empty?"]())?W.$print(" <none>"):C(t,"each",[],function Q(V){return null==V&&(V=r),W.$print(" ",(null==Q.$$s?this:Q.$$s).$racc_token2str(V))},{$$s:s}),W.$puts(" --\x3e "+s.$racc_token2str(D)),s.$racc_print_stacks(i,v),s.racc_debug_out.$puts()}),R(o,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),R(o,"$racc_e_pop",function(t,D,i){var v=this;return v.racc_debug_out.$puts("error recovering mode: pop token"),v.$racc_print_states(t),v.$racc_print_stacks(D,i),v.racc_debug_out.$puts()}),R(o,"$racc_next_state",function(t,D){var i=this;return i.racc_debug_out.$puts("goto    "+t),i.$racc_print_states(D),i.racc_debug_out.$puts()}),R(o,"$racc_print_stacks",function(t,D){var v=r;return(v=this.racc_debug_out).$print("        ["),C(t,"each_index",[],function s(W){return null==W&&(W=r),v.$print(" (",(null==s.$$s?this:s.$$s).$racc_token2str(t["$[]"](W))," ",D["$[]"](W).$inspect(),")")},{$$s:this}),v.$puts(" ]")}),R(o,"$racc_print_states",function(t){var i=r;return(i=this.racc_debug_out).$print("        ["),C(t,"each",[],function(s){return null==s&&(s=r),i.$print(" ",s)}),i.$puts(" ]")}),R(o,"$racc_token2str",function(t){var i;return c(i=_(this.$class(),"Racc_token_to_s_table")["$[]"](t))?i:this.$raise("[Racc Bug] can't convert token "+t+" to string")}),R(o,"$token_to_str",function(t){return _(this.$class(),"Racc_token_to_s_table")["$[]"](t)})}(n[0],n)},Opal.modules["bcdice/arithmetic/node"]=function(e){var u,r,y,$,o,p,b,h,n,U=e.module,L=e.klass,c=e.def,P=e.thrower,I=e.return_ivar,q=e.send2,M=e.find_super,R=e.eqeq,A=e.const_set,C=e.eqeqeq,F=e.rb_divide,j=e.truthy,E=e.assign_ivar,B=e.alias,N=[],x=e.nil,Y=e.$$$;return u=N,r=n=[U(N[0],"BCDice")].concat(u),y=h=[U(n[0],"Arithmetic")].concat(r),p=[U(h[0],"Node")].concat(y),b=e.$r(p),(o=($=L(p[0],null,"BinaryOp")).$$prototype).lhs=o.rhs=o.op=x,c($,"$initialize",function(k,H,m){var t=this;return t.lhs=k,t.op=H,t.rhs=m}),c($,"$eval",function(k){try{P("eval_return");var D,m=this,t=x;return t=m.lhs.$eval(k),D=m.rhs.$eval(k),t.$send(m.op,D)}catch(i){if(i===e.t_eval_return)return i.$v;throw i}}),c($,"$output",function(){var k=this;return""+k.lhs.$output()+k.op+k.rhs.$output()}),c($,"$s_exp",function(){var k=this;return"("+k.$op_for_s_exp()+" "+k.lhs.$s_exp()+" "+k.rhs.$s_exp()+")"}),c($,"$op_for_s_exp",I("op")),function(l,d,$){var o=L(l,d,"DivideBase"),a=[o].concat($),k=e.$r(a),H=o.$$prototype;H.lhs=H.rhs=H.op=x,c(o,"$initialize",function m(t,D){return m.$$p=null,q(this,M(this,"initialize",m,!1,!0),"initialize",[t,"/",D],null)}),c(o,"$eval",function(t){try{P("eval_return");var v,s,i=this;return v=i.lhs.$eval(t),s=i.rhs.$eval(t),R(s,0)&&i.$raise(k("ZeroDivisionError")),i.$divide_and_round(v,s,t)}catch(W){if(W===e.t_eval_return)return W.$v;throw W}}),c(o,"$output",function m(){var t=m.$$p||x,D=this;return m.$$p=null,""+q(D,M(D,"output",m,!1,!0),"output",[],t)+D.$rounding_method()}),o.$private(),c(o,"$rounding_method",function(){return Y(this.$class(),"ROUNDING_METHOD")}),c(o,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),c(o,"$divide_and_round",function(t,D,i){return this.$raise(k("NotImplementedError"))})}(p[0],b("BinaryOp"),p),function(l,d,$){var o=L(l,d,"DivideWithGameSystemDefault"),a=[o].concat($),k=e.$r(a);A(a[0],"ROUNDING_METHOD",""),o.$private(),c(o,"$divide_and_round",function(m,t,D){var i,v=x;return C(Y(k("RoundType"),"CEIL"),i=D)?F(m.$to_f(),t).$ceil():C(Y(k("RoundType"),"ROUND"),i)?(v=F(m.$to_f(),t),j(v["$negative?"]())?v.$abs().$round()["$-@"]():v.$round()):F(m,t).$floor()})}(p[0],b("DivideBase"),p),function(l,d,$){var o=L(l,d,"DivideWithCeil"),a=[o].concat($);A(a[0],"ROUNDING_METHOD","C"),o.$private(),c(o,"$divide_and_round",function(H,m,t){return F(H.$to_f(),m).$ceil()})}(p[0],b("DivideBase"),p),function(l,d,$){var o=L(l,d,"DivideWithRound"),a=[o].concat($);A(a[0],"ROUNDING_METHOD","R"),o.$private(),c(o,"$divide_and_round",function(H,m,t){var D=x;return D=F(H.$to_f(),m),j(D["$negative?"]())?D.$abs().$round()["$-@"]():D.$round()})}(p[0],b("DivideBase"),p),function(l,d,$){var o=L(l,d,"DivideWithFloor"),a=[o].concat($);A(a[0],"ROUNDING_METHOD","F"),o.$private(),c(o,"$divide_and_round",function(H,m,t){return F(H,m).$floor()})}(p[0],b("DivideBase"),p),function(l,d){var $=L(l,null,"Negative");$.$$prototype.body=x,c($,"$initialize",E("body")),c($,"$eval",function(k){try{return P("eval_return"),this.body.$eval(k)["$-@"]()}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c($,"$output",function(){return"-"+this.body.$output()}),c($,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(p[0]),function(l,d){var $=L(l,null,"Parenthesis");$.$$prototype.expr=x,c($,"$initialize",E("expr")),c($,"$eval",function(k){try{return P("eval_return"),this.expr.$eval(k)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c($,"$output",function(){return"("+this.expr.$output()+")"}),c($,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(p[0]),function(l,d){var $=L(l,null,"Number");return $.$$prototype.value=x,c($,"$initialize",E("value")),c($,"$eval",I("value")),c($,"$output",function(){return this.value.$to_s()}),B($,"s_exp","output")}(p[0])},Opal.modules.strscan=function(e){var E,B,N,x,Y,L=e.def,c=e.truthy,P=e.eqeqeq,I=e.Opal,q=e.return_ivar,M=e.send,R=e.alias,A=[],C=e.nil;return E=A,N=[B=(0,e.klass)(A[0],null,"StringScanner")].concat(E),x=e.$r(N),(Y=B.$$prototype).pos=Y.string=Y.working=Y.matched=Y.prev_pos=Y.match=C,B.$attr_reader("pos","matched"),L(B,"$initialize",function(u){var f=this;return f.string=u,f.pos=0,f.matched=C,f.working=u,f.match=[]}),B.$attr_reader("string"),L(B,"$beginning_of_line?",function(){var u=this;return 0===u.pos||"\n"===u.string.charAt(u.pos-1)}),L(B,"$scan",function(u){var f=this,n=(u=f.$anchor(u)).exec(f.working);return null==n?f.matched=C:(f.prev_pos=f.pos,f.pos+=n[0].length,f.working=f.working.substring(n[0].length),f.matched=n[0],f.match=n,n[0])}),L(B,"$scan_until",function(u){var f=this;u=f.$anchor(u);for(var n=f.working,T=0;n.length!=T;++T){var r=u.exec(n.substr(T));if(null!==r){var _=T+r[0].length,h=n.substr(0,_);return f.matched=r[0],f.match=r,f.prev_pos=f.pos+T,f.pos+=_,f.working=n.substr(_),h}}return f.matched=C}),L(B,"$[]",function(u){var n;if(c(this.match["$empty?"]()))return C;P(x("Symbol"),n=u)?u=u.$to_s():P(x("String"),n)||(u=I["$coerce_to!"](u,x("Integer"),"to_int"));var T=this.match;return u<0&&(u+=T.length),u<0||u>=T.length||null==T[u]?C:T[u]}),L(B,"$check",function(u){var f=this,n=(u=f.$anchor(u)).exec(f.working);return f.matched=null==n?C:n[0]}),L(B,"$check_until",function(u){var f=this,n=f.prev_pos,T=f.pos,r=f.working,_=f.$scan_until(u);return f.prev_pos=n,f.pos=T,f.working=r,_}),L(B,"$peek",function(u){return this.working.substring(0,u)}),L(B,"$eos?",function(){return 0===this.working.length}),L(B,"$exist?",function(u){var n=u.exec(this.working);return null==n?C:0==n.index?0:n.index+1}),L(B,"$skip",function(u){var f=this,n=(u=f.$anchor(u)).exec(f.working);if(null==n)return f.match=[],f.matched=C;var T=n[0],r=T.length;return f.matched=T,f.match=n,f.prev_pos=f.pos,f.pos+=r,f.working=f.working.substring(r),r}),L(B,"$skip_until",function(u){var n=this.$scan_until(u);return n===C?C:(this.matched=n.substr(-1),n.length)}),L(B,"$get_byte",function(){var u=this,f=C;return u.pos<u.string.length?(u.prev_pos=u.pos,u.pos+=1,f=u.matched=u.working.substring(0,1),u.working=u.working.substring(1)):u.matched=C,f}),L(B,"$match?",function(u){var f=this,n=(u=f.$anchor(u)).exec(f.working);return null==n?C:(f.prev_pos=f.pos,n[0].length)}),L(B,"$pos=",function(u){var f=this;return u<0&&(u+=f.string.$length()),f.pos=u,f.working=f.string.slice(u)}),L(B,"$matched_size",function(){return this.matched===C?C:this.matched.length}),L(B,"$post_match",function(){var u=this;return u.matched===C?C:u.string.substr(u.pos)}),L(B,"$pre_match",function(){var u=this;return u.matched===C?C:u.string.substr(0,u.prev_pos)}),L(B,"$reset",function(){var u=this;return u.working=u.string,u.matched=C,u.pos=0}),L(B,"$rest",q("working")),L(B,"$rest?",function(){return 0!==this.working.length}),L(B,"$rest_size",function(){return this.$rest().$size()}),L(B,"$terminate",function(){var u,f=this;return f.match=C,u=[f.string.$length()],M(f,"pos=",u),u[u.length-1]}),L(B,"$unscan",function(){var u=this;return u.pos=u.prev_pos,u.prev_pos=C,u.match=C,u}),R(B,"bol?","beginning_of_line?"),R(B,"getch","get_byte"),B.$private(),L(B,"$anchor",function(u){var f=u.toString().match(/\/([^\/]+)$/);return f=f?f[1]:void 0,new RegExp("^(?:"+u.source+")",f)})},Opal.modules["bcdice/normalize"]=function(e){var R,j,C,U=e.module,L=e.eqeqeq,c=e.def,P=e.eqeq,I=[],q=e.nil;return R=I,C=[U(I[0],"BCDice")].concat(R),(j=U(C[0],"Normalize")).$module_function(),c(j,"$comparison_operator",function(B){var N;return L(/<=|=</,N=B)?"<=":L(/>=|=>/,N)?">=":L(/<>|!=|=!/,N)?"!=":L(/</,N)?"<":L(/>/,N)?">":L(/=/,N)?"==":q}),c(j,"$target_number",function(B){return P(B,"?")?B:B.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var E,Y,T,r,_,h,S,u,N,U=e.module,L=e.klass,c=e.const_set,P=e.hash2,I=e.truthy,q=e.send,M=e.def,R=e.thrower,A=e.top,C=[],F=e.nil;return A.$require("strscan"),A.$require("bcdice/normalize"),E=C,Y=N=[U(C[0],"BCDice")].concat(E),T=u=[U(N[0],"Command")].concat(Y),_=[r=L(u[0],null,"Lexer")].concat(T),h=e.$r(_),(S=r.$$prototype).scanner=S.notations=F,c(_[0],"SYMBOLS",P(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),M(r,"$initialize",function(w,p){var b,l,$;return w=I($=(b=(l=w)===F||null==l?F:l.$split(" ",2))===F||null==b?F:b.$first())?$:"",this.scanner=h("StringScanner").$new(w),this.notations=q(p,"map",[],function(a){return null==a&&(a=F),I(a["$is_a?"](h("String")))?h("Regexp").$new(a):a})}),M(r,"$next_token",function(){try{var w=R("return"),p=this,b=F,l=F,$=F,o=F;return I(p.scanner["$eos?"]())?[!1,"$"]:(q(p.notations,"each",[],function a(k){var m,H=null==a.$$s?this:a.$$s;if(null==H.scanner&&(H.scanner=F),null==k&&(k=F),m=H.scanner.$scan(k),!I(m))return F;w.$throw(["NOTATION",m])},{$$s:p,$$ret:w}),I(b=p.scanner.$scan(/\d+/))?["NUMBER",b.$to_i()]:I(l=p.scanner.$scan(/[<>!=]+/))?(l=h("Normalize").$comparison_operator(l),[I(l)?"CMP_OP":"ILLEGAL",l]):($=p.scanner.$getch().$upcase(),[I(o=h("SYMBOLS")["$[]"]($))?o:$.$to_sym(),$]))}catch(a){if(a===w)return a.$v;throw a}}),M(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var A,E,G,u,f,n,T,N,F,U=e.module,L=e.klass,c=e.def,P=e.return_ivar,I=e.truthy,q=[],M=e.nil;return A=q,E=F=[U(q[0],"BCDice")].concat(A),G=N=[U(F[0],"Command")].concat(E),f=[u=L(N[0],null,"Parsed")].concat(G),n=e.$r(f),(T=u.$$prototype).critical=T.fumble=T.dollar=T.modify_number=T.question_target=T.target_number=T.prefix_number=T.command=T.suffix_number=T.cmp_op=M,u.$attr_accessor("command"),u.$attr_accessor("prefix_number"),u.$attr_accessor("suffix_number"),u.$attr_accessor("critical"),u.$attr_accessor("fumble"),u.$attr_accessor("dollar"),u.$attr_accessor("modify_number"),u.$attr_accessor("cmp_op"),u.$attr_accessor("target_number"),u.$attr_writer("question_target"),c(u,"$initialize",function(){var _=this;return _.prefix_number=M,_.suffix_number=M,_.critical=M,_.fumble=M,_.dollar=M,_.cmp_op=M,_.target_number=M,_.question_target=!1}),c(u,"$question_target?",P("question_target")),c(u,"$to_s",function(_){var h=this,S=M,y=M,w=M,p=M,b=M;switch(null==_&&(_="after_command"),S=I(h.critical)?"@"+h.critical:M,y=I(h.fumble)?"#"+h.fumble:M,w=I(h.dollar)?"$"+h.dollar:M,p=n("Format").$modifier(h.modify_number),b=I(h.question_target)?"?":h.target_number,_.valueOf()){case"after_command":return[h.prefix_number,h.command,h.suffix_number,S,y,w,p,h.cmp_op,b].$join();case"after_modify_number":return[h.prefix_number,h.command,h.suffix_number,p,S,y,w,h.cmp_op,b].$join();case"after_target_number":return[h.prefix_number,h.command,h.suffix_number,p,h.cmp_op,b,S,y,w].$join();default:return M}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var _,w,o,D,i,v,s,W,Q,V,ie,$e,ue,a,m,t,se,b,l,S,U=e.klass,L=e.module,c=e.slice,P=e.extract_kwargs,I=e.ensure_kwargs,q=e.get_kwarg,M=e.send2,R=e.find_super,A=e.def,C=e.send,F=e.eqeq,j=e.thrower,E=e.hash,B=e.const_set,N=e.truthy,x=e.to_ary,Y=e.hash2,G=e.top,u=[],f=e.$r(u),n=e.nil,T=e.$$$;return G.$require("racc/parser.rb"),G.$require("bcdice/arithmetic/node"),G.$require("bcdice/command/lexer"),G.$require("bcdice/command/parsed"),U(T(f("BCDice"),"Command"),T(f("Racc"),"Parser"),"Parser"),_=u,w=S=[L(u[0],"BCDice")].concat(_),b=[L(S[0],"Command")].concat(w),l=e.$r(b),o=b,m=[a=U(b[0],T(l("Racc"),"Parser"),"Parser")].concat(o),t=e.$r(m),(se=a.$$prototype).notations=se.lexer=se.modifier=se.suffix_number=se.prefix_number=se.need_suffix_number=se.need_prefix_number=se.critical=se.fumble=se.dollar=se.allowed_cmp_op=se.question_target=n,A(a,"$initialize",function K(g,Z){var X,z,O,te,J=this;return K.$$p=null,X=c(arguments),z=P(X),z=I(z),O=X,te=q(z,"round_type"),M(J,R(J,"initialize",K,!1,!0),"initialize",[],null),J.notations=O,J.round_type=te,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[n,">=",">","<=","<","==","!="],J.question_target=!1},-2),A(a,"$disable_modifier",function(){return this.modifier=!1,this}),A(a,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),A(a,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),A(a,"$has_prefix_number",function(){var g=this;return g.prefix_number=!0,g.need_prefix_number=!0,g}),A(a,"$has_suffix_number",function(){var g=this;return g.suffix_number=!0,g.need_suffix_number=!0,g}),A(a,"$enable_critical",function(){return this.critical=!0,this}),A(a,"$enable_fumble",function(){return this.fumble=!0,this}),A(a,"$enable_dollar",function(){return this.dollar=!0,this}),A(a,"$restrict_cmp_op_to",function(g){var Z;return Z=c(arguments),this.allowed_cmp_op=Z,this},-1),A(a,"$enable_question_target",function(){return this.question_target=!0,this}),A(a,"$parse",function(g){var Z=this;try{return Z.lexer=t("Lexer").$new(g,Z.notations),Z.$do_parse()}catch(X){if(!e.rescue(X,[t("ParseError"),t("ZeroDivisionError")]))throw X;try{return n}finally{e.pop_exception()}}}),a.$private(),A(a,"$parsed",function(g,Z,X,z){try{return j("eval_return"),C(t("Parsed").$new(),"tap",[],function ee(J){var ce,le,de,ve,me,fe,he,oe=null==ee.$$s?this:ee.$$s;return null==oe.round_type&&(oe.round_type=n),null==J&&(J=n),J["$command="](g["$[]"]("command")),J["$prefix_number="]((ce=g["$[]"]("prefix"))===n||null==ce?n:ce.$eval(oe.round_type)),J["$suffix_number="]((le=g["$[]"]("suffix"))===n||null==le?n:le.$eval(oe.round_type)),J["$critical="]((de=Z["$[]"]("critical"))===n||null==de?n:de.$eval(oe.round_type)),J["$fumble="]((ve=Z["$[]"]("fumble"))===n||null==ve?n:ve.$eval(oe.round_type)),J["$dollar="]((me=Z["$[]"]("dollar"))===n||null==me?n:me.$eval(oe.round_type)),J["$modify_number="](X.$eval(oe.round_type)),J["$cmp_op="](z["$[]"]("cmp_op")),F(z["$[]"]("target"),"?")?(J["$question_target="](!0),C(J,"target_number=",fe=[0]),fe[fe.length-1]):(J["$question_target="](!1),fe=[(he=z["$[]"]("target"),he===n||null==he?n:he.$eval(oe.round_type))],C(J,"target_number=",fe),fe[fe.length-1])},{$$s:this})}catch(ee){if(ee===e.t_eval_return)return ee.$v;throw ee}}),A(a,"$next_token",function(){return this.lexer.$next_token()}),D=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),i=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),v=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),s=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),W=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),Q=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),V=[n,6,13,3,9,-1,27,-15,-10,-1,-38],ie=[n,n,n,n,n,n,19,16,15,n,n],$e=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ue=E(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),B(m[0],"Racc_arg",[D,i,s,v,W,Q,ie,V,19,$e,ue,58,35,!0]),N(t("Ractor","skip_raise")?"constant":n)&&t("Ractor").$make_shareable(t("Racc_arg")),B(m[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),N(t("Ractor","skip_raise")?"constant":n)&&t("Ractor").$make_shareable(t("Racc_token_to_s_table")),B(m[0],"Racc_debug_parser",!1),A(a,"$_reduce_1",function(g,Z,X){var z;return N(this.modifier)||this.$raise(t("ParseError")),z=x(g),this.$parsed(null==z[0]?n:z[0],null==z[1]?n:z[1],null==z[2]?n:z[2],null==z[3]?n:z[3])}),A(a,"$_reduce_2",function(g,Z,X){var z;return N(this.modifier)||this.$raise(t("ParseError")),z=x(g),this.$parsed(null==z[0]?n:z[0],null==z[2]?n:z[2],null==z[1]?n:z[1],null==z[3]?n:z[3])}),A(a,"$_reduce_3",function(g,Z,X){var z,ce;return ce=null==(z=x(g))[2]?n:z[2],this.$parsed(null==z[0]?n:z[0],null==z[1]?n:z[1],T(T(t("Arithmetic"),"Node"),"Number").$new(0),ce)}),A(a,"$_reduce_4",function(g,Z,X){var z=this;return N(z.prefix_number)&&N(z.suffix_number)||z.$raise(t("ParseError")),Y(["command","prefix","suffix"],{command:g["$[]"](1),prefix:g["$[]"](0),suffix:g["$[]"](2)})}),A(a,"$_reduce_5",function(g,Z,X){var z=this;return N(z.prefix_number)||z.$raise(t("ParseError")),N(z.need_suffix_number)&&z.$raise(t("ParseError")),Y(["command","prefix"],{command:g["$[]"](1),prefix:g["$[]"](0)})}),A(a,"$_reduce_6",function(g,Z,X){var z=this;return N(z.suffix_number)||z.$raise(t("ParseError")),N(z.need_prefix_number)&&z.$raise(t("ParseError")),Y(["command","suffix"],{command:g["$[]"](0),suffix:g["$[]"](1)})}),A(a,"$_reduce_7",function(g,Z,X){var z=this;return(N(z.need_prefix_number)||N(z.need_suffix_number))&&z.$raise(t("ParseError")),Y(["command"],{command:g["$[]"](0)})}),A(a,"$_reduce_8",function(g,Z,X){return Y([],{})}),A(a,"$_reduce_9",function(g,Z,X){var z,ce,ee=n;return ee=null==(z=x(g))[0]?n:z[0],ce=null==z[2]?n:z[2],N(this.critical)&&N(ee["$[]"]("critical")["$nil?"]())||this.$raise(t("ParseError")),ee["$[]="]("critical",ce),ee}),A(a,"$_reduce_10",function(g,Z,X){var z,ce,ee=n;return ee=null==(z=x(g))[0]?n:z[0],ce=null==z[2]?n:z[2],N(this.fumble)&&N(ee["$[]"]("fumble")["$nil?"]())||this.$raise(t("ParseError")),ee["$[]="]("fumble",ce),ee}),A(a,"$_reduce_11",function(g,Z,X){var z,ce,ee=n;return ee=null==(z=x(g))[0]?n:z[0],ce=null==z[2]?n:z[2],N(this.dollar)&&N(ee["$[]"]("dollar")["$nil?"]())||this.$raise(t("ParseError")),ee["$[]="]("dollar",ce),ee}),A(a,"$_reduce_12",function(g,Z,X){return g["$[]"](1)}),A(a,"$_reduce_13",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"Negative").$new(g["$[]"](1))}),A(a,"$_reduce_14",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"+",g["$[]"](2))}),A(a,"$_reduce_15",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"-",g["$[]"](2))}),A(a,"$_reduce_16",function(g,Z,X){return N(this.allowed_cmp_op["$include?"](n))||this.$raise(t("ParseError")),Y([],{})}),A(a,"$_reduce_17",function(g,Z,X){var z,ee,J;return J=null==(z=x(g))[1]?n:z[1],N(this.allowed_cmp_op["$include?"](ee=null==z[0]?n:z[0]))||this.$raise(t("ParseError")),Y(["cmp_op","target"],{cmp_op:ee,target:J})}),A(a,"$_reduce_18",function(g,Z,X){var O,z=this;return O=g["$[]"](0),N(z.question_target)||z.$raise(t("ParseError")),N(z.allowed_cmp_op["$include?"](O))||z.$raise(t("ParseError")),Y(["cmp_op","target"],{cmp_op:O,target:"?"})}),A(a,"$_reduce_19",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"+",g["$[]"](2))}),A(a,"$_reduce_20",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"-",g["$[]"](2))}),A(a,"$_reduce_22",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"*",g["$[]"](2))}),A(a,"$_reduce_23",function(g,Z,X){return g["$[]"](3).$new(g["$[]"](0),g["$[]"](2))}),A(a,"$_reduce_25",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),A(a,"$_reduce_26",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"DivideWithCeil")}),A(a,"$_reduce_27",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"DivideWithCeil")}),A(a,"$_reduce_28",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"DivideWithRound")}),A(a,"$_reduce_29",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"DivideWithFloor")}),A(a,"$_reduce_30",function(g,Z,X){return g["$[]"](1)}),A(a,"$_reduce_31",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"Negative").$new(g["$[]"](1))}),A(a,"$_reduce_33",function(g,Z,X){return g["$[]"](1)}),A(a,"$_reduce_34",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"Number").$new(g["$[]"](0))}),A(a,"$_reduce_none",function(g,Z,X){return g["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var C,B,G,u,f,n,x,j,U=e.module,L=e.send,c=e.eqeqeq,P=e.truthy,I=e.def,q=e.return_val,M=[],R=e.nil;return C=M,B=j=[U(M[0],"BCDice")].concat(C),G=x=[U(j[0],"Deprecated")].concat(B),f=[u=U(x[0],"Checker")].concat(G),n=e.$r(f),u.$private(),I(u,"$check_result_legacy",function(r,_,h,S){var b,y=this,w=R,p=R,l=R,d=R;return w=L(_,"map",[],"sides".$to_proc()),b=(p=L(_,"map",[],"value".$to_proc())).$sum(),l=c([100],d=w)?y.$check_1D100(r,b,h,S):c([20],d)?y.$check_1D20(r,b,h,S):c([6,6],d)?y.$check_2D6(r,b,p,h,S):R,(P(l["$nil?"]())||P(l["$empty?"]()))&&(l=c([10],d=w.$uniq())?y.$check_nD10(r,b,p,h,S):c([6],d)?y.$check_nD6(r,b,p,h,S):R,P(l["$nil?"]())||P(l["$empty?"]()))?R:n("Result").$new(l.$delete_prefix(" \uff1e "))}),I(u,"$check_1D100",q(R)),I(u,"$check_1D20",q(R)),I(u,"$check_nD10",q(R)),I(u,"$check_2D6",q(R)),I(u,"$check_nD6",q(R))},Opal.modules["bcdice/base"]=function(e){var f,y,d,H,t,D,$,o,a,k,p,U=e.module,L=e.klass,c=e.slice,P=e.rb_plus,I=e.truthy,q=e.def,M=e.regexp,R=e.send,A=e.thrower,C=e.return_ivar,F=e.assign_ivar_val,j=e.eqeqeq,E=e.eqeq,B=e.return_val,N=e.range,x=e.rb_minus,Y=e.rb_divide,G=e.rb_times,u=e.rb_ge,n=e.top,T=[],r=e.$r(T),_=e.nil,h=e.$$$;return n.$require("i18n"),n.$require("i18n/backend/fallbacks"),n.$require("bcdice/randomizer"),n.$require("bcdice/dice_table"),n.$require("bcdice/enum"),n.$require("bcdice/translate"),n.$require("bcdice/result"),n.$require("bcdice/command/parser"),n.$require("bcdice/deprecated/checker"),y=T,d=p=[U(T[0],"BCDice")].concat(y),o=[$=L(p[0],null,"Base")].concat(d),a=e.$r(o),(k=$.$$prototype).raw_input=k.randomizer=k.enabled_upcase_input=k.debug=_,t=[H=e.get_singleton_class($)].concat(o),D=e.$r(t),H.$attr_reader("prefixes"),q(H,"$register_prefix",function(v){var W,V,Q=this;return null==Q.prefixes&&(Q.prefixes=_),W=c(arguments),Q.prefixes=P(I(V=Q.prefixes)?V:[],W.$flatten())},-1),q(H,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),q(H,"$prefixes_pattern",function(){var v=this,s=_;return null==v.prefixes_pattern&&(v.prefixes_pattern=_),null==v.prefixes&&(v.prefixes=_),v.prefixes_pattern=I(s=v.prefixes_pattern)?s:_,I(v.prefixes_pattern)?v.prefixes_pattern:(v.prefixes=I(s=v.prefixes)?s:[],v.prefixes.$freeze(),v.prefixes_pattern=(I(v.prefixes["$empty?"]())?/(?!)/:M(["^(S)?(",v.prefixes.$join("|"),")"],"i")).$freeze())}),q(H,"$command_pattern",function(){var v=this,s=_,W=_;return null==v.command_pattern&&(v.command_pattern=_),null==v.prefixes&&(v.prefixes=_),v.command_pattern=I(s=v.command_pattern)?s:_,I(v.command_pattern)?v.command_pattern:(v.prefixes=I(s=v.prefixes)?s:[],v.prefixes.$freeze(),W=P(R(h(D("CommonCommand"),"COMMANDS"),"map",[],function(V){return null==V&&(V=_),h(V,"PREFIX_PATTERN").$source()}),v.prefixes),v.command_pattern=M(["^S?(",W.$join("|"),")"],"i").$freeze())}),q(H,"$eval",function(v){try{return A("eval_return"),this.$new(v).$eval()}catch(Q){if(Q===e.t_eval_return)return Q.$v;throw Q}}),$.$include(a("Translate")),$.$include(h(a("Deprecated"),"Checker")),q($,"$initialize",function(m){var t=this;return t.raw_input=m,t.sort_add_dice=!1,t.sort_barabara_dice=!1,t.d66_sort_type=h(a("D66SortType"),"NO_SORT"),t.enabled_d9=!1,t.round_type=h(a("RoundType"),"FLOOR"),t.sides_implicit_d=6,t.upper_dice_reroll_threshold=_,t.reroll_dice_reroll_threshold=_,t.default_cmp_op=_,t.default_target_number=_,t.enabled_upcase_input=!0,t.locale="ja_jp",t.randomizer=h(a("BCDice"),"Randomizer").$new(),t.debug=!1}),$.$attr_accessor("randomizer"),$.$attr_reader("d66_sort_type"),$.$attr_reader("round_type"),$.$attr_reader("sides_implicit_d"),$.$attr_reader("upper_dice_reroll_threshold"),$.$attr_reader("reroll_dice_reroll_threshold"),$.$attr_reader("default_cmp_op"),$.$attr_reader("default_target_number"),q($,"$sort_add_dice?",C("sort_add_dice")),q($,"$sort_barabara_dice?",C("sort_barabara_dice")),q($,"$enabled_d9?",C("enabled_d9")),q($,"$enable_debug",F("debug",!0)),q($,"$eval",function(){var t,i,m=this,D=_;return t=h(a("BCDice"),"Preprocessor").$process(m.raw_input,m),D=I(i=m.$dice_command(t))?i:m.$eval_common_command(m.raw_input),I(D)?(D["$rands="](m.randomizer.$rand_results()),D["$detailed_rands="](m.randomizer.$detailed_rand_results()),D):_}),q($,"$change_text",function(m){return m}),q($,"$check_result",function(m,t,D,i){var v=this,s=_,W=_,Q=_,V=_,ie=_;return s=v.$check_result_legacy(m,t,D,i),I(s)?s:(W=R(t,"map",[],"sides".$to_proc()),V=(Q=R(t,"map",[],"value".$to_proc())).$sum(),s=j([100],ie=W)?v.$result_1d100(m,V,D,i):j([20],ie)?v.$result_1d20(m,V,D,i):j([6,6],ie)?v.$result_2d6(m,V,Q,D,i):_,E(s,a("Result").$nothing())?_:I(s)?s:(s=j([10],ie=W.$uniq())?v.$result_nd10(m,V,Q,D,i):j([6],ie)?v.$result_nd6(m,V,Q,D,i):_,E(s,a("Result").$nothing())?_:I(s)?s:v.$result_ndx(m,D,i)))}),q($,"$grich_text",B(_)),$.$private(),q($,"$eval_common_command",function(m){try{A("eval_return");var D=A("return");return m=this.$change_text(m),R(h(a("CommonCommand"),"COMMANDS"),"each",[],function v(s){var Q,W=null==v.$$s?this:v.$$s;if(null==W.randomizer&&(W.randomizer=_),null==s&&(s=_),Q=s.$eval(m,W,W.randomizer),!I(Q))return _;D.$throw(Q)},{$$s:this,$$ret:D}),_}catch(v){if(v===e.t_eval_return||v===D)return v.$v;throw v}}),q($,"$dice_command",function(m){var t=this,D=_,i=_,v=_,s=_;return I(t.enabled_upcase_input)&&(m=m.$upcase()),D=t.$class().$prefixes_pattern().$match(m),I(D)?(i=D["$[]"](1)["$nil?"]()["$!"](),I(i)&&(m=m["$[]"](N(1,-1,!1))),v=t.$eval_game_system_specific_command(m),I(v["$is_a?"](a("Result")))?(v["$secret="](I(s=v["$secret?"]())?s:i),v):I(v["$nil?"]())||I(v["$empty?"]())||E(v,"1")?_:R(a("Result").$new(),"tap",[],function(Q){var V;return null==Q&&(Q=_),Q["$text="](v.$to_s()),R(Q,"secret=",V=[i]),V[V.length-1]})):_}),q($,"$eval_game_system_specific_command",B(_)),q($,"$result_ndx",function(m,t,D){return I(D["$is_a?"](a("String")))?_:I(m.$send(t,D))?a("Result").$success(this.$translate("success")):a("Result").$failure(this.$translate("failure"))}),q($,"$result_1d100",B(_)),q($,"$result_1d20",B(_)),q($,"$result_nd10",B(_)),q($,"$result_2d6",B(_)),q($,"$result_nd6",B(_)),q($,"$get_table_by_2d6",function(m){return this.$get_table_by_nD6(m,2)}),q($,"$get_table_by_1d6",function(m){return this.$get_table_by_nD6(m,1)}),q($,"$get_table_by_nD6",function(m,t){return this.$get_table_by_nDx(m,t,6)}),q($,"$get_table_by_nDx",function(m,t,D){var v,s=_;return v=this.randomizer.$roll_sum(t,D),s=this.$get_table_value(m["$[]"](x(v,t))),I(s["$nil?"]())?["1",0]:[s,v]}),q($,"$get_table_by_1d3",function(m){var i,v,t=this,s=_;return t.$debug("get_table_by_1d3"),i=t.randomizer.$roll_sum(1,6),t.$debug("num",i),v=Y(x(i,1),2).$to_i(),t.$debug("index",v),s=m["$[]"](v),I(s["$nil?"]())?["1",0]:[s,i]}),q($,"$get_table_by_d66_swap",function(m){var D;return D=this.randomizer.$roll_d66(h(a("D66SortType"),"ASC")),[this.$get_table_by_number(D,m),D]}),q($,"$get_table_by_d66",function(m){var D,i,v,W,s=_;return D=this.randomizer.$roll_once(6),i=this.randomizer.$roll_once(6),v=P(G(x(D,1),6),x(i,1)),s=m["$[]"](v),W=""+D+i,I(s["$nil?"]())?["1",W]:[s,W]}),q($,"$get_table_by_number",function(m,t,D){try{var i=A("return");return null==D&&(D="1"),R(t,"each",[],function s(W){var V,Q=null==s.$$s?this:s.$$s;if(null==W&&(W=_),V=W["$[]"](0),!I(u(V,m)))return _;i.$throw(Q.$get_table_value(W["$[]"](1)))},{$$s:this,$$ret:i}),this.$get_table_value(D)}catch(s){if(s===i)return s.$v;throw s}},-3),q($,"$get_table_value",function(m){return I(m["$is_a?"](a("Proc")))?m.$call():m}),q($,"$roll_tables",function(m,t){var i=_;return i=t["$[]"](m),I(i)?i.$roll(this.randomizer).$to_s():_}),q($,"$debug",function(m,t){var i,v=this,s=_,W=_;return i=c(arguments,1),I(v.debug)?(s=I(m["$is_a?"](a("String")))?m:m.$inspect(),I(i["$empty?"]())?v.$warn(s):(W=R(i,"map",[],function(V){return null==V&&(V=_),I(V["$is_a?"](a("String")))?'"'+V+'"':V.$inspect()}),v.$warn(s+": "+W.$join(", ")))):_},-2),h(h(r("I18n"),"Backend"),"Simple").$include(h(h(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),f=[["ja_jp"]],R(r("I18n").$fallbacks(),"defaults=",f),f[f.length-1]},Opal.queue(function(e){var N,u,h,b,d,$,S,y,w,n,T,Y,U=e.module,L=e.klass,c=e.const_set,P=e.regexp,I=e.truthy,q=e.def,M=e.thrower,R=e.send,A=e.hash2,F=[],j=e.nil,E=e.$$$;return e.top.$require("bcdice/base"),N=F,u=Y=[U(F[0],"BCDice")].concat(N),n=[U(Y[0],"GameSystem")].concat(u),T=e.$r(n),h=n,y=[S=L(n[0],T("Base"),"UnsungDuet")].concat(h),w=e.$r(y),S.$$prototype.randomizer=j,c(y[0],"ID","UnsungDuet"),c(y[0],"NAME","\u30a2\u30f3\u30b5\u30f3\u30b0\u30fb\u30c7\u30e5\u30a8\u30c3\u30c8"),c(y[0],"SORT_KEY","\u3042\u3093\u3055\u3093\u304f\u3066\u3086\u3048\u3064\u3068"),c(y[0],"HELP_MESSAGE","\u25a0 \u30b7\u30d5\u30bf\u30fc\u7528\u5224\u5b9a (shifter, UDS)\n  1D10\u3092\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3057\u3066\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n  \u4f8b\uff09 shifter, UDS, shifter>=5, shifter+1>=6\n\n\u25a0 \u30d0\u30a4\u30f3\u30c0\u30fc\u7528\u5224\u5b9a (binder, UDB)\n  2D6\u3092\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3057\u3066\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n  \u4f8b\uff09 binder, UDB, binder>=5, binder+1>=6\n\n\u25a0 \u5909\u7570\u8868\n  \u30fb\u5916\u50b7 (HIN, HInjury)\n  \u30fb\u4f53\u8abf\u306e\u5909\u5316 (HPH, HPhysical)\n  \u30fb\u6050\u6016 (HFE, HFear)\n  \u30fb\u5e7b\u60f3\u5316 (HFA, HFantasy)\n  \u30fb\u7cbe\u795e (HMI, HMind)\n  \u30fb\u305d\u306e\u307b\u304b (HOT, HOther)\n"),c(y[0],"ALIAS_1D10",["shifter","UDS"].$freeze()),c(y[0],"ALIAS_2D6",["binder","UDB"].$freeze()),c(y[0],"SHIFTER_ALIAS_REG",P(["^",w("ALIAS_1D10").$join("|")],"i").$freeze()),c(y[0],"BINDER_ALIAS_REG",P(["^",w("ALIAS_2D6").$join("|")],"i").$freeze()),S.$register_prefix(w("ALIAS_1D10"),w("ALIAS_2D6")),q(S,"$eval_game_system_specific_command",function(l){var o,d=this,$=j;return l=I($=w("ALIAS")["$[]"](l))?$:l,I($=I(o=d.$roll_replaced_command_if_match(l,w("SHIFTER_ALIAS_REG"),"1D10"))?o:d.$roll_replaced_command_if_match(l,w("BINDER_ALIAS_REG"),"2D6"))?$:d.$roll_tables(l,E(d.$class(),"TABLES"))}),q(S,"$roll_replaced_command_if_match",function(l,d,$){try{return M("eval_return"),I(l["$match?"](d))?E(w("CommonCommand"),"AddDice").$eval(l.$sub(d,$),this,this.randomizer):j}catch(k){if(k===e.t_eval_return)return k.$v;throw k}}),c(y[0],"ALIAS",R(A(["HInjury","HPhysical","HFear","HFantasy","HMind","HOther"],{HInjury:"HIN",HPhysical:"HPH",HFear:"HFE",HFantasy:"HFA",HMind:"HMI",HOther:"HOT"}),"transform_keys",[],"upcase".$to_proc())),d=[b=e.get_singleton_class(S)].concat(y),$=e.$r(d),b.$private(),q(b,"$translate_tables",function(a){return A(["HIN","HPH","HFE","HFA","HMI","HOT"],{HIN:E($("DiceTable"),"Table").$from_i18n("UnsungDuet.MutatingInjuryTable",a),HPH:E($("DiceTable"),"Table").$from_i18n("UnsungDuet.MutatingPhysicalConditionTable",a),HFE:E($("DiceTable"),"Table").$from_i18n("UnsungDuet.MutatingFearTable",a),HFA:E($("DiceTable"),"Table").$from_i18n("UnsungDuet.MutatingFantasyTable",a),HMI:E($("DiceTable"),"Table").$from_i18n("UnsungDuet.MutatingMindTable",a),HOT:E($("DiceTable"),"Table").$from_i18n("UnsungDuet.MutatingOtherTable",a)}).$freeze()}),c(y[0],"TABLES",S.$translate_tables("ja_jp")),S.$register_prefix(w("ALIAS").$keys(),w("TABLES").$keys())})}}]);