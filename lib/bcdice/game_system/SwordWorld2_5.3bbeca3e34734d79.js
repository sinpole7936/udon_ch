(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[4579],{6899:(Re,xe,ke)=>{ke(5151),Opal.modules["bcdice/arithmetic_evaluator"]=function(e){var H,Y,i,o,p,z,q,Q,V=e.module,G=e.ensure_kwargs,l=e.truthy,P=e.thrower,K=e.def,d=[],M=e.nil,h=e.$$$;return H=d,Y=Q=[V(d[0],"BCDice")].concat(H),q=[z=V(Q[0],"ArithmeticEvaluator")].concat(Y),o=[i=e.get_singleton_class(z)].concat(q),p=e.$r(o),K(i,"$eval",function(B,n){try{P("eval_return");var k,L=M;return null==(k=(n=G(n)).$$smap.round_type)&&(k=h(p("RoundType"),"FLOOR")),l(B)&&l(L=p("Arithmetic").$eval(B,k))?L:0}catch(A){if(A===e.t_eval_return)return A.$v;throw A}},-2)},Opal.modules["i18n/backend/fallbacks"]=function(e){var I,_,n,$,o,p,V=e.module,G=e.class_variable_set,l=e.truthy,P=e.class_variable_get,K=e.def,d=e.send,M=e.send2,h=e.find_super,N=e.hash2,H=e.find_block_super,j=e.neqeq,Q=e.thrower,E=e.return_val,Y=[],z=e.nil,q=e.$$$;return I=Y,p=[o=V(Y[0],"I18n")].concat(I),G(p[0],"@@fallbacks",z),_=e.get_singleton_class(o),n=[_].concat(p),$=e.$r(n),K(_,"$fallbacks",function(){var A=z;return G(n[1],"@@fallbacks",l(null!=n[1].$$cvars["@@fallbacks"]?"class variable":z)&&l(A=P(n[1],"@@fallbacks",!1))?A:q(q($("I18n"),"Locale"),"Fallbacks").$new()),l(A=$("Thread").$current()["$[]"]("i18n_fallbacks"))?A:P(n[1],"@@fallbacks",!1)}),K(_,"$fallbacks=",function(L){var A;return G(n[1],"@@fallbacks",l(L["$is_a?"]($("Array")))?q(q($("I18n"),"Locale"),"Fallbacks").$new(L):L),A=["i18n_fallbacks",P(n[1],"@@fallbacks",!1)],d($("Thread").$current(),"[]=",A),A[A.length-1]}),function(_,B){var L,A,C,D,$=[V(_,"Backend")].concat(B);return L=$,C=[A=V($[0],"Fallbacks")].concat(L),D=e.$r(C),K(A,"$translate",function w(v,y,a){try{var c=Q("return"),u=w.$$p||z,b=this,f=z,m=z;return w.$$p=null,null==a&&(a=D("EMPTY_HASH")),l(a.$fetch("fallback",!0))?l(a["$[]"]("fallback_in_progress"))?M(b,h(b,"translate",w,!1,!0),"translate",[v,y,a],u):(l(a["$[]"]("default"))&&(f=b["$extract_non_symbol_default!"](a)),m=a.$merge(N(["fallback_in_progress"],{fallback_in_progress:!0})),d(D("I18n").$fallbacks()["$[]"](v),"each",[],function r(R){var t=null==r.$$s?this:r.$$s;null==R&&(R=z);try{return d(t,"catch",["exception"],function g(){var s=null==g.$$s?this:g.$$s,O=z;if(O=M(s,H(s,"translate",g.$$def||r.$$def||w,!1,!1),"translate",[R,y,m],null),l(O["$nil?"]()))return z;j(v.$to_s(),R.$to_s())&&s.$on_fallback(v,R,y,a),c.$throw(O)},{$$s:t,$$ret:c})}catch(g){if(!e.rescue(g,[q(D("I18n"),"InvalidLocale")]))throw g;try{return z}finally{e.pop_exception()}}},{$$s:b}),l(a["$key?"]("default"))&&l(a["$[]"]("default")["$nil?"]())?z:l(f)?M(b,h(b,"translate",w,!1,!0),"translate",[v,z,a.$merge(N(["default"],{default:f}))],null):b.$throw("exception",q(D("I18n"),"MissingTranslation").$new(v,y,a))):M(b,h(b,"translate",w,!1,!0),"translate",[v,y,a],u)}catch(r){if(r===c)return r.$v;throw r}},-3),K(A,"$extract_non_symbol_default!",function(v){var a,y=z;return y=[v["$[]"]("default")].$flatten(),a=d(y,"detect",[],function(u){return null==u&&(u=z),u["$is_a?"](D("Symbol"))["$!"]()}),l(a)&&v["$[]="]("default",y["$[]"](0,y.$index(a))),a}),K(A,"$exists?",function w(v,y,a){try{var c=Q("return"),u=w.$$p||z,b=this;return w.$$p=null,null==a&&(a=D("EMPTY_HASH")),l(a.$fetch("fallback",!0))?(d(D("I18n").$fallbacks()["$[]"](v),"each",[],function f(m){var r=null==f.$$s?this:f.$$s;null==m&&(m=z);try{if(!l(M(r,H(r,"exists?",f.$$def||w,!1,!1),"exists?",[m,y],null)))return z;c.$throw(!0)}catch(R){if(!e.rescue(R,[q(D("I18n"),"InvalidLocale")]))throw R;try{return z}finally{e.pop_exception()}}},{$$s:b,$$ret:c}),!1):M(b,h(b,"exists?",w,!1,!0),"exists?",[v,y,a],u)}catch(f){if(f===c)return f.$v;throw f}},-3),A.$private(),K(A,"$on_fallback",E(z))}(p[0],p)},Opal.modules["bcdice/randomizer"]=function(e){var o,k,L,A,C,D,_,B,G=e.klass,l=e.const_set,P=e.def,K=e.truthy,d=e.rb_gt,M=e.rb_plus,h=e.rb_le,N=e.send,H=e.rb_minus,j=e.eqeq,Q=e.rb_times,E=e.eqeqeq,Y=e.rb_ge,z=[],q=e.nil,i=e.$$$;return o=z,_=[(0,e.module)(z[0],"BCDice")].concat(o),B=e.$r(_),k=_,A=[L=G(_[0],null,"Randomizer")].concat(k),C=e.$r(A),(D=L.$$prototype).rand_results=D.detailed_rand_results=q,l(A[0],"UPPER_LIMIT_DICE_TIMES",200),l(A[0],"UPPER_LIMIT_DICE_SIDES",1e4),l(A[0],"UPPER_LIMIT_RANDS",1e4),P(L,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),L.$attr_reader("rand_results"),L.$attr_reader("detailed_rand_results"),l(A[0],"DetailedRandResult",C("Struct").$new("kind","sides","value")),P(L,"$roll_barabara",function(v,y){var a=this;return K(d(M(a.rand_results.$size(),v),C("UPPER_LIMIT_RANDS")))&&a.$raise(C("TooManyRandsError")),K(h(v,0))||K(d(v,C("UPPER_LIMIT_DICE_TIMES")))?[]:N(C("Array"),"new",[v],function c(){return(null==c.$$s?this:c.$$s).$roll_once(y)},{$$s:a})}),P(L,"$roll_sum",function(v,y){return this.$roll_barabara(v,y).$sum()}),P(L,"$roll_once",function(v){var a=q;return K(h(v,0))||K(d(v,C("UPPER_LIMIT_DICE_SIDES")))?0:(a=this.$rand_inner(v),this.$push_to_detail("normal",v,a),a)}),P(L,"$roll_index",function(v){return H(this.$roll_once(v),1)}),P(L,"$roll_tens_d10",function(){var a,y=q;return y=this.$rand_inner(10),j(y,10)&&(y=0),a=Q(y,10),this.$push_to_detail("tens_d10",10,a),a}),P(L,"$roll_d9",function(){var y;return y=H(this.$rand_inner(10),1),this.$push_to_detail("d9",10,y),y}),P(L,"$roll_d66",function(v){var c,a=q;return a=N(C("Array"),"new",[2],function u(){return(null==u.$$s?this:u.$$s).$roll_once(6)},{$$s:this}),E(i(C("D66SortType"),"ASC"),c=v)?a["$sort!"]():E(i(C("D66SortType"),"DESC"),c)&&a["$sort!"]()["$reverse!"](),M(Q(a["$[]"](0),10),a["$[]"](1))}),L.$private(),P(L,"$rand_inner",function(v){var a,y=this;return K(Y(y.rand_results.$size(),C("UPPER_LIMIT_RANDS")))&&y.$raise(C("TooManyRandsError")),a=y.$random(v),y.rand_results["$<<"]([a,v]),a}),P(L,"$random",function(v){return M(C("Kernel").$rand(v),1)}),P(L,"$push_to_detail",function(v,y,a){var u;return u=C("DetailedRandResult").$new(v,y,a),this.detailed_rand_results.$push(u)}),G(_[0],B("StandardError"),"TooManyRandsError"),q},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var N,E,I,o,p,_,B,z,j,V=e.module,G=e.klass,l=e.def,P=e.truthy,K=e.return_val,d=[],M=e.nil;return N=d,E=j=[V(d[0],"BCDice")].concat(N),I=z=[V(j[0],"DiceTable")].concat(E),p=[o=G(z[0],null,"RollResult")].concat(I),_=e.$r(p),(B=o.$$prototype).table_name=B.value=B.body=M,l(o,"$initialize",function($,k,L){var A=this;return A.table_name=$,A.value=k,A.body=L}),o.$attr_reader("table_name"),o.$attr_reader("value"),o.$attr_reader("body"),l(o,"$to_s",function(){var $=this;return $.table_name+"("+$.value+") \uff1e "+$.body}),l(o,"$last_body",function(){var $=this;return P($.body["$is_a?"](_("RollResult")))?$.body.$last_body():$.body}),l(o,"$empty?",K(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var N,E,I,o,p,_,B,z,j,V=e.module,G=e.klass,l=e.truthy,P=e.def,K=e.rb_minus,d=[],M=e.nil;return N=d,E=j=[V(d[0],"BCDice")].concat(N),I=z=[V(j[0],"DiceTable")].concat(E),p=[o=G(z[0],null,"ChainTable")].concat(I),_=e.$r(p),(B=o.$$prototype).times=B.sides=B.items=B.name=M,P(o,"$initialize",function($,k,L){var A=this,C=M;return A.name=$,A.items=L.$freeze(),C=/(\d+)D(\d+)/i.$match(k),l(C)||A.$raise(_("ArgumentError"),"Unexpected table type: "+k),A.times=C["$[]"](1).$to_i(),A.sides=C["$[]"](2).$to_i()}),P(o,"$roll",function($){var L,A,k=this,C=M;return L=$.$roll_sum(k.times,k.sides),A=K(L,k.times),C=k.items["$[]"](A),l(C["$respond_to?"]("roll"))&&(C=C.$roll($)),_("RollResult").$new(k.name,L,C)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var Q,q,_,B,n,$,k,I,Y,V=e.module,G=e.klass,l=e.hash2,P=e.defs,K=e.def,d=e.rb_plus,M=e.rb_times,h=e.rb_minus,N=[],H=e.nil;return Q=N,q=Y=[V(N[0],"BCDice")].concat(Q),_=I=[V(Y[0],"DiceTable")].concat(q),n=[B=G(I[0],null,"D66GridTable")].concat(_),$=e.$r(n),(k=B.$$prototype).name=k.items=H,P(B,"$from_i18n",function(A,C){var w=H;return w=$("I18n").$t(A,l(["locale","raise"],{locale:C,raise:!0})),this.$new(w["$[]"]("name"),w["$[]"]("items"))}),K(B,"$initialize",function(A,C){return this.name=A,this.items=C.$freeze()}),K(B,"$roll",function(A){var D,w,v,y,a;return D=A.$roll_once(6),w=A.$roll_once(6),v=d(M(D,10),w),y=h(D,1),a=h(w,1),$("RollResult").$new(this.name,v,this.items["$[]"](y)["$[]"](a))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var H,Y,p,_,B,n,q,i,Q,V=e.module,G=e.klass,l=e.hash2,P=e.defs,K=e.def,M=[],h=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),H=M,Y=Q=[V(M[0],"BCDice")].concat(H),q=[V(Q[0],"DiceTable")].concat(Y),i=e.$r(q),p=q,B=[_=G(q[0],i("D66GridTable"),"D66HalfGridTable")].concat(p),n=e.$r(B),P(_,"$from_i18n",function(k,L){var C=h;return C=n("I18n").$t(k,l(["locale","raise"],{locale:L,raise:!0})),this.$new(C["$[]"]("name"),C["$[]"]("items_1_2_3"),C["$[]"]("items_4_5_6"))}),K(_,"$initialize",function(k,L,A){return this.name=k,this.items=[L,L,L,A,A,A].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var H,Y,p,_,B,n,q,i,Q,V=e.module,G=e.klass,l=e.hash2,P=e.defs,K=e.def,M=[],h=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),H=M,Y=Q=[V(M[0],"BCDice")].concat(H),q=[V(Q[0],"DiceTable")].concat(Y),i=e.$r(q),p=q,B=[_=G(q[0],i("D66GridTable"),"D66OneThirdTable")].concat(p),n=e.$r(B),P(_,"$from_i18n",function(k,L){var C=h;return C=n("I18n").$t(k,l(["locale","raise"],{locale:L,raise:!0})),this.$new(C["$[]"]("name"),C["$[]"]("items_1_2"),C["$[]"]("items_3_4"),C["$[]"]("items_5_6"))}),K(_,"$initialize",function(k,L,A,C){return this.name=k,this.items=[L,L,A,A,C,C].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var Y,I,n,$,k,L,A,p,q,V=e.module,G=e.klass,l=e.hash2,P=e.defs,K=e.def,d=e.eqeqeq,M=e.rb_plus,h=e.rb_times,N=e.truthy,H=[],j=e.nil,Q=e.$$$;return Y=H,I=q=[V(H[0],"BCDice")].concat(Y),n=p=[V(q[0],"DiceTable")].concat(I),k=[$=G(p[0],null,"D66Table")].concat(n),L=e.$r(k),(A=$.$$prototype).sort_type=A.items=A.name=j,P($,"$from_i18n",function(D,w){var a,y=j;return y=L("I18n").$t(D,l(["locale"],{locale:w})),a=L("D66SortType").$const_get(y["$[]"]("d66_sort_type")),this.$new(y["$[]"]("name"),a,y["$[]"]("items"))}),K($,"$initialize",function(D,w,v){var y=this;return y.name=D,y.sort_type=w,y.items=v.$freeze()}),K($,"$roll",function(D){var w=this,v=j,y=j,a=j,c=j;return v=D.$roll_barabara(2,6),d(Q(L("D66SortType"),"ASC"),y=w.sort_type)?v["$sort!"]():d(Q(L("D66SortType"),"DESC"),y)&&v["$sort!"]()["$reverse!"](),a=M(h(v["$[]"](0),10),v["$[]"](1)),c=N(y=w.items["$[]"](a))?y:w.items["$[]"](a.$to_s()),N(c["$respond_to?"]("roll"))&&(c=c.$roll(D)),L("RollResult").$new(w.name,a,c)}),K($,"$choice",function(D){return L("RollResult").$new(this.name,D,this.items["$[]"](D))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var z,o,_,B,i,V=e.module,G=e.klass,l=e.hash2,P=e.send,K=e.to_ary,d=e.rb_plus,M=e.rb_times,h=e.send2,N=e.find_super,H=e.def,Q=[],E=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),z=Q,o=i=[V(Q[0],"BCDice")].concat(z),_=[V(i[0],"DiceTable")].concat(o),B=e.$r(_),H(G(_[0],B("D66Table"),"D66LeftRangeTable"),"$initialize",function L(A,C,D){var y;return L.$$p=null,y=l([],{}),P(D,"each",[],function(c){var u,m;return null==c&&(c=E),u=K(c),m=null==u[1]?E:u[1],P(null==u[0]?E:u[0],"each",[],function(R){return null==R&&(R=E),P(m,"each_with_index",[],function(g,s){var O,re;return null==g&&(g=E),null==s&&(s=E),re=d(M(R,10),d(s,1)),P(y,"[]=",O=[re,g]),O[O.length-1]})})}),h(this,N(this,"initialize",L,!1,!0),"initialize",[A,C,y],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var E,i,B,n,$,k,L,o,z,V=e.module,G=e.klass,l=e.hash2,P=e.defs,K=e.def,d=e.truthy,M=e.rb_minus,h=e.rb_plus,N=e.rb_times,H=[],j=e.nil;return E=H,i=z=[V(H[0],"BCDice")].concat(E),B=o=[V(z[0],"DiceTable")].concat(i),$=[n=G(o[0],null,"D66ParityTable")].concat(B),k=e.$r($),(L=n.$$prototype).odd=L.even=L.name=j,P(n,"$from_i18n",function(C,D){var v=j;return v=k("I18n").$t(C,l(["locale","raise"],{locale:D,raise:!0})),this.$new(v["$[]"]("name"),v["$[]"]("odd"),v["$[]"]("even"))}),K(n,"$initialize",function(C,D,w){var v=this;return v.name=C,v.odd=D.$freeze(),v.even=w.$freeze()}),K(n,"$roll",function(C){var v,a,c,D=this,w=j;return w=C.$roll_once(6),v=C.$roll_once(6),a=(d(w["$odd?"]())?D.odd:D.even)["$[]"](M(v,1)),c=h(N(w,10),v),k("RollResult").$new(D.name,c,a)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var H,Y,o,p,_,B,n,q,Q,V=e.module,G=e.klass,l=e.def,P=e.rb_plus,K=e.rb_times,d=e.send,M=[],h=e.nil;return H=M,Y=Q=[V(M[0],"BCDice")].concat(H),o=q=[V(Q[0],"DiceTable")].concat(Y),_=[p=G(q[0],null,"D66RangeTable")].concat(o),B=e.$r(_),(n=p.$$prototype).items=n.name=h,l(p,"$initialize",function(k,L){return this.name=k,this.items=L.$freeze()}),l(p,"$roll",function(k){var A,C,D,w=h;return A=k.$roll_once(6),C=k.$roll_once(6),D=P(K(A,10),C),w=d(this.items,"find",[],function(y){return null==y&&(y=h),y["$[]"](0)["$include?"](D)}),B("RollResult").$new(this.name,D,w["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var z,o,$,D,v,y,k,L,A,C,_,i,V=e.module,G=e.klass,l=e.const_set,P=e.send,K=e.hash2,d=e.def,M=e.eqeqeq,h=e.truthy,N=e.to_a,H=e.rb_times,j=e.rb_plus,Q=[],E=e.nil;return z=Q,o=i=[V(Q[0],"BCDice")].concat(z),$=_=[V(i[0],"DiceTable")].concat(o),L=[k=G(_[0],null,"RangeTable")].concat($),A=e.$r(L),(C=k.$$prototype).name=C.items=C.num_of_dice=C.num_of_sides=C.formatter=E,l(L[0],"RollResult",P(A("Struct"),"new",["sum","values","content","formatted"],function D(){return(null==D.$$s?this:D.$$s).$alias_method("to_s","formatted")},{$$s:k})),l(L[0],"Item",A("Struct").$new("range","content")),l(L[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),l(L[0],"DEFAULT_FORMATTER",P(k,"lambda",[],function(w,v){return null==w&&(w=E),null==v&&(v=E),w.$name()+"("+v.$sum()+") \uff1e "+v.$content()})),k.$attr_reader("name"),k.$attr_reader("num_of_dice"),k.$attr_reader("num_of_sides"),v=[D=e.get_singleton_class(k)].concat(L),y=e.$r(v),d(D,"$from_i18n",function(c,u){var m,f=E;return f=y("I18n").$t(c,K(["locale"],{locale:u})),m=P(f["$[]"]("items"),"map",[],function r(R){return null==R&&(R=E),[(null==r.$$s?this:r.$$s).$conv_string_range(R["$[]"](0)),R["$[]"](1)]},{$$s:this}),this.$new(f["$[]"]("name"),f["$[]"]("type"),m)}),d(D,"$conv_string_range",function(c){var b,u=this;return null==u.name&&(u.name=E),M(y("Integer"),b=c)?c:M(y("String"),b)?h(c["$include?"](".."))?P(y("Range"),"new",N(P(c.$split("..",2),"map",[],function f(m){return null==m&&(m=E),(null==f.$$s?this:f.$$s).$Integer(m)},{$$s:u}))):u.$Integer(c):u.$raise(y("TypeError"),u.name+": "+c+" ("+c.$class()+") must be a String or an Integer")}),d(k,"$initialize",function D(w,v,y){var u,a=D.$$p||E,c=this,b=E;return D.$$p=null,c.name=w.$freeze(),c.formatter=h(u=a)?u:A("DEFAULT_FORMATTER"),b=A("DICE_ROLL_METHOD_RE").$match(v),h(b)||c.$raise(A("ArgumentError"),c.name+": invalid dice roll method: "+v),c.num_of_dice=b["$[]"](1).$to_i(),c.num_of_sides=b["$[]"](2).$to_i(),c.$store(y)}),d(k,"$fetch",function(w){var y,v=this;return y=P(v.items,"find",[],function(c){return null==c&&(c=E),c.$range()["$include?"](w)}),h(y)||v.$raise(A("RangeError"),v.name+": value is out of range: "+w),y}),d(k,"$roll",function(w){var a,v=this,y=E,c=E;return a=(y=w.$roll_barabara(v.num_of_dice,v.num_of_sides)).$sum(),(c=A("RollResult").$new(a,y,v.$fetch(a).$content()))["$formatted="](v.formatter["$[]"](v,c)),c}),k.$private(),d(k,"$store",function(w){var y,a,v=this;return y=P(w,"map",[],function c(u,b){return null==u&&(u=E),null==b&&(b=E),[(null==c.$$s?this:c.$$s).$coerce_to_int_range(u),b]},{$$s:v}),a=P(y,"sort_by",[],function(u,b){return null==u&&(u=E),null==b&&(b=E),u.$min()}),v.$assert_min_sum_is_covered(a),v.$assert_max_sum_is_covered(a),v.$assert_no_gap_or_overlap_in_ranges(a),v.items=P(a,"map",[],function(u,b){return null==u&&(u=E),null==b&&(b=E),A("Item").$new(u,b.$freeze()).$freeze()}).$freeze(),v}),d(k,"$coerce_to_int_range",function(w){var y;return M(A("Integer"),y=w)?A("Range").$new(w,w):M(A("Range"),y)&&h(w.$begin()["$is_a?"](A("Integer")))&&h(w.$end()["$is_a?"](A("Integer")))?w:this.$raise(A("TypeError"),this.name+": "+w+" ("+w.$class()+") must be an Integer or a Range with Integers ")}),d(k,"$assert_min_sum_is_covered",function(w){var y,v=this,a=E;return y=v.num_of_dice,a=w.$first()["$[]"](0),h(a["$include?"](y))||v.$raise(A("RangeError"),v.name+": min value ("+y+") is not covered: "+a),v}),d(k,"$assert_max_sum_is_covered",function(w){var y,v=this,a=E;return y=H(v.num_of_dice,v.num_of_sides),a=w.$last()["$[]"](0),h(a["$include?"](y))||v.$raise(A("RangeError"),v.name+": max value ("+y+") is not covered: "+a),v}),d(k,"$assert_no_gap_or_overlap_in_ranges",function(w){return P(w,"each_cons",[2],function y(a,c){var m,r,u=null==y.$$s?this:y.$$s,b=E,f=E;return null==u.name&&(u.name=E),null==a&&(a=E),null==c&&(c=E),b=a["$[]"](0),f=c["$[]"](0),m=b.$max(),r=j(m,1),h(f["$include?"](m))&&u.$raise(A("RangeError"),u.name+": Range overlap: "+b+" and "+f),h(f["$include?"](r))?E:u.$raise(A("RangeError"),u.name+": Range gap: "+b+" and "+f)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var j,z,p,k,L,A,C,B,i,E,V=e.module,G=e.klass,l=e.send,P=e.def,K=e.rb_minus,d=e.return_ivar,M=[],h=e.nil,N=e.$$$;return j=M,z=E=[V(M[0],"BCDice")].concat(j),p=i=[V(E[0],"DiceTable")].concat(z),k=B=[G(i[0],null,"SaiFicSkillTable")].concat(p),A=[L=G(B[0],null,"Category")].concat(k),C=e.$r(A),P(L,"$initialize",function(w,v,y,a){var c=this;return c.name=w,c.skills=l(v.$map(),"with_index",[2],function(b,f){return null==b&&(b=h),null==f&&(f=h),N(C("SaiFicSkillTable"),"Skill").$new(w,b,y,f,a)}),c.dice=y}),P(L,"$roll",function(w){return this.$skills()["$[]"](K(w.$roll_sum(2,6),2))}),P(L,"$to_s",d("name")),L.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var h,Q,i,B,n,o,Y,H,V=e.module,G=e.klass,l=e.def,P=e.hash2,K=[],d=e.nil;return h=K,Q=H=[V(K[0],"BCDice")].concat(h),i=Y=[V(H[0],"DiceTable")].concat(Q),o=[G(Y[0],null,"SaiFicSkillTable")].concat(i),(n=(B=G(o[0],null,"Skill")).$$prototype).s_format=n.category_dice=n.row_dice=n.category_name=n.name=d,l(B,"$initialize",function(k,L,A,C,D){var w=this;return w.category_name=k,w.name=L,w.category_dice=A,w.row_dice=C,w.s_format=D}),l(B,"$to_s",function(){var k=this;return k.$format(k.s_format,P(["category_dice","row_dice","category_name","skill_name"],{category_dice:k.category_dice,row_dice:k.row_dice,category_name:k.category_name,skill_name:k.name}))}),B.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var o,n,C,D,w,v,y,k,_,V=e.module,G=e.klass,l=e.ensure_kwargs,P=e.hash2,K=e.send,M=e.defs,h=e.const_set,N=e.to_ary,H=e.def,j=e.truthy,Q=e.rb_minus,E=e.rb_plus,Y=e.top,z=[],q=e.nil,i=e.$$$;return Y.$require("bcdice/dice_table/sai_fic_skill_table/category"),Y.$require("bcdice/dice_table/sai_fic_skill_table/skill"),o=z,n=_=[V(z[0],"BCDice")].concat(o),C=k=[V(_[0],"DiceTable")].concat(n),w=[D=G(k[0],null,"SaiFicSkillTable")].concat(C),v=e.$r(w),(y=D.$$prototype).rtt=y.rtt_format=y.rct=y.rct_format=y.rttn=y.rttn_format=y.categories=q,M(D,"$from_i18n",function(c,u,b){var f,m,r,s,g=q;return null==(f=(b=l(b)).$$smap.rtt)&&(f=q),null==(m=b.$$smap.rct)&&(m=q),null==(r=b.$$smap.rttn)&&(r=q),s=(g=v("I18n").$t("RTT",P(["locale","raise","default"],{locale:u,raise:!1,default:P([],{})})).$merge(v("I18n").$t(c,P(["locale","raise"],{locale:u,raise:!0}))))["$[]"]("items"),g=K(g,"select",[],function(re,ee){return null==re&&(re=q),null==ee&&(ee=q),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](re)}),this.$new(s,e.to_hash(g).$merge(P(["rtt","rct","rttn"],{rtt:f,rct:m,rttn:r})))},-3),h(w[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),h(w[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),h(w[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),h(w[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),H(D,"$initialize",function(c,u){var b,f,m,r,R,t,g,s=this;return null==(b=(u=l(u)).$$smap.rtt)&&(b=q),null==(f=u.$$smap.rct)&&(f=q),null==(m=u.$$smap.rttn)&&(m=q),null==(r=u.$$smap.rtt_format)&&(r=v("DEFAULT_RTT")),null==(R=u.$$smap.rct_format)&&(R=v("DEFAULT_RCT")),null==(t=u.$$smap.rttn_format)&&(t=v("DEFAULT_RTTN")),null==(g=u.$$smap.s_format)&&(g=v("DEFAULT_S")),s.categories=K(c.$map(),"with_index",[1],function(re,ee){var ie,oe,ue;return null==re&&(re=q),null==ee&&(ee=q),oe=null==(ie=N(re))[0]?q:ie[0],ue=null==ie[1]?q:ie[1],i(v("SaiFicSkillTable"),"Category").$new(oe,ue,ee,g)},{$$has_top_level_mlhs_arg:!0}),s.rtt=b,s.rct=f,s.rttn=m.$to_a(),s.rtt_format=r,s.rct_format=R,s.rttn_format=t},-2),h(w[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),D.$attr_reader("categories"),H(D,"$roll_command",function(c,u){var f,b=this,m=q,r=q;return j(["RTT",b.rtt]["$include?"](f=u))?b.$format_skill(b.rtt_format,b.$roll_skill(c)):j(["RCT",b.rct]["$include?"](f))?(m=b.$roll_category(c),b.$format(b.rct_format,P(["category_dice","category_name"],{category_dice:m.$dice(),category_name:m.$name()}))):j(r=v("RTTN").$index(f))||j(r=b.rttn.$index(f))?b.$format_skill(b.rttn_format,b.categories["$[]"](r).$roll(c)):q}),H(D,"$roll_category",function(c){return this.categories["$[]"](Q(c.$roll_once(6),1))}),H(D,"$roll_skill",function(c){return this.$roll_category(c).$roll(c)}),H(D,"$prefixes",function(){var c=this;return E(["RTT[1-6]?","RCT",c.rtt,c.rct],c.rttn).$compact()}),D.$private(),H(D,"$format_skill",function(c,u){return this.$format(c,P(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:u.$category_dice(),row_dice:u.$row_dice(),category_name:u.$category_name(),skill_name:u.$name(),text:u.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var j,z,p,_,B,n,$,i,E,V=e.module,G=e.klass,l=e.hash2,P=e.defs,K=e.truthy,d=e.def,M=e.rb_minus,h=[],N=e.nil;return j=h,z=E=[V(h[0],"BCDice")].concat(j),p=i=[V(E[0],"DiceTable")].concat(z),B=[_=G(i[0],null,"Table")].concat(p),n=e.$r(B),($=_.$$prototype).times=$.sides=$.name=$.items=N,P(_,"$from_i18n",function(L,A){var D=N;return D=n("I18n").$t(L,l(["locale"],{locale:A})),this.$new(D["$[]"]("name"),D["$[]"]("type"),D["$[]"]("items"))}),d(_,"$initialize",function(L,A,C){var D=this,w=N;return D.name=L,D.items=C.$freeze(),w=/(\d+)D(\d+)/i.$match(A),K(w)||D.$raise(n("ArgumentError"),"Unexpected table type: "+A),D.times=w["$[]"](1).$to_i(),D.sides=w["$[]"](2).$to_i()}),d(_,"$roll",function(L){var C,A=this;return C=L.$roll_sum(A.times,A.sides),A.$choice(C)}),d(_,"$choice",function(L){var C,A=this;return C=M(L,A.times),n("RollResult").$new(A.name,L,A.items["$[]"](C))})},Opal.modules["bcdice/dice_table"]=function(e){var V=e.top;return V.$require("bcdice/dice_table/roll_result"),V.$require("bcdice/dice_table/chain_table"),V.$require("bcdice/dice_table/d66_grid_table"),V.$require("bcdice/dice_table/d66_half_grid_table"),V.$require("bcdice/dice_table/d66_one_third_table"),V.$require("bcdice/dice_table/d66_left_range_table"),V.$require("bcdice/dice_table/d66_parity_table"),V.$require("bcdice/dice_table/d66_range_table"),V.$require("bcdice/dice_table/d66_table"),V.$require("bcdice/dice_table/range_table"),V.$require("bcdice/dice_table/sai_fic_skill_table"),V.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var d,H,Q,h,V=e.module,G=e.const_set,l=[];return d=l,H=h=[V(l[0],"BCDice")].concat(d),Q=[V(h[0],"D66SortType")].concat(H),G(Q[0],"NO_SORT","no_sort"),G(Q[0],"ASC","asc"),G(Q[0],"DESC","desc"),function(N,H){var Q=[V(N,"RoundType")].concat(H);return G(Q[0],"CEIL","ceil"),G(Q[0],"FLOOR","floor"),G(Q[0],"ROUND","round")}(h[0],h)},Opal.modules["bcdice/translate"]=function(e){var H,Y,z,q,i,Q,V=e.module,G=e.ensure_kwargs,l=e.kwrestargs,K=e.hash2,d=e.def,M=[],h=e.nil;return H=M,Y=Q=[V(M[0],"BCDice")].concat(H),q=[z=V(Q[0],"Translate")].concat(Y),i=e.$r(q),d(z,"$translate",function(o,p){var _,B=this;return null==B.locale&&(B.locale=h),p=G(p),_=l(p,{}),i("I18n").$translate(o,K(["locale","raise"],{locale:B.locale,raise:!0}).$merge(e.to_hash(_)))},-2)},Opal.modules["bcdice/result"]=function(e){var z,I,q,H,Q,G=e.klass,l=e.send,P=e.def,K=e.return_val,d=e.return_ivar,M=[],h=e.nil;return H=M,z=Q=[(0,e.module)(M[0],"BCDice")].concat(H),[q=G(Q[0],null,"Result")].concat(z),P(I=e.get_singleton_class(q),"$success",function(_){return l(this.$new(),"tap",[],function($){var k;return null==$&&($=h),$["$text="](_),l($,"success=",k=[!0]),k[k.length-1]})}),P(I,"$failure",function(_){return l(this.$new(),"tap",[],function($){var k;return null==$&&($=h),$["$text="](_),l($,"failure=",k=[!0]),k[k.length-1]})}),P(I,"$critical",function(_){return l(this.$new(),"tap",[],function($){var k;return null==$&&($=h),$["$text="](_),$["$critical="](!0),l($,"success=",k=[!0]),k[k.length-1]})}),P(I,"$fumble",function(_){return l(this.$new(),"tap",[],function($){var k;return null==$&&($=h),$["$text="](_),$["$fumble="](!0),l($,"failure=",k=[!0]),k[k.length-1]})}),P(I,"$nothing",K("nothing")),P(q,"$initialize",function(o){var p=this;return null==o&&(o=h),p.text=o,p.rands=h,p.detailed_rands=h,p.secret=!1,p.success=!1,p.failure=!1,p.critical=!1,p.fumble=!1},-1),q.$attr_accessor("text","rands","detailed_rands"),q.$attr_writer("secret","success","failure","critical","fumble"),P(q,"$secret?",d("secret")),P(q,"$success?",d("success")),P(q,"$failure?",d("failure")),P(q,"$critical?",d("critical")),P(q,"$fumble?",d("fumble")),P(q,"$condition=",function(o){return this.success=o,this.failure=o["$!"]()})},Opal.modules["racc/parser"]=function(e){var L,C,D,V=e.module,G=e.klass,l=e.truthy,P=e.const_set,K=e.defs,d=e.gvars,M=e.rb_lt,h=e.def,N=e.to_ary,H=e.send,j=e.neqeq,Q=e.rb_plus,E=e.eqeq,Y=e.rb_ge,z=e.rb_gt,q=e.rb_minus,i=e.rb_le,I=e.rb_times,o=e.assign_ivar_val,_=[],B=e.$r(_),n=e.nil,$=e.$$$;return L=_,C=[V(_[0],"Racc")].concat(L),D=e.$r(C),G(C[0],D("StandardError"),"ParseError"),l($("::","ParseError","skip_raise")?"constant":n)||P(_[0],"ParseError",$(B("Racc"),"ParseError")),function(k,L){var a,c,u,b,f,D=[V(k,"Racc")].concat(L),w=e.$r(D);return l(w("Racc_No_Extensions","skip_raise")?"constant":n)||P(D[0],"Racc_No_Extensions",!1),a=D,u=[c=G(D[0],null,"Parser")].concat(a),b=e.$r(u),(f=c.$$prototype).yydebug=f.racc_debug_out=f.racc_error_status=f.racc_t=f.racc_vstack=f.racc_val=f.racc_state=f.racc_tstack=n,P(u[0],"Racc_Runtime_Version","1.4.6"),P(u[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),P(u[0],"Racc_Runtime_Core_Version_R","1.4.6"),P(u[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),P(u[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),P(u[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),P(u[0],"Racc_Runtime_Core_Version",b("Racc_Runtime_Core_Version_R")),P(u[0],"Racc_Runtime_Core_Revision",b("Racc_Runtime_Core_Revision_R")),P(u[0],"Racc_Runtime_Type","ruby"),K(b("Parser"),"$racc_runtime_type",function(){return b("Racc_Runtime_Type")}),h(c,"$_racc_setup",function(){var r,R,t=this,g=n,s=n;return null==d.stderr&&(d.stderr=n),l($(t.$class(),"Racc_debug_parser"))||(t.yydebug=!1),l(null!=(r=t.yydebug)&&r!==n?"instance-variable":n)||(t.yydebug=!1),l(t.yydebug)&&(l(null!=(R=t.racc_debug_out)&&R!==n?"instance-variable":n)||(t.racc_debug_out=d.stderr),t.racc_debug_out=l(g=t.racc_debug_out)?g:d.stderr),s=$(t.$class(),"Racc_arg"),l(M(s.$size(),14))&&s["$[]="](13,!0),s}),h(c,"$_racc_init_sysvars",function(){var r=this;return r.racc_state=[0],r.racc_tstack=[],r.racc_vstack=[],r.racc_t=n,r.racc_val=n,r.racc_read_next=!0,r.racc_user_yyerror=!1,r.racc_error_status=0}),h(c,"$do_parse",function(){return this.$__send__(b("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),h(c,"$next_token",function(){return this.$raise(b("NotImplementedError"),this.$class()+"#next_token is not defined")}),h(c,"$_racc_do_parse_rb",function(r,R){var t,s=this,O=n,re=n,ee=n,ie=n,oe=n,ue=n,_e=n,le=n;return t=N(r),O=null==t[0]?n:t[0],re=null==t[1]?n:t[1],ee=null==t[2]?n:t[2],ie=null==t[3]?n:t[3],oe=null==t[10]?n:t[10],s.$_racc_init_sysvars(),ue=_e=le=n,H(s,"catch",["racc_end_parse"],function $e(){var se,te,S=null==$e.$$s?this:$e.$$s,X=n;for(null==S.racc_state&&(S.racc_state=n),null==S.racc_read_next&&(S.racc_read_next=n),null==S.racc_t&&(S.racc_t=n),null==S.yydebug&&(S.yydebug=n),null==S.racc_val&&(S.racc_val=n);l(!0);)for(l(le=ie["$[]"](S.racc_state["$[]"](-1)))?(l(S.racc_read_next)&&j(S.racc_t,0)&&(te=S.$next_token(),se=N(te),ue=null==se[0]?n:se[0],S.racc_val=null==se[1]?n:se[1],S.racc_t=l(ue)?l(X=oe["$[]"](ue))?X:1:0,l(S.yydebug)&&S.$racc_read_token(S.racc_t,ue,S.racc_val),S.racc_read_next=!1),le=Q(le,S.racc_t),l(Y(le,0))&&l(_e=O["$[]"](le))&&E(re["$[]"](le),S.racc_state["$[]"](-1))||(_e=ee["$[]"](S.racc_state["$[]"](-1)))):_e=ee["$[]"](S.racc_state["$[]"](-1));l(_e=S.$_racc_evalact(_e,r)););},{$$s:s})}),h(c,"$yyparse",function(r,R){return this.$__send__(b("Racc_YY_Parse_Method"),r,R,this.$_racc_setup(),!0)}),h(c,"$_racc_yyparse_rb",function(r,R,t,g){var s,ee=n,ie=n,ce=n,oe=n,_e=n,le=n,$e=n;return s=N(t),ee=null==s[0]?n:s[0],ie=null==s[1]?n:s[1],ce=null==s[2]?n:s[2],oe=null==s[3]?n:s[3],_e=null==s[10]?n:s[10],this.$_racc_init_sysvars(),le=n,$e=n,H(this,"catch",["racc_end_parse"],function se(){var te=null==se.$$s?this:se.$$s;for(null==te.racc_state&&(te.racc_state=n);!l($e=oe["$[]"](te.racc_state["$[]"](-1)));)for(;l(le=te.$_racc_evalact(ce["$[]"](te.racc_state["$[]"](-1)),t)););return H(r,"__send__",[R],function S(X,F){var x=null==S.$$s?this:S.$$s,Z=n,T=n;for(null==x.racc_t&&(x.racc_t=n),null==x.racc_state&&(x.racc_state=n),null==x.racc_read_next&&(x.racc_read_next=n),null==X&&(X=n),null==F&&(F=n),x.racc_t=l(X)?l(Z=_e["$[]"](X))?Z:1:0,x.racc_val=F,x.racc_read_next=!1,$e=Q($e,x.racc_t),l(Y($e,0))&&l(le=ee["$[]"]($e))&&E(ie["$[]"]($e),x.racc_state["$[]"](-1))||(le=ce["$[]"](x.racc_state["$[]"](-1)));l(le=x.$_racc_evalact(le,t)););for(;l(l(Z=l(T=($e=oe["$[]"](x.racc_state["$[]"](-1)))["$!"]())?T:x.racc_read_next["$!"]())?Z:x.racc_t["$=="](0));)for(l($e)&&l($e=Q($e,x.racc_t))&&l(Y($e,0))&&l(le=ee["$[]"]($e))&&E(ie["$[]"]($e),x.racc_state["$[]"](-1))||(le=ce["$[]"](x.racc_state["$[]"](-1)));l(le=x.$_racc_evalact(le,t)););},{$$s:te})},{$$s:this})}),h(c,"$_racc_evalact",function(r,R){var t,ce,s=this,O=n,re=n,ie=n,oe=n,ue=n,_e=n;if(O=null==(t=N(R))[0]?n:t[0],re=null==t[1]?n:t[1],ie=null==t[3]?n:t[3],ce=null==t[11]?n:t[11],oe=null==t[12]?n:t[12],l(z(r,0))&&l(M(r,ce)))l(z(s.racc_error_status,0))&&(E(s.racc_t,1)||(s.racc_error_status=q(s.racc_error_status,1))),s.racc_vstack.$push(s.racc_val),s.racc_state.$push(r),s.racc_read_next=!0,l(s.yydebug)&&(s.racc_tstack.$push(s.racc_t),s.$racc_shift(s.racc_t,s.racc_tstack,s.racc_vstack));else if(l(M(r,0))&&l(z(r,oe["$-@"]()))){if(ue=H(s,"catch",["racc_jump"],function le(){var $e=null==le.$$s?this:le.$$s;return null==$e.racc_state&&($e.racc_state=n),$e.racc_state.$push($e.$_racc_do_reduce(R,r)),!1},{$$s:s}),l(ue))switch(ue.valueOf()){case 1:return s.racc_user_yyerror=!0,oe["$-@"]();case 2:return ce;default:s.$raise("[Racc Bug] unknown jump code")}}else if(E(r,ce))l(s.yydebug)&&s.$racc_accept(),s.$throw("racc_end_parse",s.racc_vstack["$[]"](0));else{if(E(r,oe["$-@"]())){switch(s.racc_error_status.valueOf()){case 0:l(R["$[]"](21))||s.$on_error(s.racc_t,s.racc_val,s.racc_vstack);break;case 3:E(s.racc_t,0)&&s.$throw("racc_end_parse",n),s.racc_read_next=!0}for(s.racc_user_yyerror=!1,s.racc_error_status=3;l(!0)&&!(l(_e=ie["$[]"](s.racc_state["$[]"](-1)))&&(_e=Q(_e,1),l(Y(_e,0))&&l(r=O["$[]"](_e))&&E(re["$[]"](_e),s.racc_state["$[]"](-1))));)l(i(s.racc_state.$size(),1))&&s.$throw("racc_end_parse",n),s.racc_state.$pop(),s.racc_vstack.$pop(),l(s.yydebug)&&(s.racc_tstack.$pop(),s.$racc_e_pop(s.racc_state,s.racc_tstack,s.racc_vstack));return r}s.$raise("[Racc Bug] unknown action "+r.$inspect())}return l(s.yydebug)&&s.$racc_next_state(s.racc_state["$[]"](-1),s.racc_state),n}),h(c,"$_racc_do_reduce",function(r,R){var t,oe,_e,X,F,x,W,s=this,re=n,ee=n,ie=n,ce=n,ue=n,le=n,$e=n,se=n,te=n,S=n,Z=n,T=n,J=n;return re=null==(t=N(r))[4]?n:t[4],ee=null==t[5]?n:t[5],ie=null==t[6]?n:t[6],ce=null==t[7]?n:t[7],oe=null==t[8]?n:t[8],ue=null==t[9]?n:t[9],_e=null==t[13]?n:t[13],le=s.racc_state,$e=s.racc_vstack,se=s.racc_tstack,te=I(R,-3),S=ue["$[]"](te),X=ue["$[]"](Q(te,1)),F=ue["$[]"](Q(te,2)),x=[],l(s.yydebug)&&(Z=se["$[]"](S["$-@"](),S)),T=$e["$[]"](S["$-@"](),S),l(s.yydebug)&&se["$[]="](S["$-@"](),S,x),$e["$[]="](S["$-@"](),S,x),le["$[]="](S["$-@"](),S,x),l(_e)?$e.$push(s.$__send__(F,T,$e,T["$[]"](0))):$e.$push(s.$__send__(F,T,$e)),se.$push(X),l(s.yydebug)&&s.$racc_reduce(Z,X,se,$e),W=q(X,oe),l(te=ce["$[]"](W))&&(te=Q(te,le["$[]"](-1)),l(Y(te,0))&&l(J=re["$[]"](te))&&E(ee["$[]"](te),W))?J:ie["$[]"](W)}),h(c,"$on_error",function(r,R,t){var s,g=this;return g.$raise(b("ParseError"),g.$sprintf("\nparse error on value %s (%s)",R.$inspect(),l(s=g.$token_to_str(r))?s:"?"))}),h(c,"$yyerror",function(){return this.$throw("racc_jump",1)}),h(c,"$yyaccept",function(){return this.$throw("racc_jump",2)}),h(c,"$yyerrok",o("racc_error_status",0)),h(c,"$racc_read_token",function(r,R,t){var g=this;return g.racc_debug_out.$print("read    "),g.racc_debug_out.$print(R.$inspect(),"(",g.$racc_token2str(r),") "),g.racc_debug_out.$puts(t.$inspect()),g.racc_debug_out.$puts()}),h(c,"$racc_shift",function(r,R,t){var g=this;return g.racc_debug_out.$puts("shift   "+g.$racc_token2str(r)),g.$racc_print_stacks(R,t),g.racc_debug_out.$puts()}),h(c,"$racc_reduce",function(r,R,t,g){var s=this,O=n;return(O=s.racc_debug_out).$print("reduce "),l(r["$empty?"]())?O.$print(" <none>"):H(r,"each",[],function re(ee){return null==ee&&(ee=n),O.$print(" ",(null==re.$$s?this:re.$$s).$racc_token2str(ee))},{$$s:s}),O.$puts(" --\x3e "+s.$racc_token2str(R)),s.$racc_print_stacks(t,g),s.racc_debug_out.$puts()}),h(c,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),h(c,"$racc_e_pop",function(r,R,t){var g=this;return g.racc_debug_out.$puts("error recovering mode: pop token"),g.$racc_print_states(r),g.$racc_print_stacks(R,t),g.racc_debug_out.$puts()}),h(c,"$racc_next_state",function(r,R){var t=this;return t.racc_debug_out.$puts("goto    "+r),t.$racc_print_states(R),t.racc_debug_out.$puts()}),h(c,"$racc_print_stacks",function(r,R){var g=n;return(g=this.racc_debug_out).$print("        ["),H(r,"each_index",[],function s(O){return null==O&&(O=n),g.$print(" (",(null==s.$$s?this:s.$$s).$racc_token2str(r["$[]"](O))," ",R["$[]"](O).$inspect(),")")},{$$s:this}),g.$puts(" ]")}),h(c,"$racc_print_states",function(r){var t=n;return(t=this.racc_debug_out).$print("        ["),H(r,"each",[],function(s){return null==s&&(s=n),t.$print(" ",s)}),t.$puts(" ]")}),h(c,"$racc_token2str",function(r){var t;return l(t=$(this.$class(),"Racc_token_to_s_table")["$[]"](r))?t:this.$raise("[Racc Bug] can't convert token "+r+" to string")}),h(c,"$token_to_str",function(r){return $(this.$class(),"Racc_token_to_s_table")["$[]"](r)})}(_[0],_)},Opal.modules["bcdice/arithmetic/node"]=function(e){var o,n,A,a,c,D,w,k,_,V=e.module,G=e.klass,l=e.def,P=e.thrower,K=e.return_ivar,d=e.send2,M=e.find_super,h=e.eqeq,N=e.const_set,H=e.eqeqeq,j=e.rb_divide,Q=e.truthy,E=e.assign_ivar,Y=e.alias,z=[],q=e.nil,i=e.$$$;return o=z,n=_=[V(z[0],"BCDice")].concat(o),A=k=[V(_[0],"Arithmetic")].concat(n),D=[V(k[0],"Node")].concat(A),w=e.$r(D),(c=(a=G(D[0],null,"BinaryOp")).$$prototype).lhs=c.rhs=c.op=q,l(a,"$initialize",function(b,f,m){var r=this;return r.lhs=b,r.op=f,r.rhs=m}),l(a,"$eval",function(b){try{P("eval_return");var R,m=this,r=q;return r=m.lhs.$eval(b),R=m.rhs.$eval(b),r.$send(m.op,R)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),l(a,"$output",function(){var b=this;return""+b.lhs.$output()+b.op+b.rhs.$output()}),l(a,"$s_exp",function(){var b=this;return"("+b.$op_for_s_exp()+" "+b.lhs.$s_exp()+" "+b.rhs.$s_exp()+")"}),l(a,"$op_for_s_exp",K("op")),function(v,y,a){var c=G(v,y,"DivideBase"),u=[c].concat(a),b=e.$r(u),f=c.$$prototype;f.lhs=f.rhs=f.op=q,l(c,"$initialize",function m(r,R){return m.$$p=null,d(this,M(this,"initialize",m,!1,!0),"initialize",[r,"/",R],null)}),l(c,"$eval",function(r){try{P("eval_return");var g,s,t=this;return g=t.lhs.$eval(r),s=t.rhs.$eval(r),h(s,0)&&t.$raise(b("ZeroDivisionError")),t.$divide_and_round(g,s,r)}catch(O){if(O===e.t_eval_return)return O.$v;throw O}}),l(c,"$output",function m(){var r=m.$$p||q,R=this;return m.$$p=null,""+d(R,M(R,"output",m,!1,!0),"output",[],r)+R.$rounding_method()}),c.$private(),l(c,"$rounding_method",function(){return i(this.$class(),"ROUNDING_METHOD")}),l(c,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),l(c,"$divide_and_round",function(r,R,t){return this.$raise(b("NotImplementedError"))})}(D[0],w("BinaryOp"),D),function(v,y,a){var c=G(v,y,"DivideWithGameSystemDefault"),u=[c].concat(a),b=e.$r(u);N(u[0],"ROUNDING_METHOD",""),c.$private(),l(c,"$divide_and_round",function(m,r,R){var t,g=q;return H(i(b("RoundType"),"CEIL"),t=R)?j(m.$to_f(),r).$ceil():H(i(b("RoundType"),"ROUND"),t)?(g=j(m.$to_f(),r),Q(g["$negative?"]())?g.$abs().$round()["$-@"]():g.$round()):j(m,r).$floor()})}(D[0],w("DivideBase"),D),function(v,y,a){var c=G(v,y,"DivideWithCeil"),u=[c].concat(a);N(u[0],"ROUNDING_METHOD","C"),c.$private(),l(c,"$divide_and_round",function(f,m,r){return j(f.$to_f(),m).$ceil()})}(D[0],w("DivideBase"),D),function(v,y,a){var c=G(v,y,"DivideWithRound"),u=[c].concat(a);N(u[0],"ROUNDING_METHOD","R"),c.$private(),l(c,"$divide_and_round",function(f,m,r){var R=q;return R=j(f.$to_f(),m),Q(R["$negative?"]())?R.$abs().$round()["$-@"]():R.$round()})}(D[0],w("DivideBase"),D),function(v,y,a){var c=G(v,y,"DivideWithFloor"),u=[c].concat(a);N(u[0],"ROUNDING_METHOD","F"),c.$private(),l(c,"$divide_and_round",function(f,m,r){return j(f,m).$floor()})}(D[0],w("DivideBase"),D),function(v,y){var a=G(v,null,"Negative");a.$$prototype.body=q,l(a,"$initialize",E("body")),l(a,"$eval",function(b){try{return P("eval_return"),this.body.$eval(b)["$-@"]()}catch(r){if(r===e.t_eval_return)return r.$v;throw r}}),l(a,"$output",function(){return"-"+this.body.$output()}),l(a,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(D[0]),function(v,y){var a=G(v,null,"Parenthesis");a.$$prototype.expr=q,l(a,"$initialize",E("expr")),l(a,"$eval",function(b){try{return P("eval_return"),this.expr.$eval(b)}catch(r){if(r===e.t_eval_return)return r.$v;throw r}}),l(a,"$output",function(){return"("+this.expr.$output()+")"}),l(a,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(D[0]),function(v,y){var a=G(v,null,"Number");return a.$$prototype.value=q,l(a,"$initialize",E("value")),l(a,"$eval",K("value")),l(a,"$output",function(){return this.value.$to_s()}),Y(a,"s_exp","output")}(D[0])},Opal.modules.strscan=function(e){var E,Y,z,q,i,G=e.def,l=e.truthy,P=e.eqeqeq,K=e.Opal,d=e.return_ivar,M=e.send,h=e.alias,N=[],H=e.nil;return E=N,z=[Y=(0,e.klass)(N[0],null,"StringScanner")].concat(E),q=e.$r(z),(i=Y.$$prototype).pos=i.string=i.working=i.matched=i.prev_pos=i.match=H,Y.$attr_reader("pos","matched"),G(Y,"$initialize",function(o){var p=this;return p.string=o,p.pos=0,p.matched=H,p.working=o,p.match=[]}),Y.$attr_reader("string"),G(Y,"$beginning_of_line?",function(){var o=this;return 0===o.pos||"\n"===o.string.charAt(o.pos-1)}),G(Y,"$scan",function(o){var p=this,_=(o=p.$anchor(o)).exec(p.working);return null==_?p.matched=H:(p.prev_pos=p.pos,p.pos+=_[0].length,p.working=p.working.substring(_[0].length),p.matched=_[0],p.match=_,_[0])}),G(Y,"$scan_until",function(o){var p=this;o=p.$anchor(o);for(var _=p.working,B=0;_.length!=B;++B){var n=o.exec(_.substr(B));if(null!==n){var $=B+n[0].length,k=_.substr(0,$);return p.matched=n[0],p.match=n,p.prev_pos=p.pos+B,p.pos+=$,p.working=_.substr($),k}}return p.matched=H}),G(Y,"$[]",function(o){var _;if(l(this.match["$empty?"]()))return H;P(q("Symbol"),_=o)?o=o.$to_s():P(q("String"),_)||(o=K["$coerce_to!"](o,q("Integer"),"to_int"));var B=this.match;return o<0&&(o+=B.length),o<0||o>=B.length||null==B[o]?H:B[o]}),G(Y,"$check",function(o){var p=this,_=(o=p.$anchor(o)).exec(p.working);return p.matched=null==_?H:_[0]}),G(Y,"$check_until",function(o){var p=this,_=p.prev_pos,B=p.pos,n=p.working,$=p.$scan_until(o);return p.prev_pos=_,p.pos=B,p.working=n,$}),G(Y,"$peek",function(o){return this.working.substring(0,o)}),G(Y,"$eos?",function(){return 0===this.working.length}),G(Y,"$exist?",function(o){var _=o.exec(this.working);return null==_?H:0==_.index?0:_.index+1}),G(Y,"$skip",function(o){var p=this,_=(o=p.$anchor(o)).exec(p.working);if(null==_)return p.match=[],p.matched=H;var B=_[0],n=B.length;return p.matched=B,p.match=_,p.prev_pos=p.pos,p.pos+=n,p.working=p.working.substring(n),n}),G(Y,"$skip_until",function(o){var _=this.$scan_until(o);return _===H?H:(this.matched=_.substr(-1),_.length)}),G(Y,"$get_byte",function(){var o=this,p=H;return o.pos<o.string.length?(o.prev_pos=o.pos,o.pos+=1,p=o.matched=o.working.substring(0,1),o.working=o.working.substring(1)):o.matched=H,p}),G(Y,"$match?",function(o){var p=this,_=(o=p.$anchor(o)).exec(p.working);return null==_?H:(p.prev_pos=p.pos,_[0].length)}),G(Y,"$pos=",function(o){var p=this;return o<0&&(o+=p.string.$length()),p.pos=o,p.working=p.string.slice(o)}),G(Y,"$matched_size",function(){return this.matched===H?H:this.matched.length}),G(Y,"$post_match",function(){var o=this;return o.matched===H?H:o.string.substr(o.pos)}),G(Y,"$pre_match",function(){var o=this;return o.matched===H?H:o.string.substr(0,o.prev_pos)}),G(Y,"$reset",function(){var o=this;return o.working=o.string,o.matched=H,o.pos=0}),G(Y,"$rest",d("working")),G(Y,"$rest?",function(){return 0!==this.working.length}),G(Y,"$rest_size",function(){return this.$rest().$size()}),G(Y,"$terminate",function(){var o,p=this;return p.match=H,o=[p.string.$length()],M(p,"pos=",o),o[o.length-1]}),G(Y,"$unscan",function(){var o=this;return o.pos=o.prev_pos,o.prev_pos=H,o.match=H,o}),h(Y,"bol?","beginning_of_line?"),h(Y,"getch","get_byte"),Y.$private(),G(Y,"$anchor",function(o){var p=o.toString().match(/\/([^\/]+)$/);return p=p?p[1]:void 0,new RegExp("^(?:"+o.source+")",p)})},Opal.modules["bcdice/normalize"]=function(e){var h,Q,H,V=e.module,G=e.eqeqeq,l=e.def,P=e.eqeq,K=[],d=e.nil;return h=K,H=[V(K[0],"BCDice")].concat(h),(Q=V(H[0],"Normalize")).$module_function(),l(Q,"$comparison_operator",function(Y){var z;return G(/<=|=</,z=Y)?"<=":G(/>=|=>/,z)?">=":G(/<>|!=|=!/,z)?"!=":G(/</,z)?"<":G(/>/,z)?">":G(/=/,z)?"==":d}),l(Q,"$target_number",function(Y){return P(Y,"?")?Y:Y.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var E,i,B,n,$,k,L,o,z,V=e.module,G=e.klass,l=e.const_set,P=e.hash2,K=e.truthy,d=e.send,M=e.def,h=e.thrower,N=e.top,H=[],j=e.nil;return N.$require("strscan"),N.$require("bcdice/normalize"),E=H,i=z=[V(H[0],"BCDice")].concat(E),B=o=[V(z[0],"Command")].concat(i),$=[n=G(o[0],null,"Lexer")].concat(B),k=e.$r($),(L=n.$$prototype).scanner=L.notations=j,l($[0],"SYMBOLS",P(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),M(n,"$initialize",function(C,D){var w,v,a;return C=K(a=(w=(v=C)===j||null==v?j:v.$split(" ",2))===j||null==w?j:w.$first())?a:"",this.scanner=k("StringScanner").$new(C),this.notations=d(D,"map",[],function(u){return null==u&&(u=j),K(u["$is_a?"](k("String")))?k("Regexp").$new(u):u})}),M(n,"$next_token",function(){try{var C=h("return"),D=this,w=j,v=j,a=j,c=j;return K(D.scanner["$eos?"]())?[!1,"$"]:(d(D.notations,"each",[],function u(b){var m,f=null==u.$$s?this:u.$$s;if(null==f.scanner&&(f.scanner=j),null==b&&(b=j),m=f.scanner.$scan(b),!K(m))return j;C.$throw(["NOTATION",m])},{$$s:D,$$ret:C}),K(w=D.scanner.$scan(/\d+/))?["NUMBER",w.$to_i()]:K(v=D.scanner.$scan(/[<>!=]+/))?(v=k("Normalize").$comparison_operator(v),[K(v)?"CMP_OP":"ILLEGAL",v]):(a=D.scanner.$getch().$upcase(),[K(c=k("SYMBOLS")["$[]"](a))?c:a.$to_sym(),a]))}catch(u){if(u===C)return u.$v;throw u}}),M(n,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var N,E,I,o,p,_,B,z,j,V=e.module,G=e.klass,l=e.def,P=e.return_ivar,K=e.truthy,d=[],M=e.nil;return N=d,E=j=[V(d[0],"BCDice")].concat(N),I=z=[V(j[0],"Command")].concat(E),p=[o=G(z[0],null,"Parsed")].concat(I),_=e.$r(p),(B=o.$$prototype).critical=B.fumble=B.dollar=B.modify_number=B.question_target=B.target_number=B.prefix_number=B.command=B.suffix_number=B.cmp_op=M,o.$attr_accessor("command"),o.$attr_accessor("prefix_number"),o.$attr_accessor("suffix_number"),o.$attr_accessor("critical"),o.$attr_accessor("fumble"),o.$attr_accessor("dollar"),o.$attr_accessor("modify_number"),o.$attr_accessor("cmp_op"),o.$attr_accessor("target_number"),o.$attr_writer("question_target"),l(o,"$initialize",function(){var $=this;return $.prefix_number=M,$.suffix_number=M,$.critical=M,$.fumble=M,$.dollar=M,$.cmp_op=M,$.target_number=M,$.question_target=!1}),l(o,"$question_target?",P("question_target")),l(o,"$to_s",function($){var k=this,L=M,A=M,C=M,D=M,w=M;switch(null==$&&($="after_command"),L=K(k.critical)?"@"+k.critical:M,A=K(k.fumble)?"#"+k.fumble:M,C=K(k.dollar)?"$"+k.dollar:M,D=_("Format").$modifier(k.modify_number),w=K(k.question_target)?"?":k.target_number,$.valueOf()){case"after_command":return[k.prefix_number,k.command,k.suffix_number,L,A,C,D,k.cmp_op,w].$join();case"after_modify_number":return[k.prefix_number,k.command,k.suffix_number,D,L,A,C,k.cmp_op,w].$join();case"after_target_number":return[k.prefix_number,k.command,k.suffix_number,D,k.cmp_op,w,L,A,C].$join();default:return M}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var $,C,c,R,t,g,s,O,re,ee,ie,ce,_e,u,m,r,se,w,v,L,V=e.klass,G=e.module,l=e.slice,P=e.extract_kwargs,K=e.ensure_kwargs,d=e.get_kwarg,M=e.send2,h=e.find_super,N=e.def,H=e.send,j=e.eqeq,Q=e.thrower,E=e.hash,Y=e.const_set,z=e.truthy,q=e.to_ary,i=e.hash2,I=e.top,o=[],p=e.$r(o),_=e.nil,B=e.$$$;return I.$require("racc/parser.rb"),I.$require("bcdice/arithmetic/node"),I.$require("bcdice/command/lexer"),I.$require("bcdice/command/parsed"),V(B(p("BCDice"),"Command"),B(p("Racc"),"Parser"),"Parser"),$=o,C=L=[G(o[0],"BCDice")].concat($),w=[G(L[0],"Command")].concat(C),v=e.$r(w),c=w,m=[u=V(w[0],B(v("Racc"),"Parser"),"Parser")].concat(c),r=e.$r(m),(se=u.$$prototype).notations=se.lexer=se.modifier=se.suffix_number=se.prefix_number=se.need_suffix_number=se.need_prefix_number=se.critical=se.fumble=se.dollar=se.allowed_cmp_op=se.question_target=_,N(u,"$initialize",function te(S,X){var F,x,Z,T,J=this;return te.$$p=null,F=l(arguments),x=P(F),x=K(x),Z=F,T=d(x,"round_type"),M(J,h(J,"initialize",te,!1,!0),"initialize",[],null),J.notations=Z,J.round_type=T,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[_,">=",">","<=","<","==","!="],J.question_target=!1},-2),N(u,"$disable_modifier",function(){return this.modifier=!1,this}),N(u,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),N(u,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),N(u,"$has_prefix_number",function(){var S=this;return S.prefix_number=!0,S.need_prefix_number=!0,S}),N(u,"$has_suffix_number",function(){var S=this;return S.suffix_number=!0,S.need_suffix_number=!0,S}),N(u,"$enable_critical",function(){return this.critical=!0,this}),N(u,"$enable_fumble",function(){return this.fumble=!0,this}),N(u,"$enable_dollar",function(){return this.dollar=!0,this}),N(u,"$restrict_cmp_op_to",function(S){var X;return X=l(arguments),this.allowed_cmp_op=X,this},-1),N(u,"$enable_question_target",function(){return this.question_target=!0,this}),N(u,"$parse",function(S){var X=this;try{return X.lexer=r("Lexer").$new(S,X.notations),X.$do_parse()}catch(F){if(!e.rescue(F,[r("ParseError"),r("ZeroDivisionError")]))throw F;try{return _}finally{e.pop_exception()}}}),u.$private(),N(u,"$parsed",function(S,X,F,x){try{return Q("eval_return"),H(r("Parsed").$new(),"tap",[],function W(J){var U,ne,ae,fe,de,me,ve,he=null==W.$$s?this:W.$$s;return null==he.round_type&&(he.round_type=_),null==J&&(J=_),J["$command="](S["$[]"]("command")),J["$prefix_number="]((U=S["$[]"]("prefix"))===_||null==U?_:U.$eval(he.round_type)),J["$suffix_number="]((ne=S["$[]"]("suffix"))===_||null==ne?_:ne.$eval(he.round_type)),J["$critical="]((ae=X["$[]"]("critical"))===_||null==ae?_:ae.$eval(he.round_type)),J["$fumble="]((fe=X["$[]"]("fumble"))===_||null==fe?_:fe.$eval(he.round_type)),J["$dollar="]((de=X["$[]"]("dollar"))===_||null==de?_:de.$eval(he.round_type)),J["$modify_number="](F.$eval(he.round_type)),J["$cmp_op="](x["$[]"]("cmp_op")),j(x["$[]"]("target"),"?")?(J["$question_target="](!0),H(J,"target_number=",me=[0]),me[me.length-1]):(J["$question_target="](!1),me=[(ve=x["$[]"]("target"),ve===_||null==ve?_:ve.$eval(he.round_type))],H(J,"target_number=",me),me[me.length-1])},{$$s:this})}catch(W){if(W===e.t_eval_return)return W.$v;throw W}}),N(u,"$next_token",function(){return this.lexer.$next_token()}),R=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),t=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),g=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),s=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),O=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),re=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),ee=[_,6,13,3,9,-1,27,-15,-10,-1,-38],ie=[_,_,_,_,_,_,19,16,15,_,_],ce=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),_e=E(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),Y(m[0],"Racc_arg",[R,t,s,g,O,re,ie,ee,19,ce,_e,58,35,!0]),z(r("Ractor","skip_raise")?"constant":_)&&r("Ractor").$make_shareable(r("Racc_arg")),Y(m[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),z(r("Ractor","skip_raise")?"constant":_)&&r("Ractor").$make_shareable(r("Racc_token_to_s_table")),Y(m[0],"Racc_debug_parser",!1),N(u,"$_reduce_1",function(S,X,F){var x,T=this;return z(T.modifier)||T.$raise(r("ParseError")),x=q(S),T.$parsed(null==x[0]?_:x[0],null==x[1]?_:x[1],null==x[2]?_:x[2],null==x[3]?_:x[3])}),N(u,"$_reduce_2",function(S,X,F){var x,T=this;return z(T.modifier)||T.$raise(r("ParseError")),x=q(S),T.$parsed(null==x[0]?_:x[0],null==x[2]?_:x[2],null==x[1]?_:x[1],null==x[3]?_:x[3])}),N(u,"$_reduce_3",function(S,X,F){var x,U;return U=null==(x=q(S))[2]?_:x[2],this.$parsed(null==x[0]?_:x[0],null==x[1]?_:x[1],B(B(r("Arithmetic"),"Node"),"Number").$new(0),U)}),N(u,"$_reduce_4",function(S,X,F){var x=this;return z(x.prefix_number)&&z(x.suffix_number)||x.$raise(r("ParseError")),i(["command","prefix","suffix"],{command:S["$[]"](1),prefix:S["$[]"](0),suffix:S["$[]"](2)})}),N(u,"$_reduce_5",function(S,X,F){var x=this;return z(x.prefix_number)||x.$raise(r("ParseError")),z(x.need_suffix_number)&&x.$raise(r("ParseError")),i(["command","prefix"],{command:S["$[]"](1),prefix:S["$[]"](0)})}),N(u,"$_reduce_6",function(S,X,F){var x=this;return z(x.suffix_number)||x.$raise(r("ParseError")),z(x.need_prefix_number)&&x.$raise(r("ParseError")),i(["command","suffix"],{command:S["$[]"](0),suffix:S["$[]"](1)})}),N(u,"$_reduce_7",function(S,X,F){var x=this;return(z(x.need_prefix_number)||z(x.need_suffix_number))&&x.$raise(r("ParseError")),i(["command"],{command:S["$[]"](0)})}),N(u,"$_reduce_8",function(S,X,F){return i([],{})}),N(u,"$_reduce_9",function(S,X,F){var x,U,W=_;return W=null==(x=q(S))[0]?_:x[0],U=null==x[2]?_:x[2],z(this.critical)&&z(W["$[]"]("critical")["$nil?"]())||this.$raise(r("ParseError")),W["$[]="]("critical",U),W}),N(u,"$_reduce_10",function(S,X,F){var x,U,W=_;return W=null==(x=q(S))[0]?_:x[0],U=null==x[2]?_:x[2],z(this.fumble)&&z(W["$[]"]("fumble")["$nil?"]())||this.$raise(r("ParseError")),W["$[]="]("fumble",U),W}),N(u,"$_reduce_11",function(S,X,F){var x,U,W=_;return W=null==(x=q(S))[0]?_:x[0],U=null==x[2]?_:x[2],z(this.dollar)&&z(W["$[]"]("dollar")["$nil?"]())||this.$raise(r("ParseError")),W["$[]="]("dollar",U),W}),N(u,"$_reduce_12",function(S,X,F){return S["$[]"](1)}),N(u,"$_reduce_13",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"Negative").$new(S["$[]"](1))}),N(u,"$_reduce_14",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"BinaryOp").$new(S["$[]"](0),"+",S["$[]"](2))}),N(u,"$_reduce_15",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"BinaryOp").$new(S["$[]"](0),"-",S["$[]"](2))}),N(u,"$_reduce_16",function(S,X,F){return z(this.allowed_cmp_op["$include?"](_))||this.$raise(r("ParseError")),i([],{})}),N(u,"$_reduce_17",function(S,X,F){var x,W,J;return J=null==(x=q(S))[1]?_:x[1],z(this.allowed_cmp_op["$include?"](W=null==x[0]?_:x[0]))||this.$raise(r("ParseError")),i(["cmp_op","target"],{cmp_op:W,target:J})}),N(u,"$_reduce_18",function(S,X,F){var Z,x=this;return Z=S["$[]"](0),z(x.question_target)||x.$raise(r("ParseError")),z(x.allowed_cmp_op["$include?"](Z))||x.$raise(r("ParseError")),i(["cmp_op","target"],{cmp_op:Z,target:"?"})}),N(u,"$_reduce_19",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"BinaryOp").$new(S["$[]"](0),"+",S["$[]"](2))}),N(u,"$_reduce_20",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"BinaryOp").$new(S["$[]"](0),"-",S["$[]"](2))}),N(u,"$_reduce_22",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"BinaryOp").$new(S["$[]"](0),"*",S["$[]"](2))}),N(u,"$_reduce_23",function(S,X,F){return S["$[]"](3).$new(S["$[]"](0),S["$[]"](2))}),N(u,"$_reduce_25",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),N(u,"$_reduce_26",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"DivideWithCeil")}),N(u,"$_reduce_27",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"DivideWithCeil")}),N(u,"$_reduce_28",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"DivideWithRound")}),N(u,"$_reduce_29",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"DivideWithFloor")}),N(u,"$_reduce_30",function(S,X,F){return S["$[]"](1)}),N(u,"$_reduce_31",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"Negative").$new(S["$[]"](1))}),N(u,"$_reduce_33",function(S,X,F){return S["$[]"](1)}),N(u,"$_reduce_34",function(S,X,F){return B(B(r("Arithmetic"),"Node"),"Number").$new(S["$[]"](0))}),N(u,"$_reduce_none",function(S,X,F){return S["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var H,Y,I,o,p,_,q,Q,V=e.module,G=e.send,l=e.eqeqeq,P=e.truthy,K=e.def,d=e.return_val,M=[],h=e.nil;return H=M,Y=Q=[V(M[0],"BCDice")].concat(H),I=q=[V(Q[0],"Deprecated")].concat(Y),p=[o=V(q[0],"Checker")].concat(I),_=e.$r(p),o.$private(),K(o,"$check_result_legacy",function(n,$,k,L){var w,A=this,C=h,D=h,v=h,y=h;return C=G($,"map",[],"sides".$to_proc()),w=(D=G($,"map",[],"value".$to_proc())).$sum(),v=l([100],y=C)?A.$check_1D100(n,w,k,L):l([20],y)?A.$check_1D20(n,w,k,L):l([6,6],y)?A.$check_2D6(n,w,D,k,L):h,(P(v["$nil?"]())||P(v["$empty?"]()))&&(v=l([10],y=C.$uniq())?A.$check_nD10(n,w,D,k,L):l([6],y)?A.$check_nD6(n,w,D,k,L):h,P(v["$nil?"]())||P(v["$empty?"]()))?h:_("Result").$new(v.$delete_prefix(" \uff1e "))}),K(o,"$check_1D100",d(h)),K(o,"$check_1D20",d(h)),K(o,"$check_nD10",d(h)),K(o,"$check_2D6",d(h)),K(o,"$check_nD6",d(h))},Opal.modules["bcdice/base"]=function(e){var p,A,y,f,r,R,a,c,u,b,D,V=e.module,G=e.klass,l=e.slice,P=e.rb_plus,K=e.truthy,d=e.def,M=e.regexp,h=e.send,N=e.thrower,H=e.return_ivar,j=e.assign_ivar_val,Q=e.eqeqeq,E=e.eqeq,Y=e.return_val,z=e.range,q=e.rb_minus,i=e.rb_divide,I=e.rb_times,o=e.rb_ge,_=e.top,B=[],n=e.$r(B),$=e.nil,k=e.$$$;return _.$require("i18n"),_.$require("i18n/backend/fallbacks"),_.$require("bcdice/randomizer"),_.$require("bcdice/dice_table"),_.$require("bcdice/enum"),_.$require("bcdice/translate"),_.$require("bcdice/result"),_.$require("bcdice/command/parser"),_.$require("bcdice/deprecated/checker"),A=B,y=D=[V(B[0],"BCDice")].concat(A),c=[a=G(D[0],null,"Base")].concat(y),u=e.$r(c),(b=a.$$prototype).raw_input=b.randomizer=b.enabled_upcase_input=b.debug=$,r=[f=e.get_singleton_class(a)].concat(c),R=e.$r(r),f.$attr_reader("prefixes"),d(f,"$register_prefix",function(g){var O,ee;return null==this.prefixes&&(this.prefixes=$),O=l(arguments),this.prefixes=P(K(ee=this.prefixes)?ee:[],O.$flatten())},-1),d(f,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),d(f,"$prefixes_pattern",function(){var g=this,s=$;return null==g.prefixes_pattern&&(g.prefixes_pattern=$),null==g.prefixes&&(g.prefixes=$),g.prefixes_pattern=K(s=g.prefixes_pattern)?s:$,K(g.prefixes_pattern)?g.prefixes_pattern:(g.prefixes=K(s=g.prefixes)?s:[],g.prefixes.$freeze(),g.prefixes_pattern=(K(g.prefixes["$empty?"]())?/(?!)/:M(["^(S)?(",g.prefixes.$join("|"),")"],"i")).$freeze())}),d(f,"$command_pattern",function(){var g=this,s=$,O=$;return null==g.command_pattern&&(g.command_pattern=$),null==g.prefixes&&(g.prefixes=$),g.command_pattern=K(s=g.command_pattern)?s:$,K(g.command_pattern)?g.command_pattern:(g.prefixes=K(s=g.prefixes)?s:[],g.prefixes.$freeze(),O=P(h(k(R("CommonCommand"),"COMMANDS"),"map",[],function(ee){return null==ee&&(ee=$),k(ee,"PREFIX_PATTERN").$source()}),g.prefixes),g.command_pattern=M(["^S?(",O.$join("|"),")"],"i").$freeze())}),d(f,"$eval",function(g){try{return N("eval_return"),this.$new(g).$eval()}catch(re){if(re===e.t_eval_return)return re.$v;throw re}}),a.$include(u("Translate")),a.$include(k(u("Deprecated"),"Checker")),d(a,"$initialize",function(m){var r=this;return r.raw_input=m,r.sort_add_dice=!1,r.sort_barabara_dice=!1,r.d66_sort_type=k(u("D66SortType"),"NO_SORT"),r.enabled_d9=!1,r.round_type=k(u("RoundType"),"FLOOR"),r.sides_implicit_d=6,r.upper_dice_reroll_threshold=$,r.reroll_dice_reroll_threshold=$,r.default_cmp_op=$,r.default_target_number=$,r.enabled_upcase_input=!0,r.locale="ja_jp",r.randomizer=k(u("BCDice"),"Randomizer").$new(),r.debug=!1}),a.$attr_accessor("randomizer"),a.$attr_reader("d66_sort_type"),a.$attr_reader("round_type"),a.$attr_reader("sides_implicit_d"),a.$attr_reader("upper_dice_reroll_threshold"),a.$attr_reader("reroll_dice_reroll_threshold"),a.$attr_reader("default_cmp_op"),a.$attr_reader("default_target_number"),d(a,"$sort_add_dice?",H("sort_add_dice")),d(a,"$sort_barabara_dice?",H("sort_barabara_dice")),d(a,"$enabled_d9?",H("enabled_d9")),d(a,"$enable_debug",j("debug",!0)),d(a,"$eval",function(){var r,t,m=this,R=$;return r=k(u("BCDice"),"Preprocessor").$process(m.raw_input,m),R=K(t=m.$dice_command(r))?t:m.$eval_common_command(m.raw_input),K(R)?(R["$rands="](m.randomizer.$rand_results()),R["$detailed_rands="](m.randomizer.$detailed_rand_results()),R):$}),d(a,"$change_text",function(m){return m}),d(a,"$check_result",function(m,r,R,t){var g=this,s=$,O=$,re=$,ee=$,ie=$;return s=g.$check_result_legacy(m,r,R,t),K(s)?s:(O=h(r,"map",[],"sides".$to_proc()),ee=(re=h(r,"map",[],"value".$to_proc())).$sum(),s=Q([100],ie=O)?g.$result_1d100(m,ee,R,t):Q([20],ie)?g.$result_1d20(m,ee,R,t):Q([6,6],ie)?g.$result_2d6(m,ee,re,R,t):$,E(s,u("Result").$nothing())?$:K(s)?s:(s=Q([10],ie=O.$uniq())?g.$result_nd10(m,ee,re,R,t):Q([6],ie)?g.$result_nd6(m,ee,re,R,t):$,E(s,u("Result").$nothing())?$:K(s)?s:g.$result_ndx(m,R,t)))}),d(a,"$grich_text",Y($)),a.$private(),d(a,"$eval_common_command",function(m){try{N("eval_return");var R=N("return");return m=this.$change_text(m),h(k(u("CommonCommand"),"COMMANDS"),"each",[],function g(s){var re,O=null==g.$$s?this:g.$$s;if(null==O.randomizer&&(O.randomizer=$),null==s&&(s=$),re=s.$eval(m,O,O.randomizer),!K(re))return $;R.$throw(re)},{$$s:this,$$ret:R}),$}catch(g){if(g===e.t_eval_return||g===R)return g.$v;throw g}}),d(a,"$dice_command",function(m){var r=this,R=$,t=$,g=$,s=$;return K(r.enabled_upcase_input)&&(m=m.$upcase()),R=r.$class().$prefixes_pattern().$match(m),K(R)?(t=R["$[]"](1)["$nil?"]()["$!"](),K(t)&&(m=m["$[]"](z(1,-1,!1))),g=r.$eval_game_system_specific_command(m),K(g["$is_a?"](u("Result")))?(g["$secret="](K(s=g["$secret?"]())?s:t),g):K(g["$nil?"]())||K(g["$empty?"]())||E(g,"1")?$:h(u("Result").$new(),"tap",[],function(re){var ee;return null==re&&(re=$),re["$text="](g.$to_s()),h(re,"secret=",ee=[t]),ee[ee.length-1]})):$}),d(a,"$eval_game_system_specific_command",Y($)),d(a,"$result_ndx",function(m,r,R){return K(R["$is_a?"](u("String")))?$:K(m.$send(r,R))?u("Result").$success(this.$translate("success")):u("Result").$failure(this.$translate("failure"))}),d(a,"$result_1d100",Y($)),d(a,"$result_1d20",Y($)),d(a,"$result_nd10",Y($)),d(a,"$result_2d6",Y($)),d(a,"$result_nd6",Y($)),d(a,"$get_table_by_2d6",function(m){return this.$get_table_by_nD6(m,2)}),d(a,"$get_table_by_1d6",function(m){return this.$get_table_by_nD6(m,1)}),d(a,"$get_table_by_nD6",function(m,r){return this.$get_table_by_nDx(m,r,6)}),d(a,"$get_table_by_nDx",function(m,r,R){var g,s=$;return g=this.randomizer.$roll_sum(r,R),s=this.$get_table_value(m["$[]"](q(g,r))),K(s["$nil?"]())?["1",0]:[s,g]}),d(a,"$get_table_by_1d3",function(m){var t,g,r=this,s=$;return r.$debug("get_table_by_1d3"),t=r.randomizer.$roll_sum(1,6),r.$debug("num",t),g=i(q(t,1),2).$to_i(),r.$debug("index",g),s=m["$[]"](g),K(s["$nil?"]())?["1",0]:[s,t]}),d(a,"$get_table_by_d66_swap",function(m){var R;return R=this.randomizer.$roll_d66(k(u("D66SortType"),"ASC")),[this.$get_table_by_number(R,m),R]}),d(a,"$get_table_by_d66",function(m){var R,t,g,O,s=$;return R=this.randomizer.$roll_once(6),t=this.randomizer.$roll_once(6),g=P(I(q(R,1),6),q(t,1)),s=m["$[]"](g),O=""+R+t,K(s["$nil?"]())?["1",O]:[s,O]}),d(a,"$get_table_by_number",function(m,r,R){try{var t=N("return");return null==R&&(R="1"),h(r,"each",[],function s(O){var ee,re=null==s.$$s?this:s.$$s;if(null==O&&(O=$),ee=O["$[]"](0),!K(o(ee,m)))return $;t.$throw(re.$get_table_value(O["$[]"](1)))},{$$s:this,$$ret:t}),this.$get_table_value(R)}catch(s){if(s===t)return s.$v;throw s}},-3),d(a,"$get_table_value",function(m){return K(m["$is_a?"](u("Proc")))?m.$call():m}),d(a,"$roll_tables",function(m,r){var t=$;return t=r["$[]"](m),K(t)?t.$roll(this.randomizer).$to_s():$}),d(a,"$debug",function(m,r){var t,g=this,s=$,O=$;return t=l(arguments,1),K(g.debug)?(s=K(m["$is_a?"](u("String")))?m:m.$inspect(),K(t["$empty?"]())?g.$warn(s):(O=h(t,"map",[],function(ee){return null==ee&&(ee=$),K(ee["$is_a?"](u("String")))?'"'+ee+'"':ee.$inspect()}),g.$warn(s+": "+O.$join(", ")))):$},-2),k(k(n("I18n"),"Backend"),"Simple").$include(k(k(n("I18n"),"Backend"),"Fallbacks")),n("I18n").$load_path()["$<<"](n("Dir")["$[]"](n("File").$join("bcdice","../../i18n/**/*.yml"))),n("I18n")["$default_locale="]("ja_jp"),p=[["ja_jp"]],h(n("I18n").$fallbacks(),"defaults=",p),p[p.length-1]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(e){var j,z,_,L,A,C,D,n,i,I,E,V=e.module,G=e.klass,l=e.const_set,P=e.hash2,K=e.truthy,d=e.def,h=[],N=e.nil;return e.top.$require("strscan"),j=h,z=E=[V(h[0],"BCDice")].concat(j),i=[V(E[0],"GameSystem")].concat(z),I=e.$r(i),_=i,L=n=[G(i[0],I("Base"),"SwordWorld")].concat(_),C=[A=G(n[0],null,"RatingLexer")].concat(L),D=e.$r(C),A.$$prototype.scanner=N,l(C[0],"SYMBOLS",P(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),d(A,"$initialize",function(y){var a,c,b;return y=K(b=(a=(c=y)===N||null==c?N:c.$split(" ",2))===N||null==a?N:a.$first())?b:"",this.scanner=D("StringScanner").$new(y)}),d(A,"$next_token",function(){var y=this,a=N,c=N,b=N;return K(y.scanner["$eos?"]())?[!1,"$"]:K(a=y.scanner.$scan(/\d+/))?["NUMBER",a.$to_i()]:(c=y.scanner.$getch().$upcase(),[K(b=D("SYMBOLS")["$[]"](c))?b:c.$to_sym(),c])}),d(A,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(e){var Q,q,B,A,C,D,w,v,$,I,o,Y,V=e.module,G=e.klass,l=e.def,P=e.truthy,K=e.rb_le,d=e.rb_plus,M=e.rb_lt,h=e.neqeq,N=[],H=e.nil;return Q=N,q=Y=[V(N[0],"BCDice")].concat(Q),I=[V(Y[0],"GameSystem")].concat(q),o=e.$r(I),B=I,A=$=[G(I[0],o("Base"),"SwordWorld")].concat(B),D=[C=G($[0],null,"RatingParsed")].concat(A),w=e.$r(D),(v=C.$$prototype).modifier_after_half=v.modifier_after_one_and_a_half=v.semi_fixed_val=v.kept_modify=v.rate=v.greatest_fortune=v.modifier=H,C.$attr_accessor("rate"),C.$attr_accessor("critical"),C.$attr_accessor("kept_modify"),C.$attr_accessor("first_to"),C.$attr_accessor("first_modify"),C.$attr_accessor("rateup"),C.$attr_accessor("greatest_fortune"),C.$attr_accessor("semi_fixed_val"),C.$attr_accessor("tmp_fixed_val"),C.$attr_accessor("modifier"),C.$attr_accessor("modifier_after_half"),C.$attr_accessor("modifier_after_one_and_a_half"),l(C,"$initialize",function(a,c){var u=this;return u.rate=a,u.modifier=c,u.critical=13,u.kept_modify=0,u.first_to=0,u.first_modify=0,u.greatest_fortune=!1,u.rateup=0,u.semi_fixed_val=0,u.tmp_fixed_val=0,u.modifier_after_half=H,u.modifier_after_one_and_a_half=H}),l(C,"$half",function(){return this.modifier_after_half["$nil?"]()["$!"]()}),l(C,"$one_and_a_half",function(){return this.modifier_after_one_and_a_half["$nil?"]()["$!"]()}),l(C,"$min_critical",function(){var a=this;return P(K(a.semi_fixed_val,1))?3:d(d(a.semi_fixed_val,a.kept_modify),2).$clamp(3,13)}),l(C,"$infinite_roll?",function(){return M(this.$critical(),this.$min_critical())}),l(C,"$to_s",function(){var a=this,c=H;return c="KeyNo."+a.rate,P(M(a.$critical(),13))&&(c=d(c,"c["+a.$critical()+"]")),h(a.$first_modify(),0)&&(c=d(c,"m["+w("Format").$modifier(a.$first_modify())+"]")),h(a.$first_to(),0)&&(c=d(c,"m["+a.$first_to()+"]")),h(a.$rateup(),0)&&(c=d(c,"r["+a.$rateup()+"]")),P(a.greatest_fortune)&&(c=d(c,"gf")),h(a.$semi_fixed_val(),0)&&(c=d(c,"sf["+a.$semi_fixed_val()+"]")),h(a.$tmp_fixed_val(),0)&&(c=d(c,"tf["+a.$tmp_fixed_val()+"]")),h(a.$kept_modify(),0)&&(c=d(c,"a["+w("Format").$modifier(a.$kept_modify())+"]")),h(a.modifier,0)&&(c=d(c,w("Format").$modifier(a.modifier))),c})},Opal.modules["bcdice/game_system/sword_world/rating_options"]=function(e){var h,Q,I,n,p,Y,z,H,V=e.module,G=e.klass,l=e.truthy,P=e.def,K=[];return h=K,Q=H=[V(K[0],"BCDice")].concat(h),Y=[V(H[0],"GameSystem")].concat(Q),z=e.$r(Y),I=Y,p=[G(Y[0],z("Base"),"SwordWorld")].concat(I),(n=G(p[0],null,"RatingOptions")).$attr_accessor("critical"),n.$attr_accessor("kept_modify"),n.$attr_accessor("first_to"),n.$attr_accessor("first_modify"),n.$attr_accessor("rateup"),n.$attr_accessor("greatest_fortune"),n.$attr_accessor("semi_fixed_val"),n.$attr_accessor("tmp_fixed_val"),n.$attr_accessor("modifier"),n.$attr_accessor("modifier_after_half"),n.$attr_accessor("modifier_after_one_and_a_half"),P(n,"$settable_first_roll_adjust_option?",function(){var L;return l(L=this.$first_modify()["$nil?"]())?this.$first_to()["$nil?"]():L}),P(n,"$settable_non_2d_roll_option?",function(){var L,A,k=this;return l(L=l(A=k.$greatest_fortune()["$nil?"]())?k.$semi_fixed_val()["$nil?"]():A)?k.$tmp_fixed_val()["$nil?"]():L})},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(e){var p,$,w,b,g,s,O,re,ee,ie,ce,oe,ue,$e,f,R,t,S,y,a,L,A,B,V=e.module,G=e.klass,l=e.ensure_kwargs,P=e.send2,K=e.find_super,d=e.def,M=e.send,h=e.truthy,N=e.not,H=e.thrower,j=e.hash,Q=e.const_set,E=e.to_ary,Y=e.eqeq,z=e.top,q=[],i=e.nil,I=e.$$$;return z.$require("racc/parser.rb"),z.$require("bcdice/arithmetic/node"),z.$require("bcdice/enum"),z.$require("bcdice/game_system/sword_world/rating_lexer"),z.$require("bcdice/game_system/sword_world/rating_parsed"),z.$require("bcdice/game_system/sword_world/rating_options"),p=q,$=B=[V(q[0],"BCDice")].concat(p),L=[V(B[0],"GameSystem")].concat($),A=e.$r(L),w=L,y=[G(L[0],A("Base"),"SwordWorld")].concat(w),a=e.$r(y),b=y,R=[f=G(y[0],I(a("Racc"),"Parser"),"RatingParser")].concat(b),t=e.$r(R),(S=f.$$prototype).lexer=S.round_type=S.version=i,d(f,"$initialize",function X(F){var x,Z,W=this;return X.$$p=null,null==(x=(F=l(F)).$$smap.version)&&(x="v1_0"),null==(Z=F.$$smap.round_type)&&(Z=I(t("RoundType"),"CEIL")),P(W,K(W,"initialize",X,!1,!0),"initialize",[],null),W.version=x,W.round_type=Z},-1),d(f,"$set_debug",function(){return this.yydebug=!0,this}),d(f,"$parse",function(F){try{return this.lexer=t("RatingLexer").$new(F),this.$do_parse()}catch(Z){if(!e.rescue(Z,[t("ParseError"),t("ZeroDivisionError")]))throw Z;try{return i}finally{e.pop_exception()}}}),f.$private(),d(f,"$parsed",function(F,x,Z){try{return H("eval_return"),M(t("RatingParsed").$new(F,x),"tap",[],function J(U){var ne,ae,fe,de,me,ve,he,ye,pe,ge=null==J.$$s?this:J.$$s,be=i;return null==ge.round_type&&(ge.round_type=i),null==U&&(U=i),U["$kept_modify="](h(be=(ne=Z.$kept_modify())===i||null==ne?i:ne.$eval(ge.round_type))?be:0),U["$first_to="](h(be=Z.$first_to())?be:0),U["$first_modify="](h(be=Z.$first_modify())?be:0),U["$rateup="](h(be=(ae=Z.$rateup())===i||null==ae?i:ae.$eval(ge.round_type))?be:0),N(Z.$greatest_fortune()["$nil?"]())&&U["$greatest_fortune="](Z.$greatest_fortune()),U["$semi_fixed_val="](h(be=(fe=Z.$semi_fixed_val())===i||null==fe?i:fe.$clamp(1,6))?be:0),U["$tmp_fixed_val="](h(be=(de=Z.$tmp_fixed_val())===i||null==de?i:de.$clamp(1,6))?be:0),U["$modifier_after_half="]((me=Z.$modifier_after_half())===i||null==me?i:me.$eval(ge.round_type)),U["$modifier_after_one_and_a_half="]((ve=Z.$modifier_after_one_and_a_half())===i||null==ve?i:ve.$eval(ge.round_type)),he=[h((pe=Z.$critical(),ye=pe===i||null==pe?i:pe.$eval(ge.round_type),be=ye===i||null==ye?i:ye.$clamp(0,13)))?be:h(U.$half())||h(U.$one_and_a_half())?13:10],M(U,"critical=",he),he[he.length-1]},{$$s:this})}catch(J){if(J===e.t_eval_return)return J.$v;throw J}}),d(f,"$next_token",function(){return this.lexer.$next_token()}),g=e.large_array_unpack("18,16,17,19,6,20,21,23,24,64,65,27,28,13,66,14,22,15,18,16,17,19,5,20,21,23,24,5,9,3,4,13,10,14,22,15,18,16,17,19,11,20,21,23,24,34,5,34,40,13,42,14,22,15,30,31,30,31,33,34,33,34,62,63,62,63,34,43,30,31,30,31,33,34,33,30,31,44,34,33,34,52,30,31,57,34,33,30,31,30,31,33,34,33,30,31,58,34,33,34,60,30,31,61,34,33,30,31,30,31,33,34,33,30,31,,34,33,34,,30,31,,34,33,30,31,30,31,33,36,33,30,31,62,63,33,62,63,37,38,62,63,62,63,62,63"),s=e.large_array_unpack("7,7,7,7,1,7,7,7,7,55,55,12,12,7,55,7,7,7,25,25,25,25,3,25,25,25,25,0,4,0,0,25,5,25,25,25,49,49,49,49,6,49,49,49,49,13,9,14,17,49,19,49,49,49,13,13,14,14,13,16,14,18,46,46,48,48,22,20,16,16,18,18,16,23,18,22,22,21,24,22,27,29,23,23,37,28,23,24,24,27,27,24,30,27,28,28,38,31,28,33,43,30,30,44,40,30,31,31,33,33,31,62,33,40,40,,63,40,64,,62,62,,65,62,63,63,64,64,63,15,64,65,65,50,50,65,51,51,15,15,56,56,69,69,70,70"),O=e.large_array_unpack("24,4,,19,23,30,40,-4,,43,,,0,43,45,128,57,43,59,42,59,69,64,71,76,14,,78,83,63,90,95,,97,,,,82,94,,102,,,98,101,,49,,51,32,121,124,,,,-2,128,,,,,,109,114,116,121,,,,130,132"),re=e.large_array_unpack("-36,-36,-5,-36,-36,-36,-36,-1,-5,-36,-4,71,-6,-36,-36,-36,-12,-36,-36,-36,-36,-36,-36,-36,-36,-2,-5,-36,-36,-36,-36,-36,-33,-36,-35,-8,-9,-36,-36,-13,-14,-16,-17,-36,-36,-20,-21,-30,-22,-3,-23,-24,-7,-31,-32,-36,-27,-10,-11,-15,-18,-19,-36,-36,-36,-36,-34,-28,-29,-25,-26"),ee=e.large_array_unpack("29,35,7,39,1,41,46,48,25,45,50,51,2,55,,8,56,53,54,,,26,,,,,49,59,,,,,,,,,,,,,,,,,,,,69,70,67,68"),ie=e.large_array_unpack("5,5,3,5,1,5,6,6,3,5,6,6,2,7,,2,6,5,5,,,2,,,,,3,5,,,,,,,,,,,,,,,,,,,,6,6,5,5"),ce=[i,4,12,0,i,-13,-17,-20,i],oe=[i,i,i,i,12,47,i,i,32],ue=e.large_array_unpack("0,0,racc_error,2,23,_reduce_1,3,23,_reduce_2,4,23,_reduce_3,2,24,_reduce_4,0,25,_reduce_5,2,25,_reduce_6,4,25,_reduce_7,3,25,_reduce_8,3,25,_reduce_9,4,25,_reduce_10,4,25,_reduce_11,2,25,_reduce_12,3,25,_reduce_13,3,25,_reduce_14,4,25,_reduce_15,3,25,_reduce_16,3,25,_reduce_17,4,25,_reduce_18,4,25,_reduce_19,3,25,_reduce_20,2,26,_reduce_21,2,26,_reduce_22,3,26,_reduce_23,3,26,_reduce_24,3,29,_reduce_25,3,29,_reduce_26,1,29,_reduce_none,3,28,_reduce_28,3,28,_reduce_29,1,28,_reduce_none,2,27,_reduce_31,2,27,_reduce_32,1,27,_reduce_none,3,30,_reduce_34,1,30,_reduce_35"),$e=j(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"O",6,"G",7,"F",8,"S",9,"T",10,"PLUS",11,"MINUS",12,"ASTERISK",13,"SLASH",14,"PARENL",15,"PARENR",16,"BRACKETL",17,"BRACKETR",18,"AT",19,"SHARP",20,"DOLLAR",21),Q(R[0],"Racc_arg",[g,s,re,O,ee,ie,oe,ce,22,ue,$e,71,36,!0]),h(t("Ractor","skip_raise")?"constant":i)&&t("Ractor").$make_shareable(t("Racc_arg")),Q(R[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","O","G","F","S","T","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),h(t("Ractor","skip_raise")?"constant":i)&&t("Ractor").$make_shareable(t("Racc_token_to_s_table")),Q(R[0],"Racc_debug_parser",!1),d(f,"$_reduce_1",function(F,x,Z){try{H("eval_return");var W,ne,de,ae=i,fe=i;return ne=null==(W=E(F))[0]?i:W[0],fe=h(de=(ae=null==W[1]?i:W[1]).$modifier())?de:I(I(t("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ne,fe.$eval(this.round_type),ae)}catch(me){if(me===e.t_eval_return)return me.$v;throw me}}),d(f,"$_reduce_2",function(F,x,Z){try{H("eval_return");var W,ae,de,U=this,fe=i,me=i;return ae=null==(W=E(F))[1]?i:W[1],h((fe=null==W[2]?i:W[2]).$modifier_after_one_and_a_half())&&U.$raise(t("ParseError")),h(fe.$modifier_after_half())||fe["$modifier_after_half="](I(I(t("Arithmetic"),"Node"),"Number").$new(0)),me=h(de=fe.$modifier())?de:I(I(t("Arithmetic"),"Node"),"Number").$new(0),U.$parsed(ae,me.$eval(U.round_type),fe)}catch(ve){if(ve===e.t_eval_return)return ve.$v;throw ve}}),d(f,"$_reduce_3",function(F,x,Z){try{H("eval_return");var W,ae,de,U=this,fe=i,me=i;return ae=null==(W=E(F))[2]?i:W[2],h((fe=null==W[3]?i:W[3]).$modifier_after_half())&&U.$raise(t("ParseError")),h(fe.$modifier_after_one_and_a_half())||fe["$modifier_after_one_and_a_half="](I(I(t("Arithmetic"),"Node"),"Number").$new(0)),me=h(de=fe.$modifier())?de:I(I(t("Arithmetic"),"Node"),"Number").$new(0),U.$parsed(ae,me.$eval(U.round_type),fe)}catch(ve){if(ve===e.t_eval_return)return ve.$v;throw ve}}),d(f,"$_reduce_4",function(F,x,Z){return F["$[]"](1).$to_i()}),d(f,"$_reduce_5",function(F,x,Z){return t("RatingOptions").$new()}),d(f,"$_reduce_6",function(F,x,Z){var T,ne,U=i;return ne=null==(T=E(F))[1]?i:T[1],h((U=null==T[0]?i:T[0]).$modifier()["$nil?"]())||this.$raise(t("ParseError")),U["$modifier="](ne),U}),d(f,"$_reduce_7",function(F,x,Z){var T,ae,U=i;return ae=null==(T=E(F))[2]?i:T[2],h((U=null==T[0]?i:T[0]).$critical()["$nil?"]())||this.$raise(t("ParseError")),U["$critical="](ae),U}),d(f,"$_reduce_8",function(F,x,Z){var T,ae,U=i;return ae=null==(T=E(F))[2]?i:T[2],h((U=null==T[0]?i:T[0]).$critical()["$nil?"]())||this.$raise(t("ParseError")),U["$critical="](ae),U}),d(f,"$_reduce_9",function(F,x,Z){var T,U=i,ae=i;return ae=null==(T=E(F))[2]?i:T[2],h((U=null==T[0]?i:T[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),U["$first_to="](ae.$to_i()),U}),d(f,"$_reduce_10",function(F,x,Z){var T,U=i,ae=i;return ae=null==(T=E(F))[3]?i:T[3],h((U=null==T[0]?i:T[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),U["$first_modify="](ae.$to_i()),U}),d(f,"$_reduce_11",function(F,x,Z){var T,U=i,ae=i;return ae=null==(T=E(F))[3]?i:T[3],h((U=null==T[0]?i:T[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),U["$first_modify="](ae.$to_i()["$-@"]()),U}),d(f,"$_reduce_12",function(F,x,Z){var T,U=i;return T=E(F),h((U=null==T[0]?i:T[0]).$modifier_after_half()["$nil?"]())||this.$raise(t("ParseError")),U["$modifier_after_half="](I(I(t("Arithmetic"),"Node"),"Number").$new(0)),U}),d(f,"$_reduce_13",function(F,x,Z){var T,ae,U=i;return ae=null==(T=E(F))[2]?i:T[2],h((U=null==T[0]?i:T[0]).$modifier_after_half()["$nil?"]())||this.$raise(t("ParseError")),U["$modifier_after_half="](ae),U}),d(f,"$_reduce_14",function(F,x,Z){var T,U=i;return T=E(F),h((U=null==T[0]?i:T[0]).$modifier_after_one_and_a_half())&&this.$raise(t("ParseError")),U["$modifier_after_one_and_a_half="](I(I(t("Arithmetic"),"Node"),"Number").$new(0)),U}),d(f,"$_reduce_15",function(F,x,Z){var T,ae,U=i;return ae=null==(T=E(F))[3]?i:T[3],h((U=null==T[0]?i:T[0]).$modifier_after_one_and_a_half())&&this.$raise(t("ParseError")),U["$modifier_after_one_and_a_half="](ae),U}),d(f,"$_reduce_16",function(F,x,Z){var T,ae,U=i;return U=null==(T=E(F))[0]?i:T[0],ae=null==T[2]?i:T[2],h(["v2_5","v2_0"]["$include?"](this.version))&&h(U.$rateup()["$nil?"]())||this.$raise(t("ParseError")),U["$rateup="](ae),U}),d(f,"$_reduce_17",function(F,x,Z){var T,U=i;return U=null==(T=E(F))[0]?i:T[0],h(["v2_5","v2_0"]["$include?"](this.version))&&h(U["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),U["$greatest_fortune="](!0),U}),d(f,"$_reduce_18",function(F,x,Z){var T,U=i,ae=i;return U=null==(T=E(F))[0]?i:T[0],ae=null==T[3]?i:T[3],h(["v2_5","v2_0"]["$include?"](this.version))&&h(U["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),U["$semi_fixed_val="](ae.$to_i()),U}),d(f,"$_reduce_19",function(F,x,Z){var T,U=i,ae=i;return U=null==(T=E(F))[0]?i:T[0],ae=null==T[3]?i:T[3],h(["v2_5","v2_0"]["$include?"](this.version))&&h(U["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),U["$tmp_fixed_val="](ae.$to_i()),U}),d(f,"$_reduce_20",function(F,x,Z){var T,ae,U=i;return U=null==(T=E(F))[0]?i:T[0],ae=null==T[2]?i:T[2],Y(this.version,"v2_5")&&h(U.$kept_modify()["$nil?"]())||this.$raise(t("ParseError")),U["$kept_modify="](ae),U}),d(f,"$_reduce_21",function(F,x,Z){return F["$[]"](1)}),d(f,"$_reduce_22",function(F,x,Z){return I(I(t("Arithmetic"),"Node"),"Negative").$new(F["$[]"](1))}),d(f,"$_reduce_23",function(F,x,Z){return I(I(t("Arithmetic"),"Node"),"BinaryOp").$new(F["$[]"](0),"+",F["$[]"](2))}),d(f,"$_reduce_24",function(F,x,Z){return I(I(t("Arithmetic"),"Node"),"BinaryOp").$new(F["$[]"](0),"-",F["$[]"](2))}),d(f,"$_reduce_25",function(F,x,Z){return I(I(t("Arithmetic"),"Node"),"BinaryOp").$new(F["$[]"](0),"+",F["$[]"](2))}),d(f,"$_reduce_26",function(F,x,Z){return I(I(t("Arithmetic"),"Node"),"BinaryOp").$new(F["$[]"](0),"-",F["$[]"](2))}),d(f,"$_reduce_28",function(F,x,Z){return I(I(t("Arithmetic"),"Node"),"BinaryOp").$new(F["$[]"](0),"*",F["$[]"](2))}),d(f,"$_reduce_29",function(F,x,Z){return I(I(t("Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(F["$[]"](0),F["$[]"](2))}),d(f,"$_reduce_31",function(F,x,Z){return F["$[]"](1)}),d(f,"$_reduce_32",function(F,x,Z){return I(I(t("Arithmetic"),"Node"),"Negative").$new(F["$[]"](1))}),d(f,"$_reduce_34",function(F,x,Z){return F["$[]"](1)}),d(f,"$_reduce_35",function(F,x,Z){return I(I(t("Arithmetic"),"Node"),"Number").$new(F["$[]"](0))}),d(f,"$_reduce_none",function(F,x,Z){return F["$[]"](0)})},Opal.modules["bcdice/game_system/SwordWorld"]=function(e){var L,w,b,f,m,r,R,y,a,C,V=e.module,G=e.klass,l=e.const_set,P=e.send2,K=e.find_super,d=e.def,M=e.truthy,h=e.rb_ge,N=e.rb_le,H=e.eqeq,j=e.neqeq,Q=e.rb_minus,E=e.rb_gt,Y=e.hash2,z=e.send,q=e.to_ary,i=e.rb_plus,I=e.rb_lt,o=e.rb_times,p=e.thrower,_=e.rb_divide,B=e.top,n=[],$=e.nil;return B.$require("bcdice/base"),B.$require("bcdice/game_system/sword_world/rating_parser"),L=n,w=C=[V(n[0],"BCDice")].concat(L),y=[V(C[0],"GameSystem")].concat(w),a=e.$r(y),b=y,m=[f=G(y[0],a("Base"),"SwordWorld")].concat(b),r=e.$r(m),(R=f.$$prototype).rating_table=R.randomizer=$,l(m[0],"ID","SwordWorld"),l(m[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),l(m[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),l(m[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),f.$register_prefix("H?K"),d(f,"$initialize",function t(g){var O=this;return t.$$p=null,P(O,K(O,"initialize",t,!1,!0),"initialize",[g],null),O.rating_table=0}),d(f,"$result_2d6",function(g,s,O,re,ee){return M(h(s,12))?r("Result").$critical(this.$translate("SwordWorld.critical")):M(N(s,2))?r("Result").$fumble(this.$translate("SwordWorld.fumble")):j(re,">=")||H(ee,"?")?$:M(h(g,ee))?r("Result").$success(this.$translate("success")):r("Result").$failure(this.$translate("failure"))}),d(f,"$eval_game_system_specific_command",function(g){return this.$rating(g)}),f.$private(),d(f,"$rating_parser",function(){return r("RatingParser").$new()}),d(f,"$rating",function(g){var s,O,re=this,ee=$,ie=$,ce=$,oe=$,ue=$,_e=$,le=$,$e=$,se=$,te=$,S=$,X=$,F=$,x=$,T=$,W=$;return re.$debug("rating string",g),ee=re.$rating_parser().$parse(g),M(ee)?(ie=re.$getSW2_0_RatingTable(),ce=Q(ie.$length(),1),re.$debug("keyMax",ce),M(E(ee.$rate(),ce))?r("Result").$new(re.$translate("SwordWorld.keynumber_exceeds",Y(["keyMax"],{keyMax:ce}))):M(ee["$infinite_roll?"]())?r("Result").$new(re.$translate("SwordWorld.infinite_critical",Y(["min_critical"],{min_critical:ee.$min_critical()}))):(oe=re.$getNewRates(ie),ue=ee+" \uff1e ",_e=[],le=[],$e=[],se=0,te=0,S=0,X=0,F=ee.$first_to(),x=ee.$first_modify(),function(){try{var J=p("break");return z(re,"loop",[],function U(){var ne,ae,ve,he,fe=null==U.$$s?this:U.$$s,de=$,me=$;if(ae=fe.$rollDice(ee,X),me=null==(ne=q(ae))[1]?$:ne[1],se=de=null==ne[0]?$:ne[0],j(F,0)?(se=de=F,F=0):j(x,0)&&(se=i(se,x),x=0),M(N(de,2))&&(_e["$<<"](de.$to_s()),le["$<<"](me.$to_s()),$e["$<<"]("**"),X=i(X,1),J.$throw()),j(ee.$kept_modify(),0)&&j(se,2)&&(se=i(se,ee.$kept_modify())),M(I(se,2))&&(se=2),M(E(se,12))&&(se=12),ve=i(ee.$rate(),o(X,ee.$rateup())).$clamp(0,ce),fe.$debug("currentKey",ve),he=oe["$[]"](se)["$[]"](ve),fe.$debug("rateValue",he),S=i(S,he),te=i(te,se),_e["$<<"](se.$to_s()),le["$<<"](me.$to_s()),$e["$<<"](M(E(se,2))?he:"**"),X=i(X,1),M(h(se,ee.$critical())))return $;J.$throw()},{$$s:re})}catch(U){if(U===J)return U.$v;throw U}}(),O=re.$getResultText(S,ee,le,_e,$e,te,X),s=q(O),T=null==s[1]?$:s[1],W=null==s[2]?$:s[2],ue=i(ue,null==s[0]?$:s[0]),z(r("Result").$new(),"tap",[],function(U){var ne;return null==U&&(U=$),U["$text="](ue),U["$critical="](T),z(U,"fumble=",ne=[W]),ne[ne.length-1]}))):(re.$debug("not matched"),"1")}),d(f,"$getSW2_0_RatingTable",function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]}),d(f,"$getNewRates",function(g){var s,O,ee=$,ie=$,ce=$,oe=$,ue=$,_e=$,le=$,$e=$,se=$,te=$,S=$;return ee=[],ie=[],ce=[],oe=[],ue=[],_e=[],le=[],$e=[],se=[],te=[],S=[],z(g,"each",[],function(x){var Z=$;return null==x&&(x=$),Z=x.$split(/,/),S.$push(0),ee.$push(Z["$[]"](1).$to_i()),ie.$push(Z["$[]"](2).$to_i()),ce.$push(Z["$[]"](3).$to_i()),oe.$push(Z["$[]"](4).$to_i()),ue.$push(Z["$[]"](5).$to_i()),_e.$push(Z["$[]"](6).$to_i()),le.$push(Z["$[]"](7).$to_i()),$e.$push(Z["$[]"](8).$to_i()),se.$push(Z["$[]"](9).$to_i()),te.$push(Z["$[]"](10).$to_i())}),H(this.rating_table,1)&&te["$[]="](31,(s=[32,(O=[33,10],z(te,"[]=",O),O[O.length-1])],z(te,"[]=",s),s[s.length-1])),[S,S,S,ee,ie,ce,oe,ue,_e,le,$e,se,te]}),d(f,"$rollDice",function(g,s){var re=$;return[(re=this.randomizer.$roll_barabara(2,6)).$sum(),re.$join(",")]}),d(f,"$getResultText",function(g,s,O,re,ee,ie,ce){var ue=$,_e=$,le=$,$e=$,se=$;return(ue=[]).$push("2D:["+O.$join(" ")+"]="+re.$join(",")),M(N(ie,2))?(ue.$push(ee.$join(",")),ue.$push(this.$translate("SwordWorld.fumble")),[ue.$join(" \uff1e "),!1,!0]):(M(E(ee.$size(),1))||j(s.$modifier(),0)?(_e=i(ee.$join(","),r("Format").$modifier(s.$modifier())),M(s.$half())?(_e="("+_e+")/2",j(s.$modifier_after_half(),0)&&(_e=i(_e,r("Format").$modifier(s.$modifier_after_half())))):M(s.$one_and_a_half())&&(_e="("+_e+")*1.5",j(s.$modifier_after_one_and_a_half(),0)&&(_e=i(_e,r("Format").$modifier(s.$modifier_after_one_and_a_half())))),ue.$push(_e)):M(s.$half())?(_e=ee.$first()+"/2",j(s.$modifier_after_half(),0)&&(_e=i(_e,r("Format").$modifier(s.$modifier_after_half()))),ue.$push(_e)):M(s.$one_and_a_half())&&(_e=ee.$first()+"*1.5",j(s.$modifier_after_one_and_a_half(),0)&&(_e=i(_e,r("Format").$modifier(s.$modifier_after_one_and_a_half()))),ue.$push(_e)),M(E(ce,1))&&(le=this.$translate("SwordWorld.round_text",Y(["reroll_count"],{reroll_count:Q(ce,1)})),ue.$push(le)),$e=i(g,s.$modifier()),M(s.$half())?($e=_($e,2).$ceil(),j(s.$modifier_after_half(),0)&&($e=i($e,s.$modifier_after_half()))):M(s.$one_and_a_half())&&($e=o($e,1.5).$ceil(),j(s.$modifier_after_one_and_a_half(),0)&&($e=i($e,s.$modifier_after_one_and_a_half()))),se=$e.$to_s(),ue.$push(se),[ue.$join(" \uff1e "),E(ce,1),!1])})},Opal.modules["bcdice/game_system/sword_world/transcendent_test"]=function(e){var Y,I,$,D,w,v,y,a,L,p,_,q,V=e.module,G=e.klass,l=e.def,P=e.truthy,K=e.rb_lt,d=e.hash2,M=e.rb_ge,h=e.rb_plus,N=e.send,H=e.top,j=[],Q=e.nil;return H.$require("bcdice/result"),H.$require("bcdice/translate"),Y=j,I=q=[V(j[0],"BCDice")].concat(Y),p=[V(q[0],"GameSystem")].concat(I),_=e.$r(p),$=p,D=L=[G(p[0],_("SwordWorld"),"SwordWorld2_0")].concat($),v=[w=G(L[0],null,"TranscendentTest")].concat(D),y=e.$r(v),(a=w.$$prototype).modifier=a.critical_value=a.expression=a.modifier_str=a.target=a.cmp_op=Q,w.$include(y("Translate")),l(w,"$initialize",function(u,b,f,m,r){var R=this;return R.critical_value=u,R.modifier=b,R.cmp_op=f,R.target=m,R.locale=r,R.modifier_str=y("Format").$modifier(R.modifier),R.expression=R.$node_expression()}),l(w,"$execute",function(u){var r,R,t,b=this,f=Q,m=Q,g=Q,s=Q,O=Q,re=Q;if(P(K(b.critical_value,3)))return b.$translate("SwordWorld2_0.transcendent_critical_too_small",d(["expression"],{expression:b.expression}));if(m=[f=u.$roll_barabara(2,6)],r=f["$=="]([1,1]),R=f["$=="]([6,6]),!P(r))for(;P(M(b.$sum_of_dice(m.$last()),b.critical_value));)m.$push(u.$roll_barabara(2,6));return t=b.$sum_of_dice(m),g=h(t,b.modifier),s=b.$result_status(g,m.$length(),r,R),O=d(["success","failure","super_success","critical","fumble"],{success:b.$translate("success"),failure:b.$translate("failure"),super_success:b.$translate("SwordWorld2_0.super_success"),critical:b.$translate("SwordWorld.critical"),fumble:b.$translate("SwordWorld.fumble")}).$freeze()["$[]"](s),re=["("+b.expression+")",""+b.$dice_str(m,t)+b.modifier_str,g,O].$compact(),N(y("Result").$new(),"tap",[],function(ie){var ce;return null==ie&&(ie=Q),ie["$text="](re.$join(" \uff1e ")),ie["$fumble="](s["$=="]("fumble")),ie["$critical="](s["$=="]("critical")),ie["$success="](["success","super_success","critical"]["$include?"](s)),ce=[["failure","fumble"]["$include?"](s)],N(ie,"failure=",ce),ce[ce.length-1]})}),w.$private(),l(w,"$node_expression",function(){var b,u=this;return b="2D6@"+u.critical_value+u.modifier_str,P(u.target)?""+b+u.cmp_op+u.target:b}),l(w,"$sum_of_dice",function(u){return u.$flatten().$sum()}),l(w,"$dice_str",function(u,b){return""+b+N(u,"map",[],function(r){return null==r&&(r=Q),"["+r.$join(",")+"]"}).$join()}),l(w,"$result_status",function(u,b,f,m){var r=this;return P(r.target)?P(f)?"fumble":P(m)?"critical":P(u.$send(r.cmp_op,r.target))?P(M(b,2))&&P(M(u,41))?"super_success":"success":"failure":"no_target"})},Opal.modules["bcdice/game_system/SwordWorld2_0"]=function(e){var _,k,v,y,a,c,u,A,C,n,V=e.module,G=e.klass,l=e.const_set,P=e.send2,K=e.find_super,d=e.def,M=e.eqeqeq,h=e.truthy,N=e.hash2,H=e.rb_gt,j=e.rb_plus,Q=e.eqeq,E=e.rb_times,Y=e.send,z=e.neqeq,q=e.top,i=[],I=e.nil,o=e.$$$;return q.$require("bcdice/arithmetic_evaluator"),q.$require("bcdice/game_system/SwordWorld"),q.$require("bcdice/game_system/sword_world/transcendent_test"),_=i,k=n=[V(i[0],"BCDice")].concat(_),A=[V(n[0],"GameSystem")].concat(k),C=e.$r(A),v=A,a=[y=G(A[0],C("SwordWorld"),"SwordWorld2_0")].concat(v),c=e.$r(a),(u=y.$$prototype).locale=u.randomizer=I,l(a[0],"ID","SwordWorld2.0"),l(a[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.0"),l(a[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.0"),l(a[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r10\n\u3000\u4f8b\uff09K20r10\u3000K30+24@8R10\u3000K40+24@8$12r10\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r10gf\n\n\u30fb\u5a01\u529b\u8868\u30921d+sf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u3082\u7d99\u7d9a sf4\n\u3000\u4f8b\uff09k10sf4\u3000k0+5SF4@13\u3000k70+26sf3@9\n\n\u30fb\u5a01\u529b\u8868\u30921d+tf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u306f2d\u3067\u53c2\u7167 tf3\n\u3000\u4f8b\uff09k10tf3\u3000k0+5TF4@13\u3000k70+26tf3@9\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),y.$register_prefix("H?K","Gr","2D6?@\\d+","FT","TT"),d(y,"$initialize",function b(f){var r=this;return b.$$p=null,P(r,K(r,"initialize",b,!1,!0),"initialize",[f],null),r.rating_table=2}),d(y,"$eval_game_system_specific_command",function b(f){var R,r=this,g=I;return b.$$p=null,M(/^Gr(\d+)?/i,R=f)?h(f["$=~"](/^Gr(\d+)/i))?r.$growth(c("Regexp").$last_match(1).$to_i()):r.$growth():M(/^2D6?@\d+/i,R)?(g=o(c("Command"),"Parser").$new(/2D6?/i,N(["round_type"],{round_type:o(o(c("BCDice"),"RoundType"),"CEIL")})).$enable_critical().$restrict_cmp_op_to(I,">=",">").$parse(f),h(g)?c("TranscendentTest").$new(g.$critical(),g.$modify_number(),g.$cmp_op(),g.$target_number(),r.locale).$execute(r.randomizer):I):M("FT",R)?r.$get_fumble_table():M("TT",R)?r.$get_tangle_table():P(r,K(r,"eval_game_system_specific_command",b,!1,!0),"eval_game_system_specific_command",[f],null)}),d(y,"$rating_parser",function(){return c("RatingParser").$new(N(["version"],{version:"v2_0"}))}),d(y,"$rollDice",function b(f,m){var R=this,t=I;return b.$$p=null,h(H(f.$semi_fixed_val(),0))?(t=R.randomizer.$roll_once(6),[j(t,f.$semi_fixed_val()),t+","+f.$semi_fixed_val()]):Q(m,0)&&h(H(f.$tmp_fixed_val(),0))?(t=R.randomizer.$roll_once(6),[j(t,f.$tmp_fixed_val()),t+","+f.$tmp_fixed_val()]):h(f.$greatest_fortune())?(t=R.randomizer.$roll_once(6),[E(t,2),t+","+t]):P(R,K(R,"rollDice",b,!1,!0),"rollDice",[f,m],null)}),d(y,"$growth",function(f){return null==f&&(f=1),Y(e.Range.$new(1,f,!1),"map",[],function r(){return(null==r.$$s?this:r.$$s).$growth_step()},{$$s:this}).$join(" | ")},-1),d(y,"$growth_step",function(){var f=this,m=I,r=I,R=I;return r=(m=o(c("DiceTable"),"Table").$from_i18n("SwordWorld2_0.GrowthTable",f.locale)).$roll(f.randomizer),R=m.$roll(f.randomizer),z(r.$value(),R.$value())?"["+r.$value()+","+R.$value()+"]->("+r.$body()+" or "+R.$body()+")":"["+r.$value()+","+R.$value()+"]->("+r.$body()+")"}),d(y,"$get_fumble_table",function(){return o(c("DiceTable"),"Table").$from_i18n("SwordWorld2_0.FumbleTable",this.locale).$roll(this.randomizer)}),d(y,"$get_tangle_table",function(){return o(c("DiceTable"),"Table").$from_i18n("SwordWorld2_0.TangleTable",this.locale).$roll(this.randomizer)})},Opal.queue(function(e){var I,B,C,D,w,v,y,$,k,p,V=e.module,G=e.klass,l=e.const_set,P=e.eqeqeq,K=e.send,d=e.hash2,M=e.truthy,h=e.send2,N=e.find_super,H=e.def,j=e.range,Q=e.rb_plus,Y=[],z=e.nil,q=e.$$$;return e.top.$require("bcdice/game_system/SwordWorld2_0"),I=Y,B=p=[V(Y[0],"BCDice")].concat(I),$=[V(p[0],"GameSystem")].concat(B),k=e.$r($),C=$,w=[D=G($[0],k("SwordWorld2_0"),"SwordWorld2_5")].concat(C),v=e.$r(w),(y=D.$$prototype).randomizer=y.locale=z,l(w[0],"ID","SwordWorld2.5"),l(w[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.5"),l(w[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.5"),l(w[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H+(1+1)\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e1.5\u500d (OHKx, KxOH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"OH"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u30921.5\u500d\u3057\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u30011.5\u500d\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09OHK20\u3000\u3000K20oh\u3000\u3000OHK10-5@9\u3000\u3000K20+8OH+2\u3000\u3000K20+8OH+(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u5fc5\u6bba\u653b\u6483\u7528\uff09\n\u3000\u300c\uff03\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u7d99\u7d9a\u3055\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09K20#1\u3000\u3000\u3000k10-5@9#2\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r5\n\u3000\u4f8b\uff09K20r5\u3000K30+24@8R5\u3000K40+24@8$12r5\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r5gf\n\n\u30fb\u5a01\u529b\u8868\u30921d+sf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u3082\u7d99\u7d9a sf4\n\u3000\u4f8b\uff09k10sf4\u3000k0+5sf4@13\u3000k70+26sf3@9\n\n\u30fb\u5a01\u529b\u8868\u30921d+tf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u306f2d\u3067\u53c2\u7167 tf3\n\u3000\u4f8b\uff09k10tf3\u3000k0+5tf4@13\u3000k70+26tf3@9\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u30c9\u30eb\u30a4\u30c9\u306e\u7269\u7406\u9b54\u6cd5\u7528\u8868\u3000(Dru[2-6\u306e\u5024,7-9\u306e\u5024,10-12\u306e\u5024])\n\u3000\u4f8b\uff09Dru[0,3,6]+10-3\n\n\u30fb\u30a2\u30d3\u30b9\u30ab\u30fc\u30b9\u8868\u3000(ABT)\n\u3000\u30a2\u30d3\u30b9\u30ab\u30fc\u30b9\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),D.$register_prefix("H?K","OHK","Gr","2D6?@\\d+","FT","TT","Dru","ABT"),H(D,"$eval_game_system_specific_command",function a(c){var f,b=this,m=z,R=z;return a.$$p=null,P(/^dru\[(\d+),(\d+),(\d+)\]/i,f=c)?(m=K(v("Regexp").$last_match().$captures(),"map",[],"to_i".$to_proc()),R=q(v("Command"),"Parser").$new(/dru\[\d+,\d+,\d+\]/i,d(["round_type"],{round_type:q(q(v("BCDice"),"RoundType"),"CEIL")})).$parse(c),M(R)?b.$druid_dice(R,m):z):P("ABT",f)?b.$get_abyss_curse_table():h(b,N(b,"eval_game_system_specific_command",a,!1,!0),"eval_game_system_specific_command",[c],null)}),H(D,"$rating_parser",function(){return v("RatingParser").$new(d(["version"],{version:"v2_5"}))}),H(D,"$druid_dice",function(c,u){var m,r,R,t,g,f=z;return m=(f=this.randomizer.$roll_barabara(2,6)).$sum(),r=P(j(2,6,!1),R=m)?0:P(j(7,9,!1),R)?1:P(j(10,12,!1),R)?2:z,t=u["$[]"](r),g=Q(t,c.$modify_number()),["("+c.$command().$capitalize()+v("Format").$modifier(c.$modify_number())+")","2D["+f.$join(",")+"]="+m,""+t+v("Format").$modifier(c.$modify_number()),g].$join(" \uff1e ")}),H(D,"$get_abyss_curse_table",function(){var f,c=this,u=z,b=z;return u=q(v("DiceTable"),"D66GridTable").$from_i18n("SwordWorld2_5.AbyssCurseTable",c.locale).$roll(c.randomizer),b=P(14,f=u.$value())?q(v("DiceTable"),"D66ParityTable").$from_i18n("SwordWorld2_5.AbyssCurseCategoryTable",c.locale).$roll(c.randomizer).$to_s():P(25,f)?q(v("DiceTable"),"D66ParityTable").$from_i18n("SwordWorld2_5.AbyssCurseAttrTable",c.locale).$roll(c.randomizer).$to_s():z,[u.$to_s(),b].$compact().$join("\n")})})}}]);