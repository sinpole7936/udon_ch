(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[288],{4627:(re,ne,te)=>{te(5151),Opal.modules["bcdice/arithmetic_evaluator"]=function(n){var P,s,B,r,z,H,o,S,M=n.module,G=n.ensure_kwargs,A=n.truthy,L=n.thrower,J=n.def,d=[],p=n.nil,x=n.$$$;return P=d,s=S=[M(d[0],"BCDice")].concat(P),o=[H=M(S[0],"ArithmeticEvaluator")].concat(s),r=[B=n.get_singleton_class(H)].concat(o),z=n.$r(r),J(B,"$eval",function(K,N){try{L("eval_return");var D,q=p;return null==(D=(N=G(N)).$$smap.round_type)&&(D=x(z("RoundType"),"FLOOR")),A(K)&&A(q=z("Arithmetic").$eval(K,D))?q:0}catch(T){if(T===n.t_eval_return)return T.$v;throw T}},-2)},Opal.modules["bcdice/dice_table/range_table"]=function(n){var H,r,W,y,i,c,D,q,T,j,Q,B,M=n.module,G=n.klass,A=n.const_set,L=n.send,J=n.hash2,d=n.def,p=n.eqeqeq,x=n.truthy,F=n.to_a,P=n.rb_times,k=n.rb_plus,S=[],l=n.nil;return H=S,r=B=[M(S[0],"BCDice")].concat(H),W=Q=[M(B[0],"DiceTable")].concat(r),q=[D=G(Q[0],null,"RangeTable")].concat(W),T=n.$r(q),(j=D.$$prototype).name=j.items=j.num_of_dice=j.num_of_sides=j.formatter=l,A(q[0],"RollResult",L(T("Struct"),"new",["sum","values","content","formatted"],function y(){return(null==y.$$s?this:y.$$s).$alias_method("to_s","formatted")},{$$s:D})),A(q[0],"Item",T("Struct").$new("range","content")),A(q[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),A(q[0],"DEFAULT_FORMATTER",L(D,"lambda",[],function(m,i){return null==m&&(m=l),null==i&&(i=l),m.$name()+"("+i.$sum()+") \uff1e "+i.$content()})),D.$attr_reader("name"),D.$attr_reader("num_of_dice"),D.$attr_reader("num_of_sides"),i=[y=n.get_singleton_class(D)].concat(q),c=n.$r(i),d(y,"$from_i18n",function(a,f){var _,v=l;return v=c("I18n").$t(a,J(["locale"],{locale:f})),_=L(v["$[]"]("items"),"map",[],function $(e){return null==e&&(e=l),[(null==$.$$s?this:$.$$s).$conv_string_range(e["$[]"](0)),e["$[]"](1)]},{$$s:this}),this.$new(v["$[]"]("name"),v["$[]"]("type"),_)}),d(y,"$conv_string_range",function(a){var g,f=this;return null==f.name&&(f.name=l),p(c("Integer"),g=a)?a:p(c("String"),g)?x(a["$include?"](".."))?L(c("Range"),"new",F(L(a.$split("..",2),"map",[],function v(_){return null==_&&(_=l),(null==v.$$s?this:v.$$s).$Integer(_)},{$$s:f}))):f.$Integer(a):f.$raise(c("TypeError"),f.name+": "+a+" ("+a.$class()+") must be a String or an Integer")}),d(D,"$initialize",function y(m,i,c){var f,u=y.$$p||l,a=this,g=l;return y.$$p=null,a.name=m.$freeze(),a.formatter=x(f=u)?f:T("DEFAULT_FORMATTER"),g=T("DICE_ROLL_METHOD_RE").$match(i),x(g)||a.$raise(T("ArgumentError"),a.name+": invalid dice roll method: "+i),a.num_of_dice=g["$[]"](1).$to_i(),a.num_of_sides=g["$[]"](2).$to_i(),a.$store(c)}),d(D,"$fetch",function(m){var c,i=this;return c=L(i.items,"find",[],function(a){return null==a&&(a=l),a.$range()["$include?"](m)}),x(c)||i.$raise(T("RangeError"),i.name+": value is out of range: "+m),c}),d(D,"$roll",function(m){var u,i=this,c=l,a=l;return u=(c=m.$roll_barabara(i.num_of_dice,i.num_of_sides)).$sum(),(a=T("RollResult").$new(u,c,i.$fetch(u).$content()))["$formatted="](i.formatter["$[]"](i,a)),a}),D.$private(),d(D,"$store",function(m){var c,u,i=this;return c=L(m,"map",[],function a(f,g){return null==f&&(f=l),null==g&&(g=l),[(null==a.$$s?this:a.$$s).$coerce_to_int_range(f),g]},{$$s:i}),u=L(c,"sort_by",[],function(f,g){return null==f&&(f=l),null==g&&(g=l),f.$min()}),i.$assert_min_sum_is_covered(u),i.$assert_max_sum_is_covered(u),i.$assert_no_gap_or_overlap_in_ranges(u),i.items=L(u,"map",[],function(f,g){return null==f&&(f=l),null==g&&(g=l),T("Item").$new(f,g.$freeze()).$freeze()}).$freeze(),i}),d(D,"$coerce_to_int_range",function(m){var c;return p(T("Integer"),c=m)?T("Range").$new(m,m):p(T("Range"),c)&&x(m.$begin()["$is_a?"](T("Integer")))&&x(m.$end()["$is_a?"](T("Integer")))?m:this.$raise(T("TypeError"),this.name+": "+m+" ("+m.$class()+") must be an Integer or a Range with Integers ")}),d(D,"$assert_min_sum_is_covered",function(m){var c,i=this,u=l;return c=i.num_of_dice,u=m.$first()["$[]"](0),x(u["$include?"](c))||i.$raise(T("RangeError"),i.name+": min value ("+c+") is not covered: "+u),i}),d(D,"$assert_max_sum_is_covered",function(m){var c,i=this,u=l;return c=P(i.num_of_dice,i.num_of_sides),u=m.$last()["$[]"](0),x(u["$include?"](c))||i.$raise(T("RangeError"),i.name+": max value ("+c+") is not covered: "+u),i}),d(D,"$assert_no_gap_or_overlap_in_ranges",function(m){return L(m,"each_cons",[2],function c(u,a){var _,$,f=null==c.$$s?this:c.$$s,g=l,v=l;return null==f.name&&(f.name=l),null==u&&(u=l),null==a&&(a=l),g=u["$[]"](0),v=a["$[]"](0),_=g.$max(),$=k(_,1),x(v["$include?"](_))&&f.$raise(T("RangeError"),f.name+": Range overlap: "+g+" and "+v),x(v["$include?"]($))?l:f.$raise(T("RangeError"),f.name+": Range gap: "+g+" and "+v)},{$$s:this}),this})},Opal.queue(function(n){var K,q,m,i,c,$,e,I,t,b,u,a,f,j,y,W,M=n.module,G=n.klass,A=n.const_set,L=n.send2,J=n.find_super,d=n.def,p=n.truthy,x=n.rb_lt,F=n.rb_gt,P=n.rb_plus,k=n.send,S=n.rb_ge,l=n.eqeq,s=n.hash2,H=n.to_ary,o=n.range,B=n.top,U=[],r=n.nil,z=n.$$$;return B.$require("bcdice/arithmetic_evaluator"),B.$require("bcdice/dice_table/range_table"),K=U,q=W=[M(U[0],"BCDice")].concat(K),j=[M(W[0],"GameSystem")].concat(q),y=n.$r(j),m=j[0],i=y("Base"),c=j,a=[u=G(m,i,"DoubleCross")].concat(c),f=n.$r(a),u.$$prototype.randomizer=r,A(a[0],"ID","DoubleCross"),A(a[0],"NAME","\u30c0\u30d6\u30eb\u30af\u30ed\u30b92nd,3rd"),A(a[0],"SORT_KEY","\u305f\u3075\u308b\u304f\u308d\u30592"),A(a[0],"HELP_MESSAGE",'\u30fb\u5224\u5b9a\u30b3\u30de\u30f3\u30c9\uff08xDX+y@c or xDXc+y\uff09\n\u3000"(\u500b\u6570)DX(\u4fee\u6b63)@(\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024)" \u3082\u3057\u304f\u306f "(\u500b\u6570)DX(\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024)(\u4fee\u6b63)" \u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u4fee\u6b63\u5024\u3082\u4ed8\u3051\u3089\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff0910dx\u3000\u300010dx+5@8\uff08OD tool\u5f0f)\u3000\u30005DX7+7-3\uff08\u75be\u98a8\u6012\u6fe4\u5f0f\uff09\n\n\u30fb\u5404\u7a2e\u8868\n\u3000\u30fb\u611f\u60c5\u8868\uff08ET\uff09\n\u3000\u3000\u30dd\u30b8\u30c6\u30a3\u30d6\u3068\u30cd\u30ac\u30c6\u30a3\u30d6\u306e\u4e21\u65b9\u3092\u632f\u3063\u3066\u3001\u8868\u306b\u306a\u3063\u3066\u3044\u308b\u5074\u306b\u25cb\u3092\u4ed8\u3051\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n\u3000\u3000\u3082\u3061\u308d\u3093\u4efb\u610f\u3067\u9078\u3076\u90e8\u5206\u306f\u5909\u66f4\u3057\u3066\u69cb\u3044\u307e\u305b\u3093\u3002\n\n\u30fbD66\u30c0\u30a4\u30b9\u3042\u308a\n'),d(u,"$initialize",function v(_){var e=this;return v.$$p=null,L(e,J(e,"initialize",v,!1,!0),"initialize",[_],null),e.sides_implicit_d=10}),u.$register_prefix("\\d+DX","ET"),$=a,I=[e=G(a[0],null,"DX")].concat($),t=n.$r(I),(b=e.$$prototype).modifier=b.critical_value=b.expression=b.num=b.modifier_str=b.target_value=r,e.$include(t("Translate")),d(e,"$initialize",function(R,E,w,X){var h=this;return h.num=R,h.critical_value=E,h.modifier=w,h.target_value=X,h.modifier_str=t("Format").$modifier(h.modifier),h.expression=h.$node_expression(),h.locale="ja_jp"}),d(e,"$execute",function(R){var E=this,w=r,X=r,h=r,Z=r,Y=r,V=r;if(p(x(E.critical_value,2)))return t("Result").$new("("+E.expression+") \uff1e "+E.$translate("DoubleCross.DX.invalid_critical"));if(p(x(E.num,1)))return t("Result").$failure("("+E.expression+") \uff1e "+E.$translate("DoubleCross.DX.auto_failure"));for(w=[],X=E.num,h=0;p(p(Z=F(X,0))?x(h,z(z(t("CommonCommand"),"RerollDice"),"REROLL_LIMIT")):Z);)Y=R.$roll_barabara(X,10),V=t("ValueGroup").$new(Y,E.critical_value),w.$push(V),X=V.$num_of_critical_occurrences(),h=P(h,1);return E.$result(w)}),e.$private(),d(e,"$node_expression",function(){var E,R=this;return E=R.num+"DX"+R.critical_value+R.modifier_str,p(R.target_value)?E+">="+R.target_value:E}),d(e,"$result",function(R){var X,Z,E=this,w=r,h=r,Y=r,V=r,O=r,ee=r;return(w=t("Result").$new())["$fumble="](R["$[]"](0).$values()["$all?"](1)),X=k(R,"map",[],"max".$to_proc()).$sum(),h=p(w["$fumble?"]())?0:P(X,E.modifier),Z=p(w["$fumble?"]())?h+" ("+E.$translate("fumble")+")":h.$to_s(),w["$critical="](F(R.$length(),1)),Y=["("+E.expression+")",""+R.$join("+")+E.modifier_str,Z],p(E.target_value)&&(V=p(O=w["$fumble?"]()["$!"]())?S(h,E.target_value):O,p(V)?w["$success="](!0):w["$failure="](!0),ee=E.$translate(p(V)?"success":"failure"),Y.$push(ee)),w["$text="](Y.$join(" \uff1e ")),w}),function(v,_){var $=G(v,null,"ValueGroup"),e=$.$$prototype;e.values=e.critical_value=r,$.$attr_reader("values"),$.$attr_reader("critical_value"),d($,"$initialize",function(t,b){return this.values=t.$sort(),this.critical_value=b}),d($,"$to_s",function(){return this.$max()+"["+this.values.$join(",")+"]"}),d($,"$max",function(){var t=this;return p(k(t.values,"any?",[],function b(C){return null==C&&(C=r),(null==b.$$s?this:b.$$s)["$critical?"](C)},{$$s:t}))?10:t.values.$max()}),d($,"$num_of_critical_occurrences",function(){return k(this.values,"count",[],function b(C){return null==C&&(C=r),(null==b.$$s?this:b.$$s)["$critical?"](C)},{$$s:this})}),$.$private(),d($,"$critical?",function(t){return S(t,this.critical_value)})}(a[0]),d(u,"$eval_game_system_specific_command",function(_){var $=this,e=r;return p(e=$.$parse_dx(_))?e.$execute($.randomizer):l(_,"ET")?$.$roll_emotion_table():r}),u.$private(),d(u,"$parse_dx",function(_){var e;return p(e=this.$parse_dx_od(_))?e:this.$parse_dx_shippu_doto(_)}),d(u,"$parse_dx_od",function(_){var I=r,t=r,b=r,C=r;return I=z(f("Command"),"Parser").$new(/\d+DX/,s(["round_type"],{round_type:this.$round_type()})).$enable_critical().$restrict_cmp_op_to(r,">=").$parse(_),p(I)?(t=I.$command().$to_i(),b=p(C=I.$critical())?C:10,z(this.$class(),"DX").$new(t,b,I.$modify_number(),I.$target_number())):r}),d(u,"$parse_dx_shippu_doto",function(_){var $,e,b=r,C=r,R=r,E=r;return b=z(f("Command"),"Parser").$new(/\d+DX\d*/,s(["round_type"],{round_type:this.$round_type()})).$restrict_cmp_op_to(r,">=").$parse(_),p(b)?(e=k(b.$command().$split("DX",2),"map",[],function(X){var h;return null==X&&(X=r),(h=X)===r||null==h?r:h.$to_i()}),C=null==($=H(e))[0]?r:$[0],R=p(E=R=null==$[1]?r:$[1])?E:10,z(this.$class(),"DX").$new(C,R,b.$modify_number(),b.$target_number())):r}),d(u,"$roll_emotion_table",function(){var I,_=this,$=r,e=r,t=r,C=r;return $=z(_.$class(),"POSITIVE_EMOTION_TABLE").$roll(_.randomizer),e=z(_.$class(),"NEGATIVE_EMOTION_TABLE").$roll(_.randomizer),I=_.randomizer.$roll_once(2)["$=="](1),t=p(I)?["\u25cb"+$.$content(),e.$content()]:[$.$content(),"\u25cb"+e.$content()],C=[_.$translate("DoubleCross.ET.name")+"("+$.$sum()+"-"+e.$sum()+")",t.$join(" - ")],f("Result").$new(C.$join(" \uff1e "))}),function(v,_){var $=[v].concat(_),e=n.$r($);v.$private(),d(v,"$positive_emotion_table",function(t){return z(e("DiceTable"),"RangeTable").$new(e("I18n").$translate("DoubleCross.ET.positive.name",s(["locale"],{locale:t})),"1D100",[[o(1,5,!1),e("I18n").$translate("DoubleCross.ET.positive.items.1_5",s(["locale"],{locale:t}))],[o(6,10,!1),e("I18n").$translate("DoubleCross.ET.positive.items.6_10",s(["locale"],{locale:t}))],[o(11,15,!1),e("I18n").$translate("DoubleCross.ET.positive.items.11_15",s(["locale"],{locale:t}))],[o(16,20,!1),e("I18n").$translate("DoubleCross.ET.positive.items.16_20",s(["locale"],{locale:t}))],[o(21,25,!1),e("I18n").$translate("DoubleCross.ET.positive.items.21_25",s(["locale"],{locale:t}))],[o(26,30,!1),e("I18n").$translate("DoubleCross.ET.positive.items.26_30",s(["locale"],{locale:t}))],[o(31,35,!1),e("I18n").$translate("DoubleCross.ET.positive.items.31_35",s(["locale"],{locale:t}))],[o(36,40,!1),e("I18n").$translate("DoubleCross.ET.positive.items.36_40",s(["locale"],{locale:t}))],[o(41,45,!1),e("I18n").$translate("DoubleCross.ET.positive.items.41_45",s(["locale"],{locale:t}))],[o(46,50,!1),e("I18n").$translate("DoubleCross.ET.positive.items.46_50",s(["locale"],{locale:t}))],[o(51,55,!1),e("I18n").$translate("DoubleCross.ET.positive.items.51_55",s(["locale"],{locale:t}))],[o(56,60,!1),e("I18n").$translate("DoubleCross.ET.positive.items.56_60",s(["locale"],{locale:t}))],[o(61,65,!1),e("I18n").$translate("DoubleCross.ET.positive.items.61_65",s(["locale"],{locale:t}))],[o(66,70,!1),e("I18n").$translate("DoubleCross.ET.positive.items.66_70",s(["locale"],{locale:t}))],[o(71,75,!1),e("I18n").$translate("DoubleCross.ET.positive.items.71_75",s(["locale"],{locale:t}))],[o(76,80,!1),e("I18n").$translate("DoubleCross.ET.positive.items.76_80",s(["locale"],{locale:t}))],[o(81,85,!1),e("I18n").$translate("DoubleCross.ET.positive.items.81_85",s(["locale"],{locale:t}))],[o(86,90,!1),e("I18n").$translate("DoubleCross.ET.positive.items.86_90",s(["locale"],{locale:t}))],[o(91,95,!1),e("I18n").$translate("DoubleCross.ET.positive.items.91_95",s(["locale"],{locale:t}))],[o(96,100,!1),e("I18n").$translate("DoubleCross.ET.positive.items.96_100",s(["locale"],{locale:t}))]])}),d(v,"$negative_emotion_table",function(t){return z(e("DiceTable"),"RangeTable").$new(e("I18n").$translate("DoubleCross.ET.negative.name",s(["locale"],{locale:t})),"1D100",[[o(1,5,!1),e("I18n").$translate("DoubleCross.ET.negative.items.1_5",s(["locale"],{locale:t}))],[o(6,10,!1),e("I18n").$translate("DoubleCross.ET.negative.items.6_10",s(["locale"],{locale:t}))],[o(11,15,!1),e("I18n").$translate("DoubleCross.ET.negative.items.11_15",s(["locale"],{locale:t}))],[o(16,20,!1),e("I18n").$translate("DoubleCross.ET.negative.items.16_20",s(["locale"],{locale:t}))],[o(21,25,!1),e("I18n").$translate("DoubleCross.ET.negative.items.21_25",s(["locale"],{locale:t}))],[o(26,30,!1),e("I18n").$translate("DoubleCross.ET.negative.items.26_30",s(["locale"],{locale:t}))],[o(31,35,!1),e("I18n").$translate("DoubleCross.ET.negative.items.31_35",s(["locale"],{locale:t}))],[o(36,40,!1),e("I18n").$translate("DoubleCross.ET.negative.items.36_40",s(["locale"],{locale:t}))],[o(41,45,!1),e("I18n").$translate("DoubleCross.ET.negative.items.41_45",s(["locale"],{locale:t}))],[o(46,50,!1),e("I18n").$translate("DoubleCross.ET.negative.items.46_50",s(["locale"],{locale:t}))],[o(51,55,!1),e("I18n").$translate("DoubleCross.ET.negative.items.51_55",s(["locale"],{locale:t}))],[o(56,60,!1),e("I18n").$translate("DoubleCross.ET.negative.items.56_60",s(["locale"],{locale:t}))],[o(61,65,!1),e("I18n").$translate("DoubleCross.ET.negative.items.61_65",s(["locale"],{locale:t}))],[o(66,70,!1),e("I18n").$translate("DoubleCross.ET.negative.items.66_70",s(["locale"],{locale:t}))],[o(71,75,!1),e("I18n").$translate("DoubleCross.ET.negative.items.71_75",s(["locale"],{locale:t}))],[o(76,80,!1),e("I18n").$translate("DoubleCross.ET.negative.items.76_80",s(["locale"],{locale:t}))],[o(81,85,!1),e("I18n").$translate("DoubleCross.ET.negative.items.81_85",s(["locale"],{locale:t}))],[o(86,90,!1),e("I18n").$translate("DoubleCross.ET.negative.items.86_90",s(["locale"],{locale:t}))],[o(91,95,!1),e("I18n").$translate("DoubleCross.ET.negative.items.91_95",s(["locale"],{locale:t}))],[o(96,100,!1),e("I18n").$translate("DoubleCross.ET.negative.items.96_100",s(["locale"],{locale:t}))]]).$freeze()})}(n.get_singleton_class(u),a),A(a[0],"POSITIVE_EMOTION_TABLE",u.$positive_emotion_table("ja_jp").$freeze()),A(a[0],"NEGATIVE_EMOTION_TABLE",u.$negative_emotion_table("ja_jp").$freeze())})}}]);