(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[5564],{1903:(ge,pe,he)=>{he(5151),Opal.modules["i18n/backend/fallbacks"]=function(e){var X,i,$,r,s,v,K=e.module,G=e.class_variable_set,_=e.truthy,B=e.class_variable_get,L=e.def,p=e.send,g=e.send2,R=e.find_super,S=e.hash2,M=e.find_block_super,Y=e.neqeq,W=e.thrower,N=e.return_val,j=[],I=e.nil,w=e.$$$;return X=j,v=[s=K(j[0],"I18n")].concat(X),G(v[0],"@@fallbacks",I),i=e.get_singleton_class(s),$=[i].concat(v),r=e.$r($),L(i,"$fallbacks",function(){var z=I;return G($[1],"@@fallbacks",_(null!=$[1].$$cvars["@@fallbacks"]?"class variable":I)&&_(z=B($[1],"@@fallbacks",!1))?z:w(w(r("I18n"),"Locale"),"Fallbacks").$new()),_(z=r("Thread").$current()["$[]"]("i18n_fallbacks"))?z:B($[1],"@@fallbacks",!1)}),L(i,"$fallbacks=",function(P){var z;return G($[1],"@@fallbacks",_(P["$is_a?"](r("Array")))?w(w(r("I18n"),"Locale"),"Fallbacks").$new(P):P),z=["i18n_fallbacks",B($[1],"@@fallbacks",!1)],p(r("Thread").$current(),"[]=",z),z[z.length-1]}),function(i,C){var P,z,H,x,r=[K(i,"Backend")].concat(C);return P=r,H=[z=K(r[0],"Fallbacks")].concat(P),x=e.$r(H),L(z,"$translate",function k(f,y,u){try{var h=W("return"),c=k.$$p||I,q=this,F=I,o=I;return k.$$p=null,null==u&&(u=x("EMPTY_HASH")),_(u.$fetch("fallback",!0))?_(u["$[]"]("fallback_in_progress"))?g(q,R(q,"translate",k,!1,!0),"translate",[f,y,u],c):(_(u["$[]"]("default"))&&(F=q["$extract_non_symbol_default!"](u)),o=u.$merge(S(["fallback_in_progress"],{fallback_in_progress:!0})),p(x("I18n").$fallbacks()["$[]"](f),"each",[],function n(m){var a=null==n.$$s?this:n.$$s;null==m&&(m=I);try{return p(a,"catch",["exception"],function l(){var t=null==l.$$s?this:l.$$s,T=I;if(T=g(t,M(t,"translate",l.$$def||n.$$def||k,!1,!1),"translate",[m,y,o],null),_(T["$nil?"]()))return I;Y(f.$to_s(),m.$to_s())&&t.$on_fallback(f,m,y,u),h.$throw(T)},{$$s:a,$$ret:h})}catch(l){if(!e.rescue(l,[w(x("I18n"),"InvalidLocale")]))throw l;try{return I}finally{e.pop_exception()}}},{$$s:q}),_(u["$key?"]("default"))&&_(u["$[]"]("default")["$nil?"]())?I:_(F)?g(q,R(q,"translate",k,!1,!0),"translate",[f,I,u.$merge(S(["default"],{default:F}))],null):q.$throw("exception",w(x("I18n"),"MissingTranslation").$new(f,y,u))):g(q,R(q,"translate",k,!1,!0),"translate",[f,y,u],c)}catch(n){if(n===h)return n.$v;throw n}},-3),L(z,"$extract_non_symbol_default!",function(f){var u,y=I;return y=[f["$[]"]("default")].$flatten(),u=p(y,"detect",[],function(c){return null==c&&(c=I),c["$is_a?"](x("Symbol"))["$!"]()}),_(u)&&f["$[]="]("default",y["$[]"](0,y.$index(u))),u}),L(z,"$exists?",function k(f,y,u){try{var h=W("return"),c=k.$$p||I,q=this;return k.$$p=null,null==u&&(u=x("EMPTY_HASH")),_(u.$fetch("fallback",!0))?(p(x("I18n").$fallbacks()["$[]"](f),"each",[],function F(o){var n=null==F.$$s?this:F.$$s;null==o&&(o=I);try{if(!_(g(n,M(n,"exists?",F.$$def||k,!1,!1),"exists?",[o,y],null)))return I;h.$throw(!0)}catch(m){if(!e.rescue(m,[w(x("I18n"),"InvalidLocale")]))throw m;try{return I}finally{e.pop_exception()}}},{$$s:q,$$ret:h}),!1):g(q,R(q,"exists?",k,!1,!0),"exists?",[f,y,u],c)}catch(F){if(F===h)return F.$v;throw F}},-3),z.$private(),L(z,"$on_fallback",N(I))}(v[0],v)},Opal.modules["bcdice/randomizer"]=function(e){var s,d,P,z,H,x,i,C,G=e.klass,_=e.const_set,B=e.def,L=e.truthy,p=e.rb_gt,g=e.rb_plus,R=e.rb_le,S=e.send,M=e.rb_minus,Y=e.eqeq,W=e.rb_times,N=e.eqeqeq,j=e.rb_ge,I=[],w=e.nil,J=e.$$$;return s=I,i=[(0,e.module)(I[0],"BCDice")].concat(s),C=e.$r(i),d=i,z=[P=G(i[0],null,"Randomizer")].concat(d),H=e.$r(z),(x=P.$$prototype).rand_results=x.detailed_rand_results=w,_(z[0],"UPPER_LIMIT_DICE_TIMES",200),_(z[0],"UPPER_LIMIT_DICE_SIDES",1e4),_(z[0],"UPPER_LIMIT_RANDS",1e4),B(P,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),P.$attr_reader("rand_results"),P.$attr_reader("detailed_rand_results"),_(z[0],"DetailedRandResult",H("Struct").$new("kind","sides","value")),B(P,"$roll_barabara",function(f,y){var u=this;return L(p(g(u.rand_results.$size(),f),H("UPPER_LIMIT_RANDS")))&&u.$raise(H("TooManyRandsError")),L(R(f,0))||L(p(f,H("UPPER_LIMIT_DICE_TIMES")))?[]:S(H("Array"),"new",[f],function h(){return(null==h.$$s?this:h.$$s).$roll_once(y)},{$$s:u})}),B(P,"$roll_sum",function(f,y){return this.$roll_barabara(f,y).$sum()}),B(P,"$roll_once",function(f){var u=w;return L(R(f,0))||L(p(f,H("UPPER_LIMIT_DICE_SIDES")))?0:(u=this.$rand_inner(f),this.$push_to_detail("normal",f,u),u)}),B(P,"$roll_index",function(f){return M(this.$roll_once(f),1)}),B(P,"$roll_tens_d10",function(){var u,y=w;return y=this.$rand_inner(10),Y(y,10)&&(y=0),u=W(y,10),this.$push_to_detail("tens_d10",10,u),u}),B(P,"$roll_d9",function(){var y;return y=M(this.$rand_inner(10),1),this.$push_to_detail("d9",10,y),y}),B(P,"$roll_d66",function(f){var h,u=w;return u=S(H("Array"),"new",[2],function c(){return(null==c.$$s?this:c.$$s).$roll_once(6)},{$$s:this}),N(J(H("D66SortType"),"ASC"),h=f)?u["$sort!"]():N(J(H("D66SortType"),"DESC"),h)&&u["$sort!"]()["$reverse!"](),g(W(u["$[]"](0),10),u["$[]"](1))}),P.$private(),B(P,"$rand_inner",function(f){var u,y=this;return L(j(y.rand_results.$size(),H("UPPER_LIMIT_RANDS")))&&y.$raise(H("TooManyRandsError")),u=y.$random(f),y.rand_results["$<<"]([u,f]),u}),B(P,"$random",function(f){return g(H("Kernel").$rand(f),1)}),B(P,"$push_to_detail",function(f,y,u){var c;return c=H("DetailedRandResult").$new(f,y,u),this.detailed_rand_results.$push(c)}),G(i[0],C("StandardError"),"TooManyRandsError"),w},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var S,N,X,s,v,i,C,I,Y,K=e.module,G=e.klass,_=e.def,B=e.truthy,L=e.return_val,p=[],g=e.nil;return S=p,N=Y=[K(p[0],"BCDice")].concat(S),X=I=[K(Y[0],"DiceTable")].concat(N),v=[s=G(I[0],null,"RollResult")].concat(X),i=e.$r(v),(C=s.$$prototype).table_name=C.value=C.body=g,_(s,"$initialize",function(r,d,P){var z=this;return z.table_name=r,z.value=d,z.body=P}),s.$attr_reader("table_name"),s.$attr_reader("value"),s.$attr_reader("body"),_(s,"$to_s",function(){var r=this;return r.table_name+"("+r.value+") \uff1e "+r.body}),_(s,"$last_body",function(){var r=this;return B(r.body["$is_a?"](i("RollResult")))?r.body.$last_body():r.body}),_(s,"$empty?",L(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var S,N,X,s,v,i,C,I,Y,K=e.module,G=e.klass,_=e.truthy,B=e.def,L=e.rb_minus,p=[],g=e.nil;return S=p,N=Y=[K(p[0],"BCDice")].concat(S),X=I=[K(Y[0],"DiceTable")].concat(N),v=[s=G(I[0],null,"ChainTable")].concat(X),i=e.$r(v),(C=s.$$prototype).times=C.sides=C.items=C.name=g,B(s,"$initialize",function(r,d,P){var z=this,H=g;return z.name=r,z.items=P.$freeze(),H=/(\d+)D(\d+)/i.$match(d),_(H)||z.$raise(i("ArgumentError"),"Unexpected table type: "+d),z.times=H["$[]"](1).$to_i(),z.sides=H["$[]"](2).$to_i()}),B(s,"$roll",function(r){var P,z,d=this,H=g;return P=r.$roll_sum(d.times,d.sides),z=L(P,d.times),H=d.items["$[]"](z),_(H["$respond_to?"]("roll"))&&(H=H.$roll(r)),i("RollResult").$new(d.name,P,H)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var W,w,i,C,$,r,d,X,j,K=e.module,G=e.klass,_=e.hash2,B=e.defs,L=e.def,p=e.rb_plus,g=e.rb_times,R=e.rb_minus,S=[],M=e.nil;return W=S,w=j=[K(S[0],"BCDice")].concat(W),i=X=[K(j[0],"DiceTable")].concat(w),$=[C=G(X[0],null,"D66GridTable")].concat(i),r=e.$r($),(d=C.$$prototype).name=d.items=M,B(C,"$from_i18n",function(z,H){var k=M;return k=r("I18n").$t(z,_(["locale","raise"],{locale:H,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items"))}),L(C,"$initialize",function(z,H){return this.name=z,this.items=H.$freeze()}),L(C,"$roll",function(z){var x,k,f,y,u;return x=z.$roll_once(6),k=z.$roll_once(6),f=p(g(x,10),k),y=R(x,1),u=R(k,1),r("RollResult").$new(this.name,f,this.items["$[]"](y)["$[]"](u))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var M,j,v,i,C,$,w,J,W,K=e.module,G=e.klass,_=e.hash2,B=e.defs,L=e.def,g=[],R=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),M=g,j=W=[K(g[0],"BCDice")].concat(M),w=[K(W[0],"DiceTable")].concat(j),J=e.$r(w),v=w,C=[i=G(w[0],J("D66GridTable"),"D66HalfGridTable")].concat(v),$=e.$r(C),B(i,"$from_i18n",function(d,P){var H=R;return H=$("I18n").$t(d,_(["locale","raise"],{locale:P,raise:!0})),this.$new(H["$[]"]("name"),H["$[]"]("items_1_2_3"),H["$[]"]("items_4_5_6"))}),L(i,"$initialize",function(d,P,z){return this.name=d,this.items=[P,P,P,z,z,z].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var M,j,v,i,C,$,w,J,W,K=e.module,G=e.klass,_=e.hash2,B=e.defs,L=e.def,g=[],R=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),M=g,j=W=[K(g[0],"BCDice")].concat(M),w=[K(W[0],"DiceTable")].concat(j),J=e.$r(w),v=w,C=[i=G(w[0],J("D66GridTable"),"D66OneThirdTable")].concat(v),$=e.$r(C),B(i,"$from_i18n",function(d,P){var H=R;return H=$("I18n").$t(d,_(["locale","raise"],{locale:P,raise:!0})),this.$new(H["$[]"]("name"),H["$[]"]("items_1_2"),H["$[]"]("items_3_4"),H["$[]"]("items_5_6"))}),L(i,"$initialize",function(d,P,z,H){return this.name=d,this.items=[P,P,z,z,H,H].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var j,X,$,r,d,P,z,v,w,K=e.module,G=e.klass,_=e.hash2,B=e.defs,L=e.def,p=e.eqeqeq,g=e.rb_plus,R=e.rb_times,S=e.truthy,M=[],Y=e.nil,W=e.$$$;return j=M,X=w=[K(M[0],"BCDice")].concat(j),$=v=[K(w[0],"DiceTable")].concat(X),d=[r=G(v[0],null,"D66Table")].concat($),P=e.$r(d),(z=r.$$prototype).sort_type=z.items=z.name=Y,B(r,"$from_i18n",function(x,k){var u,y=Y;return y=P("I18n").$t(x,_(["locale"],{locale:k})),u=P("D66SortType").$const_get(y["$[]"]("d66_sort_type")),this.$new(y["$[]"]("name"),u,y["$[]"]("items"))}),L(r,"$initialize",function(x,k,f){var y=this;return y.name=x,y.sort_type=k,y.items=f.$freeze()}),L(r,"$roll",function(x){var k=this,f=Y,y=Y,u=Y,h=Y;return f=x.$roll_barabara(2,6),p(W(P("D66SortType"),"ASC"),y=k.sort_type)?f["$sort!"]():p(W(P("D66SortType"),"DESC"),y)&&f["$sort!"]()["$reverse!"](),u=g(R(f["$[]"](0),10),f["$[]"](1)),h=S(y=k.items["$[]"](u))?y:k.items["$[]"](u.$to_s()),S(h["$respond_to?"]("roll"))&&(h=h.$roll(x)),P("RollResult").$new(k.name,u,h)}),L(r,"$choice",function(x){return P("RollResult").$new(this.name,x,this.items["$[]"](x))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var I,s,i,C,J,K=e.module,G=e.klass,_=e.hash2,B=e.send,L=e.to_ary,p=e.rb_plus,g=e.rb_times,R=e.send2,S=e.find_super,M=e.def,W=[],N=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),I=W,s=J=[K(W[0],"BCDice")].concat(I),i=[K(J[0],"DiceTable")].concat(s),C=e.$r(i),M(G(i[0],C("D66Table"),"D66LeftRangeTable"),"$initialize",function P(z,H,x){var y;return P.$$p=null,y=_([],{}),B(x,"each",[],function(h){var c,o;return null==h&&(h=N),c=L(h),o=null==c[1]?N:c[1],B(null==c[0]?N:c[0],"each",[],function(m){return null==m&&(m=N),B(o,"each_with_index",[],function(l,t){var T,E;return null==l&&(l=N),null==t&&(t=N),E=p(g(m,10),p(t,1)),B(y,"[]=",T=[E,l]),T[T.length-1]})})}),R(this,S(this,"initialize",P,!1,!0),"initialize",[z,H,y],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var N,J,C,$,r,d,P,s,I,K=e.module,G=e.klass,_=e.hash2,B=e.defs,L=e.def,p=e.truthy,g=e.rb_minus,R=e.rb_plus,S=e.rb_times,M=[],Y=e.nil;return N=M,J=I=[K(M[0],"BCDice")].concat(N),C=s=[K(I[0],"DiceTable")].concat(J),r=[$=G(s[0],null,"D66ParityTable")].concat(C),d=e.$r(r),(P=$.$$prototype).odd=P.even=P.name=Y,B($,"$from_i18n",function(H,x){var f=Y;return f=d("I18n").$t(H,_(["locale","raise"],{locale:x,raise:!0})),this.$new(f["$[]"]("name"),f["$[]"]("odd"),f["$[]"]("even"))}),L($,"$initialize",function(H,x,k){var f=this;return f.name=H,f.odd=x.$freeze(),f.even=k.$freeze()}),L($,"$roll",function(H){var f,u,h,x=this,k=Y;return k=H.$roll_once(6),f=H.$roll_once(6),u=(p(k["$odd?"]())?x.odd:x.even)["$[]"](g(f,1)),h=R(S(k,10),f),d("RollResult").$new(x.name,h,u)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var M,j,s,v,i,C,$,w,W,K=e.module,G=e.klass,_=e.def,B=e.rb_plus,L=e.rb_times,p=e.send,g=[],R=e.nil;return M=g,j=W=[K(g[0],"BCDice")].concat(M),s=w=[K(W[0],"DiceTable")].concat(j),i=[v=G(w[0],null,"D66RangeTable")].concat(s),C=e.$r(i),($=v.$$prototype).items=$.name=R,_(v,"$initialize",function(d,P){return this.name=d,this.items=P.$freeze()}),_(v,"$roll",function(d){var z,H,x,k=R;return z=d.$roll_once(6),H=d.$roll_once(6),x=B(L(z,10),H),k=p(this.items,"find",[],function(y){return null==y&&(y=R),y["$[]"](0)["$include?"](x)}),C("RollResult").$new(this.name,x,k["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var I,s,r,x,f,y,d,P,z,H,i,J,K=e.module,G=e.klass,_=e.const_set,B=e.send,L=e.hash2,p=e.def,g=e.eqeqeq,R=e.truthy,S=e.to_a,M=e.rb_times,Y=e.rb_plus,W=[],N=e.nil;return I=W,s=J=[K(W[0],"BCDice")].concat(I),r=i=[K(J[0],"DiceTable")].concat(s),P=[d=G(i[0],null,"RangeTable")].concat(r),z=e.$r(P),(H=d.$$prototype).name=H.items=H.num_of_dice=H.num_of_sides=H.formatter=N,_(P[0],"RollResult",B(z("Struct"),"new",["sum","values","content","formatted"],function x(){return(null==x.$$s?this:x.$$s).$alias_method("to_s","formatted")},{$$s:d})),_(P[0],"Item",z("Struct").$new("range","content")),_(P[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),_(P[0],"DEFAULT_FORMATTER",B(d,"lambda",[],function(k,f){return null==k&&(k=N),null==f&&(f=N),k.$name()+"("+f.$sum()+") \uff1e "+f.$content()})),d.$attr_reader("name"),d.$attr_reader("num_of_dice"),d.$attr_reader("num_of_sides"),f=[x=e.get_singleton_class(d)].concat(P),y=e.$r(f),p(x,"$from_i18n",function(h,c){var o,F=N;return F=y("I18n").$t(h,L(["locale"],{locale:c})),o=B(F["$[]"]("items"),"map",[],function n(m){return null==m&&(m=N),[(null==n.$$s?this:n.$$s).$conv_string_range(m["$[]"](0)),m["$[]"](1)]},{$$s:this}),this.$new(F["$[]"]("name"),F["$[]"]("type"),o)}),p(x,"$conv_string_range",function(h){var q,c=this;return null==c.name&&(c.name=N),g(y("Integer"),q=h)?h:g(y("String"),q)?R(h["$include?"](".."))?B(y("Range"),"new",S(B(h.$split("..",2),"map",[],function F(o){return null==o&&(o=N),(null==F.$$s?this:F.$$s).$Integer(o)},{$$s:c}))):c.$Integer(h):c.$raise(y("TypeError"),c.name+": "+h+" ("+h.$class()+") must be a String or an Integer")}),p(d,"$initialize",function x(k,f,y){var c,u=x.$$p||N,h=this,q=N;return x.$$p=null,h.name=k.$freeze(),h.formatter=R(c=u)?c:z("DEFAULT_FORMATTER"),q=z("DICE_ROLL_METHOD_RE").$match(f),R(q)||h.$raise(z("ArgumentError"),h.name+": invalid dice roll method: "+f),h.num_of_dice=q["$[]"](1).$to_i(),h.num_of_sides=q["$[]"](2).$to_i(),h.$store(y)}),p(d,"$fetch",function(k){var y,f=this;return y=B(f.items,"find",[],function(h){return null==h&&(h=N),h.$range()["$include?"](k)}),R(y)||f.$raise(z("RangeError"),f.name+": value is out of range: "+k),y}),p(d,"$roll",function(k){var u,f=this,y=N,h=N;return u=(y=k.$roll_barabara(f.num_of_dice,f.num_of_sides)).$sum(),(h=z("RollResult").$new(u,y,f.$fetch(u).$content()))["$formatted="](f.formatter["$[]"](f,h)),h}),d.$private(),p(d,"$store",function(k){var y,u,f=this;return y=B(k,"map",[],function h(c,q){return null==c&&(c=N),null==q&&(q=N),[(null==h.$$s?this:h.$$s).$coerce_to_int_range(c),q]},{$$s:f}),u=B(y,"sort_by",[],function(c,q){return null==c&&(c=N),null==q&&(q=N),c.$min()}),f.$assert_min_sum_is_covered(u),f.$assert_max_sum_is_covered(u),f.$assert_no_gap_or_overlap_in_ranges(u),f.items=B(u,"map",[],function(c,q){return null==c&&(c=N),null==q&&(q=N),z("Item").$new(c,q.$freeze()).$freeze()}).$freeze(),f}),p(d,"$coerce_to_int_range",function(k){var y;return g(z("Integer"),y=k)?z("Range").$new(k,k):g(z("Range"),y)&&R(k.$begin()["$is_a?"](z("Integer")))&&R(k.$end()["$is_a?"](z("Integer")))?k:this.$raise(z("TypeError"),this.name+": "+k+" ("+k.$class()+") must be an Integer or a Range with Integers ")}),p(d,"$assert_min_sum_is_covered",function(k){var y,f=this,u=N;return y=f.num_of_dice,u=k.$first()["$[]"](0),R(u["$include?"](y))||f.$raise(z("RangeError"),f.name+": min value ("+y+") is not covered: "+u),f}),p(d,"$assert_max_sum_is_covered",function(k){var y,f=this,u=N;return y=M(f.num_of_dice,f.num_of_sides),u=k.$last()["$[]"](0),R(u["$include?"](y))||f.$raise(z("RangeError"),f.name+": max value ("+y+") is not covered: "+u),f}),p(d,"$assert_no_gap_or_overlap_in_ranges",function(k){return B(k,"each_cons",[2],function y(u,h){var o,n,c=null==y.$$s?this:y.$$s,q=N,F=N;return null==c.name&&(c.name=N),null==u&&(u=N),null==h&&(h=N),q=u["$[]"](0),F=h["$[]"](0),o=q.$max(),n=Y(o,1),R(F["$include?"](o))&&c.$raise(z("RangeError"),c.name+": Range overlap: "+q+" and "+F),R(F["$include?"](n))?N:c.$raise(z("RangeError"),c.name+": Range gap: "+q+" and "+F)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var Y,I,v,d,P,z,H,C,J,N,K=e.module,G=e.klass,_=e.send,B=e.def,L=e.rb_minus,p=e.return_ivar,g=[],R=e.nil,S=e.$$$;return Y=g,I=N=[K(g[0],"BCDice")].concat(Y),v=J=[K(N[0],"DiceTable")].concat(I),d=C=[G(J[0],null,"SaiFicSkillTable")].concat(v),z=[P=G(C[0],null,"Category")].concat(d),H=e.$r(z),B(P,"$initialize",function(k,f,y,u){var h=this;return h.name=k,h.skills=_(f.$map(),"with_index",[2],function(q,F){return null==q&&(q=R),null==F&&(F=R),S(H("SaiFicSkillTable"),"Skill").$new(k,q,y,F,u)}),h.dice=y}),B(P,"$roll",function(k){return this.$skills()["$[]"](L(k.$roll_sum(2,6),2))}),B(P,"$to_s",p("name")),P.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var R,W,J,C,$,s,j,M,K=e.module,G=e.klass,_=e.def,B=e.hash2,L=[],p=e.nil;return R=L,W=M=[K(L[0],"BCDice")].concat(R),J=j=[K(M[0],"DiceTable")].concat(W),s=[G(j[0],null,"SaiFicSkillTable")].concat(J),($=(C=G(s[0],null,"Skill")).$$prototype).s_format=$.category_dice=$.row_dice=$.category_name=$.name=p,_(C,"$initialize",function(d,P,z,H,x){var k=this;return k.category_name=d,k.name=P,k.category_dice=z,k.row_dice=H,k.s_format=x}),_(C,"$to_s",function(){var d=this;return d.$format(d.s_format,B(["category_dice","row_dice","category_name","skill_name"],{category_dice:d.category_dice,row_dice:d.row_dice,category_name:d.category_name,skill_name:d.name}))}),C.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var s,$,H,x,k,f,y,d,i,K=e.module,G=e.klass,_=e.ensure_kwargs,B=e.hash2,L=e.send,g=e.defs,R=e.const_set,S=e.to_ary,M=e.def,Y=e.truthy,W=e.rb_minus,N=e.rb_plus,j=e.top,I=[],w=e.nil,J=e.$$$;return j.$require("bcdice/dice_table/sai_fic_skill_table/category"),j.$require("bcdice/dice_table/sai_fic_skill_table/skill"),s=I,$=i=[K(I[0],"BCDice")].concat(s),H=d=[K(i[0],"DiceTable")].concat($),k=[x=G(d[0],null,"SaiFicSkillTable")].concat(H),f=e.$r(k),(y=x.$$prototype).rtt=y.rtt_format=y.rct=y.rct_format=y.rttn=y.rttn_format=y.categories=w,g(x,"$from_i18n",function(h,c,q){var F,o,n,t,l=w;return null==(F=(q=_(q)).$$smap.rtt)&&(F=w),null==(o=q.$$smap.rct)&&(o=w),null==(n=q.$$smap.rttn)&&(n=w),t=(l=f("I18n").$t("RTT",B(["locale","raise","default"],{locale:c,raise:!1,default:B([],{})})).$merge(f("I18n").$t(h,B(["locale","raise"],{locale:c,raise:!0}))))["$[]"]("items"),l=L(l,"select",[],function(E,D){return null==E&&(E=w),null==D&&(D=w),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](E)}),this.$new(t,e.to_hash(l).$merge(B(["rtt","rct","rttn"],{rtt:F,rct:o,rttn:n})))},-3),R(k[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),R(k[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),R(k[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),R(k[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),M(x,"$initialize",function(h,c){var q,F,o,n,m,a,l,t=this;return null==(q=(c=_(c)).$$smap.rtt)&&(q=w),null==(F=c.$$smap.rct)&&(F=w),null==(o=c.$$smap.rttn)&&(o=w),null==(n=c.$$smap.rtt_format)&&(n=f("DEFAULT_RTT")),null==(m=c.$$smap.rct_format)&&(m=f("DEFAULT_RCT")),null==(a=c.$$smap.rttn_format)&&(a=f("DEFAULT_RTTN")),null==(l=c.$$smap.s_format)&&(l=f("DEFAULT_S")),t.categories=L(h.$map(),"with_index",[1],function(E,D){var U,ee,V;return null==E&&(E=w),null==D&&(D=w),ee=null==(U=S(E))[0]?w:U[0],V=null==U[1]?w:U[1],J(f("SaiFicSkillTable"),"Category").$new(ee,V,D,l)},{$$has_top_level_mlhs_arg:!0}),t.rtt=q,t.rct=F,t.rttn=o.$to_a(),t.rtt_format=n,t.rct_format=m,t.rttn_format=a},-2),R(k[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),x.$attr_reader("categories"),M(x,"$roll_command",function(h,c){var F,q=this,o=w,n=w;return Y(["RTT",q.rtt]["$include?"](F=c))?q.$format_skill(q.rtt_format,q.$roll_skill(h)):Y(["RCT",q.rct]["$include?"](F))?(o=q.$roll_category(h),q.$format(q.rct_format,B(["category_dice","category_name"],{category_dice:o.$dice(),category_name:o.$name()}))):Y(n=f("RTTN").$index(F))||Y(n=q.rttn.$index(F))?q.$format_skill(q.rttn_format,q.categories["$[]"](n).$roll(h)):w}),M(x,"$roll_category",function(h){return this.categories["$[]"](W(h.$roll_once(6),1))}),M(x,"$roll_skill",function(h){return this.$roll_category(h).$roll(h)}),M(x,"$prefixes",function(){var h=this;return N(["RTT[1-6]?","RCT",h.rtt,h.rct],h.rttn).$compact()}),x.$private(),M(x,"$format_skill",function(h,c){return this.$format(h,B(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:c.$category_dice(),row_dice:c.$row_dice(),category_name:c.$category_name(),skill_name:c.$name(),text:c.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var Y,I,v,i,C,$,r,J,N,K=e.module,G=e.klass,_=e.hash2,B=e.defs,L=e.truthy,p=e.def,g=e.rb_minus,R=[],S=e.nil;return Y=R,I=N=[K(R[0],"BCDice")].concat(Y),v=J=[K(N[0],"DiceTable")].concat(I),C=[i=G(J[0],null,"Table")].concat(v),$=e.$r(C),(r=i.$$prototype).times=r.sides=r.name=r.items=S,B(i,"$from_i18n",function(P,z){var x=S;return x=$("I18n").$t(P,_(["locale"],{locale:z})),this.$new(x["$[]"]("name"),x["$[]"]("type"),x["$[]"]("items"))}),p(i,"$initialize",function(P,z,H){var x=this,k=S;return x.name=P,x.items=H.$freeze(),k=/(\d+)D(\d+)/i.$match(z),L(k)||x.$raise($("ArgumentError"),"Unexpected table type: "+z),x.times=k["$[]"](1).$to_i(),x.sides=k["$[]"](2).$to_i()}),p(i,"$roll",function(P){var H,z=this;return H=P.$roll_sum(z.times,z.sides),z.$choice(H)}),p(i,"$choice",function(P){var H,z=this;return H=g(P,z.times),$("RollResult").$new(z.name,P,z.items["$[]"](H))})},Opal.modules["bcdice/dice_table"]=function(e){var K=e.top;return K.$require("bcdice/dice_table/roll_result"),K.$require("bcdice/dice_table/chain_table"),K.$require("bcdice/dice_table/d66_grid_table"),K.$require("bcdice/dice_table/d66_half_grid_table"),K.$require("bcdice/dice_table/d66_one_third_table"),K.$require("bcdice/dice_table/d66_left_range_table"),K.$require("bcdice/dice_table/d66_parity_table"),K.$require("bcdice/dice_table/d66_range_table"),K.$require("bcdice/dice_table/d66_table"),K.$require("bcdice/dice_table/range_table"),K.$require("bcdice/dice_table/sai_fic_skill_table"),K.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var p,M,W,R,K=e.module,G=e.const_set,_=[];return p=_,M=R=[K(_[0],"BCDice")].concat(p),W=[K(R[0],"D66SortType")].concat(M),G(W[0],"NO_SORT","no_sort"),G(W[0],"ASC","asc"),G(W[0],"DESC","desc"),function(S,M){var W=[K(S,"RoundType")].concat(M);return G(W[0],"CEIL","ceil"),G(W[0],"FLOOR","floor"),G(W[0],"ROUND","round")}(R[0],R)},Opal.modules["bcdice/translate"]=function(e){var M,j,I,w,J,W,K=e.module,G=e.ensure_kwargs,_=e.kwrestargs,L=e.hash2,p=e.def,g=[],R=e.nil;return M=g,j=W=[K(g[0],"BCDice")].concat(M),w=[I=K(W[0],"Translate")].concat(j),J=e.$r(w),p(I,"$translate",function(s,v){var i,C=this;return null==C.locale&&(C.locale=R),v=G(v),i=_(v,{}),J("I18n").$translate(s,L(["locale","raise"],{locale:C.locale,raise:!0}).$merge(e.to_hash(i)))},-2)},Opal.modules["bcdice/result"]=function(e){var I,X,w,M,W,G=e.klass,_=e.send,B=e.def,L=e.return_val,p=e.return_ivar,g=[],R=e.nil;return M=g,I=W=[(0,e.module)(g[0],"BCDice")].concat(M),[w=G(W[0],null,"Result")].concat(I),B(X=e.get_singleton_class(w),"$success",function(i){return _(this.$new(),"tap",[],function(r){var d;return null==r&&(r=R),r["$text="](i),_(r,"success=",d=[!0]),d[d.length-1]})}),B(X,"$failure",function(i){return _(this.$new(),"tap",[],function(r){var d;return null==r&&(r=R),r["$text="](i),_(r,"failure=",d=[!0]),d[d.length-1]})}),B(X,"$critical",function(i){return _(this.$new(),"tap",[],function(r){var d;return null==r&&(r=R),r["$text="](i),r["$critical="](!0),_(r,"success=",d=[!0]),d[d.length-1]})}),B(X,"$fumble",function(i){return _(this.$new(),"tap",[],function(r){var d;return null==r&&(r=R),r["$text="](i),r["$fumble="](!0),_(r,"failure=",d=[!0]),d[d.length-1]})}),B(X,"$nothing",L("nothing")),B(w,"$initialize",function(s){var v=this;return null==s&&(s=R),v.text=s,v.rands=R,v.detailed_rands=R,v.secret=!1,v.success=!1,v.failure=!1,v.critical=!1,v.fumble=!1},-1),w.$attr_accessor("text","rands","detailed_rands"),w.$attr_writer("secret","success","failure","critical","fumble"),B(w,"$secret?",p("secret")),B(w,"$success?",p("success")),B(w,"$failure?",p("failure")),B(w,"$critical?",p("critical")),B(w,"$fumble?",p("fumble")),B(w,"$condition=",function(s){return this.success=s,this.failure=s["$!"]()})},Opal.modules["racc/parser"]=function(e){var P,H,x,K=e.module,G=e.klass,_=e.truthy,B=e.const_set,L=e.defs,p=e.gvars,g=e.rb_lt,R=e.def,S=e.to_ary,M=e.send,Y=e.neqeq,W=e.rb_plus,N=e.eqeq,j=e.rb_ge,I=e.rb_gt,w=e.rb_minus,J=e.rb_le,X=e.rb_times,s=e.assign_ivar_val,i=[],C=e.$r(i),$=e.nil,r=e.$$$;return P=i,H=[K(i[0],"Racc")].concat(P),x=e.$r(H),G(H[0],x("StandardError"),"ParseError"),_(r("::","ParseError","skip_raise")?"constant":$)||B(i[0],"ParseError",r(C("Racc"),"ParseError")),function(d,P){var u,h,c,q,F,x=[K(d,"Racc")].concat(P),k=e.$r(x);return _(k("Racc_No_Extensions","skip_raise")?"constant":$)||B(x[0],"Racc_No_Extensions",!1),u=x,c=[h=G(x[0],null,"Parser")].concat(u),q=e.$r(c),(F=h.$$prototype).yydebug=F.racc_debug_out=F.racc_error_status=F.racc_t=F.racc_vstack=F.racc_val=F.racc_state=F.racc_tstack=$,B(c[0],"Racc_Runtime_Version","1.4.6"),B(c[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),B(c[0],"Racc_Runtime_Core_Version_R","1.4.6"),B(c[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),B(c[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),B(c[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),B(c[0],"Racc_Runtime_Core_Version",q("Racc_Runtime_Core_Version_R")),B(c[0],"Racc_Runtime_Core_Revision",q("Racc_Runtime_Core_Revision_R")),B(c[0],"Racc_Runtime_Type","ruby"),L(q("Parser"),"$racc_runtime_type",function(){return q("Racc_Runtime_Type")}),R(h,"$_racc_setup",function(){var n,m,a=this,l=$,t=$;return null==p.stderr&&(p.stderr=$),_(r(a.$class(),"Racc_debug_parser"))||(a.yydebug=!1),_(null!=(n=a.yydebug)&&n!==$?"instance-variable":$)||(a.yydebug=!1),_(a.yydebug)&&(_(null!=(m=a.racc_debug_out)&&m!==$?"instance-variable":$)||(a.racc_debug_out=p.stderr),a.racc_debug_out=_(l=a.racc_debug_out)?l:p.stderr),t=r(a.$class(),"Racc_arg"),_(g(t.$size(),14))&&t["$[]="](13,!0),t}),R(h,"$_racc_init_sysvars",function(){var n=this;return n.racc_state=[0],n.racc_tstack=[],n.racc_vstack=[],n.racc_t=$,n.racc_val=$,n.racc_read_next=!0,n.racc_user_yyerror=!1,n.racc_error_status=0}),R(h,"$do_parse",function(){return this.$__send__(q("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),R(h,"$next_token",function(){return this.$raise(q("NotImplementedError"),this.$class()+"#next_token is not defined")}),R(h,"$_racc_do_parse_rb",function(n,m){var a,t=this,T=$,E=$,D=$,U=$,ee=$,V=$,O=$,te=$;return a=S(n),T=null==a[0]?$:a[0],E=null==a[1]?$:a[1],D=null==a[2]?$:a[2],U=null==a[3]?$:a[3],ee=null==a[10]?$:a[10],t.$_racc_init_sysvars(),V=O=te=$,M(t,"catch",["racc_end_parse"],function ne(){var ie,Z,b=null==ne.$$s?this:ne.$$s,re=$;for(null==b.racc_state&&(b.racc_state=$),null==b.racc_read_next&&(b.racc_read_next=$),null==b.racc_t&&(b.racc_t=$),null==b.yydebug&&(b.yydebug=$),null==b.racc_val&&(b.racc_val=$);_(!0);)for(_(te=U["$[]"](b.racc_state["$[]"](-1)))?(_(b.racc_read_next)&&Y(b.racc_t,0)&&(Z=b.$next_token(),ie=S(Z),V=null==ie[0]?$:ie[0],b.racc_val=null==ie[1]?$:ie[1],b.racc_t=_(V)?_(re=ee["$[]"](V))?re:1:0,_(b.yydebug)&&b.$racc_read_token(b.racc_t,V,b.racc_val),b.racc_read_next=!1),te=W(te,b.racc_t),_(j(te,0))&&_(O=T["$[]"](te))&&N(E["$[]"](te),b.racc_state["$[]"](-1))||(O=D["$[]"](b.racc_state["$[]"](-1)))):O=D["$[]"](b.racc_state["$[]"](-1));_(O=b.$_racc_evalact(O,n)););},{$$s:t})}),R(h,"$yyparse",function(n,m){return this.$__send__(q("Racc_YY_Parse_Method"),n,m,this.$_racc_setup(),!0)}),R(h,"$_racc_yyparse_rb",function(n,m,a,l){var t,E=this,D=$,U=$,Q=$,ee=$,O=$,te=$,ne=$;return t=S(a),D=null==t[0]?$:t[0],U=null==t[1]?$:t[1],Q=null==t[2]?$:t[2],ee=null==t[3]?$:t[3],O=null==t[10]?$:t[10],E.$_racc_init_sysvars(),te=$,ne=$,M(E,"catch",["racc_end_parse"],function ie(){var Z=null==ie.$$s?this:ie.$$s;for(null==Z.racc_state&&(Z.racc_state=$);!_(ne=ee["$[]"](Z.racc_state["$[]"](-1)));)for(;_(te=Z.$_racc_evalact(Q["$[]"](Z.racc_state["$[]"](-1)),a)););return M(n,"__send__",[m],function b(re,$e){var A=null==b.$$s?this:b.$$s,se=$,ce=$;for(null==A.racc_t&&(A.racc_t=$),null==A.racc_state&&(A.racc_state=$),null==A.racc_read_next&&(A.racc_read_next=$),null==re&&(re=$),null==$e&&($e=$),A.racc_t=_(re)?_(se=O["$[]"](re))?se:1:0,A.racc_val=$e,A.racc_read_next=!1,ne=W(ne,A.racc_t),_(j(ne,0))&&_(te=D["$[]"](ne))&&N(U["$[]"](ne),A.racc_state["$[]"](-1))||(te=Q["$[]"](A.racc_state["$[]"](-1)));_(te=A.$_racc_evalact(te,a)););for(;_(_(se=_(ce=(ne=ee["$[]"](A.racc_state["$[]"](-1)))["$!"]())?ce:A.racc_read_next["$!"]())?se:A.racc_t["$=="](0));)for(_(ne)&&_(ne=W(ne,A.racc_t))&&_(j(ne,0))&&_(te=D["$[]"](ne))&&N(U["$[]"](ne),A.racc_state["$[]"](-1))||(te=Q["$[]"](A.racc_state["$[]"](-1)));_(te=A.$_racc_evalact(te,a)););},{$$s:Z})},{$$s:E})}),R(h,"$_racc_evalact",function(n,m){var a,Q,t=this,T=$,E=$,U=$,ee=$,V=$,O=$;if(T=null==(a=S(m))[0]?$:a[0],E=null==a[1]?$:a[1],U=null==a[3]?$:a[3],Q=null==a[11]?$:a[11],ee=null==a[12]?$:a[12],_(I(n,0))&&_(g(n,Q)))_(I(t.racc_error_status,0))&&(N(t.racc_t,1)||(t.racc_error_status=w(t.racc_error_status,1))),t.racc_vstack.$push(t.racc_val),t.racc_state.$push(n),t.racc_read_next=!0,_(t.yydebug)&&(t.racc_tstack.$push(t.racc_t),t.$racc_shift(t.racc_t,t.racc_tstack,t.racc_vstack));else if(_(g(n,0))&&_(I(n,ee["$-@"]()))){if(V=M(t,"catch",["racc_jump"],function te(){var ne=null==te.$$s?this:te.$$s;return null==ne.racc_state&&(ne.racc_state=$),ne.racc_state.$push(ne.$_racc_do_reduce(m,n)),!1},{$$s:t}),_(V))switch(V.valueOf()){case 1:return t.racc_user_yyerror=!0,ee["$-@"]();case 2:return Q;default:t.$raise("[Racc Bug] unknown jump code")}}else if(N(n,Q))_(t.yydebug)&&t.$racc_accept(),t.$throw("racc_end_parse",t.racc_vstack["$[]"](0));else{if(N(n,ee["$-@"]())){switch(t.racc_error_status.valueOf()){case 0:_(m["$[]"](21))||t.$on_error(t.racc_t,t.racc_val,t.racc_vstack);break;case 3:N(t.racc_t,0)&&t.$throw("racc_end_parse",$),t.racc_read_next=!0}for(t.racc_user_yyerror=!1,t.racc_error_status=3;_(!0)&&!(_(O=U["$[]"](t.racc_state["$[]"](-1)))&&(O=W(O,1),_(j(O,0))&&_(n=T["$[]"](O))&&N(E["$[]"](O),t.racc_state["$[]"](-1))));)_(J(t.racc_state.$size(),1))&&t.$throw("racc_end_parse",$),t.racc_state.$pop(),t.racc_vstack.$pop(),_(t.yydebug)&&(t.racc_tstack.$pop(),t.$racc_e_pop(t.racc_state,t.racc_tstack,t.racc_vstack));return n}t.$raise("[Racc Bug] unknown action "+n.$inspect())}return _(t.yydebug)&&t.$racc_next_state(t.racc_state["$[]"](-1),t.racc_state),$}),R(h,"$_racc_do_reduce",function(n,m){var a,ee,O,re,$e,A,ue,t=this,E=$,D=$,U=$,Q=$,V=$,te=$,ne=$,ie=$,Z=$,b=$,se=$,ce=$,ae=$;return E=null==(a=S(n))[4]?$:a[4],D=null==a[5]?$:a[5],U=null==a[6]?$:a[6],Q=null==a[7]?$:a[7],ee=null==a[8]?$:a[8],V=null==a[9]?$:a[9],O=null==a[13]?$:a[13],te=t.racc_state,ne=t.racc_vstack,ie=t.racc_tstack,Z=X(m,-3),b=V["$[]"](Z),re=V["$[]"](W(Z,1)),$e=V["$[]"](W(Z,2)),A=[],_(t.yydebug)&&(se=ie["$[]"](b["$-@"](),b)),ce=ne["$[]"](b["$-@"](),b),_(t.yydebug)&&ie["$[]="](b["$-@"](),b,A),ne["$[]="](b["$-@"](),b,A),te["$[]="](b["$-@"](),b,A),_(O)?ne.$push(t.$__send__($e,ce,ne,ce["$[]"](0))):ne.$push(t.$__send__($e,ce,ne)),ie.$push(re),_(t.yydebug)&&t.$racc_reduce(se,re,ie,ne),ue=w(re,ee),_(Z=Q["$[]"](ue))&&(Z=W(Z,te["$[]"](-1)),_(j(Z,0))&&_(ae=E["$[]"](Z))&&N(D["$[]"](Z),ue))?ae:U["$[]"](ue)}),R(h,"$on_error",function(n,m,a){var t,l=this;return l.$raise(q("ParseError"),l.$sprintf("\nparse error on value %s (%s)",m.$inspect(),_(t=l.$token_to_str(n))?t:"?"))}),R(h,"$yyerror",function(){return this.$throw("racc_jump",1)}),R(h,"$yyaccept",function(){return this.$throw("racc_jump",2)}),R(h,"$yyerrok",s("racc_error_status",0)),R(h,"$racc_read_token",function(n,m,a){var l=this;return l.racc_debug_out.$print("read    "),l.racc_debug_out.$print(m.$inspect(),"(",l.$racc_token2str(n),") "),l.racc_debug_out.$puts(a.$inspect()),l.racc_debug_out.$puts()}),R(h,"$racc_shift",function(n,m,a){var l=this;return l.racc_debug_out.$puts("shift   "+l.$racc_token2str(n)),l.$racc_print_stacks(m,a),l.racc_debug_out.$puts()}),R(h,"$racc_reduce",function(n,m,a,l){var t=this,T=$;return(T=t.racc_debug_out).$print("reduce "),_(n["$empty?"]())?T.$print(" <none>"):M(n,"each",[],function E(D){return null==D&&(D=$),T.$print(" ",(null==E.$$s?this:E.$$s).$racc_token2str(D))},{$$s:t}),T.$puts(" --\x3e "+t.$racc_token2str(m)),t.$racc_print_stacks(a,l),t.racc_debug_out.$puts()}),R(h,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),R(h,"$racc_e_pop",function(n,m,a){var l=this;return l.racc_debug_out.$puts("error recovering mode: pop token"),l.$racc_print_states(n),l.$racc_print_stacks(m,a),l.racc_debug_out.$puts()}),R(h,"$racc_next_state",function(n,m){var a=this;return a.racc_debug_out.$puts("goto    "+n),a.$racc_print_states(m),a.racc_debug_out.$puts()}),R(h,"$racc_print_stacks",function(n,m){var l=$;return(l=this.racc_debug_out).$print("        ["),M(n,"each_index",[],function t(T){return null==T&&(T=$),l.$print(" (",(null==t.$$s?this:t.$$s).$racc_token2str(n["$[]"](T))," ",m["$[]"](T).$inspect(),")")},{$$s:this}),l.$puts(" ]")}),R(h,"$racc_print_states",function(n){var a=$;return(a=this.racc_debug_out).$print("        ["),M(n,"each",[],function(t){return null==t&&(t=$),a.$print(" ",t)}),a.$puts(" ]")}),R(h,"$racc_token2str",function(n){var a;return _(a=r(this.$class(),"Racc_token_to_s_table")["$[]"](n))?a:this.$raise("[Racc Bug] can't convert token "+n+" to string")}),R(h,"$token_to_str",function(n){return r(this.$class(),"Racc_token_to_s_table")["$[]"](n)})}(i[0],i)},Opal.modules["bcdice/arithmetic/node"]=function(e){var s,$,z,u,h,x,k,d,i,K=e.module,G=e.klass,_=e.def,B=e.thrower,L=e.return_ivar,p=e.send2,g=e.find_super,R=e.eqeq,S=e.const_set,M=e.eqeqeq,Y=e.rb_divide,W=e.truthy,N=e.assign_ivar,j=e.alias,I=[],w=e.nil,J=e.$$$;return s=I,$=i=[K(I[0],"BCDice")].concat(s),z=d=[K(i[0],"Arithmetic")].concat($),x=[K(d[0],"Node")].concat(z),k=e.$r(x),(h=(u=G(x[0],null,"BinaryOp")).$$prototype).lhs=h.rhs=h.op=w,_(u,"$initialize",function(q,F,o){var n=this;return n.lhs=q,n.op=F,n.rhs=o}),_(u,"$eval",function(q){try{B("eval_return");var m,o=this,n=w;return n=o.lhs.$eval(q),m=o.rhs.$eval(q),n.$send(o.op,m)}catch(a){if(a===e.t_eval_return)return a.$v;throw a}}),_(u,"$output",function(){var q=this;return""+q.lhs.$output()+q.op+q.rhs.$output()}),_(u,"$s_exp",function(){var q=this;return"("+q.$op_for_s_exp()+" "+q.lhs.$s_exp()+" "+q.rhs.$s_exp()+")"}),_(u,"$op_for_s_exp",L("op")),function(f,y,u){var h=G(f,y,"DivideBase"),c=[h].concat(u),q=e.$r(c),F=h.$$prototype;F.lhs=F.rhs=F.op=w,_(h,"$initialize",function o(n,m){return o.$$p=null,p(this,g(this,"initialize",o,!1,!0),"initialize",[n,"/",m],null)}),_(h,"$eval",function(n){try{B("eval_return");var l,t,a=this;return l=a.lhs.$eval(n),t=a.rhs.$eval(n),R(t,0)&&a.$raise(q("ZeroDivisionError")),a.$divide_and_round(l,t,n)}catch(T){if(T===e.t_eval_return)return T.$v;throw T}}),_(h,"$output",function o(){var n=o.$$p||w,m=this;return o.$$p=null,""+p(m,g(m,"output",o,!1,!0),"output",[],n)+m.$rounding_method()}),h.$private(),_(h,"$rounding_method",function(){return J(this.$class(),"ROUNDING_METHOD")}),_(h,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),_(h,"$divide_and_round",function(n,m,a){return this.$raise(q("NotImplementedError"))})}(x[0],k("BinaryOp"),x),function(f,y,u){var h=G(f,y,"DivideWithGameSystemDefault"),c=[h].concat(u),q=e.$r(c);S(c[0],"ROUNDING_METHOD",""),h.$private(),_(h,"$divide_and_round",function(o,n,m){var a,l=w;return M(J(q("RoundType"),"CEIL"),a=m)?Y(o.$to_f(),n).$ceil():M(J(q("RoundType"),"ROUND"),a)?(l=Y(o.$to_f(),n),W(l["$negative?"]())?l.$abs().$round()["$-@"]():l.$round()):Y(o,n).$floor()})}(x[0],k("DivideBase"),x),function(f,y,u){var h=G(f,y,"DivideWithCeil"),c=[h].concat(u);S(c[0],"ROUNDING_METHOD","C"),h.$private(),_(h,"$divide_and_round",function(F,o,n){return Y(F.$to_f(),o).$ceil()})}(x[0],k("DivideBase"),x),function(f,y,u){var h=G(f,y,"DivideWithRound"),c=[h].concat(u);S(c[0],"ROUNDING_METHOD","R"),h.$private(),_(h,"$divide_and_round",function(F,o,n){var m=w;return m=Y(F.$to_f(),o),W(m["$negative?"]())?m.$abs().$round()["$-@"]():m.$round()})}(x[0],k("DivideBase"),x),function(f,y,u){var h=G(f,y,"DivideWithFloor"),c=[h].concat(u);S(c[0],"ROUNDING_METHOD","F"),h.$private(),_(h,"$divide_and_round",function(F,o,n){return Y(F,o).$floor()})}(x[0],k("DivideBase"),x),function(f,y){var u=G(f,null,"Negative");u.$$prototype.body=w,_(u,"$initialize",N("body")),_(u,"$eval",function(q){try{return B("eval_return"),this.body.$eval(q)["$-@"]()}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),_(u,"$output",function(){return"-"+this.body.$output()}),_(u,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(x[0]),function(f,y){var u=G(f,null,"Parenthesis");u.$$prototype.expr=w,_(u,"$initialize",N("expr")),_(u,"$eval",function(q){try{return B("eval_return"),this.expr.$eval(q)}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),_(u,"$output",function(){return"("+this.expr.$output()+")"}),_(u,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(x[0]),function(f,y){var u=G(f,null,"Number");return u.$$prototype.value=w,_(u,"$initialize",N("value")),_(u,"$eval",L("value")),_(u,"$output",function(){return this.value.$to_s()}),j(u,"s_exp","output")}(x[0])},Opal.modules.strscan=function(e){var N,j,I,w,J,G=e.def,_=e.truthy,B=e.eqeqeq,L=e.Opal,p=e.return_ivar,g=e.send,R=e.alias,S=[],M=e.nil;return N=S,I=[j=(0,e.klass)(S[0],null,"StringScanner")].concat(N),w=e.$r(I),(J=j.$$prototype).pos=J.string=J.working=J.matched=J.prev_pos=J.match=M,j.$attr_reader("pos","matched"),G(j,"$initialize",function(s){var v=this;return v.string=s,v.pos=0,v.matched=M,v.working=s,v.match=[]}),j.$attr_reader("string"),G(j,"$beginning_of_line?",function(){var s=this;return 0===s.pos||"\n"===s.string.charAt(s.pos-1)}),G(j,"$scan",function(s){var v=this,i=(s=v.$anchor(s)).exec(v.working);return null==i?v.matched=M:(v.prev_pos=v.pos,v.pos+=i[0].length,v.working=v.working.substring(i[0].length),v.matched=i[0],v.match=i,i[0])}),G(j,"$scan_until",function(s){var v=this;s=v.$anchor(s);for(var i=v.working,C=0;i.length!=C;++C){var $=s.exec(i.substr(C));if(null!==$){var r=C+$[0].length,d=i.substr(0,r);return v.matched=$[0],v.match=$,v.prev_pos=v.pos+C,v.pos+=r,v.working=i.substr(r),d}}return v.matched=M}),G(j,"$[]",function(s){var i;if(_(this.match["$empty?"]()))return M;B(w("Symbol"),i=s)?s=s.$to_s():B(w("String"),i)||(s=L["$coerce_to!"](s,w("Integer"),"to_int"));var C=this.match;return s<0&&(s+=C.length),s<0||s>=C.length||null==C[s]?M:C[s]}),G(j,"$check",function(s){var v=this,i=(s=v.$anchor(s)).exec(v.working);return v.matched=null==i?M:i[0]}),G(j,"$check_until",function(s){var v=this,i=v.prev_pos,C=v.pos,$=v.working,r=v.$scan_until(s);return v.prev_pos=i,v.pos=C,v.working=$,r}),G(j,"$peek",function(s){return this.working.substring(0,s)}),G(j,"$eos?",function(){return 0===this.working.length}),G(j,"$exist?",function(s){var i=s.exec(this.working);return null==i?M:0==i.index?0:i.index+1}),G(j,"$skip",function(s){var v=this,i=(s=v.$anchor(s)).exec(v.working);if(null==i)return v.match=[],v.matched=M;var C=i[0],$=C.length;return v.matched=C,v.match=i,v.prev_pos=v.pos,v.pos+=$,v.working=v.working.substring($),$}),G(j,"$skip_until",function(s){var i=this.$scan_until(s);return i===M?M:(this.matched=i.substr(-1),i.length)}),G(j,"$get_byte",function(){var s=this,v=M;return s.pos<s.string.length?(s.prev_pos=s.pos,s.pos+=1,v=s.matched=s.working.substring(0,1),s.working=s.working.substring(1)):s.matched=M,v}),G(j,"$match?",function(s){var v=this,i=(s=v.$anchor(s)).exec(v.working);return null==i?M:(v.prev_pos=v.pos,i[0].length)}),G(j,"$pos=",function(s){var v=this;return s<0&&(s+=v.string.$length()),v.pos=s,v.working=v.string.slice(s)}),G(j,"$matched_size",function(){return this.matched===M?M:this.matched.length}),G(j,"$post_match",function(){var s=this;return s.matched===M?M:s.string.substr(s.pos)}),G(j,"$pre_match",function(){var s=this;return s.matched===M?M:s.string.substr(0,s.prev_pos)}),G(j,"$reset",function(){var s=this;return s.working=s.string,s.matched=M,s.pos=0}),G(j,"$rest",p("working")),G(j,"$rest?",function(){return 0!==this.working.length}),G(j,"$rest_size",function(){return this.$rest().$size()}),G(j,"$terminate",function(){var s,v=this;return v.match=M,s=[v.string.$length()],g(v,"pos=",s),s[s.length-1]}),G(j,"$unscan",function(){var s=this;return s.pos=s.prev_pos,s.prev_pos=M,s.match=M,s}),R(j,"bol?","beginning_of_line?"),R(j,"getch","get_byte"),j.$private(),G(j,"$anchor",function(s){var v=s.toString().match(/\/([^\/]+)$/);return v=v?v[1]:void 0,new RegExp("^(?:"+s.source+")",v)})},Opal.modules["bcdice/normalize"]=function(e){var R,W,M,K=e.module,G=e.eqeqeq,_=e.def,B=e.eqeq,L=[],p=e.nil;return R=L,M=[K(L[0],"BCDice")].concat(R),(W=K(M[0],"Normalize")).$module_function(),_(W,"$comparison_operator",function(j){var I;return G(/<=|=</,I=j)?"<=":G(/>=|=>/,I)?">=":G(/<>|!=|=!/,I)?"!=":G(/</,I)?"<":G(/>/,I)?">":G(/=/,I)?"==":p}),_(W,"$target_number",function(j){return B(j,"?")?j:j.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var N,J,C,$,r,d,P,s,I,K=e.module,G=e.klass,_=e.const_set,B=e.hash2,L=e.truthy,p=e.send,g=e.def,R=e.thrower,S=e.top,M=[],Y=e.nil;return S.$require("strscan"),S.$require("bcdice/normalize"),N=M,J=I=[K(M[0],"BCDice")].concat(N),C=s=[K(I[0],"Command")].concat(J),r=[$=G(s[0],null,"Lexer")].concat(C),d=e.$r(r),(P=$.$$prototype).scanner=P.notations=Y,_(r[0],"SYMBOLS",B(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),g($,"$initialize",function(H,x){var k,f,u;return H=L(u=(k=(f=H)===Y||null==f?Y:f.$split(" ",2))===Y||null==k?Y:k.$first())?u:"",this.scanner=d("StringScanner").$new(H),this.notations=p(x,"map",[],function(c){return null==c&&(c=Y),L(c["$is_a?"](d("String")))?d("Regexp").$new(c):c})}),g($,"$next_token",function(){try{var H=R("return"),x=this,k=Y,f=Y,u=Y,h=Y;return L(x.scanner["$eos?"]())?[!1,"$"]:(p(x.notations,"each",[],function c(q){var o,F=null==c.$$s?this:c.$$s;if(null==F.scanner&&(F.scanner=Y),null==q&&(q=Y),o=F.scanner.$scan(q),!L(o))return Y;H.$throw(["NOTATION",o])},{$$s:x,$$ret:H}),L(k=x.scanner.$scan(/\d+/))?["NUMBER",k.$to_i()]:L(f=x.scanner.$scan(/[<>!=]+/))?(f=d("Normalize").$comparison_operator(f),[L(f)?"CMP_OP":"ILLEGAL",f]):(u=x.scanner.$getch().$upcase(),[L(h=d("SYMBOLS")["$[]"](u))?h:u.$to_sym(),u]))}catch(c){if(c===H)return c.$v;throw c}}),g($,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var S,N,X,s,v,i,C,I,Y,K=e.module,G=e.klass,_=e.def,B=e.return_ivar,L=e.truthy,p=[],g=e.nil;return S=p,N=Y=[K(p[0],"BCDice")].concat(S),X=I=[K(Y[0],"Command")].concat(N),v=[s=G(I[0],null,"Parsed")].concat(X),i=e.$r(v),(C=s.$$prototype).critical=C.fumble=C.dollar=C.modify_number=C.question_target=C.target_number=C.prefix_number=C.command=C.suffix_number=C.cmp_op=g,s.$attr_accessor("command"),s.$attr_accessor("prefix_number"),s.$attr_accessor("suffix_number"),s.$attr_accessor("critical"),s.$attr_accessor("fumble"),s.$attr_accessor("dollar"),s.$attr_accessor("modify_number"),s.$attr_accessor("cmp_op"),s.$attr_accessor("target_number"),s.$attr_writer("question_target"),_(s,"$initialize",function(){var r=this;return r.prefix_number=g,r.suffix_number=g,r.critical=g,r.fumble=g,r.dollar=g,r.cmp_op=g,r.target_number=g,r.question_target=!1}),_(s,"$question_target?",B("question_target")),_(s,"$to_s",function(r){var d=this,P=g,z=g,H=g,x=g,k=g;switch(null==r&&(r="after_command"),P=L(d.critical)?"@"+d.critical:g,z=L(d.fumble)?"#"+d.fumble:g,H=L(d.dollar)?"$"+d.dollar:g,x=i("Format").$modifier(d.modify_number),k=L(d.question_target)?"?":d.target_number,r.valueOf()){case"after_command":return[d.prefix_number,d.command,d.suffix_number,P,z,H,x,d.cmp_op,k].$join();case"after_modify_number":return[d.prefix_number,d.command,d.suffix_number,x,P,z,H,d.cmp_op,k].$join();case"after_target_number":return[d.prefix_number,d.command,d.suffix_number,x,d.cmp_op,k,P,z,H].$join();default:return g}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var r,H,h,m,a,l,t,T,E,D,U,Q,O,c,o,n,ie,k,f,P,K=e.klass,G=e.module,_=e.slice,B=e.extract_kwargs,L=e.ensure_kwargs,p=e.get_kwarg,g=e.send2,R=e.find_super,S=e.def,M=e.send,Y=e.eqeq,W=e.thrower,N=e.hash,j=e.const_set,I=e.truthy,w=e.to_ary,J=e.hash2,X=e.top,s=[],v=e.$r(s),i=e.nil,C=e.$$$;return X.$require("racc/parser.rb"),X.$require("bcdice/arithmetic/node"),X.$require("bcdice/command/lexer"),X.$require("bcdice/command/parsed"),K(C(v("BCDice"),"Command"),C(v("Racc"),"Parser"),"Parser"),r=s,H=P=[G(s[0],"BCDice")].concat(r),k=[G(P[0],"Command")].concat(H),f=e.$r(k),h=k,o=[c=K(k[0],C(f("Racc"),"Parser"),"Parser")].concat(h),n=e.$r(o),(ie=c.$$prototype).notations=ie.lexer=ie.modifier=ie.suffix_number=ie.prefix_number=ie.need_suffix_number=ie.need_prefix_number=ie.critical=ie.fumble=ie.dollar=ie.allowed_cmp_op=ie.question_target=i,S(c,"$initialize",function Z(b,re){var $e,A,se,ce,ae=this;return Z.$$p=null,$e=_(arguments),A=B($e),A=L(A),se=$e,ce=p(A,"round_type"),g(ae,R(ae,"initialize",Z,!1,!0),"initialize",[],null),ae.notations=se,ae.round_type=ce,ae.prefix_number=!1,ae.suffix_number=!1,ae.need_prefix_number=!1,ae.need_suffix_number=!1,ae.modifier=!0,ae.critical=!1,ae.fumble=!1,ae.dollar=!1,ae.allowed_cmp_op=[i,">=",">","<=","<","==","!="],ae.question_target=!1},-2),S(c,"$disable_modifier",function(){return this.modifier=!1,this}),S(c,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),S(c,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),S(c,"$has_prefix_number",function(){var b=this;return b.prefix_number=!0,b.need_prefix_number=!0,b}),S(c,"$has_suffix_number",function(){var b=this;return b.suffix_number=!0,b.need_suffix_number=!0,b}),S(c,"$enable_critical",function(){return this.critical=!0,this}),S(c,"$enable_fumble",function(){return this.fumble=!0,this}),S(c,"$enable_dollar",function(){return this.dollar=!0,this}),S(c,"$restrict_cmp_op_to",function(b){var re;return re=_(arguments),this.allowed_cmp_op=re,this},-1),S(c,"$enable_question_target",function(){return this.question_target=!0,this}),S(c,"$parse",function(b){try{return this.lexer=n("Lexer").$new(b,this.notations),this.$do_parse()}catch($e){if(!e.rescue($e,[n("ParseError"),n("ZeroDivisionError")]))throw $e;try{return i}finally{e.pop_exception()}}}),c.$private(),S(c,"$parsed",function(b,re,$e,A){try{return W("eval_return"),M(n("Parsed").$new(),"tap",[],function ue(ae){var le,_e,de,ve,me,fe,be,oe=null==ue.$$s?this:ue.$$s;return null==oe.round_type&&(oe.round_type=i),null==ae&&(ae=i),ae["$command="](b["$[]"]("command")),ae["$prefix_number="]((le=b["$[]"]("prefix"))===i||null==le?i:le.$eval(oe.round_type)),ae["$suffix_number="]((_e=b["$[]"]("suffix"))===i||null==_e?i:_e.$eval(oe.round_type)),ae["$critical="]((de=re["$[]"]("critical"))===i||null==de?i:de.$eval(oe.round_type)),ae["$fumble="]((ve=re["$[]"]("fumble"))===i||null==ve?i:ve.$eval(oe.round_type)),ae["$dollar="]((me=re["$[]"]("dollar"))===i||null==me?i:me.$eval(oe.round_type)),ae["$modify_number="]($e.$eval(oe.round_type)),ae["$cmp_op="](A["$[]"]("cmp_op")),Y(A["$[]"]("target"),"?")?(ae["$question_target="](!0),M(ae,"target_number=",fe=[0]),fe[fe.length-1]):(ae["$question_target="](!1),fe=[(be=A["$[]"]("target"),be===i||null==be?i:be.$eval(oe.round_type))],M(ae,"target_number=",fe),fe[fe.length-1])},{$$s:this})}catch(ue){if(ue===e.t_eval_return)return ue.$v;throw ue}}),S(c,"$next_token",function(){return this.lexer.$next_token()}),m=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),a=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),l=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),t=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),T=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),E=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),D=[i,6,13,3,9,-1,27,-15,-10,-1,-38],U=[i,i,i,i,i,i,19,16,15,i,i],Q=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),O=N(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),j(o[0],"Racc_arg",[m,a,t,l,T,E,U,D,19,Q,O,58,35,!0]),I(n("Ractor","skip_raise")?"constant":i)&&n("Ractor").$make_shareable(n("Racc_arg")),j(o[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),I(n("Ractor","skip_raise")?"constant":i)&&n("Ractor").$make_shareable(n("Racc_token_to_s_table")),j(o[0],"Racc_debug_parser",!1),S(c,"$_reduce_1",function(b,re,$e){var A;return I(this.modifier)||this.$raise(n("ParseError")),A=w(b),this.$parsed(null==A[0]?i:A[0],null==A[1]?i:A[1],null==A[2]?i:A[2],null==A[3]?i:A[3])}),S(c,"$_reduce_2",function(b,re,$e){var A;return I(this.modifier)||this.$raise(n("ParseError")),A=w(b),this.$parsed(null==A[0]?i:A[0],null==A[2]?i:A[2],null==A[1]?i:A[1],null==A[3]?i:A[3])}),S(c,"$_reduce_3",function(b,re,$e){var A,le;return le=null==(A=w(b))[2]?i:A[2],this.$parsed(null==A[0]?i:A[0],null==A[1]?i:A[1],C(C(n("Arithmetic"),"Node"),"Number").$new(0),le)}),S(c,"$_reduce_4",function(b,re,$e){var A=this;return I(A.prefix_number)&&I(A.suffix_number)||A.$raise(n("ParseError")),J(["command","prefix","suffix"],{command:b["$[]"](1),prefix:b["$[]"](0),suffix:b["$[]"](2)})}),S(c,"$_reduce_5",function(b,re,$e){var A=this;return I(A.prefix_number)||A.$raise(n("ParseError")),I(A.need_suffix_number)&&A.$raise(n("ParseError")),J(["command","prefix"],{command:b["$[]"](1),prefix:b["$[]"](0)})}),S(c,"$_reduce_6",function(b,re,$e){var A=this;return I(A.suffix_number)||A.$raise(n("ParseError")),I(A.need_prefix_number)&&A.$raise(n("ParseError")),J(["command","suffix"],{command:b["$[]"](0),suffix:b["$[]"](1)})}),S(c,"$_reduce_7",function(b,re,$e){var A=this;return(I(A.need_prefix_number)||I(A.need_suffix_number))&&A.$raise(n("ParseError")),J(["command"],{command:b["$[]"](0)})}),S(c,"$_reduce_8",function(b,re,$e){return J([],{})}),S(c,"$_reduce_9",function(b,re,$e){var A,le,ue=i;return ue=null==(A=w(b))[0]?i:A[0],le=null==A[2]?i:A[2],I(this.critical)&&I(ue["$[]"]("critical")["$nil?"]())||this.$raise(n("ParseError")),ue["$[]="]("critical",le),ue}),S(c,"$_reduce_10",function(b,re,$e){var A,le,ue=i;return ue=null==(A=w(b))[0]?i:A[0],le=null==A[2]?i:A[2],I(this.fumble)&&I(ue["$[]"]("fumble")["$nil?"]())||this.$raise(n("ParseError")),ue["$[]="]("fumble",le),ue}),S(c,"$_reduce_11",function(b,re,$e){var A,le,ue=i;return ue=null==(A=w(b))[0]?i:A[0],le=null==A[2]?i:A[2],I(this.dollar)&&I(ue["$[]"]("dollar")["$nil?"]())||this.$raise(n("ParseError")),ue["$[]="]("dollar",le),ue}),S(c,"$_reduce_12",function(b,re,$e){return b["$[]"](1)}),S(c,"$_reduce_13",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"Negative").$new(b["$[]"](1))}),S(c,"$_reduce_14",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"BinaryOp").$new(b["$[]"](0),"+",b["$[]"](2))}),S(c,"$_reduce_15",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"BinaryOp").$new(b["$[]"](0),"-",b["$[]"](2))}),S(c,"$_reduce_16",function(b,re,$e){return I(this.allowed_cmp_op["$include?"](i))||this.$raise(n("ParseError")),J([],{})}),S(c,"$_reduce_17",function(b,re,$e){var A,ue,ae;return ae=null==(A=w(b))[1]?i:A[1],I(this.allowed_cmp_op["$include?"](ue=null==A[0]?i:A[0]))||this.$raise(n("ParseError")),J(["cmp_op","target"],{cmp_op:ue,target:ae})}),S(c,"$_reduce_18",function(b,re,$e){var se,A=this;return se=b["$[]"](0),I(A.question_target)||A.$raise(n("ParseError")),I(A.allowed_cmp_op["$include?"](se))||A.$raise(n("ParseError")),J(["cmp_op","target"],{cmp_op:se,target:"?"})}),S(c,"$_reduce_19",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"BinaryOp").$new(b["$[]"](0),"+",b["$[]"](2))}),S(c,"$_reduce_20",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"BinaryOp").$new(b["$[]"](0),"-",b["$[]"](2))}),S(c,"$_reduce_22",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"BinaryOp").$new(b["$[]"](0),"*",b["$[]"](2))}),S(c,"$_reduce_23",function(b,re,$e){return b["$[]"](3).$new(b["$[]"](0),b["$[]"](2))}),S(c,"$_reduce_25",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),S(c,"$_reduce_26",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"DivideWithCeil")}),S(c,"$_reduce_27",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"DivideWithCeil")}),S(c,"$_reduce_28",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"DivideWithRound")}),S(c,"$_reduce_29",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"DivideWithFloor")}),S(c,"$_reduce_30",function(b,re,$e){return b["$[]"](1)}),S(c,"$_reduce_31",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"Negative").$new(b["$[]"](1))}),S(c,"$_reduce_33",function(b,re,$e){return b["$[]"](1)}),S(c,"$_reduce_34",function(b,re,$e){return C(C(n("Arithmetic"),"Node"),"Number").$new(b["$[]"](0))}),S(c,"$_reduce_none",function(b,re,$e){return b["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var M,j,X,s,v,i,w,W,K=e.module,G=e.send,_=e.eqeqeq,B=e.truthy,L=e.def,p=e.return_val,g=[],R=e.nil;return M=g,j=W=[K(g[0],"BCDice")].concat(M),X=w=[K(W[0],"Deprecated")].concat(j),v=[s=K(w[0],"Checker")].concat(X),i=e.$r(v),s.$private(),L(s,"$check_result_legacy",function($,r,d,P){var k,z=this,H=R,x=R,f=R,y=R;return H=G(r,"map",[],"sides".$to_proc()),k=(x=G(r,"map",[],"value".$to_proc())).$sum(),f=_([100],y=H)?z.$check_1D100($,k,d,P):_([20],y)?z.$check_1D20($,k,d,P):_([6,6],y)?z.$check_2D6($,k,x,d,P):R,(B(f["$nil?"]())||B(f["$empty?"]()))&&(f=_([10],y=H.$uniq())?z.$check_nD10($,k,x,d,P):_([6],y)?z.$check_nD6($,k,x,d,P):R,B(f["$nil?"]())||B(f["$empty?"]()))?R:i("Result").$new(f.$delete_prefix(" \uff1e "))}),L(s,"$check_1D100",p(R)),L(s,"$check_1D20",p(R)),L(s,"$check_nD10",p(R)),L(s,"$check_2D6",p(R)),L(s,"$check_nD6",p(R))},Opal.modules["bcdice/base"]=function(e){var v,z,y,F,n,m,u,h,c,q,x,K=e.module,G=e.klass,_=e.slice,B=e.rb_plus,L=e.truthy,p=e.def,g=e.regexp,R=e.send,S=e.thrower,M=e.return_ivar,Y=e.assign_ivar_val,W=e.eqeqeq,N=e.eqeq,j=e.return_val,I=e.range,w=e.rb_minus,J=e.rb_divide,X=e.rb_times,s=e.rb_ge,i=e.top,C=[],$=e.$r(C),r=e.nil,d=e.$$$;return i.$require("i18n"),i.$require("i18n/backend/fallbacks"),i.$require("bcdice/randomizer"),i.$require("bcdice/dice_table"),i.$require("bcdice/enum"),i.$require("bcdice/translate"),i.$require("bcdice/result"),i.$require("bcdice/command/parser"),i.$require("bcdice/deprecated/checker"),z=C,y=x=[K(C[0],"BCDice")].concat(z),h=[u=G(x[0],null,"Base")].concat(y),c=e.$r(h),(q=u.$$prototype).raw_input=q.randomizer=q.enabled_upcase_input=q.debug=r,n=[F=e.get_singleton_class(u)].concat(h),m=e.$r(n),F.$attr_reader("prefixes"),p(F,"$register_prefix",function(l){var T,D,E=this;return null==E.prefixes&&(E.prefixes=r),T=_(arguments),E.prefixes=B(L(D=E.prefixes)?D:[],T.$flatten())},-1),p(F,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),p(F,"$prefixes_pattern",function(){var l=this,t=r;return null==l.prefixes_pattern&&(l.prefixes_pattern=r),null==l.prefixes&&(l.prefixes=r),l.prefixes_pattern=L(t=l.prefixes_pattern)?t:r,L(l.prefixes_pattern)?l.prefixes_pattern:(l.prefixes=L(t=l.prefixes)?t:[],l.prefixes.$freeze(),l.prefixes_pattern=(L(l.prefixes["$empty?"]())?/(?!)/:g(["^(S)?(",l.prefixes.$join("|"),")"],"i")).$freeze())}),p(F,"$command_pattern",function(){var l=this,t=r,T=r;return null==l.command_pattern&&(l.command_pattern=r),null==l.prefixes&&(l.prefixes=r),l.command_pattern=L(t=l.command_pattern)?t:r,L(l.command_pattern)?l.command_pattern:(l.prefixes=L(t=l.prefixes)?t:[],l.prefixes.$freeze(),T=B(R(d(m("CommonCommand"),"COMMANDS"),"map",[],function(D){return null==D&&(D=r),d(D,"PREFIX_PATTERN").$source()}),l.prefixes),l.command_pattern=g(["^S?(",T.$join("|"),")"],"i").$freeze())}),p(F,"$eval",function(l){try{return S("eval_return"),this.$new(l).$eval()}catch(E){if(E===e.t_eval_return)return E.$v;throw E}}),u.$include(c("Translate")),u.$include(d(c("Deprecated"),"Checker")),p(u,"$initialize",function(o){var n=this;return n.raw_input=o,n.sort_add_dice=!1,n.sort_barabara_dice=!1,n.d66_sort_type=d(c("D66SortType"),"NO_SORT"),n.enabled_d9=!1,n.round_type=d(c("RoundType"),"FLOOR"),n.sides_implicit_d=6,n.upper_dice_reroll_threshold=r,n.reroll_dice_reroll_threshold=r,n.default_cmp_op=r,n.default_target_number=r,n.enabled_upcase_input=!0,n.locale="ja_jp",n.randomizer=d(c("BCDice"),"Randomizer").$new(),n.debug=!1}),u.$attr_accessor("randomizer"),u.$attr_reader("d66_sort_type"),u.$attr_reader("round_type"),u.$attr_reader("sides_implicit_d"),u.$attr_reader("upper_dice_reroll_threshold"),u.$attr_reader("reroll_dice_reroll_threshold"),u.$attr_reader("default_cmp_op"),u.$attr_reader("default_target_number"),p(u,"$sort_add_dice?",M("sort_add_dice")),p(u,"$sort_barabara_dice?",M("sort_barabara_dice")),p(u,"$enabled_d9?",M("enabled_d9")),p(u,"$enable_debug",Y("debug",!0)),p(u,"$eval",function(){var n,a,o=this,m=r;return n=d(c("BCDice"),"Preprocessor").$process(o.raw_input,o),m=L(a=o.$dice_command(n))?a:o.$eval_common_command(o.raw_input),L(m)?(m["$rands="](o.randomizer.$rand_results()),m["$detailed_rands="](o.randomizer.$detailed_rand_results()),m):r}),p(u,"$change_text",function(o){return o}),p(u,"$check_result",function(o,n,m,a){var l=this,t=r,T=r,E=r,D=r,U=r;return t=l.$check_result_legacy(o,n,m,a),L(t)?t:(T=R(n,"map",[],"sides".$to_proc()),D=(E=R(n,"map",[],"value".$to_proc())).$sum(),t=W([100],U=T)?l.$result_1d100(o,D,m,a):W([20],U)?l.$result_1d20(o,D,m,a):W([6,6],U)?l.$result_2d6(o,D,E,m,a):r,N(t,c("Result").$nothing())?r:L(t)?t:(t=W([10],U=T.$uniq())?l.$result_nd10(o,D,E,m,a):W([6],U)?l.$result_nd6(o,D,E,m,a):r,N(t,c("Result").$nothing())?r:L(t)?t:l.$result_ndx(o,m,a)))}),p(u,"$grich_text",j(r)),u.$private(),p(u,"$eval_common_command",function(o){try{S("eval_return");var m=S("return");return o=this.$change_text(o),R(d(c("CommonCommand"),"COMMANDS"),"each",[],function l(t){var E,T=null==l.$$s?this:l.$$s;if(null==T.randomizer&&(T.randomizer=r),null==t&&(t=r),E=t.$eval(o,T,T.randomizer),!L(E))return r;m.$throw(E)},{$$s:this,$$ret:m}),r}catch(l){if(l===e.t_eval_return||l===m)return l.$v;throw l}}),p(u,"$dice_command",function(o){var n=this,m=r,a=r,l=r,t=r;return L(n.enabled_upcase_input)&&(o=o.$upcase()),m=n.$class().$prefixes_pattern().$match(o),L(m)?(a=m["$[]"](1)["$nil?"]()["$!"](),L(a)&&(o=o["$[]"](I(1,-1,!1))),l=n.$eval_game_system_specific_command(o),L(l["$is_a?"](c("Result")))?(l["$secret="](L(t=l["$secret?"]())?t:a),l):L(l["$nil?"]())||L(l["$empty?"]())||N(l,"1")?r:R(c("Result").$new(),"tap",[],function(E){var D;return null==E&&(E=r),E["$text="](l.$to_s()),R(E,"secret=",D=[a]),D[D.length-1]})):r}),p(u,"$eval_game_system_specific_command",j(r)),p(u,"$result_ndx",function(o,n,m){return L(m["$is_a?"](c("String")))?r:L(o.$send(n,m))?c("Result").$success(this.$translate("success")):c("Result").$failure(this.$translate("failure"))}),p(u,"$result_1d100",j(r)),p(u,"$result_1d20",j(r)),p(u,"$result_nd10",j(r)),p(u,"$result_2d6",j(r)),p(u,"$result_nd6",j(r)),p(u,"$get_table_by_2d6",function(o){return this.$get_table_by_nD6(o,2)}),p(u,"$get_table_by_1d6",function(o){return this.$get_table_by_nD6(o,1)}),p(u,"$get_table_by_nD6",function(o,n){return this.$get_table_by_nDx(o,n,6)}),p(u,"$get_table_by_nDx",function(o,n,m){var l,t=r;return l=this.randomizer.$roll_sum(n,m),t=this.$get_table_value(o["$[]"](w(l,n))),L(t["$nil?"]())?["1",0]:[t,l]}),p(u,"$get_table_by_1d3",function(o){var a,l,n=this,t=r;return n.$debug("get_table_by_1d3"),a=n.randomizer.$roll_sum(1,6),n.$debug("num",a),l=J(w(a,1),2).$to_i(),n.$debug("index",l),t=o["$[]"](l),L(t["$nil?"]())?["1",0]:[t,a]}),p(u,"$get_table_by_d66_swap",function(o){var m;return m=this.randomizer.$roll_d66(d(c("D66SortType"),"ASC")),[this.$get_table_by_number(m,o),m]}),p(u,"$get_table_by_d66",function(o){var m,a,l,T,t=r;return m=this.randomizer.$roll_once(6),a=this.randomizer.$roll_once(6),l=B(X(w(m,1),6),w(a,1)),t=o["$[]"](l),T=""+m+a,L(t["$nil?"]())?["1",T]:[t,T]}),p(u,"$get_table_by_number",function(o,n,m){try{var a=S("return");return null==m&&(m="1"),R(n,"each",[],function t(T){var D,E=null==t.$$s?this:t.$$s;if(null==T&&(T=r),D=T["$[]"](0),!L(s(D,o)))return r;a.$throw(E.$get_table_value(T["$[]"](1)))},{$$s:this,$$ret:a}),this.$get_table_value(m)}catch(t){if(t===a)return t.$v;throw t}},-3),p(u,"$get_table_value",function(o){return L(o["$is_a?"](c("Proc")))?o.$call():o}),p(u,"$roll_tables",function(o,n){var a=r;return a=n["$[]"](o),L(a)?a.$roll(this.randomizer).$to_s():r}),p(u,"$debug",function(o,n){var a,l=this,t=r,T=r;return a=_(arguments,1),L(l.debug)?(t=L(o["$is_a?"](c("String")))?o:o.$inspect(),L(a["$empty?"]())?l.$warn(t):(T=R(a,"map",[],function(D){return null==D&&(D=r),L(D["$is_a?"](c("String")))?'"'+D+'"':D.$inspect()}),l.$warn(t+": "+T.$join(", ")))):r},-2),d(d($("I18n"),"Backend"),"Simple").$include(d(d($("I18n"),"Backend"),"Fallbacks")),$("I18n").$load_path()["$<<"]($("Dir")["$[]"]($("File").$join("bcdice","../../i18n/**/*.yml"))),$("I18n")["$default_locale="]("ja_jp"),v=[["ja_jp"]],R($("I18n").$fallbacks(),"defaults=",v),v[v.length-1]},Opal.modules["bcdice/arithmetic_evaluator"]=function(e){var M,j,J,s,v,I,w,W,K=e.module,G=e.ensure_kwargs,_=e.truthy,B=e.thrower,L=e.def,p=[],g=e.nil,R=e.$$$;return M=p,j=W=[K(p[0],"BCDice")].concat(M),w=[I=K(W[0],"ArithmeticEvaluator")].concat(j),s=[J=e.get_singleton_class(I)].concat(w),v=e.$r(s),L(J,"$eval",function(C,$){try{B("eval_return");var d,P=g;return null==(d=($=G($)).$$smap.round_type)&&(d=R(v("RoundType"),"FLOOR")),_(C)&&_(P=v("Arithmetic").$eval(C,d))?P:0}catch(z){if(z===e.t_eval_return)return z.$v;throw z}},-2)},Opal.queue(function(e){var z,f,c,q,F,T,E,o,n,m,a,u,h,x,K=e.module,G=e.klass,_=e.const_set,B=e.send2,L=e.find_super,p=e.def,g=e.truthy,R=e.hash2,S=e.rb_plus,M=e.rb_ge,Y=e.thrower,W=e.eqeqeq,N=e.assign_ivar,j=e.rb_divide,I=e.rb_minus,w=e.rb_times,J=e.eqeq,X=e.neqeq,s=e.rb_le,v=e.send,i=e.rb_lt,C=e.top,$=[],r=e.nil,d=e.$$$;return C.$require("bcdice/base"),C.$require("bcdice/arithmetic_evaluator"),z=$,f=x=[K($[0],"BCDice")].concat(z),u=[K(x[0],"GameSystem")].concat(f),h=e.$r(u),c=u[0],q=h("Base"),F=u,n=[o=G(c,q,"LogHorizon")].concat(F),m=e.$r(n),(a=o.$$prototype).randomizer=a.locale=r,_(n[0],"ID","LogHorizon"),_(n[0],"NAME","\u30ed\u30b0\u30fb\u30db\u30e9\u30a4\u30ba\u30f3TRPG"),_(n[0],"SORT_KEY","\u308d\u304f\u307b\u3089\u3044\u3059\u3093TRPG"),_(n[0],"HELP_MESSAGE","\u25a0 \u5224\u5b9a (xLH\xb1y>=z)\n\u3000xD6\u306e\u5224\u5b9a\u3002\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u3000x\uff1ax\u306b\u632f\u308b\u30c0\u30a4\u30b9\u6570\u3092\u5165\u529b\u3002\n\u3000\xb1y\uff1ay\u306b\u4fee\u6b63\u5024\u3092\u5165\u529b\u3002\xb1\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000>=z\uff1az\u306b\u76ee\u6a19\u5024\u3092\u5165\u529b\u3002\xb1\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 3LH\u30002LH>=8\u30003LH+1>=10\n\n\u25a0 \u6d88\u8017\u8868 (tCTx\xb1y$z)\n\u3000PCT \u4f53\u529b\uff0fECT \u6c17\u529b\uff0fGCT \u7269\u54c1\uff0fCCT \u91d1\u92ad\n\u3000x:CR\u3092\u6307\u5b9a\u3002\n\u3000\xb1y:\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000$z\uff1a\uff04\u3092\u4ed8\u3051\u308b\u3068\u30c0\u30a4\u30b9\u76ee\u3092 z \u56fa\u5b9a\u3002\u8868\u306e\u7279\u5b9a\u306e\u5024\u53c2\u7167\u7528\u306b\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 PCT1\u3000ECT2+1\u3000GCT3-1\u3000CCT3$5\n\n\u25a0 \u6d88\u8017\u8868\u30ed\u30fc\u30eb (CTx\xb1y)\n\u3000\u6d88\u8017\u8868\u30ed\u30fc\u30eb\u3092\u884c\u3044\u3001\u51fa\u76ee\u3092\u6c7a\u5b9a\u3059\u308b\u3002\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u6307\u5b9a\u3067\u304d\u307e\u3059\u304c\u3001\u7121\u8996\u3055\u308c\u307e\u3059\u3002\u7701\u7565\u53ef\u80fd\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\n\u25a0 \u8ca1\u5b9d\u8868 (tTRSx\xb1y$)\n\u3000LHZB1\u8a18\u8f09\u306e\u8ca1\u5b9d\u8868\n\u3000CTRS \u91d1\u92ad\uff0fMTRS \u9b54\u6cd5\u7d20\u6750\uff0fITRS \u63db\u91d1\u30a2\u30a4\u30c6\u30e0\uff0f\u203bHTRS \u30d2\u30ed\u30a4\u30f3\uff0fGTRS \u30b4\u30d6\u30ea\u30f3\u8ca1\u5b9d\u8868\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u7701\u7565\u6642\u306f\u30c0\u30a4\u30b9\u5024 0 \u56fa\u5b9a\u3067\u4fee\u6b63\u5024\u306e\u8868\u53c2\u7167\u3002\u300a\u30b4\u30fc\u30eb\u30c9\u30d5\u30a3\u30f3\u30ac\u30fc\u300b\u4f7f\u7528\u6642\u306a\u3069\u3002\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000$\uff1a\uff04\u3092\u4ed8\u3051\u308b\u3068\u8ca1\u5b9d\u8868\u306e\u30c0\u30a4\u30b9\u76ee\u30927\u56fa\u5b9a\uff081\u56de\u5206\u306e\u30d7\u30e9\u30a4\u30ba\u7528\uff09\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 CTRS1\u3000MTRS2+1\u3000ITRS3-1\u3000ITRS+27\u3000CTRS3$\n\n\u25a0 \u8ca1\u5b9d\u8868\uff08\u62e1\u5f35\u30eb\u30fc\u30eb\u30d6\u30c3\u30af\uff09 (tTRSEx\xb1y$)\n\u3000LHZB2\u8a18\u8f09\u306e\u8ca1\u5b9d\u8868\n\u3000CTRSE \u91d1\u92ad\uff0fMTRSE \u9b54\u6cd5\u7d20\u6750\uff0fITRSE \u63db\u91d1\u30a2\u30a4\u30c6\u30e0\uff0fOTRSE \u305d\u306e\u307b\u304b\n\u3000\u8a18\u6cd5\u306f\u8ca1\u5b9d\u8868\u3068\u540c\u69d8\n\n\u25a0 \u8ca1\u5b9d\u8868\u30ed\u30fc\u30eb (TRSx\xb1y)\n\u3000\u8ca1\u5b9d\u8868\u30ed\u30fc\u30eb\u3092\u884c\u3044\u3001\u51fa\u76ee\u3092\u6c7a\u5b9a\u3059\u308b\u3002\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u7701\u7565\u6642\u306fCR 0\u3068\u3057\u3066\u6271\u3046\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\n\u25a0 \u30a4\u30fc\u30b9\u30bf\u30eb\u63a2\u7d22\u8868 (ESTLx\xb1y$z)\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u7701\u7565\u6642\u306f\u30c0\u30a4\u30b9\u5024 0 \u56fa\u5b9a\u3067\u4fee\u6b63\u5024\u306e\u8868\u53c2\u7167\u3002\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000$z\uff1a\uff04\u3092\u4ed8\u3051\u308b\u3068\u30c0\u30a4\u30b9\u76ee\u3092 z \u56fa\u5b9a\u3002\u7279\u5b9aCR\u306e\u8868\u53c2\u7167\u7528\u306b\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 ESTL1\u3000ESTL+15\u3000ESTL2+1$5\u3000ESTL2-1$5\n\n\u25a0 \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u30c9\u30de\u30b8\u30c3\u30af\u30a2\u30a4\u30c6\u30e0\u52b9\u679c\u8868 (MGRx)\n\u3000x\u306fMG\u3092\u6307\u5b9a\u3002(LHZB1\u7528)\n\n\u25a0 \u697d\u5668\u7a2e\u5225\u8868\u2020 (MIIx)\n\u3000x\u306f\u697d\u5668\u306e\u7a2e\u985e(1\uff5e6\u3092\u6307\u5b9a)\u3001\u7701\u7565\u53ef\u80fd\n\u30001 \u6253\u697d\u5668\uff11\uff0f2 \u9375\u76e4\u697d\u5668\uff0f3 \u5f26\u697d\u5668\uff11\uff0f4 \u5f26\u697d\u5668\uff12\uff0f5 \u7ba1\u697d\u5668\uff11\uff0f6 \u7ba1\u697d\u5668\uff12\n\n\u25a0 \u7279\u6b8a\u6d88\u8017\u8868\u2606 (tSCTx\xb1y$z)\n\u3000\u6d88\u8017\u8868\u3068\u540c\u69d8\u3001\u305f\u3060\u3057CR\u306f\u7701\u7565\u53ef\u80fd\u3002\n\u3000ESCT \u30ed\u30c7\u7814\u306f\u7206\u767a\u3060\uff01\uff0fCSCT \u30a2\u30eb\u30f4\u306e\u546a\u3044\u3058\u3083\uff01\n\n\u25a0 \u30ed\u30c7\u7814\u306e\u65b0\u767a\u660e\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (IATt)\n\u3000IATA \u7279\u5fb4A(\u30e1\u30ea\u30c3\u30c8)\uff0fIATB \u7279\u5fb4B(\u30c7\u30e1\u30ea\u30c3\u30c8)\uff0fIATL \u898b\u305f\u76ee\uff0fIATT \u7a2e\u985e\n\u3000t\u3092\u7701\u7565\u3059\u308b\u3068\u5168\u3066\u8868\u793a\u3002t\u306bA/B/L/T\u3092\u4efb\u610f\u306e\u9806\u3067\u9023\u7d50\u53ef\u80fd\n\u3000\u4f8b\uff09IAT\u3000IATALT  IATABBLT  IATABL\n\n\u25a0 \u8868\n\u3000\u30fb\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u30bf\u30b0\u8868 (PTAG)\n\u3000\u30fb\u4ea4\u53cb\u8868 (KOYU)\n\u3000\u30fb\u653b\u6483\u547d\u4e2d\u7b87\u6240\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (HLOC)\n\u3000\u30fbPC\u540d\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (PCNM)\n\u3000\u30fb\u30a2\u30ad\u30d0\u306e\u8857\u3067\u906d\u9047\u3059\u308b\u30c8\u30e9\u30d6\u30eb\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (TIAS)\n\u3000\u30fb\u5ec3\u68c4\u5150\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (ABDC)\n\n\u2020\u5370\u306f\u2606\u5370\u306f\u300c\u30a4\u30f3\u30c8\u30a5\u30fb\u30b6\u30fb\u30bb\u30eb\u30c7\u30b7\u30a2 \u3055\u3089\u306a\u308b\u30d3\u30eb\u30c9\u306e\u7fbd\u3070\u305f\u304d\uff08\uff11\uff09\u300d\u3088\u308a\u3001\n\u2606\u5370\u306f\u30bb\u30eb\u30c7\u30b7\u30a2\u30fb\u30ac\u30bc\u30c3\u30c8\u300c\u3067\u304d\u308b\u304b\u306a66\u300dVol.1\u3088\u308a\u3001\n\u203b\u5370\u306f\u300c\u5b9f\u9332\u30fb\u4e03\u9762\u4f53\u5de5\u623f\u30b9\u30bf\u30c3\u30d5\u5ea7\u8ac7\u4f1a(\u590f\u306e\u9663)\u300d\u3088\u308a\u3002\u5229\u7528\u6cd5\u306a\u3069\u306f\u305d\u3061\u3089\u53c2\u7167\u3002\n\u30fbD66\u30c0\u30a4\u30b9\u3042\u308a\n"),o.$register_prefix("\\d+LH","\\w+CT","CT","\\w+TRS","TRS","IAT","TIAS","ABDC","MII","ESTL"),p(o,"$initialize",function l(t){var E=this;return l.$$p=null,B(E,L(E,"initialize",l,!1,!0),"initialize",[t],null),E.d66_sort_type=d(m("D66SortType"),"NO_SORT")}),p(o,"$eval_game_system_specific_command",function(t){var E,D,U,Q,ee,V,O,te,ne,ie,Z,T=this;return g(E=g(D=g(U=g(Q=g(ee=g(V=g(O=g(te=g(ne=g(ie=g(Z=T.$getCheckRollDiceCommandResult(t))?Z:T.$roll_consumption(t))?ie:T.$roll_consumption_table(t))?ne:T.$roll_treasure(t))?te:T.$roll_treasure_table(t))?O:T.$roll_treasure_table_b2(t))?V:T.$getInventionAttributeTextDiceCommandResult(t))?ee:T.$getTroubleInAkibaStreetDiceCommandResult(t))?Q:T.$getAbandonedChildDiceCommandResult(t))?U:T.$getMusicalInstrumentTypeDiceCommandResult(t))?D:T.$roll_eastal_exploration_table(t))?E:T.$roll_tables(t,d(T.$class(),"TABLES"))}),o.$private(),p(o,"$getCheckRollDiceCommandResult",function(t){var T=this,D=r,U=r,Q=r,ee=r,V=r,O=r,te=r;return D=d(m("Command"),"Parser").$new(/\d+LH/,R(["round_type"],{round_type:T.$round_type()})).$restrict_cmp_op_to(r,">=").$parse(t),g(D)?(U=D.$command().$to_i(),ee=(Q=T.randomizer.$roll_barabara(U,6)).$sum(),V=S(ee,D.$modify_number()),O=T.$result_text(U,Q,V,D),te=["("+D+")",ee+"["+Q.$join(",")+"]"+m("Format").$modifier(D.$modify_number()),V,O.$text()].$compact(),O["$text="](te.$join(" \uff1e ")),O):r}),p(o,"$result_text",function(t,T,E,D){var U=this;return g(M(T.$count(6),2))?m("Result").$critical(U.$translate("LogHorizon.LH.critical")):g(M(T.$count(1),t))?m("Result").$fumble(U.$translate("LogHorizon.LH.fumble")):g(D.$cmp_op()["$nil?"]())?m("Result").$new():g(M(E,D.$target_number()))?m("Result").$success(U.$translate("success")):m("Result").$failure(U.$translate("failure"))}),p(o,"$getValue",function(t,T){try{return Y("eval_return"),g(t["$nil?"]())||g(t["$empty?"]())?T:m("ArithmeticEvaluator").$eval(t)}catch(D){if(D===e.t_eval_return)return D.$v;throw D}}),p(o,"$roll_consumption",function(t){try{Y("eval_return");var D=r,U=r,Q=r,ee=r,V=r;return D=/^CT\d*([+\-\d]+)?$/.$match(t),g(D)?(U=m("ArithmeticEvaluator").$eval(D["$[]"](1)),Q=m("Format").$modifier(U),ee=this.randomizer.$roll_once(6),g(Q["$empty?"]())||(V=S(ee.$to_s(),Q)),["(1D6"+Q+")",V,S(ee,U)].$compact().$join(" \uff1e ")):r}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),p(o,"$roll_consumption_table",function(t){try{Y("eval_return");var D=r,U=r,Q=r,ee=r;return D=/(P|E|G|C|ES|CS)CT(\d+)?([+\-\d]+)?(?:\$(\d+))?/.$match(t),g(D)?(U=this.$construct_consumption_table(D["$[]"](1)),Q=D["$[]"](2).$to_i(),ee=m("ArithmeticEvaluator").$eval(D["$[]"](3)),g(D["$[]"](4))&&U.$fix_dice_value(D["$[]"](4).$to_i()),U.$roll(Q,ee,this.randomizer)):r}catch(V){if(V===e.t_eval_return)return V.$v;throw V}}),p(o,"$construct_consumption_table",function(t){var D,T=this,E=r;return E=W("P",D=t)?T.$translate("LogHorizon.CT.PCT"):W("E",D)?T.$translate("LogHorizon.CT.ECT"):W("G",D)?T.$translate("LogHorizon.CT.GCT"):W("C",D)?T.$translate("LogHorizon.CT.CCT"):W("ES",D)?T.$translate("LogHorizon.CT.ESCT"):W("CS",D)?T.$translate("LogHorizon.CT.CSCT"):r,m("ConsumptionTable").$new(E["$[]"]("name"),E["$[]"]("items"))}),(E=(T=G(n[0],null,"ConsumptionTable")).$$prototype).tables=E.dice_value=E.name=r,p(T,"$initialize",function(U,Q){return this.name=U,this.tables=Q,this.dice_value=r}),p(T,"$fix_dice_value",N("dice_value")),p(T,"$roll",function(U,Q,ee){var O,ne,Z,V=this,te=r,ie=r;return O=j(I(U,1),5).$clamp(0,I(V.tables.$size(),1)),te=V.tables["$[]"](O),V.dice_value=g(ne=V.dice_value)?ne:ee.$roll_once(6),ie=S(V.dice_value,Q),Z=te["$[]"](ie.$clamp(0,7)),V.name+"("+ie+"["+V.dice_value+"]) \uff1e "+Z}),p(o,"$roll_treasure",function(t){try{Y("eval_return");var D=r,U=r,Q=r,ee=r,V=r,O=r;return D=/^TRS(\d+)?([+\-\d]+)?$/.$match(t),g(D)?(U=D["$[]"](1).$to_i(),Q=m("ArithmeticEvaluator").$eval(D["$[]"](2)),V=(ee=this.randomizer.$roll_barabara(2,6)).$sum(),O=S(S(V,w(U,5)),Q),"(2D6+"+U+"*5"+m("Format").$modifier(Q)+") \uff1e "+V+"["+ee.$join(",")+"]"+m("Format").$modifier(S(w(U,5),Q))+" \uff1e "+O):r}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),p(o,"$roll_treasure_table",function(t){try{Y("eval_return");var E=this,D=r,U=r,Q=r,ee=r,V=r;return D=/^([CMIHG]TRS)(\d+)?([+\-\d]+)?(\$)?$/.$match(t),g(D)?(U=D["$[]"](1),Q=E.$construct_treasure_table(U),ee=D["$[]"](2).$to_i(),V=m("ArithmeticEvaluator").$eval(D["$[]"](3)),J(ee,0)&&J(V,0)?E.$translate("LogHorizon.TRS.need_cr",R(["command"],{command:t})):(g(D["$[]"](4))&&Q.$fix_dice_value(7),Q.$roll(ee,V,E.randomizer))):r}catch(O){if(O===e.t_eval_return)return O.$v;throw O}}),p(o,"$construct_treasure_table",function(t){return J(t,"HTRS")?m("HeroineTreasureTable").$from_i18n("LogHorizon.TRS.HTRS",this.locale):m("TreasureTable").$from_i18n("LogHorizon.TRS."+t,this.locale)}),p(o,"$roll_treasure_table_b2",function(t){try{Y("eval_return");var E=this,D=r,U=r,Q=r,ee=r,V=r;return D=/^([CMIO]TRSE)(\d+)?([+\-\d]+)?(\$)?$/.$match(t),g(D)?(U=D["$[]"](1),Q=m("ExpansionTreasureTable").$from_i18n("LogHorizon.TRSE."+U,E.locale),ee=D["$[]"](2).$to_i(),V=m("ArithmeticEvaluator").$eval(D["$[]"](3)),J(ee,0)&&J(V,0)?E.$translate("LogHorizon.TRS.need_cr",R(["command"],{command:t})):(g(D["$[]"](4))&&Q.$fix_dice_value(7),Q.$roll(ee,V,E.randomizer))):r}catch(O){if(O===e.t_eval_return)return O.$v;throw O}}),function(l,t,T){var ee,O,te,E=G(l,null,"TreasureTable"),D=[E].concat(T),U=e.$r(D),Q=E.$$prototype;Q.dice_list=Q.name=Q.items=r,E.$include(U("Translate")),O=[ee=e.get_singleton_class(E)].concat(D),te=e.$r(O),p(ee,"$from_i18n",function(ie,Z){var re=r;return re=te("I18n").$translate(ie,R(["raise","locale"],{raise:!0,locale:Z})),this.$new(re["$[]"]("name"),re["$[]"]("items"),Z)}),p(E,"$initialize",function(V,O,te){return this.name=V,this.items=O,this.locale=te,this.dice_list=r}),p(E,"$fix_dice_value",function(V){return this.dice_list=[V]}),p(E,"$roll",function(V,O,te){var ne,ie=this,Z=r,b=r,re=r,$e=r;return J(V,0)&&J(O,0)?r:(Z=J(V,0)&&X(O,0)?O:(ie.dice_list=g(b=ie.dice_list)?b:te.$roll_barabara(2,6),S(S(ie.dice_list.$sum(),w(5,V)),O)),re=ie.$pick_item(Z),g(ie.dice_list)&&($e="["+((ne=ie.dice_list)===r||null==ne?r:ne.$join(","))+"]"),ie.name+"("+Z+$e+") \uff1e "+re)}),E.$private(),p(E,"$pick_item",function(V){var O=this;return g(s(V,6))?O.$translate("LogHorizon.TRS.below_lower_limit",R(["value"],{value:6})):g(s(V,62))?O.items["$[]"](V.$to_s()):g(s(V,72))?O.items["$[]"](I(V,10).$to_s())+"&80G":g(s(V,82))?O.items["$[]"](I(V,20).$to_s())+"&160G":g(s(V,87))?O.items["$[]"](I(V,30).$to_s())+"&260G":O.$translate("LogHorizon.TRS.exceed_upper_limit",R(["value"],{value:88}))})}(n[0],0,n),function(l,t){var T=G(l,t,"HeroineTreasureTable");T.$$prototype.items=r,p(T,"$pick_item",function(U){var Q=this;return g(s(U,6))?Q.$translate("LogHorizon.TRS.below_lower_limit",R(["value"],{value:6})):g(s(U,53))?Q.items["$[]"](U.$to_s()):Q.$translate("LogHorizon.TRS.exceed_upper_limit",R(["value"],{value:54}))})}(n[0],m("TreasureTable")),function(l,t){var T=G(l,t,"ExpansionTreasureTable");T.$$prototype.items=r,p(T,"$pick_item",function(U){var Q=this;return g(s(U,6))?Q.$translate("LogHorizon.TRS.below_lower_limit",R(["value"],{value:6})):g(s(U,162))?Q.items["$[]"](U.$to_s()):g(s(U,172))?Q.items["$[]"](I(U,10).$to_s())+"&200G":g(s(U,182))?Q.items["$[]"](I(U,20).$to_s())+"&400G":g(s(U,187))?Q.items["$[]"](I(U,30).$to_s())+"&600G":Q.$translate("LogHorizon.TRS.exceed_upper_limit",R(["value"],{value:188}))})}(n[0],m("TreasureTable")),p(o,"$getInventionAttributeTextDiceCommandResult",function(t){var E=r,D=r,U=r,Q=r,ee=r;return g(t["$=~"](/IAT([ABMDLT]*)/))?(E=this.$translate("LogHorizon.IAT.name"),D=g(m("Regexp").$last_match(1))&&X(m("Regexp").$last_match(1),"")?m("Regexp").$last_match(1):"MDLT",U=D.$length()["$=="](1),Q=[],ee=[],v(D.$split(/(?:)/),"each",[],function V(O){var Z,te=null==V.$$s?this:V.$$s,ne=r,ie=r,b=r;return null==te.randomizer&&(te.randomizer=r),null==O&&(O=r),ne=te.randomizer.$roll_once(6),ee["$<<"](ne.$to_s()),b=(ie=W("A",Z=O)||W("M",Z)?te.$translate("LogHorizon.IAT.A"):W("B",Z)||W("D",Z)?te.$translate("LogHorizon.IAT.B"):W("L",Z)?te.$translate("LogHorizon.IAT.L"):W("T",Z)?te.$translate("LogHorizon.IAT.T"):r)["$[]"]("items")["$[]"](I(ne,1)),g(U)&&(b=ie["$[]"]("name")+"\uff1a"+b),Q.$push(b)},{$$s:this}),E+"(["+ee.$join(",")+"]) \uff1e "+Q.$join(" ")):r}),p(o,"$getTroubleInAkibaStreetDiceCommandResult",function(t){return J(t,"TIAS")?this.$roll_random_table("LogHorizon.TIAS"):r}),p(o,"$getAbandonedChildDiceCommandResult",function(t){return J(t,"ABDC")?this.$roll_random_table("LogHorizon.ABDC"):r}),p(o,"$roll_random_table",function(t){var E=r,D=r,U=r,Q=r;return E=this.$translate(t),D=E["$[]"]("tables"),U=this.randomizer.$roll_barabara(D.$size(),6),Q=v(U.$map(),"with_index",[],function(V,O){return null==V&&(V=r),null==O&&(O=r),D["$[]"](O)["$[]"](I(V,1))}),E["$[]"]("name")+"(["+U.$join(",")+"]) \uff1e "+Q.$join(" ")}),p(o,"$getMusicalInstrumentTypeDiceCommandResult",function(t){var T=this,E=r,D=r,U=r,Q=r,ee=r,V=r,O=r;return!g(t["$=~"](/MII(\d?)/))||(E=(g(D=m("Regexp").$last_match(1))?m("Regexp").$last_match(1)["$!="](""):D)["$!"](),U=g(E)?T.randomizer.$roll_once(6):m("Regexp").$last_match(1).$to_i(),g(i(U,1))||i(6,U))?r:(Q=T.$translate("LogHorizon.MII.name"),ee=T.$translate("LogHorizon.MII.type_list")["$[]"](I(U,1)),V=T.randomizer.$roll_once(6),O=T.$translate("LogHorizon.MII.items")["$[]"](I(U,1))["$[]"](I(V,1)),S(S(Q.$to_s(),g(E)?"("+U+")":"")," \uff1e "+ee+"("+V+") \uff1e "+O))}),p(o,"$roll_eastal_exploration_table",function(t){try{Y("eval_return");var E,D=this,U=r,Q=r,ee=r,V=r,O=r,te=r,ne=r,ie=r,b=r;return U=/ESTL(\d+)?([+\-\d]+)?(?:\$(\d+))?/.$match(t),!g(U)||g(U["$[]"](1)["$nil?"]())&&g(U["$[]"](2)["$nil?"]())&&g(U["$[]"](3)["$nil?"]())?r:(Q=U["$[]"](1).$to_i(),ee=m("ArithmeticEvaluator").$eval(U["$[]"](2)),V=(E=U["$[]"](3))===r||null==E?r:E.$to_i(),O=g(V)?[V]:J(Q,0)?[]:D.randomizer.$roll_barabara(2,6),g(O["$empty?"]())||(te="["+O.$join(",")+"]"),ne=S(S(O.$sum(),w(Q,5)),ee).$clamp(7,162),ie=D.$translate("LogHorizon.ESTL.name"),b=D.$translate("LogHorizon.ESTL.items")["$[]"](ne.$to_s()).$chomp(),ie+"("+ne+te+")\n"+b)}catch(re){if(re===e.t_eval_return)return re.$v;throw re}}),function(l,t){var T=[l].concat(t),E=e.$r(T);l.$private(),p(l,"$translate_tables",function(U){return R(["PTAG","KOYU","MGR1","MGR2","MGR3","HLOC","PCNM"],{PTAG:d(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.PTAG",U),KOYU:d(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.KOYU",U),MGR1:d(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.MGR1",U),MGR2:d(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.MGR2",U),MGR3:d(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.MGR3",U),HLOC:d(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.HLOC",U),PCNM:d(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.PCNM",U)})})}(e.get_singleton_class(o),n),_(n[0],"TABLES",o.$translate_tables("ja_jp")),o.$register_prefix(m("TABLES").$keys())})}}]);