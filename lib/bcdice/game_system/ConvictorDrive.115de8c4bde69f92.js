(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[3116],{1967:(ge,pe,he)=>{he(5151),Opal.modules["i18n/backend/fallbacks"]=function(e){var G,i,r,c,u,m,H=e.module,L=e.class_variable_set,_=e.truthy,A=e.class_variable_get,z=e.def,S=e.send,U=e.send2,k=e.find_super,q=e.hash2,N=e.find_block_super,F=e.neqeq,j=e.thrower,P=e.return_val,M=[],D=e.nil,x=e.$$$;return G=M,m=[u=H(M[0],"I18n")].concat(G),L(m[0],"@@fallbacks",D),i=e.get_singleton_class(u),r=[i].concat(m),c=e.$r(r),z(i,"$fallbacks",function(){var w=D;return L(r[1],"@@fallbacks",_(null!=r[1].$$cvars["@@fallbacks"]?"class variable":D)&&_(w=A(r[1],"@@fallbacks",!1))?w:x(x(c("I18n"),"Locale"),"Fallbacks").$new()),_(w=c("Thread").$current()["$[]"]("i18n_fallbacks"))?w:A(r[1],"@@fallbacks",!1)}),z(i,"$fallbacks=",function(C){var w;return L(r[1],"@@fallbacks",_(C["$is_a?"](c("Array")))?x(x(c("I18n"),"Locale"),"Fallbacks").$new(C):C),w=["i18n_fallbacks",A(r[1],"@@fallbacks",!1)],S(c("Thread").$current(),"[]=",w),w[w.length-1]}),function(i,T){var C,w,I,p,c=[H(i,"Backend")].concat(T);return C=c,I=[w=H(c[0],"Fallbacks")].concat(C),p=e.$r(I),z(w,"$translate",function h(l,b,s){try{var o=j("return"),$=h.$$p||D,y=this,B=D,f=D;return h.$$p=null,null==s&&(s=p("EMPTY_HASH")),_(s.$fetch("fallback",!0))?_(s["$[]"]("fallback_in_progress"))?U(y,k(y,"translate",h,!1,!0),"translate",[l,b,s],$):(_(s["$[]"]("default"))&&(B=y["$extract_non_symbol_default!"](s)),f=s.$merge(q(["fallback_in_progress"],{fallback_in_progress:!0})),S(p("I18n").$fallbacks()["$[]"](l),"each",[],function t(R){var n=null==t.$$s?this:t.$$s;null==R&&(R=D);try{return S(n,"catch",["exception"],function d(){var a=null==d.$$s?this:d.$$s,W=D;if(W=U(a,N(a,"translate",d.$$def||t.$$def||h,!1,!1),"translate",[R,b,f],null),_(W["$nil?"]()))return D;F(l.$to_s(),R.$to_s())&&a.$on_fallback(l,R,b,s),o.$throw(W)},{$$s:n,$$ret:o})}catch(d){if(!e.rescue(d,[x(p("I18n"),"InvalidLocale")]))throw d;try{return D}finally{e.pop_exception()}}},{$$s:y}),_(s["$key?"]("default"))&&_(s["$[]"]("default")["$nil?"]())?D:_(B)?U(y,k(y,"translate",h,!1,!0),"translate",[l,D,s.$merge(q(["default"],{default:B}))],null):y.$throw("exception",x(p("I18n"),"MissingTranslation").$new(l,b,s))):U(y,k(y,"translate",h,!1,!0),"translate",[l,b,s],$)}catch(t){if(t===o)return t.$v;throw t}},-3),z(w,"$extract_non_symbol_default!",function(l){var s,b=D;return b=[l["$[]"]("default")].$flatten(),s=S(b,"detect",[],function($){return null==$&&($=D),$["$is_a?"](p("Symbol"))["$!"]()}),_(s)&&l["$[]="]("default",b["$[]"](0,b.$index(s))),s}),z(w,"$exists?",function h(l,b,s){try{var o=j("return"),$=h.$$p||D,y=this;return h.$$p=null,null==s&&(s=p("EMPTY_HASH")),_(s.$fetch("fallback",!0))?(S(p("I18n").$fallbacks()["$[]"](l),"each",[],function B(f){var t=null==B.$$s?this:B.$$s;null==f&&(f=D);try{if(!_(U(t,N(t,"exists?",B.$$def||h,!1,!1),"exists?",[f,b],null)))return D;o.$throw(!0)}catch(R){if(!e.rescue(R,[x(p("I18n"),"InvalidLocale")]))throw R;try{return D}finally{e.pop_exception()}}},{$$s:y,$$ret:o}),!1):U(y,k(y,"exists?",h,!1,!0),"exists?",[l,b,s],$)}catch(B){if(B===o)return B.$v;throw B}},-3),w.$private(),z(w,"$on_fallback",P(D))}(m[0],m)},Opal.modules["bcdice/randomizer"]=function(e){var u,v,C,w,I,p,i,T,L=e.klass,_=e.const_set,A=e.def,z=e.truthy,S=e.rb_gt,U=e.rb_plus,k=e.rb_le,q=e.send,N=e.rb_minus,F=e.eqeq,j=e.rb_times,P=e.eqeqeq,M=e.rb_ge,D=[],x=e.nil,Y=e.$$$;return u=D,i=[(0,e.module)(D[0],"BCDice")].concat(u),T=e.$r(i),v=i,w=[C=L(i[0],null,"Randomizer")].concat(v),I=e.$r(w),(p=C.$$prototype).rand_results=p.detailed_rand_results=x,_(w[0],"UPPER_LIMIT_DICE_TIMES",200),_(w[0],"UPPER_LIMIT_DICE_SIDES",1e4),_(w[0],"UPPER_LIMIT_RANDS",1e4),A(C,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),C.$attr_reader("rand_results"),C.$attr_reader("detailed_rand_results"),_(w[0],"DetailedRandResult",I("Struct").$new("kind","sides","value")),A(C,"$roll_barabara",function(l,b){var s=this;return z(S(U(s.rand_results.$size(),l),I("UPPER_LIMIT_RANDS")))&&s.$raise(I("TooManyRandsError")),z(k(l,0))||z(S(l,I("UPPER_LIMIT_DICE_TIMES")))?[]:q(I("Array"),"new",[l],function o(){return(null==o.$$s?this:o.$$s).$roll_once(b)},{$$s:s})}),A(C,"$roll_sum",function(l,b){return this.$roll_barabara(l,b).$sum()}),A(C,"$roll_once",function(l){var s=x;return z(k(l,0))||z(S(l,I("UPPER_LIMIT_DICE_SIDES")))?0:(s=this.$rand_inner(l),this.$push_to_detail("normal",l,s),s)}),A(C,"$roll_index",function(l){return N(this.$roll_once(l),1)}),A(C,"$roll_tens_d10",function(){var s,b=x;return b=this.$rand_inner(10),F(b,10)&&(b=0),s=j(b,10),this.$push_to_detail("tens_d10",10,s),s}),A(C,"$roll_d9",function(){var b;return b=N(this.$rand_inner(10),1),this.$push_to_detail("d9",10,b),b}),A(C,"$roll_d66",function(l){var o,s=x;return s=q(I("Array"),"new",[2],function $(){return(null==$.$$s?this:$.$$s).$roll_once(6)},{$$s:this}),P(Y(I("D66SortType"),"ASC"),o=l)?s["$sort!"]():P(Y(I("D66SortType"),"DESC"),o)&&s["$sort!"]()["$reverse!"](),U(j(s["$[]"](0),10),s["$[]"](1))}),C.$private(),A(C,"$rand_inner",function(l){var s,b=this;return z(M(b.rand_results.$size(),I("UPPER_LIMIT_RANDS")))&&b.$raise(I("TooManyRandsError")),s=b.$random(l),b.rand_results["$<<"]([s,l]),s}),A(C,"$random",function(l){return U(I("Kernel").$rand(l),1)}),A(C,"$push_to_detail",function(l,b,s){var $;return $=I("DetailedRandResult").$new(l,b,s),this.detailed_rand_results.$push($)}),L(i[0],T("StandardError"),"TooManyRandsError"),x},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var q,P,G,u,m,i,T,D,F,H=e.module,L=e.klass,_=e.def,A=e.truthy,z=e.return_val,S=[],U=e.nil;return q=S,P=F=[H(S[0],"BCDice")].concat(q),G=D=[H(F[0],"DiceTable")].concat(P),m=[u=L(D[0],null,"RollResult")].concat(G),i=e.$r(m),(T=u.$$prototype).table_name=T.value=T.body=U,_(u,"$initialize",function(c,v,C){var w=this;return w.table_name=c,w.value=v,w.body=C}),u.$attr_reader("table_name"),u.$attr_reader("value"),u.$attr_reader("body"),_(u,"$to_s",function(){var c=this;return c.table_name+"("+c.value+") \uff1e "+c.body}),_(u,"$last_body",function(){var c=this;return A(c.body["$is_a?"](i("RollResult")))?c.body.$last_body():c.body}),_(u,"$empty?",z(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var q,P,G,u,m,i,T,D,F,H=e.module,L=e.klass,_=e.truthy,A=e.def,z=e.rb_minus,S=[],U=e.nil;return q=S,P=F=[H(S[0],"BCDice")].concat(q),G=D=[H(F[0],"DiceTable")].concat(P),m=[u=L(D[0],null,"ChainTable")].concat(G),i=e.$r(m),(T=u.$$prototype).times=T.sides=T.items=T.name=U,A(u,"$initialize",function(c,v,C){var w=this,I=U;return w.name=c,w.items=C.$freeze(),I=/(\d+)D(\d+)/i.$match(v),_(I)||w.$raise(i("ArgumentError"),"Unexpected table type: "+v),w.times=I["$[]"](1).$to_i(),w.sides=I["$[]"](2).$to_i()}),A(u,"$roll",function(c){var C,w,v=this,I=U;return C=c.$roll_sum(v.times,v.sides),w=z(C,v.times),I=v.items["$[]"](w),_(I["$respond_to?"]("roll"))&&(I=I.$roll(c)),i("RollResult").$new(v.name,C,I)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var j,x,i,T,r,c,v,G,M,H=e.module,L=e.klass,_=e.hash2,A=e.defs,z=e.def,S=e.rb_plus,U=e.rb_times,k=e.rb_minus,q=[],N=e.nil;return j=q,x=M=[H(q[0],"BCDice")].concat(j),i=G=[H(M[0],"DiceTable")].concat(x),r=[T=L(G[0],null,"D66GridTable")].concat(i),c=e.$r(r),(v=T.$$prototype).name=v.items=N,A(T,"$from_i18n",function(w,I){var h=N;return h=c("I18n").$t(w,_(["locale","raise"],{locale:I,raise:!0})),this.$new(h["$[]"]("name"),h["$[]"]("items"))}),z(T,"$initialize",function(w,I){return this.name=w,this.items=I.$freeze()}),z(T,"$roll",function(w){var p,h,l,b,s;return p=w.$roll_once(6),h=w.$roll_once(6),l=S(U(p,10),h),b=k(p,1),s=k(h,1),c("RollResult").$new(this.name,l,this.items["$[]"](b)["$[]"](s))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var N,M,m,i,T,r,x,Y,j,H=e.module,L=e.klass,_=e.hash2,A=e.defs,z=e.def,U=[],k=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),N=U,M=j=[H(U[0],"BCDice")].concat(N),x=[H(j[0],"DiceTable")].concat(M),Y=e.$r(x),m=x,T=[i=L(x[0],Y("D66GridTable"),"D66HalfGridTable")].concat(m),r=e.$r(T),A(i,"$from_i18n",function(v,C){var I=k;return I=r("I18n").$t(v,_(["locale","raise"],{locale:C,raise:!0})),this.$new(I["$[]"]("name"),I["$[]"]("items_1_2_3"),I["$[]"]("items_4_5_6"))}),z(i,"$initialize",function(v,C,w){return this.name=v,this.items=[C,C,C,w,w,w].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var N,M,m,i,T,r,x,Y,j,H=e.module,L=e.klass,_=e.hash2,A=e.defs,z=e.def,U=[],k=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),N=U,M=j=[H(U[0],"BCDice")].concat(N),x=[H(j[0],"DiceTable")].concat(M),Y=e.$r(x),m=x,T=[i=L(x[0],Y("D66GridTable"),"D66OneThirdTable")].concat(m),r=e.$r(T),A(i,"$from_i18n",function(v,C){var I=k;return I=r("I18n").$t(v,_(["locale","raise"],{locale:C,raise:!0})),this.$new(I["$[]"]("name"),I["$[]"]("items_1_2"),I["$[]"]("items_3_4"),I["$[]"]("items_5_6"))}),z(i,"$initialize",function(v,C,w,I){return this.name=v,this.items=[C,C,w,w,I,I].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var M,G,r,c,v,C,w,m,x,H=e.module,L=e.klass,_=e.hash2,A=e.defs,z=e.def,S=e.eqeqeq,U=e.rb_plus,k=e.rb_times,q=e.truthy,N=[],F=e.nil,j=e.$$$;return M=N,G=x=[H(N[0],"BCDice")].concat(M),r=m=[H(x[0],"DiceTable")].concat(G),v=[c=L(m[0],null,"D66Table")].concat(r),C=e.$r(v),(w=c.$$prototype).sort_type=w.items=w.name=F,A(c,"$from_i18n",function(p,h){var s,b=F;return b=C("I18n").$t(p,_(["locale"],{locale:h})),s=C("D66SortType").$const_get(b["$[]"]("d66_sort_type")),this.$new(b["$[]"]("name"),s,b["$[]"]("items"))}),z(c,"$initialize",function(p,h,l){var b=this;return b.name=p,b.sort_type=h,b.items=l.$freeze()}),z(c,"$roll",function(p){var h=this,l=F,b=F,s=F,o=F;return l=p.$roll_barabara(2,6),S(j(C("D66SortType"),"ASC"),b=h.sort_type)?l["$sort!"]():S(j(C("D66SortType"),"DESC"),b)&&l["$sort!"]()["$reverse!"](),s=U(k(l["$[]"](0),10),l["$[]"](1)),o=q(b=h.items["$[]"](s))?b:h.items["$[]"](s.$to_s()),q(o["$respond_to?"]("roll"))&&(o=o.$roll(p)),C("RollResult").$new(h.name,s,o)}),z(c,"$choice",function(p){return C("RollResult").$new(this.name,p,this.items["$[]"](p))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var D,u,i,T,Y,H=e.module,L=e.klass,_=e.hash2,A=e.send,z=e.to_ary,S=e.rb_plus,U=e.rb_times,k=e.send2,q=e.find_super,N=e.def,j=[],P=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),D=j,u=Y=[H(j[0],"BCDice")].concat(D),i=[H(Y[0],"DiceTable")].concat(u),T=e.$r(i),N(L(i[0],T("D66Table"),"D66LeftRangeTable"),"$initialize",function C(w,I,p){var b;return C.$$p=null,b=_([],{}),A(p,"each",[],function(o){var $,f;return null==o&&(o=P),$=z(o),f=null==$[1]?P:$[1],A(null==$[0]?P:$[0],"each",[],function(R){return null==R&&(R=P),A(f,"each_with_index",[],function(d,a){var W,Q;return null==d&&(d=P),null==a&&(a=P),Q=S(U(R,10),S(a,1)),A(b,"[]=",W=[Q,d]),W[W.length-1]})})}),k(this,q(this,"initialize",C,!1,!0),"initialize",[w,I,b],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var P,Y,T,r,c,v,C,u,D,H=e.module,L=e.klass,_=e.hash2,A=e.defs,z=e.def,S=e.truthy,U=e.rb_minus,k=e.rb_plus,q=e.rb_times,N=[],F=e.nil;return P=N,Y=D=[H(N[0],"BCDice")].concat(P),T=u=[H(D[0],"DiceTable")].concat(Y),c=[r=L(u[0],null,"D66ParityTable")].concat(T),v=e.$r(c),(C=r.$$prototype).odd=C.even=C.name=F,A(r,"$from_i18n",function(I,p){var l=F;return l=v("I18n").$t(I,_(["locale","raise"],{locale:p,raise:!0})),this.$new(l["$[]"]("name"),l["$[]"]("odd"),l["$[]"]("even"))}),z(r,"$initialize",function(I,p,h){var l=this;return l.name=I,l.odd=p.$freeze(),l.even=h.$freeze()}),z(r,"$roll",function(I){var l,s,o,p=this,h=F;return h=I.$roll_once(6),l=I.$roll_once(6),s=(S(h["$odd?"]())?p.odd:p.even)["$[]"](U(l,1)),o=k(q(h,10),l),v("RollResult").$new(p.name,o,s)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var N,M,u,m,i,T,r,x,j,H=e.module,L=e.klass,_=e.def,A=e.rb_plus,z=e.rb_times,S=e.send,U=[],k=e.nil;return N=U,M=j=[H(U[0],"BCDice")].concat(N),u=x=[H(j[0],"DiceTable")].concat(M),i=[m=L(x[0],null,"D66RangeTable")].concat(u),T=e.$r(i),(r=m.$$prototype).items=r.name=k,_(m,"$initialize",function(v,C){return this.name=v,this.items=C.$freeze()}),_(m,"$roll",function(v){var w,I,p,h=k;return w=v.$roll_once(6),I=v.$roll_once(6),p=A(z(w,10),I),h=S(this.items,"find",[],function(b){return null==b&&(b=k),b["$[]"](0)["$include?"](p)}),T("RollResult").$new(this.name,p,h["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var D,u,c,p,l,b,v,C,w,I,i,Y,H=e.module,L=e.klass,_=e.const_set,A=e.send,z=e.hash2,S=e.def,U=e.eqeqeq,k=e.truthy,q=e.to_a,N=e.rb_times,F=e.rb_plus,j=[],P=e.nil;return D=j,u=Y=[H(j[0],"BCDice")].concat(D),c=i=[H(Y[0],"DiceTable")].concat(u),C=[v=L(i[0],null,"RangeTable")].concat(c),w=e.$r(C),(I=v.$$prototype).name=I.items=I.num_of_dice=I.num_of_sides=I.formatter=P,_(C[0],"RollResult",A(w("Struct"),"new",["sum","values","content","formatted"],function p(){return(null==p.$$s?this:p.$$s).$alias_method("to_s","formatted")},{$$s:v})),_(C[0],"Item",w("Struct").$new("range","content")),_(C[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),_(C[0],"DEFAULT_FORMATTER",A(v,"lambda",[],function(h,l){return null==h&&(h=P),null==l&&(l=P),h.$name()+"("+l.$sum()+") \uff1e "+l.$content()})),v.$attr_reader("name"),v.$attr_reader("num_of_dice"),v.$attr_reader("num_of_sides"),l=[p=e.get_singleton_class(v)].concat(C),b=e.$r(l),S(p,"$from_i18n",function(o,$){var f,B=P;return B=b("I18n").$t(o,z(["locale"],{locale:$})),f=A(B["$[]"]("items"),"map",[],function t(R){return null==R&&(R=P),[(null==t.$$s?this:t.$$s).$conv_string_range(R["$[]"](0)),R["$[]"](1)]},{$$s:this}),this.$new(B["$[]"]("name"),B["$[]"]("type"),f)}),S(p,"$conv_string_range",function(o){var y,$=this;return null==$.name&&($.name=P),U(b("Integer"),y=o)?o:U(b("String"),y)?k(o["$include?"](".."))?A(b("Range"),"new",q(A(o.$split("..",2),"map",[],function B(f){return null==f&&(f=P),(null==B.$$s?this:B.$$s).$Integer(f)},{$$s:$}))):$.$Integer(o):$.$raise(b("TypeError"),$.name+": "+o+" ("+o.$class()+") must be a String or an Integer")}),S(v,"$initialize",function p(h,l,b){var $,s=p.$$p||P,o=this,y=P;return p.$$p=null,o.name=h.$freeze(),o.formatter=k($=s)?$:w("DEFAULT_FORMATTER"),y=w("DICE_ROLL_METHOD_RE").$match(l),k(y)||o.$raise(w("ArgumentError"),o.name+": invalid dice roll method: "+l),o.num_of_dice=y["$[]"](1).$to_i(),o.num_of_sides=y["$[]"](2).$to_i(),o.$store(b)}),S(v,"$fetch",function(h){var b,l=this;return b=A(l.items,"find",[],function(o){return null==o&&(o=P),o.$range()["$include?"](h)}),k(b)||l.$raise(w("RangeError"),l.name+": value is out of range: "+h),b}),S(v,"$roll",function(h){var s,l=this,b=P,o=P;return s=(b=h.$roll_barabara(l.num_of_dice,l.num_of_sides)).$sum(),(o=w("RollResult").$new(s,b,l.$fetch(s).$content()))["$formatted="](l.formatter["$[]"](l,o)),o}),v.$private(),S(v,"$store",function(h){var b,s,l=this;return b=A(h,"map",[],function o($,y){return null==$&&($=P),null==y&&(y=P),[(null==o.$$s?this:o.$$s).$coerce_to_int_range($),y]},{$$s:l}),s=A(b,"sort_by",[],function($,y){return null==$&&($=P),null==y&&(y=P),$.$min()}),l.$assert_min_sum_is_covered(s),l.$assert_max_sum_is_covered(s),l.$assert_no_gap_or_overlap_in_ranges(s),l.items=A(s,"map",[],function($,y){return null==$&&($=P),null==y&&(y=P),w("Item").$new($,y.$freeze()).$freeze()}).$freeze(),l}),S(v,"$coerce_to_int_range",function(h){var b;return U(w("Integer"),b=h)?w("Range").$new(h,h):U(w("Range"),b)&&k(h.$begin()["$is_a?"](w("Integer")))&&k(h.$end()["$is_a?"](w("Integer")))?h:this.$raise(w("TypeError"),this.name+": "+h+" ("+h.$class()+") must be an Integer or a Range with Integers ")}),S(v,"$assert_min_sum_is_covered",function(h){var b,l=this,s=P;return b=l.num_of_dice,s=h.$first()["$[]"](0),k(s["$include?"](b))||l.$raise(w("RangeError"),l.name+": min value ("+b+") is not covered: "+s),l}),S(v,"$assert_max_sum_is_covered",function(h){var b,l=this,s=P;return b=N(l.num_of_dice,l.num_of_sides),s=h.$last()["$[]"](0),k(s["$include?"](b))||l.$raise(w("RangeError"),l.name+": max value ("+b+") is not covered: "+s),l}),S(v,"$assert_no_gap_or_overlap_in_ranges",function(h){return A(h,"each_cons",[2],function b(s,o){var f,t,$=null==b.$$s?this:b.$$s,y=P,B=P;return null==$.name&&($.name=P),null==s&&(s=P),null==o&&(o=P),y=s["$[]"](0),B=o["$[]"](0),f=y.$max(),t=F(f,1),k(B["$include?"](f))&&$.$raise(w("RangeError"),$.name+": Range overlap: "+y+" and "+B),k(B["$include?"](t))?P:$.$raise(w("RangeError"),$.name+": Range gap: "+y+" and "+B)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var F,D,m,v,C,w,I,T,Y,P,H=e.module,L=e.klass,_=e.send,A=e.def,z=e.rb_minus,S=e.return_ivar,U=[],k=e.nil,q=e.$$$;return F=U,D=P=[H(U[0],"BCDice")].concat(F),m=Y=[H(P[0],"DiceTable")].concat(D),v=T=[L(Y[0],null,"SaiFicSkillTable")].concat(m),w=[C=L(T[0],null,"Category")].concat(v),I=e.$r(w),A(C,"$initialize",function(h,l,b,s){var o=this;return o.name=h,o.skills=_(l.$map(),"with_index",[2],function(y,B){return null==y&&(y=k),null==B&&(B=k),q(I("SaiFicSkillTable"),"Skill").$new(h,y,b,B,s)}),o.dice=b}),A(C,"$roll",function(h){return this.$skills()["$[]"](z(h.$roll_sum(2,6),2))}),A(C,"$to_s",S("name")),C.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var k,j,Y,T,r,u,M,N,H=e.module,L=e.klass,_=e.def,A=e.hash2,z=[],S=e.nil;return k=z,j=N=[H(z[0],"BCDice")].concat(k),Y=M=[H(N[0],"DiceTable")].concat(j),u=[L(M[0],null,"SaiFicSkillTable")].concat(Y),(r=(T=L(u[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=S,_(T,"$initialize",function(v,C,w,I,p){var h=this;return h.category_name=v,h.name=C,h.category_dice=w,h.row_dice=I,h.s_format=p}),_(T,"$to_s",function(){var v=this;return v.$format(v.s_format,A(["category_dice","row_dice","category_name","skill_name"],{category_dice:v.category_dice,row_dice:v.row_dice,category_name:v.category_name,skill_name:v.name}))}),T.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var u,r,I,p,h,l,b,v,i,H=e.module,L=e.klass,_=e.ensure_kwargs,A=e.hash2,z=e.send,U=e.defs,k=e.const_set,q=e.to_ary,N=e.def,F=e.truthy,j=e.rb_minus,P=e.rb_plus,M=e.top,D=[],x=e.nil,Y=e.$$$;return M.$require("bcdice/dice_table/sai_fic_skill_table/category"),M.$require("bcdice/dice_table/sai_fic_skill_table/skill"),u=D,r=i=[H(D[0],"BCDice")].concat(u),I=v=[H(i[0],"DiceTable")].concat(r),h=[p=L(v[0],null,"SaiFicSkillTable")].concat(I),l=e.$r(h),(b=p.$$prototype).rtt=b.rtt_format=b.rct=b.rct_format=b.rttn=b.rttn_format=b.categories=x,U(p,"$from_i18n",function(o,$,y){var B,f,t,a,d=x;return null==(B=(y=_(y)).$$smap.rtt)&&(B=x),null==(f=y.$$smap.rct)&&(f=x),null==(t=y.$$smap.rttn)&&(t=x),a=(d=l("I18n").$t("RTT",A(["locale","raise","default"],{locale:$,raise:!1,default:A([],{})})).$merge(l("I18n").$t(o,A(["locale","raise"],{locale:$,raise:!0}))))["$[]"]("items"),d=z(d,"select",[],function(Q,V){return null==Q&&(Q=x),null==V&&(V=x),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](Q)}),this.$new(a,e.to_hash(d).$merge(A(["rtt","rct","rttn"],{rtt:B,rct:f,rttn:t})))},-3),k(h[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),k(h[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),k(h[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),k(h[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),N(p,"$initialize",function(o,$){var y,B,f,t,R,n,d,a=this;return null==(y=($=_($)).$$smap.rtt)&&(y=x),null==(B=$.$$smap.rct)&&(B=x),null==(f=$.$$smap.rttn)&&(f=x),null==(t=$.$$smap.rtt_format)&&(t=l("DEFAULT_RTT")),null==(R=$.$$smap.rct_format)&&(R=l("DEFAULT_RCT")),null==(n=$.$$smap.rttn_format)&&(n=l("DEFAULT_RTTN")),null==(d=$.$$smap.s_format)&&(d=l("DEFAULT_S")),a.categories=z(o.$map(),"with_index",[1],function(Q,V){var O,_e,$e;return null==Q&&(Q=x),null==V&&(V=x),_e=null==(O=q(Q))[0]?x:O[0],$e=null==O[1]?x:O[1],Y(l("SaiFicSkillTable"),"Category").$new(_e,$e,V,d)},{$$has_top_level_mlhs_arg:!0}),a.rtt=y,a.rct=B,a.rttn=f.$to_a(),a.rtt_format=t,a.rct_format=R,a.rttn_format=n},-2),k(h[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),p.$attr_reader("categories"),N(p,"$roll_command",function(o,$){var B,y=this,f=x,t=x;return F(["RTT",y.rtt]["$include?"](B=$))?y.$format_skill(y.rtt_format,y.$roll_skill(o)):F(["RCT",y.rct]["$include?"](B))?(f=y.$roll_category(o),y.$format(y.rct_format,A(["category_dice","category_name"],{category_dice:f.$dice(),category_name:f.$name()}))):F(t=l("RTTN").$index(B))||F(t=y.rttn.$index(B))?y.$format_skill(y.rttn_format,y.categories["$[]"](t).$roll(o)):x}),N(p,"$roll_category",function(o){return this.categories["$[]"](j(o.$roll_once(6),1))}),N(p,"$roll_skill",function(o){return this.$roll_category(o).$roll(o)}),N(p,"$prefixes",function(){var o=this;return P(["RTT[1-6]?","RCT",o.rtt,o.rct],o.rttn).$compact()}),p.$private(),N(p,"$format_skill",function(o,$){return this.$format(o,A(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:$.$category_dice(),row_dice:$.$row_dice(),category_name:$.$category_name(),skill_name:$.$name(),text:$.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var F,D,m,i,T,r,c,Y,P,H=e.module,L=e.klass,_=e.hash2,A=e.defs,z=e.truthy,S=e.def,U=e.rb_minus,k=[],q=e.nil;return F=k,D=P=[H(k[0],"BCDice")].concat(F),m=Y=[H(P[0],"DiceTable")].concat(D),T=[i=L(Y[0],null,"Table")].concat(m),r=e.$r(T),(c=i.$$prototype).times=c.sides=c.name=c.items=q,A(i,"$from_i18n",function(C,w){var p=q;return p=r("I18n").$t(C,_(["locale"],{locale:w})),this.$new(p["$[]"]("name"),p["$[]"]("type"),p["$[]"]("items"))}),S(i,"$initialize",function(C,w,I){var p=this,h=q;return p.name=C,p.items=I.$freeze(),h=/(\d+)D(\d+)/i.$match(w),z(h)||p.$raise(r("ArgumentError"),"Unexpected table type: "+w),p.times=h["$[]"](1).$to_i(),p.sides=h["$[]"](2).$to_i()}),S(i,"$roll",function(C){var I,w=this;return I=C.$roll_sum(w.times,w.sides),w.$choice(I)}),S(i,"$choice",function(C){var I,w=this;return I=U(C,w.times),r("RollResult").$new(w.name,C,w.items["$[]"](I))})},Opal.modules["bcdice/dice_table"]=function(e){var H=e.top;return H.$require("bcdice/dice_table/roll_result"),H.$require("bcdice/dice_table/chain_table"),H.$require("bcdice/dice_table/d66_grid_table"),H.$require("bcdice/dice_table/d66_half_grid_table"),H.$require("bcdice/dice_table/d66_one_third_table"),H.$require("bcdice/dice_table/d66_left_range_table"),H.$require("bcdice/dice_table/d66_parity_table"),H.$require("bcdice/dice_table/d66_range_table"),H.$require("bcdice/dice_table/d66_table"),H.$require("bcdice/dice_table/range_table"),H.$require("bcdice/dice_table/sai_fic_skill_table"),H.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var S,N,j,k,H=e.module,L=e.const_set,_=[];return S=_,N=k=[H(_[0],"BCDice")].concat(S),j=[H(k[0],"D66SortType")].concat(N),L(j[0],"NO_SORT","no_sort"),L(j[0],"ASC","asc"),L(j[0],"DESC","desc"),function(q,N){var j=[H(q,"RoundType")].concat(N);return L(j[0],"CEIL","ceil"),L(j[0],"FLOOR","floor"),L(j[0],"ROUND","round")}(k[0],k)},Opal.modules["bcdice/translate"]=function(e){var N,M,D,x,Y,j,H=e.module,L=e.ensure_kwargs,_=e.kwrestargs,z=e.hash2,S=e.def,U=[],k=e.nil;return N=U,M=j=[H(U[0],"BCDice")].concat(N),x=[D=H(j[0],"Translate")].concat(M),Y=e.$r(x),S(D,"$translate",function(u,m){var i,T=this;return null==T.locale&&(T.locale=k),m=L(m),i=_(m,{}),Y("I18n").$translate(u,z(["locale","raise"],{locale:T.locale,raise:!0}).$merge(e.to_hash(i)))},-2)},Opal.modules["bcdice/result"]=function(e){var D,G,x,N,j,L=e.klass,_=e.send,A=e.def,z=e.return_val,S=e.return_ivar,U=[],k=e.nil;return N=U,D=j=[(0,e.module)(U[0],"BCDice")].concat(N),[x=L(j[0],null,"Result")].concat(D),A(G=e.get_singleton_class(x),"$success",function(i){return _(this.$new(),"tap",[],function(c){var v;return null==c&&(c=k),c["$text="](i),_(c,"success=",v=[!0]),v[v.length-1]})}),A(G,"$failure",function(i){return _(this.$new(),"tap",[],function(c){var v;return null==c&&(c=k),c["$text="](i),_(c,"failure=",v=[!0]),v[v.length-1]})}),A(G,"$critical",function(i){return _(this.$new(),"tap",[],function(c){var v;return null==c&&(c=k),c["$text="](i),c["$critical="](!0),_(c,"success=",v=[!0]),v[v.length-1]})}),A(G,"$fumble",function(i){return _(this.$new(),"tap",[],function(c){var v;return null==c&&(c=k),c["$text="](i),c["$fumble="](!0),_(c,"failure=",v=[!0]),v[v.length-1]})}),A(G,"$nothing",z("nothing")),A(x,"$initialize",function(u){var m=this;return null==u&&(u=k),m.text=u,m.rands=k,m.detailed_rands=k,m.secret=!1,m.success=!1,m.failure=!1,m.critical=!1,m.fumble=!1},-1),x.$attr_accessor("text","rands","detailed_rands"),x.$attr_writer("secret","success","failure","critical","fumble"),A(x,"$secret?",S("secret")),A(x,"$success?",S("success")),A(x,"$failure?",S("failure")),A(x,"$critical?",S("critical")),A(x,"$fumble?",S("fumble")),A(x,"$condition=",function(u){return this.success=u,this.failure=u["$!"]()})},Opal.modules["racc/parser"]=function(e){var C,I,p,H=e.module,L=e.klass,_=e.truthy,A=e.const_set,z=e.defs,S=e.gvars,U=e.rb_lt,k=e.def,q=e.to_ary,N=e.send,F=e.neqeq,j=e.rb_plus,P=e.eqeq,M=e.rb_ge,D=e.rb_gt,x=e.rb_minus,Y=e.rb_le,G=e.rb_times,u=e.assign_ivar_val,i=[],T=e.$r(i),r=e.nil,c=e.$$$;return C=i,I=[H(i[0],"Racc")].concat(C),p=e.$r(I),L(I[0],p("StandardError"),"ParseError"),_(c("::","ParseError","skip_raise")?"constant":r)||A(i[0],"ParseError",c(T("Racc"),"ParseError")),function(v,C){var s,o,$,y,B,p=[H(v,"Racc")].concat(C),h=e.$r(p);return _(h("Racc_No_Extensions","skip_raise")?"constant":r)||A(p[0],"Racc_No_Extensions",!1),s=p,$=[o=L(p[0],null,"Parser")].concat(s),y=e.$r($),(B=o.$$prototype).yydebug=B.racc_debug_out=B.racc_error_status=B.racc_t=B.racc_vstack=B.racc_val=B.racc_state=B.racc_tstack=r,A($[0],"Racc_Runtime_Version","1.4.6"),A($[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),A($[0],"Racc_Runtime_Core_Version_R","1.4.6"),A($[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),A($[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),A($[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),A($[0],"Racc_Runtime_Core_Version",y("Racc_Runtime_Core_Version_R")),A($[0],"Racc_Runtime_Core_Revision",y("Racc_Runtime_Core_Revision_R")),A($[0],"Racc_Runtime_Type","ruby"),z(y("Parser"),"$racc_runtime_type",function(){return y("Racc_Runtime_Type")}),k(o,"$_racc_setup",function(){var t,R,n=this,d=r,a=r;return null==S.stderr&&(S.stderr=r),_(c(n.$class(),"Racc_debug_parser"))||(n.yydebug=!1),_(null!=(t=n.yydebug)&&t!==r?"instance-variable":r)||(n.yydebug=!1),_(n.yydebug)&&(_(null!=(R=n.racc_debug_out)&&R!==r?"instance-variable":r)||(n.racc_debug_out=S.stderr),n.racc_debug_out=_(d=n.racc_debug_out)?d:S.stderr),a=c(n.$class(),"Racc_arg"),_(U(a.$size(),14))&&a["$[]="](13,!0),a}),k(o,"$_racc_init_sysvars",function(){var t=this;return t.racc_state=[0],t.racc_tstack=[],t.racc_vstack=[],t.racc_t=r,t.racc_val=r,t.racc_read_next=!0,t.racc_user_yyerror=!1,t.racc_error_status=0}),k(o,"$do_parse",function(){return this.$__send__(y("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),k(o,"$next_token",function(){return this.$raise(y("NotImplementedError"),this.$class()+"#next_token is not defined")}),k(o,"$_racc_do_parse_rb",function(t,R){var n,a=this,W=r,Q=r,V=r,O=r,_e=r,$e=r,ue=r,ae=r;return n=q(t),W=null==n[0]?r:n[0],Q=null==n[1]?r:n[1],V=null==n[2]?r:n[2],O=null==n[3]?r:n[3],_e=null==n[10]?r:n[10],a.$_racc_init_sysvars(),$e=ue=ae=r,N(a,"catch",["racc_end_parse"],function ne(){var se,K,g=null==ne.$$s?this:ne.$$s,Z=r;for(null==g.racc_state&&(g.racc_state=r),null==g.racc_read_next&&(g.racc_read_next=r),null==g.racc_t&&(g.racc_t=r),null==g.yydebug&&(g.yydebug=r),null==g.racc_val&&(g.racc_val=r);_(!0);)for(_(ae=O["$[]"](g.racc_state["$[]"](-1)))?(_(g.racc_read_next)&&F(g.racc_t,0)&&(K=g.$next_token(),se=q(K),$e=null==se[0]?r:se[0],g.racc_val=null==se[1]?r:se[1],g.racc_t=_($e)?_(Z=_e["$[]"]($e))?Z:1:0,_(g.yydebug)&&g.$racc_read_token(g.racc_t,$e,g.racc_val),g.racc_read_next=!1),ae=j(ae,g.racc_t),_(M(ae,0))&&_(ue=W["$[]"](ae))&&P(Q["$[]"](ae),g.racc_state["$[]"](-1))||(ue=V["$[]"](g.racc_state["$[]"](-1)))):ue=V["$[]"](g.racc_state["$[]"](-1));_(ue=g.$_racc_evalact(ue,t)););},{$$s:a})}),k(o,"$yyparse",function(t,R){return this.$__send__(y("Racc_YY_Parse_Method"),t,R,this.$_racc_setup(),!0)}),k(o,"$_racc_yyparse_rb",function(t,R,n,d){var a,Q=this,V=r,O=r,te=r,_e=r,ue=r,ae=r,ne=r;return a=q(n),V=null==a[0]?r:a[0],O=null==a[1]?r:a[1],te=null==a[2]?r:a[2],_e=null==a[3]?r:a[3],ue=null==a[10]?r:a[10],Q.$_racc_init_sysvars(),ae=r,ne=r,N(Q,"catch",["racc_end_parse"],function se(){var K=null==se.$$s?this:se.$$s;for(null==K.racc_state&&(K.racc_state=r);!_(ne=_e["$[]"](K.racc_state["$[]"](-1)));)for(;_(ae=K.$_racc_evalact(te["$[]"](K.racc_state["$[]"](-1)),n)););return N(t,"__send__",[R],function g(Z,X){var E=null==g.$$s?this:g.$$s,ee=r,ie=r;for(null==E.racc_t&&(E.racc_t=r),null==E.racc_state&&(E.racc_state=r),null==E.racc_read_next&&(E.racc_read_next=r),null==Z&&(Z=r),null==X&&(X=r),E.racc_t=_(Z)?_(ee=ue["$[]"](Z))?ee:1:0,E.racc_val=X,E.racc_read_next=!1,ne=j(ne,E.racc_t),_(M(ne,0))&&_(ae=V["$[]"](ne))&&P(O["$[]"](ne),E.racc_state["$[]"](-1))||(ae=te["$[]"](E.racc_state["$[]"](-1)));_(ae=E.$_racc_evalact(ae,n)););for(;_(_(ee=_(ie=(ne=_e["$[]"](E.racc_state["$[]"](-1)))["$!"]())?ie:E.racc_read_next["$!"]())?ee:E.racc_t["$=="](0));)for(_(ne)&&_(ne=j(ne,E.racc_t))&&_(M(ne,0))&&_(ae=V["$[]"](ne))&&P(O["$[]"](ne),E.racc_state["$[]"](-1))||(ae=te["$[]"](E.racc_state["$[]"](-1)));_(ae=E.$_racc_evalact(ae,n)););},{$$s:K})},{$$s:Q})}),k(o,"$_racc_evalact",function(t,R){var n,te,a=this,W=r,Q=r,O=r,_e=r,$e=r,ue=r;if(W=null==(n=q(R))[0]?r:n[0],Q=null==n[1]?r:n[1],O=null==n[3]?r:n[3],te=null==n[11]?r:n[11],_e=null==n[12]?r:n[12],_(D(t,0))&&_(U(t,te)))_(D(a.racc_error_status,0))&&(P(a.racc_t,1)||(a.racc_error_status=x(a.racc_error_status,1))),a.racc_vstack.$push(a.racc_val),a.racc_state.$push(t),a.racc_read_next=!0,_(a.yydebug)&&(a.racc_tstack.$push(a.racc_t),a.$racc_shift(a.racc_t,a.racc_tstack,a.racc_vstack));else if(_(U(t,0))&&_(D(t,_e["$-@"]()))){if($e=N(a,"catch",["racc_jump"],function ae(){var ne=null==ae.$$s?this:ae.$$s;return null==ne.racc_state&&(ne.racc_state=r),ne.racc_state.$push(ne.$_racc_do_reduce(R,t)),!1},{$$s:a}),_($e))switch($e.valueOf()){case 1:return a.racc_user_yyerror=!0,_e["$-@"]();case 2:return te;default:a.$raise("[Racc Bug] unknown jump code")}}else if(P(t,te))_(a.yydebug)&&a.$racc_accept(),a.$throw("racc_end_parse",a.racc_vstack["$[]"](0));else{if(P(t,_e["$-@"]())){switch(a.racc_error_status.valueOf()){case 0:_(R["$[]"](21))||a.$on_error(a.racc_t,a.racc_val,a.racc_vstack);break;case 3:P(a.racc_t,0)&&a.$throw("racc_end_parse",r),a.racc_read_next=!0}for(a.racc_user_yyerror=!1,a.racc_error_status=3;_(!0)&&!(_(ue=O["$[]"](a.racc_state["$[]"](-1)))&&(ue=j(ue,1),_(M(ue,0))&&_(t=W["$[]"](ue))&&P(Q["$[]"](ue),a.racc_state["$[]"](-1))));)_(Y(a.racc_state.$size(),1))&&a.$throw("racc_end_parse",r),a.racc_state.$pop(),a.racc_vstack.$pop(),_(a.yydebug)&&(a.racc_tstack.$pop(),a.$racc_e_pop(a.racc_state,a.racc_tstack,a.racc_vstack));return t}a.$raise("[Racc Bug] unknown action "+t.$inspect())}return _(a.yydebug)&&a.$racc_next_state(a.racc_state["$[]"](-1),a.racc_state),r}),k(o,"$_racc_do_reduce",function(t,R){var n,_e,ue,Z,X,E,re,a=this,Q=r,V=r,O=r,te=r,$e=r,ae=r,ne=r,se=r,K=r,g=r,ee=r,ie=r,J=r;return Q=null==(n=q(t))[4]?r:n[4],V=null==n[5]?r:n[5],O=null==n[6]?r:n[6],te=null==n[7]?r:n[7],_e=null==n[8]?r:n[8],$e=null==n[9]?r:n[9],ue=null==n[13]?r:n[13],ae=a.racc_state,ne=a.racc_vstack,se=a.racc_tstack,K=G(R,-3),g=$e["$[]"](K),Z=$e["$[]"](j(K,1)),X=$e["$[]"](j(K,2)),E=[],_(a.yydebug)&&(ee=se["$[]"](g["$-@"](),g)),ie=ne["$[]"](g["$-@"](),g),_(a.yydebug)&&se["$[]="](g["$-@"](),g,E),ne["$[]="](g["$-@"](),g,E),ae["$[]="](g["$-@"](),g,E),_(ue)?ne.$push(a.$__send__(X,ie,ne,ie["$[]"](0))):ne.$push(a.$__send__(X,ie,ne)),se.$push(Z),_(a.yydebug)&&a.$racc_reduce(ee,Z,se,ne),re=x(Z,_e),_(K=te["$[]"](re))&&(K=j(K,ae["$[]"](-1)),_(M(K,0))&&_(J=Q["$[]"](K))&&P(V["$[]"](K),re))?J:O["$[]"](re)}),k(o,"$on_error",function(t,R,n){var a,d=this;return d.$raise(y("ParseError"),d.$sprintf("\nparse error on value %s (%s)",R.$inspect(),_(a=d.$token_to_str(t))?a:"?"))}),k(o,"$yyerror",function(){return this.$throw("racc_jump",1)}),k(o,"$yyaccept",function(){return this.$throw("racc_jump",2)}),k(o,"$yyerrok",u("racc_error_status",0)),k(o,"$racc_read_token",function(t,R,n){var d=this;return d.racc_debug_out.$print("read    "),d.racc_debug_out.$print(R.$inspect(),"(",d.$racc_token2str(t),") "),d.racc_debug_out.$puts(n.$inspect()),d.racc_debug_out.$puts()}),k(o,"$racc_shift",function(t,R,n){var d=this;return d.racc_debug_out.$puts("shift   "+d.$racc_token2str(t)),d.$racc_print_stacks(R,n),d.racc_debug_out.$puts()}),k(o,"$racc_reduce",function(t,R,n,d){var a=this,W=r;return(W=a.racc_debug_out).$print("reduce "),_(t["$empty?"]())?W.$print(" <none>"):N(t,"each",[],function Q(V){return null==V&&(V=r),W.$print(" ",(null==Q.$$s?this:Q.$$s).$racc_token2str(V))},{$$s:a}),W.$puts(" --\x3e "+a.$racc_token2str(R)),a.$racc_print_stacks(n,d),a.racc_debug_out.$puts()}),k(o,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),k(o,"$racc_e_pop",function(t,R,n){var d=this;return d.racc_debug_out.$puts("error recovering mode: pop token"),d.$racc_print_states(t),d.$racc_print_stacks(R,n),d.racc_debug_out.$puts()}),k(o,"$racc_next_state",function(t,R){var n=this;return n.racc_debug_out.$puts("goto    "+t),n.$racc_print_states(R),n.racc_debug_out.$puts()}),k(o,"$racc_print_stacks",function(t,R){var d=r;return(d=this.racc_debug_out).$print("        ["),N(t,"each_index",[],function a(W){return null==W&&(W=r),d.$print(" (",(null==a.$$s?this:a.$$s).$racc_token2str(t["$[]"](W))," ",R["$[]"](W).$inspect(),")")},{$$s:this}),d.$puts(" ]")}),k(o,"$racc_print_states",function(t){var n=r;return(n=this.racc_debug_out).$print("        ["),N(t,"each",[],function(a){return null==a&&(a=r),n.$print(" ",a)}),n.$puts(" ]")}),k(o,"$racc_token2str",function(t){var n;return _(n=c(this.$class(),"Racc_token_to_s_table")["$[]"](t))?n:this.$raise("[Racc Bug] can't convert token "+t+" to string")}),k(o,"$token_to_str",function(t){return c(this.$class(),"Racc_token_to_s_table")["$[]"](t)})}(i[0],i)},Opal.modules["bcdice/arithmetic/node"]=function(e){var u,r,w,s,o,p,h,v,i,H=e.module,L=e.klass,_=e.def,A=e.thrower,z=e.return_ivar,S=e.send2,U=e.find_super,k=e.eqeq,q=e.const_set,N=e.eqeqeq,F=e.rb_divide,j=e.truthy,P=e.assign_ivar,M=e.alias,D=[],x=e.nil,Y=e.$$$;return u=D,r=i=[H(D[0],"BCDice")].concat(u),w=v=[H(i[0],"Arithmetic")].concat(r),p=[H(v[0],"Node")].concat(w),h=e.$r(p),(o=(s=L(p[0],null,"BinaryOp")).$$prototype).lhs=o.rhs=o.op=x,_(s,"$initialize",function(y,B,f){var t=this;return t.lhs=y,t.op=B,t.rhs=f}),_(s,"$eval",function(y){try{A("eval_return");var R,f=this,t=x;return t=f.lhs.$eval(y),R=f.rhs.$eval(y),t.$send(f.op,R)}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),_(s,"$output",function(){var y=this;return""+y.lhs.$output()+y.op+y.rhs.$output()}),_(s,"$s_exp",function(){var y=this;return"("+y.$op_for_s_exp()+" "+y.lhs.$s_exp()+" "+y.rhs.$s_exp()+")"}),_(s,"$op_for_s_exp",z("op")),function(l,b,s){var o=L(l,b,"DivideBase"),$=[o].concat(s),y=e.$r($),B=o.$$prototype;B.lhs=B.rhs=B.op=x,_(o,"$initialize",function f(t,R){return f.$$p=null,S(this,U(this,"initialize",f,!1,!0),"initialize",[t,"/",R],null)}),_(o,"$eval",function(t){try{A("eval_return");var d,a,n=this;return d=n.lhs.$eval(t),a=n.rhs.$eval(t),k(a,0)&&n.$raise(y("ZeroDivisionError")),n.$divide_and_round(d,a,t)}catch(W){if(W===e.t_eval_return)return W.$v;throw W}}),_(o,"$output",function f(){var t=f.$$p||x,R=this;return f.$$p=null,""+S(R,U(R,"output",f,!1,!0),"output",[],t)+R.$rounding_method()}),o.$private(),_(o,"$rounding_method",function(){return Y(this.$class(),"ROUNDING_METHOD")}),_(o,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),_(o,"$divide_and_round",function(t,R,n){return this.$raise(y("NotImplementedError"))})}(p[0],h("BinaryOp"),p),function(l,b,s){var o=L(l,b,"DivideWithGameSystemDefault"),$=[o].concat(s),y=e.$r($);q($[0],"ROUNDING_METHOD",""),o.$private(),_(o,"$divide_and_round",function(f,t,R){var n,d=x;return N(Y(y("RoundType"),"CEIL"),n=R)?F(f.$to_f(),t).$ceil():N(Y(y("RoundType"),"ROUND"),n)?(d=F(f.$to_f(),t),j(d["$negative?"]())?d.$abs().$round()["$-@"]():d.$round()):F(f,t).$floor()})}(p[0],h("DivideBase"),p),function(l,b,s){var o=L(l,b,"DivideWithCeil"),$=[o].concat(s);q($[0],"ROUNDING_METHOD","C"),o.$private(),_(o,"$divide_and_round",function(B,f,t){return F(B.$to_f(),f).$ceil()})}(p[0],h("DivideBase"),p),function(l,b,s){var o=L(l,b,"DivideWithRound"),$=[o].concat(s);q($[0],"ROUNDING_METHOD","R"),o.$private(),_(o,"$divide_and_round",function(B,f,t){var R=x;return R=F(B.$to_f(),f),j(R["$negative?"]())?R.$abs().$round()["$-@"]():R.$round()})}(p[0],h("DivideBase"),p),function(l,b,s){var o=L(l,b,"DivideWithFloor"),$=[o].concat(s);q($[0],"ROUNDING_METHOD","F"),o.$private(),_(o,"$divide_and_round",function(B,f,t){return F(B,f).$floor()})}(p[0],h("DivideBase"),p),function(l,b){var s=L(l,null,"Negative");s.$$prototype.body=x,_(s,"$initialize",P("body")),_(s,"$eval",function(y){try{return A("eval_return"),this.body.$eval(y)["$-@"]()}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),_(s,"$output",function(){return"-"+this.body.$output()}),_(s,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(p[0]),function(l,b){var s=L(l,null,"Parenthesis");s.$$prototype.expr=x,_(s,"$initialize",P("expr")),_(s,"$eval",function(y){try{return A("eval_return"),this.expr.$eval(y)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),_(s,"$output",function(){return"("+this.expr.$output()+")"}),_(s,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(p[0]),function(l,b){var s=L(l,null,"Number");return s.$$prototype.value=x,_(s,"$initialize",P("value")),_(s,"$eval",z("value")),_(s,"$output",function(){return this.value.$to_s()}),M(s,"s_exp","output")}(p[0])},Opal.modules.strscan=function(e){var P,M,D,x,Y,L=e.def,_=e.truthy,A=e.eqeqeq,z=e.Opal,S=e.return_ivar,U=e.send,k=e.alias,q=[],N=e.nil;return P=q,D=[M=(0,e.klass)(q[0],null,"StringScanner")].concat(P),x=e.$r(D),(Y=M.$$prototype).pos=Y.string=Y.working=Y.matched=Y.prev_pos=Y.match=N,M.$attr_reader("pos","matched"),L(M,"$initialize",function(u){var m=this;return m.string=u,m.pos=0,m.matched=N,m.working=u,m.match=[]}),M.$attr_reader("string"),L(M,"$beginning_of_line?",function(){var u=this;return 0===u.pos||"\n"===u.string.charAt(u.pos-1)}),L(M,"$scan",function(u){var m=this,i=(u=m.$anchor(u)).exec(m.working);return null==i?m.matched=N:(m.prev_pos=m.pos,m.pos+=i[0].length,m.working=m.working.substring(i[0].length),m.matched=i[0],m.match=i,i[0])}),L(M,"$scan_until",function(u){var m=this;u=m.$anchor(u);for(var i=m.working,T=0;i.length!=T;++T){var r=u.exec(i.substr(T));if(null!==r){var c=T+r[0].length,v=i.substr(0,c);return m.matched=r[0],m.match=r,m.prev_pos=m.pos+T,m.pos+=c,m.working=i.substr(c),v}}return m.matched=N}),L(M,"$[]",function(u){var i;if(_(this.match["$empty?"]()))return N;A(x("Symbol"),i=u)?u=u.$to_s():A(x("String"),i)||(u=z["$coerce_to!"](u,x("Integer"),"to_int"));var T=this.match;return u<0&&(u+=T.length),u<0||u>=T.length||null==T[u]?N:T[u]}),L(M,"$check",function(u){var m=this,i=(u=m.$anchor(u)).exec(m.working);return m.matched=null==i?N:i[0]}),L(M,"$check_until",function(u){var m=this,i=m.prev_pos,T=m.pos,r=m.working,c=m.$scan_until(u);return m.prev_pos=i,m.pos=T,m.working=r,c}),L(M,"$peek",function(u){return this.working.substring(0,u)}),L(M,"$eos?",function(){return 0===this.working.length}),L(M,"$exist?",function(u){var i=u.exec(this.working);return null==i?N:0==i.index?0:i.index+1}),L(M,"$skip",function(u){var m=this,i=(u=m.$anchor(u)).exec(m.working);if(null==i)return m.match=[],m.matched=N;var T=i[0],r=T.length;return m.matched=T,m.match=i,m.prev_pos=m.pos,m.pos+=r,m.working=m.working.substring(r),r}),L(M,"$skip_until",function(u){var i=this.$scan_until(u);return i===N?N:(this.matched=i.substr(-1),i.length)}),L(M,"$get_byte",function(){var u=this,m=N;return u.pos<u.string.length?(u.prev_pos=u.pos,u.pos+=1,m=u.matched=u.working.substring(0,1),u.working=u.working.substring(1)):u.matched=N,m}),L(M,"$match?",function(u){var m=this,i=(u=m.$anchor(u)).exec(m.working);return null==i?N:(m.prev_pos=m.pos,i[0].length)}),L(M,"$pos=",function(u){var m=this;return u<0&&(u+=m.string.$length()),m.pos=u,m.working=m.string.slice(u)}),L(M,"$matched_size",function(){return this.matched===N?N:this.matched.length}),L(M,"$post_match",function(){var u=this;return u.matched===N?N:u.string.substr(u.pos)}),L(M,"$pre_match",function(){var u=this;return u.matched===N?N:u.string.substr(0,u.prev_pos)}),L(M,"$reset",function(){var u=this;return u.working=u.string,u.matched=N,u.pos=0}),L(M,"$rest",S("working")),L(M,"$rest?",function(){return 0!==this.working.length}),L(M,"$rest_size",function(){return this.$rest().$size()}),L(M,"$terminate",function(){var u,m=this;return m.match=N,u=[m.string.$length()],U(m,"pos=",u),u[u.length-1]}),L(M,"$unscan",function(){var u=this;return u.pos=u.prev_pos,u.prev_pos=N,u.match=N,u}),k(M,"bol?","beginning_of_line?"),k(M,"getch","get_byte"),M.$private(),L(M,"$anchor",function(u){var m=u.toString().match(/\/([^\/]+)$/);return m=m?m[1]:void 0,new RegExp("^(?:"+u.source+")",m)})},Opal.modules["bcdice/normalize"]=function(e){var k,j,N,H=e.module,L=e.eqeqeq,_=e.def,A=e.eqeq,z=[],S=e.nil;return k=z,N=[H(z[0],"BCDice")].concat(k),(j=H(N[0],"Normalize")).$module_function(),_(j,"$comparison_operator",function(M){var D;return L(/<=|=</,D=M)?"<=":L(/>=|=>/,D)?">=":L(/<>|!=|=!/,D)?"!=":L(/</,D)?"<":L(/>/,D)?">":L(/=/,D)?"==":S}),_(j,"$target_number",function(M){return A(M,"?")?M:M.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var P,Y,T,r,c,v,C,u,D,H=e.module,L=e.klass,_=e.const_set,A=e.hash2,z=e.truthy,S=e.send,U=e.def,k=e.thrower,q=e.top,N=[],F=e.nil;return q.$require("strscan"),q.$require("bcdice/normalize"),P=N,Y=D=[H(N[0],"BCDice")].concat(P),T=u=[H(D[0],"Command")].concat(Y),c=[r=L(u[0],null,"Lexer")].concat(T),v=e.$r(c),(C=r.$$prototype).scanner=C.notations=F,_(c[0],"SYMBOLS",A(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),U(r,"$initialize",function(I,p){var h,l,s;return I=z(s=(h=(l=I)===F||null==l?F:l.$split(" ",2))===F||null==h?F:h.$first())?s:"",this.scanner=v("StringScanner").$new(I),this.notations=S(p,"map",[],function($){return null==$&&($=F),z($["$is_a?"](v("String")))?v("Regexp").$new($):$})}),U(r,"$next_token",function(){try{var I=k("return"),p=this,h=F,l=F,s=F,o=F;return z(p.scanner["$eos?"]())?[!1,"$"]:(S(p.notations,"each",[],function $(y){var f,B=null==$.$$s?this:$.$$s;if(null==B.scanner&&(B.scanner=F),null==y&&(y=F),f=B.scanner.$scan(y),!z(f))return F;I.$throw(["NOTATION",f])},{$$s:p,$$ret:I}),z(h=p.scanner.$scan(/\d+/))?["NUMBER",h.$to_i()]:z(l=p.scanner.$scan(/[<>!=]+/))?(l=v("Normalize").$comparison_operator(l),[z(l)?"CMP_OP":"ILLEGAL",l]):(s=p.scanner.$getch().$upcase(),[z(o=v("SYMBOLS")["$[]"](s))?o:s.$to_sym(),s]))}catch($){if($===I)return $.$v;throw $}}),U(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var q,P,G,u,m,i,T,D,F,H=e.module,L=e.klass,_=e.def,A=e.return_ivar,z=e.truthy,S=[],U=e.nil;return q=S,P=F=[H(S[0],"BCDice")].concat(q),G=D=[H(F[0],"Command")].concat(P),m=[u=L(D[0],null,"Parsed")].concat(G),i=e.$r(m),(T=u.$$prototype).critical=T.fumble=T.dollar=T.modify_number=T.question_target=T.target_number=T.prefix_number=T.command=T.suffix_number=T.cmp_op=U,u.$attr_accessor("command"),u.$attr_accessor("prefix_number"),u.$attr_accessor("suffix_number"),u.$attr_accessor("critical"),u.$attr_accessor("fumble"),u.$attr_accessor("dollar"),u.$attr_accessor("modify_number"),u.$attr_accessor("cmp_op"),u.$attr_accessor("target_number"),u.$attr_writer("question_target"),_(u,"$initialize",function(){var c=this;return c.prefix_number=U,c.suffix_number=U,c.critical=U,c.fumble=U,c.dollar=U,c.cmp_op=U,c.target_number=U,c.question_target=!1}),_(u,"$question_target?",A("question_target")),_(u,"$to_s",function(c){var v=this,C=U,w=U,I=U,p=U,h=U;switch(null==c&&(c="after_command"),C=z(v.critical)?"@"+v.critical:U,w=z(v.fumble)?"#"+v.fumble:U,I=z(v.dollar)?"$"+v.dollar:U,p=i("Format").$modifier(v.modify_number),h=z(v.question_target)?"?":v.target_number,c.valueOf()){case"after_command":return[v.prefix_number,v.command,v.suffix_number,C,w,I,p,v.cmp_op,h].$join();case"after_modify_number":return[v.prefix_number,v.command,v.suffix_number,p,C,w,I,v.cmp_op,h].$join();case"after_target_number":return[v.prefix_number,v.command,v.suffix_number,p,v.cmp_op,h,C,w,I].$join();default:return U}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var c,I,o,R,n,d,a,W,Q,V,O,te,ue,$,f,t,se,h,l,C,H=e.klass,L=e.module,_=e.slice,A=e.extract_kwargs,z=e.ensure_kwargs,S=e.get_kwarg,U=e.send2,k=e.find_super,q=e.def,N=e.send,F=e.eqeq,j=e.thrower,P=e.hash,M=e.const_set,D=e.truthy,x=e.to_ary,Y=e.hash2,G=e.top,u=[],m=e.$r(u),i=e.nil,T=e.$$$;return G.$require("racc/parser.rb"),G.$require("bcdice/arithmetic/node"),G.$require("bcdice/command/lexer"),G.$require("bcdice/command/parsed"),H(T(m("BCDice"),"Command"),T(m("Racc"),"Parser"),"Parser"),c=u,I=C=[L(u[0],"BCDice")].concat(c),h=[L(C[0],"Command")].concat(I),l=e.$r(h),o=h,f=[$=H(h[0],T(l("Racc"),"Parser"),"Parser")].concat(o),t=e.$r(f),(se=$.$$prototype).notations=se.lexer=se.modifier=se.suffix_number=se.prefix_number=se.need_suffix_number=se.need_prefix_number=se.critical=se.fumble=se.dollar=se.allowed_cmp_op=se.question_target=i,q($,"$initialize",function K(g,Z){var X,E,ee,ie,J=this;return K.$$p=null,X=_(arguments),E=A(X),E=z(E),ee=X,ie=S(E,"round_type"),U(J,k(J,"initialize",K,!1,!0),"initialize",[],null),J.notations=ee,J.round_type=ie,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[i,">=",">","<=","<","==","!="],J.question_target=!1},-2),q($,"$disable_modifier",function(){return this.modifier=!1,this}),q($,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),q($,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),q($,"$has_prefix_number",function(){var g=this;return g.prefix_number=!0,g.need_prefix_number=!0,g}),q($,"$has_suffix_number",function(){var g=this;return g.suffix_number=!0,g.need_suffix_number=!0,g}),q($,"$enable_critical",function(){return this.critical=!0,this}),q($,"$enable_fumble",function(){return this.fumble=!0,this}),q($,"$enable_dollar",function(){return this.dollar=!0,this}),q($,"$restrict_cmp_op_to",function(g){var Z;return Z=_(arguments),this.allowed_cmp_op=Z,this},-1),q($,"$enable_question_target",function(){return this.question_target=!0,this}),q($,"$parse",function(g){var Z=this;try{return Z.lexer=t("Lexer").$new(g,Z.notations),Z.$do_parse()}catch(X){if(!e.rescue(X,[t("ParseError"),t("ZeroDivisionError")]))throw X;try{return i}finally{e.pop_exception()}}}),$.$private(),q($,"$parsed",function(g,Z,X,E){try{return j("eval_return"),N(t("Parsed").$new(),"tap",[],function re(J){var ce,le,de,me,ve,fe,be,oe=null==re.$$s?this:re.$$s;return null==oe.round_type&&(oe.round_type=i),null==J&&(J=i),J["$command="](g["$[]"]("command")),J["$prefix_number="]((ce=g["$[]"]("prefix"))===i||null==ce?i:ce.$eval(oe.round_type)),J["$suffix_number="]((le=g["$[]"]("suffix"))===i||null==le?i:le.$eval(oe.round_type)),J["$critical="]((de=Z["$[]"]("critical"))===i||null==de?i:de.$eval(oe.round_type)),J["$fumble="]((me=Z["$[]"]("fumble"))===i||null==me?i:me.$eval(oe.round_type)),J["$dollar="]((ve=Z["$[]"]("dollar"))===i||null==ve?i:ve.$eval(oe.round_type)),J["$modify_number="](X.$eval(oe.round_type)),J["$cmp_op="](E["$[]"]("cmp_op")),F(E["$[]"]("target"),"?")?(J["$question_target="](!0),N(J,"target_number=",fe=[0]),fe[fe.length-1]):(J["$question_target="](!1),fe=[(be=E["$[]"]("target"),be===i||null==be?i:be.$eval(oe.round_type))],N(J,"target_number=",fe),fe[fe.length-1])},{$$s:this})}catch(re){if(re===e.t_eval_return)return re.$v;throw re}}),q($,"$next_token",function(){return this.lexer.$next_token()}),R=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),n=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),d=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),a=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),W=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),Q=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),V=[i,6,13,3,9,-1,27,-15,-10,-1,-38],O=[i,i,i,i,i,i,19,16,15,i,i],te=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ue=P(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),M(f[0],"Racc_arg",[R,n,a,d,W,Q,O,V,19,te,ue,58,35,!0]),D(t("Ractor","skip_raise")?"constant":i)&&t("Ractor").$make_shareable(t("Racc_arg")),M(f[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),D(t("Ractor","skip_raise")?"constant":i)&&t("Ractor").$make_shareable(t("Racc_token_to_s_table")),M(f[0],"Racc_debug_parser",!1),q($,"$_reduce_1",function(g,Z,X){var E;return D(this.modifier)||this.$raise(t("ParseError")),E=x(g),this.$parsed(null==E[0]?i:E[0],null==E[1]?i:E[1],null==E[2]?i:E[2],null==E[3]?i:E[3])}),q($,"$_reduce_2",function(g,Z,X){var E;return D(this.modifier)||this.$raise(t("ParseError")),E=x(g),this.$parsed(null==E[0]?i:E[0],null==E[2]?i:E[2],null==E[1]?i:E[1],null==E[3]?i:E[3])}),q($,"$_reduce_3",function(g,Z,X){var E,ce;return ce=null==(E=x(g))[2]?i:E[2],this.$parsed(null==E[0]?i:E[0],null==E[1]?i:E[1],T(T(t("Arithmetic"),"Node"),"Number").$new(0),ce)}),q($,"$_reduce_4",function(g,Z,X){var E=this;return D(E.prefix_number)&&D(E.suffix_number)||E.$raise(t("ParseError")),Y(["command","prefix","suffix"],{command:g["$[]"](1),prefix:g["$[]"](0),suffix:g["$[]"](2)})}),q($,"$_reduce_5",function(g,Z,X){var E=this;return D(E.prefix_number)||E.$raise(t("ParseError")),D(E.need_suffix_number)&&E.$raise(t("ParseError")),Y(["command","prefix"],{command:g["$[]"](1),prefix:g["$[]"](0)})}),q($,"$_reduce_6",function(g,Z,X){var E=this;return D(E.suffix_number)||E.$raise(t("ParseError")),D(E.need_prefix_number)&&E.$raise(t("ParseError")),Y(["command","suffix"],{command:g["$[]"](0),suffix:g["$[]"](1)})}),q($,"$_reduce_7",function(g,Z,X){var E=this;return(D(E.need_prefix_number)||D(E.need_suffix_number))&&E.$raise(t("ParseError")),Y(["command"],{command:g["$[]"](0)})}),q($,"$_reduce_8",function(g,Z,X){return Y([],{})}),q($,"$_reduce_9",function(g,Z,X){var E,ce,re=i;return re=null==(E=x(g))[0]?i:E[0],ce=null==E[2]?i:E[2],D(this.critical)&&D(re["$[]"]("critical")["$nil?"]())||this.$raise(t("ParseError")),re["$[]="]("critical",ce),re}),q($,"$_reduce_10",function(g,Z,X){var E,ce,re=i;return re=null==(E=x(g))[0]?i:E[0],ce=null==E[2]?i:E[2],D(this.fumble)&&D(re["$[]"]("fumble")["$nil?"]())||this.$raise(t("ParseError")),re["$[]="]("fumble",ce),re}),q($,"$_reduce_11",function(g,Z,X){var E,ce,re=i;return re=null==(E=x(g))[0]?i:E[0],ce=null==E[2]?i:E[2],D(this.dollar)&&D(re["$[]"]("dollar")["$nil?"]())||this.$raise(t("ParseError")),re["$[]="]("dollar",ce),re}),q($,"$_reduce_12",function(g,Z,X){return g["$[]"](1)}),q($,"$_reduce_13",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"Negative").$new(g["$[]"](1))}),q($,"$_reduce_14",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"+",g["$[]"](2))}),q($,"$_reduce_15",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"-",g["$[]"](2))}),q($,"$_reduce_16",function(g,Z,X){return D(this.allowed_cmp_op["$include?"](i))||this.$raise(t("ParseError")),Y([],{})}),q($,"$_reduce_17",function(g,Z,X){var E,re,J;return J=null==(E=x(g))[1]?i:E[1],D(this.allowed_cmp_op["$include?"](re=null==E[0]?i:E[0]))||this.$raise(t("ParseError")),Y(["cmp_op","target"],{cmp_op:re,target:J})}),q($,"$_reduce_18",function(g,Z,X){var ee,E=this;return ee=g["$[]"](0),D(E.question_target)||E.$raise(t("ParseError")),D(E.allowed_cmp_op["$include?"](ee))||E.$raise(t("ParseError")),Y(["cmp_op","target"],{cmp_op:ee,target:"?"})}),q($,"$_reduce_19",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"+",g["$[]"](2))}),q($,"$_reduce_20",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"-",g["$[]"](2))}),q($,"$_reduce_22",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"*",g["$[]"](2))}),q($,"$_reduce_23",function(g,Z,X){return g["$[]"](3).$new(g["$[]"](0),g["$[]"](2))}),q($,"$_reduce_25",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),q($,"$_reduce_26",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"DivideWithCeil")}),q($,"$_reduce_27",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"DivideWithCeil")}),q($,"$_reduce_28",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"DivideWithRound")}),q($,"$_reduce_29",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"DivideWithFloor")}),q($,"$_reduce_30",function(g,Z,X){return g["$[]"](1)}),q($,"$_reduce_31",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"Negative").$new(g["$[]"](1))}),q($,"$_reduce_33",function(g,Z,X){return g["$[]"](1)}),q($,"$_reduce_34",function(g,Z,X){return T(T(t("Arithmetic"),"Node"),"Number").$new(g["$[]"](0))}),q($,"$_reduce_none",function(g,Z,X){return g["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var N,M,G,u,m,i,x,j,H=e.module,L=e.send,_=e.eqeqeq,A=e.truthy,z=e.def,S=e.return_val,U=[],k=e.nil;return N=U,M=j=[H(U[0],"BCDice")].concat(N),G=x=[H(j[0],"Deprecated")].concat(M),m=[u=H(x[0],"Checker")].concat(G),i=e.$r(m),u.$private(),z(u,"$check_result_legacy",function(r,c,v,C){var h,w=this,I=k,p=k,l=k,b=k;return I=L(c,"map",[],"sides".$to_proc()),h=(p=L(c,"map",[],"value".$to_proc())).$sum(),l=_([100],b=I)?w.$check_1D100(r,h,v,C):_([20],b)?w.$check_1D20(r,h,v,C):_([6,6],b)?w.$check_2D6(r,h,p,v,C):k,(A(l["$nil?"]())||A(l["$empty?"]()))&&(l=_([10],b=I.$uniq())?w.$check_nD10(r,h,p,v,C):_([6],b)?w.$check_nD6(r,h,p,v,C):k,A(l["$nil?"]())||A(l["$empty?"]()))?k:i("Result").$new(l.$delete_prefix(" \uff1e "))}),z(u,"$check_1D100",S(k)),z(u,"$check_1D20",S(k)),z(u,"$check_nD10",S(k)),z(u,"$check_2D6",S(k)),z(u,"$check_nD6",S(k))},Opal.modules["bcdice/base"]=function(e){var m,w,b,B,t,R,s,o,$,y,p,H=e.module,L=e.klass,_=e.slice,A=e.rb_plus,z=e.truthy,S=e.def,U=e.regexp,k=e.send,q=e.thrower,N=e.return_ivar,F=e.assign_ivar_val,j=e.eqeqeq,P=e.eqeq,M=e.return_val,D=e.range,x=e.rb_minus,Y=e.rb_divide,G=e.rb_times,u=e.rb_ge,i=e.top,T=[],r=e.$r(T),c=e.nil,v=e.$$$;return i.$require("i18n"),i.$require("i18n/backend/fallbacks"),i.$require("bcdice/randomizer"),i.$require("bcdice/dice_table"),i.$require("bcdice/enum"),i.$require("bcdice/translate"),i.$require("bcdice/result"),i.$require("bcdice/command/parser"),i.$require("bcdice/deprecated/checker"),w=T,b=p=[H(T[0],"BCDice")].concat(w),o=[s=L(p[0],null,"Base")].concat(b),$=e.$r(o),(y=s.$$prototype).raw_input=y.randomizer=y.enabled_upcase_input=y.debug=c,t=[B=e.get_singleton_class(s)].concat(o),R=e.$r(t),B.$attr_reader("prefixes"),S(B,"$register_prefix",function(d){var W,V,Q=this;return null==Q.prefixes&&(Q.prefixes=c),W=_(arguments),Q.prefixes=A(z(V=Q.prefixes)?V:[],W.$flatten())},-1),S(B,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),S(B,"$prefixes_pattern",function(){var d=this,a=c;return null==d.prefixes_pattern&&(d.prefixes_pattern=c),null==d.prefixes&&(d.prefixes=c),d.prefixes_pattern=z(a=d.prefixes_pattern)?a:c,z(d.prefixes_pattern)?d.prefixes_pattern:(d.prefixes=z(a=d.prefixes)?a:[],d.prefixes.$freeze(),d.prefixes_pattern=(z(d.prefixes["$empty?"]())?/(?!)/:U(["^(S)?(",d.prefixes.$join("|"),")"],"i")).$freeze())}),S(B,"$command_pattern",function(){var d=this,a=c,W=c;return null==d.command_pattern&&(d.command_pattern=c),null==d.prefixes&&(d.prefixes=c),d.command_pattern=z(a=d.command_pattern)?a:c,z(d.command_pattern)?d.command_pattern:(d.prefixes=z(a=d.prefixes)?a:[],d.prefixes.$freeze(),W=A(k(v(R("CommonCommand"),"COMMANDS"),"map",[],function(V){return null==V&&(V=c),v(V,"PREFIX_PATTERN").$source()}),d.prefixes),d.command_pattern=U(["^S?(",W.$join("|"),")"],"i").$freeze())}),S(B,"$eval",function(d){try{return q("eval_return"),this.$new(d).$eval()}catch(Q){if(Q===e.t_eval_return)return Q.$v;throw Q}}),s.$include($("Translate")),s.$include(v($("Deprecated"),"Checker")),S(s,"$initialize",function(f){var t=this;return t.raw_input=f,t.sort_add_dice=!1,t.sort_barabara_dice=!1,t.d66_sort_type=v($("D66SortType"),"NO_SORT"),t.enabled_d9=!1,t.round_type=v($("RoundType"),"FLOOR"),t.sides_implicit_d=6,t.upper_dice_reroll_threshold=c,t.reroll_dice_reroll_threshold=c,t.default_cmp_op=c,t.default_target_number=c,t.enabled_upcase_input=!0,t.locale="ja_jp",t.randomizer=v($("BCDice"),"Randomizer").$new(),t.debug=!1}),s.$attr_accessor("randomizer"),s.$attr_reader("d66_sort_type"),s.$attr_reader("round_type"),s.$attr_reader("sides_implicit_d"),s.$attr_reader("upper_dice_reroll_threshold"),s.$attr_reader("reroll_dice_reroll_threshold"),s.$attr_reader("default_cmp_op"),s.$attr_reader("default_target_number"),S(s,"$sort_add_dice?",N("sort_add_dice")),S(s,"$sort_barabara_dice?",N("sort_barabara_dice")),S(s,"$enabled_d9?",N("enabled_d9")),S(s,"$enable_debug",F("debug",!0)),S(s,"$eval",function(){var t,n,f=this,R=c;return t=v($("BCDice"),"Preprocessor").$process(f.raw_input,f),R=z(n=f.$dice_command(t))?n:f.$eval_common_command(f.raw_input),z(R)?(R["$rands="](f.randomizer.$rand_results()),R["$detailed_rands="](f.randomizer.$detailed_rand_results()),R):c}),S(s,"$change_text",function(f){return f}),S(s,"$check_result",function(f,t,R,n){var d=this,a=c,W=c,Q=c,V=c,O=c;return a=d.$check_result_legacy(f,t,R,n),z(a)?a:(W=k(t,"map",[],"sides".$to_proc()),V=(Q=k(t,"map",[],"value".$to_proc())).$sum(),a=j([100],O=W)?d.$result_1d100(f,V,R,n):j([20],O)?d.$result_1d20(f,V,R,n):j([6,6],O)?d.$result_2d6(f,V,Q,R,n):c,P(a,$("Result").$nothing())?c:z(a)?a:(a=j([10],O=W.$uniq())?d.$result_nd10(f,V,Q,R,n):j([6],O)?d.$result_nd6(f,V,Q,R,n):c,P(a,$("Result").$nothing())?c:z(a)?a:d.$result_ndx(f,R,n)))}),S(s,"$grich_text",M(c)),s.$private(),S(s,"$eval_common_command",function(f){try{q("eval_return");var R=q("return");return f=this.$change_text(f),k(v($("CommonCommand"),"COMMANDS"),"each",[],function d(a){var Q,W=null==d.$$s?this:d.$$s;if(null==W.randomizer&&(W.randomizer=c),null==a&&(a=c),Q=a.$eval(f,W,W.randomizer),!z(Q))return c;R.$throw(Q)},{$$s:this,$$ret:R}),c}catch(d){if(d===e.t_eval_return||d===R)return d.$v;throw d}}),S(s,"$dice_command",function(f){var t=this,R=c,n=c,d=c,a=c;return z(t.enabled_upcase_input)&&(f=f.$upcase()),R=t.$class().$prefixes_pattern().$match(f),z(R)?(n=R["$[]"](1)["$nil?"]()["$!"](),z(n)&&(f=f["$[]"](D(1,-1,!1))),d=t.$eval_game_system_specific_command(f),z(d["$is_a?"]($("Result")))?(d["$secret="](z(a=d["$secret?"]())?a:n),d):z(d["$nil?"]())||z(d["$empty?"]())||P(d,"1")?c:k($("Result").$new(),"tap",[],function(Q){var V;return null==Q&&(Q=c),Q["$text="](d.$to_s()),k(Q,"secret=",V=[n]),V[V.length-1]})):c}),S(s,"$eval_game_system_specific_command",M(c)),S(s,"$result_ndx",function(f,t,R){return z(R["$is_a?"]($("String")))?c:z(f.$send(t,R))?$("Result").$success(this.$translate("success")):$("Result").$failure(this.$translate("failure"))}),S(s,"$result_1d100",M(c)),S(s,"$result_1d20",M(c)),S(s,"$result_nd10",M(c)),S(s,"$result_2d6",M(c)),S(s,"$result_nd6",M(c)),S(s,"$get_table_by_2d6",function(f){return this.$get_table_by_nD6(f,2)}),S(s,"$get_table_by_1d6",function(f){return this.$get_table_by_nD6(f,1)}),S(s,"$get_table_by_nD6",function(f,t){return this.$get_table_by_nDx(f,t,6)}),S(s,"$get_table_by_nDx",function(f,t,R){var d,a=c;return d=this.randomizer.$roll_sum(t,R),a=this.$get_table_value(f["$[]"](x(d,t))),z(a["$nil?"]())?["1",0]:[a,d]}),S(s,"$get_table_by_1d3",function(f){var n,d,t=this,a=c;return t.$debug("get_table_by_1d3"),n=t.randomizer.$roll_sum(1,6),t.$debug("num",n),d=Y(x(n,1),2).$to_i(),t.$debug("index",d),a=f["$[]"](d),z(a["$nil?"]())?["1",0]:[a,n]}),S(s,"$get_table_by_d66_swap",function(f){var R;return R=this.randomizer.$roll_d66(v($("D66SortType"),"ASC")),[this.$get_table_by_number(R,f),R]}),S(s,"$get_table_by_d66",function(f){var R,n,d,W,a=c;return R=this.randomizer.$roll_once(6),n=this.randomizer.$roll_once(6),d=A(G(x(R,1),6),x(n,1)),a=f["$[]"](d),W=""+R+n,z(a["$nil?"]())?["1",W]:[a,W]}),S(s,"$get_table_by_number",function(f,t,R){try{var n=q("return");return null==R&&(R="1"),k(t,"each",[],function a(W){var V,Q=null==a.$$s?this:a.$$s;if(null==W&&(W=c),V=W["$[]"](0),!z(u(V,f)))return c;n.$throw(Q.$get_table_value(W["$[]"](1)))},{$$s:this,$$ret:n}),this.$get_table_value(R)}catch(a){if(a===n)return a.$v;throw a}},-3),S(s,"$get_table_value",function(f){return z(f["$is_a?"]($("Proc")))?f.$call():f}),S(s,"$roll_tables",function(f,t){var n=c;return n=t["$[]"](f),z(n)?n.$roll(this.randomizer).$to_s():c}),S(s,"$debug",function(f,t){var n,d=this,a=c,W=c;return n=_(arguments,1),z(d.debug)?(a=z(f["$is_a?"]($("String")))?f:f.$inspect(),z(n["$empty?"]())?d.$warn(a):(W=k(n,"map",[],function(V){return null==V&&(V=c),z(V["$is_a?"]($("String")))?'"'+V+'"':V.$inspect()}),d.$warn(a+": "+W.$join(", ")))):c},-2),v(v(r("I18n"),"Backend"),"Simple").$include(v(v(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),m=[["ja_jp"]],k(r("I18n").$fallbacks(),"defaults=",m),m[m.length-1]},Opal.queue(function(e){var G,T,I,p,h,l,c,v,m,H=e.module,L=e.klass,_=e.const_set,A=e.hash2,z=e.send2,S=e.find_super,U=e.def,k=e.truthy,q=e.send,N=e.rb_ge,F=e.rb_gt,j=e.rb_plus,M=[],D=e.nil,x=e.$$$;return e.top.$require("bcdice/base"),G=M,T=m=[H(M[0],"BCDice")].concat(G),c=[H(m[0],"GameSystem")].concat(T),v=e.$r(c),I=c,h=[p=L(c[0],v("Base"),"ConvictorDrive")].concat(I),l=e.$r(h),p.$$prototype.randomizer=D,_(h[0],"ID","ConvictorDrive"),_(h[0],"NAME","\u30b3\u30f3\u30f4\u30a3\u30af\u30bf\u30fc\u30fb\u30c9\u30e9\u30a4\u30d6"),_(h[0],"SORT_KEY","\u3053\u3093\u3046\u3044\u304f\u305f\u3042\u3068\u3089\u3044\u3075"),_(h[0],"HELP_MESSAGE","xCD@z>=y: x\u500b\u306e10\u9762\u30c0\u30a4\u30b9\u3067\u76ee\u6a19\u5024y\uff08\u7701\u7565\u66425\uff09\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30e9\u30a4\u30f3z\uff08\u7701\u7565\u664210\uff09\u306e\u5224\u5b9a\u3092\u884c\u3046\u3002\nSLT: \u6280\u80fd\u30ec\u30d9\u30eb\u8868\u3092\u632f\u308b\nDCT: \u9045\u5ef6\u30a4\u30d9\u30f3\u30c8\u8868\u3092\u632f\u308b\n"),_(h[0],"TABLES",A(["SLT","DCT"],{SLT:x(l("DiceTable"),"Table").$new("\u6280\u80fd\u30e9\u30f3\u30af\u8868","2D10",["\u30e9\u30f3\u30af\u5916","E-","E","E+","D-","D","D+","C-","C","C+","B-","B","B+","A-","A","A+","S-","S","S+"]),DCT:x(l("DiceTable"),"Table").$new("\u9045\u5ef6\u30a4\u30d9\u30f3\u30c8\u8868","1D10",["\u72b6\u6cc1\u9045\u5ef6\u2160\uff08\u5168\u54e1\u306e\u521d\u671f\u30ea\u30bd\u30fc\u30b9\u3092-1\u3059\u308b\uff09","\u72b6\u6cc1\u9045\u5ef6\u2161\uff08\u5168\u54e1\u306e\u521d\u671f\u30ea\u30bd\u30fc\u30b9\u3092-1\u3059\u308b\uff09","\u72b6\u6cc1\u9045\u5ef6\u2162\uff08\u5168\u54e1\u306e\u521d\u671f\u30ea\u30bd\u30fc\u30b9\u3092-2\u3059\u308b\uff09","\u6b66\u88c5\u3092\u8a31\u3059\u2160\uff08\u30dc\u30b9\u306e\u653b\u6483\u30c0\u30a4\u30b9\u3092+1d\u3059\u308b\uff09","\u6b66\u88c5\u3092\u8a31\u3059\u2161\uff08\u8105\u5a01\u5ea64\u4ee5\u4e0b\u306e\u30a8\u30cd\u30df\u30fc\u306e\u653b\u6483\u30c0\u30a4\u30b9\u30922\u4f53\u307e\u3067+1d\u3059\u308b\uff09","\u6b66\u88c5\u3092\u8a31\u3059\u2162\uff08\u8105\u5a01\u5ea63\u4ee5\u4e0b\u306e\u30a8\u30cd\u30df\u30fc\u306e\u653b\u6483\u30c0\u30a4\u30b9\u30921\u4f53+2d\u3059\u308b\uff09","\u7dca\u6025\u51fa\u6483\u2160\uff08\u30e9\u30f3\u30c0\u30e0\u306aPC\u306eHP\u3092-1\u3059\u308b\uff09","\u7dca\u6025\u51fa\u6483\u2161\uff08\u30e9\u30f3\u30c0\u30e0\u306aPC\u306eHP\u3092-1\u3059\u308b\uff09","\u7dca\u6025\u51fa\u6483\u2162\uff08\u30e9\u30f3\u30c0\u30e0\u306aPC2\u4eba\u306eHP\u3092-1\u3059\u308b\uff09","\u7d76\u671b\uff08\u30c0\u30a4\u30b9\u3092\u4e8c\u5ea6\u632f\u308a\u3001\u4e8c\u3064\u9069\u7528\u3059\u308b\uff09"])}).$freeze()),p.$register_prefix("[-+*0-9()]*CD",l("TABLES").$keys()),U(p,"$initialize",function s(o){var y=this;return s.$$p=null,z(y,S(y,"initialize",s,!1,!0),"initialize",[o],null),y.sides_implicit_d=10}),U(p,"$eval_game_system_specific_command",function(o){var y,$=this;return $.$debug("eval_game_system_specific_command Begin"),k(y=$.$roll_command(o))?y:$.$roll_tables(o,l("TABLES"))}),U(p,"$roll_command",function(o){var $,f=D,t=D,R=D,n=D,d=D,a=D,W=D,Q=D;return f=x(l("Command"),"Parser").$new("CD",A(["round_type"],{round_type:this.$round_type()})).$has_prefix_number().$enable_critical().$restrict_cmp_op_to(">=",D).$parse(o),k(f)?(t=this.randomizer.$roll_barabara(f.$prefix_number(),10),R=k(n=f.$target_number())?n:5,d=k(n=($=f.$critical())===D||null==$?D:$.$clamp(R,10))?n:10,a=q(t,"count",[],function(O){return null==O&&(O=D),N(O,R)}),W=q(t,"count",[],function(O){return null==O&&(O=D),N(O,d)}),Q=[f.$to_s(),t.$join(","),k(F(W,0))?"\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u6570"+W:D,"\u6210\u529f\u6570"+j(a,W)].$compact().$join(" \uff1e "),q(l("Result").$new(),"tap",[],function(O){var te;return null==O&&(O=D),O["$success="](F(a,0)),O["$critical="](F(W,0)),q(O,"text=",te=[Q]),te[te.length-1]})):D})})}}]);