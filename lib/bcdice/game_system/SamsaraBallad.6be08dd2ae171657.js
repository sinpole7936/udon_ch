(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[1751],{4946:(ge,pe,he)=>{he(5151),Opal.modules["i18n/backend/fallbacks"]=function(e){var G,$,t,c,u,m,F=e.module,L=e.class_variable_set,_=e.truthy,B=e.class_variable_get,w=e.def,T=e.send,M=e.send2,R=e.find_super,E=e.hash2,N=e.find_block_super,H=e.neqeq,j=e.thrower,P=e.return_val,U=[],A=e.nil,b=e.$$$;return G=U,m=[u=F(U[0],"I18n")].concat(G),L(m[0],"@@fallbacks",A),$=e.get_singleton_class(u),t=[$].concat(m),c=e.$r(t),w($,"$fallbacks",function(){var D=A;return L(t[1],"@@fallbacks",_(null!=t[1].$$cvars["@@fallbacks"]?"class variable":A)&&_(D=B(t[1],"@@fallbacks",!1))?D:b(b(c("I18n"),"Locale"),"Fallbacks").$new()),_(D=c("Thread").$current()["$[]"]("i18n_fallbacks"))?D:B(t[1],"@@fallbacks",!1)}),w($,"$fallbacks=",function(I){var D;return L(t[1],"@@fallbacks",_(I["$is_a?"](c("Array")))?b(b(c("I18n"),"Locale"),"Fallbacks").$new(I):I),D=["i18n_fallbacks",B(t[1],"@@fallbacks",!1)],T(c("Thread").$current(),"[]=",D),D[D.length-1]}),function($,q){var I,D,C,x,c=[F($,"Backend")].concat(q);return I=c,C=[D=F(c[0],"Fallbacks")].concat(I),x=e.$r(C),w(D,"$translate",function p(l,v,s){try{var d=j("return"),i=p.$$p||A,y=this,z=A,o=A;return p.$$p=null,null==s&&(s=x("EMPTY_HASH")),_(s.$fetch("fallback",!0))?_(s["$[]"]("fallback_in_progress"))?M(y,R(y,"translate",p,!1,!0),"translate",[l,v,s],i):(_(s["$[]"]("default"))&&(z=y["$extract_non_symbol_default!"](s)),o=s.$merge(E(["fallback_in_progress"],{fallback_in_progress:!0})),T(x("I18n").$fallbacks()["$[]"](l),"each",[],function r(g){var n=null==r.$$s?this:r.$$s;null==g&&(g=A);try{return T(n,"catch",["exception"],function f(){var a=null==f.$$s?this:f.$$s,W=A;if(W=M(a,N(a,"translate",f.$$def||r.$$def||p,!1,!1),"translate",[g,v,o],null),_(W["$nil?"]()))return A;H(l.$to_s(),g.$to_s())&&a.$on_fallback(l,g,v,s),d.$throw(W)},{$$s:n,$$ret:d})}catch(f){if(!e.rescue(f,[b(x("I18n"),"InvalidLocale")]))throw f;try{return A}finally{e.pop_exception()}}},{$$s:y}),_(s["$key?"]("default"))&&_(s["$[]"]("default")["$nil?"]())?A:_(z)?M(y,R(y,"translate",p,!1,!0),"translate",[l,A,s.$merge(E(["default"],{default:z}))],null):y.$throw("exception",b(x("I18n"),"MissingTranslation").$new(l,v,s))):M(y,R(y,"translate",p,!1,!0),"translate",[l,v,s],i)}catch(r){if(r===d)return r.$v;throw r}},-3),w(D,"$extract_non_symbol_default!",function(l){var s,v=A;return v=[l["$[]"]("default")].$flatten(),s=T(v,"detect",[],function(i){return null==i&&(i=A),i["$is_a?"](x("Symbol"))["$!"]()}),_(s)&&l["$[]="]("default",v["$[]"](0,v.$index(s))),s}),w(D,"$exists?",function p(l,v,s){try{var d=j("return"),i=p.$$p||A,y=this;return p.$$p=null,null==s&&(s=x("EMPTY_HASH")),_(s.$fetch("fallback",!0))?(T(x("I18n").$fallbacks()["$[]"](l),"each",[],function z(o){var r=null==z.$$s?this:z.$$s;null==o&&(o=A);try{if(!_(M(r,N(r,"exists?",z.$$def||p,!1,!1),"exists?",[o,v],null)))return A;d.$throw(!0)}catch(g){if(!e.rescue(g,[b(x("I18n"),"InvalidLocale")]))throw g;try{return A}finally{e.pop_exception()}}},{$$s:y,$$ret:d}),!1):M(y,R(y,"exists?",p,!1,!0),"exists?",[l,v,s],i)}catch(z){if(z===d)return z.$v;throw z}},-3),D.$private(),w(D,"$on_fallback",P(A))}(m[0],m)},Opal.modules["bcdice/randomizer"]=function(e){var u,h,I,D,C,x,$,q,L=e.klass,_=e.const_set,B=e.def,w=e.truthy,T=e.rb_gt,M=e.rb_plus,R=e.rb_le,E=e.send,N=e.rb_minus,H=e.eqeq,j=e.rb_times,P=e.eqeqeq,U=e.rb_ge,A=[],b=e.nil,Y=e.$$$;return u=A,$=[(0,e.module)(A[0],"BCDice")].concat(u),q=e.$r($),h=$,D=[I=L($[0],null,"Randomizer")].concat(h),C=e.$r(D),(x=I.$$prototype).rand_results=x.detailed_rand_results=b,_(D[0],"UPPER_LIMIT_DICE_TIMES",200),_(D[0],"UPPER_LIMIT_DICE_SIDES",1e4),_(D[0],"UPPER_LIMIT_RANDS",1e4),B(I,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),I.$attr_reader("rand_results"),I.$attr_reader("detailed_rand_results"),_(D[0],"DetailedRandResult",C("Struct").$new("kind","sides","value")),B(I,"$roll_barabara",function(l,v){var s=this;return w(T(M(s.rand_results.$size(),l),C("UPPER_LIMIT_RANDS")))&&s.$raise(C("TooManyRandsError")),w(R(l,0))||w(T(l,C("UPPER_LIMIT_DICE_TIMES")))?[]:E(C("Array"),"new",[l],function d(){return(null==d.$$s?this:d.$$s).$roll_once(v)},{$$s:s})}),B(I,"$roll_sum",function(l,v){return this.$roll_barabara(l,v).$sum()}),B(I,"$roll_once",function(l){var s=b;return w(R(l,0))||w(T(l,C("UPPER_LIMIT_DICE_SIDES")))?0:(s=this.$rand_inner(l),this.$push_to_detail("normal",l,s),s)}),B(I,"$roll_index",function(l){return N(this.$roll_once(l),1)}),B(I,"$roll_tens_d10",function(){var s,v=b;return v=this.$rand_inner(10),H(v,10)&&(v=0),s=j(v,10),this.$push_to_detail("tens_d10",10,s),s}),B(I,"$roll_d9",function(){var v;return v=N(this.$rand_inner(10),1),this.$push_to_detail("d9",10,v),v}),B(I,"$roll_d66",function(l){var d,s=b;return s=E(C("Array"),"new",[2],function i(){return(null==i.$$s?this:i.$$s).$roll_once(6)},{$$s:this}),P(Y(C("D66SortType"),"ASC"),d=l)?s["$sort!"]():P(Y(C("D66SortType"),"DESC"),d)&&s["$sort!"]()["$reverse!"](),M(j(s["$[]"](0),10),s["$[]"](1))}),I.$private(),B(I,"$rand_inner",function(l){var s,v=this;return w(U(v.rand_results.$size(),C("UPPER_LIMIT_RANDS")))&&v.$raise(C("TooManyRandsError")),s=v.$random(l),v.rand_results["$<<"]([s,l]),s}),B(I,"$random",function(l){return M(C("Kernel").$rand(l),1)}),B(I,"$push_to_detail",function(l,v,s){var i;return i=C("DetailedRandResult").$new(l,v,s),this.detailed_rand_results.$push(i)}),L($[0],q("StandardError"),"TooManyRandsError"),b},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var E,P,G,u,m,$,q,A,H,F=e.module,L=e.klass,_=e.def,B=e.truthy,w=e.return_val,T=[],M=e.nil;return E=T,P=H=[F(T[0],"BCDice")].concat(E),G=A=[F(H[0],"DiceTable")].concat(P),m=[u=L(A[0],null,"RollResult")].concat(G),$=e.$r(m),(q=u.$$prototype).table_name=q.value=q.body=M,_(u,"$initialize",function(c,h,I){var D=this;return D.table_name=c,D.value=h,D.body=I}),u.$attr_reader("table_name"),u.$attr_reader("value"),u.$attr_reader("body"),_(u,"$to_s",function(){var c=this;return c.table_name+"("+c.value+") \uff1e "+c.body}),_(u,"$last_body",function(){var c=this;return B(c.body["$is_a?"]($("RollResult")))?c.body.$last_body():c.body}),_(u,"$empty?",w(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var E,P,G,u,m,$,q,A,H,F=e.module,L=e.klass,_=e.truthy,B=e.def,w=e.rb_minus,T=[],M=e.nil;return E=T,P=H=[F(T[0],"BCDice")].concat(E),G=A=[F(H[0],"DiceTable")].concat(P),m=[u=L(A[0],null,"ChainTable")].concat(G),$=e.$r(m),(q=u.$$prototype).times=q.sides=q.items=q.name=M,B(u,"$initialize",function(c,h,I){var D=this,C=M;return D.name=c,D.items=I.$freeze(),C=/(\d+)D(\d+)/i.$match(h),_(C)||D.$raise($("ArgumentError"),"Unexpected table type: "+h),D.times=C["$[]"](1).$to_i(),D.sides=C["$[]"](2).$to_i()}),B(u,"$roll",function(c){var I,D,h=this,C=M;return I=c.$roll_sum(h.times,h.sides),D=w(I,h.times),C=h.items["$[]"](D),_(C["$respond_to?"]("roll"))&&(C=C.$roll(c)),$("RollResult").$new(h.name,I,C)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var j,b,$,q,t,c,h,G,U,F=e.module,L=e.klass,_=e.hash2,B=e.defs,w=e.def,T=e.rb_plus,M=e.rb_times,R=e.rb_minus,E=[],N=e.nil;return j=E,b=U=[F(E[0],"BCDice")].concat(j),$=G=[F(U[0],"DiceTable")].concat(b),t=[q=L(G[0],null,"D66GridTable")].concat($),c=e.$r(t),(h=q.$$prototype).name=h.items=N,B(q,"$from_i18n",function(D,C){var p=N;return p=c("I18n").$t(D,_(["locale","raise"],{locale:C,raise:!0})),this.$new(p["$[]"]("name"),p["$[]"]("items"))}),w(q,"$initialize",function(D,C){return this.name=D,this.items=C.$freeze()}),w(q,"$roll",function(D){var x,p,l,v,s;return x=D.$roll_once(6),p=D.$roll_once(6),l=T(M(x,10),p),v=R(x,1),s=R(p,1),c("RollResult").$new(this.name,l,this.items["$[]"](v)["$[]"](s))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var N,U,m,$,q,t,b,Y,j,F=e.module,L=e.klass,_=e.hash2,B=e.defs,w=e.def,M=[],R=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),N=M,U=j=[F(M[0],"BCDice")].concat(N),b=[F(j[0],"DiceTable")].concat(U),Y=e.$r(b),m=b,q=[$=L(b[0],Y("D66GridTable"),"D66HalfGridTable")].concat(m),t=e.$r(q),B($,"$from_i18n",function(h,I){var C=R;return C=t("I18n").$t(h,_(["locale","raise"],{locale:I,raise:!0})),this.$new(C["$[]"]("name"),C["$[]"]("items_1_2_3"),C["$[]"]("items_4_5_6"))}),w($,"$initialize",function(h,I,D){return this.name=h,this.items=[I,I,I,D,D,D].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var N,U,m,$,q,t,b,Y,j,F=e.module,L=e.klass,_=e.hash2,B=e.defs,w=e.def,M=[],R=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),N=M,U=j=[F(M[0],"BCDice")].concat(N),b=[F(j[0],"DiceTable")].concat(U),Y=e.$r(b),m=b,q=[$=L(b[0],Y("D66GridTable"),"D66OneThirdTable")].concat(m),t=e.$r(q),B($,"$from_i18n",function(h,I){var C=R;return C=t("I18n").$t(h,_(["locale","raise"],{locale:I,raise:!0})),this.$new(C["$[]"]("name"),C["$[]"]("items_1_2"),C["$[]"]("items_3_4"),C["$[]"]("items_5_6"))}),w($,"$initialize",function(h,I,D,C){return this.name=h,this.items=[I,I,D,D,C,C].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var U,G,t,c,h,I,D,m,b,F=e.module,L=e.klass,_=e.hash2,B=e.defs,w=e.def,T=e.eqeqeq,M=e.rb_plus,R=e.rb_times,E=e.truthy,N=[],H=e.nil,j=e.$$$;return U=N,G=b=[F(N[0],"BCDice")].concat(U),t=m=[F(b[0],"DiceTable")].concat(G),h=[c=L(m[0],null,"D66Table")].concat(t),I=e.$r(h),(D=c.$$prototype).sort_type=D.items=D.name=H,B(c,"$from_i18n",function(x,p){var s,v=H;return v=I("I18n").$t(x,_(["locale"],{locale:p})),s=I("D66SortType").$const_get(v["$[]"]("d66_sort_type")),this.$new(v["$[]"]("name"),s,v["$[]"]("items"))}),w(c,"$initialize",function(x,p,l){var v=this;return v.name=x,v.sort_type=p,v.items=l.$freeze()}),w(c,"$roll",function(x){var p=this,l=H,v=H,s=H,d=H;return l=x.$roll_barabara(2,6),T(j(I("D66SortType"),"ASC"),v=p.sort_type)?l["$sort!"]():T(j(I("D66SortType"),"DESC"),v)&&l["$sort!"]()["$reverse!"](),s=M(R(l["$[]"](0),10),l["$[]"](1)),d=E(v=p.items["$[]"](s))?v:p.items["$[]"](s.$to_s()),E(d["$respond_to?"]("roll"))&&(d=d.$roll(x)),I("RollResult").$new(p.name,s,d)}),w(c,"$choice",function(x){return I("RollResult").$new(this.name,x,this.items["$[]"](x))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var A,u,$,q,Y,F=e.module,L=e.klass,_=e.hash2,B=e.send,w=e.to_ary,T=e.rb_plus,M=e.rb_times,R=e.send2,E=e.find_super,N=e.def,j=[],P=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),A=j,u=Y=[F(j[0],"BCDice")].concat(A),$=[F(Y[0],"DiceTable")].concat(u),q=e.$r($),N(L($[0],q("D66Table"),"D66LeftRangeTable"),"$initialize",function I(D,C,x){var v;return I.$$p=null,v=_([],{}),B(x,"each",[],function(d){var i,o;return null==d&&(d=P),i=w(d),o=null==i[1]?P:i[1],B(null==i[0]?P:i[0],"each",[],function(g){return null==g&&(g=P),B(o,"each_with_index",[],function(f,a){var W,Q;return null==f&&(f=P),null==a&&(a=P),Q=T(M(g,10),T(a,1)),B(v,"[]=",W=[Q,f]),W[W.length-1]})})}),R(this,E(this,"initialize",I,!1,!0),"initialize",[D,C,v],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var P,Y,q,t,c,h,I,u,A,F=e.module,L=e.klass,_=e.hash2,B=e.defs,w=e.def,T=e.truthy,M=e.rb_minus,R=e.rb_plus,E=e.rb_times,N=[],H=e.nil;return P=N,Y=A=[F(N[0],"BCDice")].concat(P),q=u=[F(A[0],"DiceTable")].concat(Y),c=[t=L(u[0],null,"D66ParityTable")].concat(q),h=e.$r(c),(I=t.$$prototype).odd=I.even=I.name=H,B(t,"$from_i18n",function(C,x){var l=H;return l=h("I18n").$t(C,_(["locale","raise"],{locale:x,raise:!0})),this.$new(l["$[]"]("name"),l["$[]"]("odd"),l["$[]"]("even"))}),w(t,"$initialize",function(C,x,p){var l=this;return l.name=C,l.odd=x.$freeze(),l.even=p.$freeze()}),w(t,"$roll",function(C){var l,s,d,x=this,p=H;return p=C.$roll_once(6),l=C.$roll_once(6),s=(T(p["$odd?"]())?x.odd:x.even)["$[]"](M(l,1)),d=R(E(p,10),l),h("RollResult").$new(x.name,d,s)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var N,U,u,m,$,q,t,b,j,F=e.module,L=e.klass,_=e.def,B=e.rb_plus,w=e.rb_times,T=e.send,M=[],R=e.nil;return N=M,U=j=[F(M[0],"BCDice")].concat(N),u=b=[F(j[0],"DiceTable")].concat(U),$=[m=L(b[0],null,"D66RangeTable")].concat(u),q=e.$r($),(t=m.$$prototype).items=t.name=R,_(m,"$initialize",function(h,I){return this.name=h,this.items=I.$freeze()}),_(m,"$roll",function(h){var D,C,x,p=R;return D=h.$roll_once(6),C=h.$roll_once(6),x=B(w(D,10),C),p=T(this.items,"find",[],function(v){return null==v&&(v=R),v["$[]"](0)["$include?"](x)}),q("RollResult").$new(this.name,x,p["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var A,u,c,x,l,v,h,I,D,C,$,Y,F=e.module,L=e.klass,_=e.const_set,B=e.send,w=e.hash2,T=e.def,M=e.eqeqeq,R=e.truthy,E=e.to_a,N=e.rb_times,H=e.rb_plus,j=[],P=e.nil;return A=j,u=Y=[F(j[0],"BCDice")].concat(A),c=$=[F(Y[0],"DiceTable")].concat(u),I=[h=L($[0],null,"RangeTable")].concat(c),D=e.$r(I),(C=h.$$prototype).name=C.items=C.num_of_dice=C.num_of_sides=C.formatter=P,_(I[0],"RollResult",B(D("Struct"),"new",["sum","values","content","formatted"],function x(){return(null==x.$$s?this:x.$$s).$alias_method("to_s","formatted")},{$$s:h})),_(I[0],"Item",D("Struct").$new("range","content")),_(I[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),_(I[0],"DEFAULT_FORMATTER",B(h,"lambda",[],function(p,l){return null==p&&(p=P),null==l&&(l=P),p.$name()+"("+l.$sum()+") \uff1e "+l.$content()})),h.$attr_reader("name"),h.$attr_reader("num_of_dice"),h.$attr_reader("num_of_sides"),l=[x=e.get_singleton_class(h)].concat(I),v=e.$r(l),T(x,"$from_i18n",function(d,i){var o,z=P;return z=v("I18n").$t(d,w(["locale"],{locale:i})),o=B(z["$[]"]("items"),"map",[],function r(g){return null==g&&(g=P),[(null==r.$$s?this:r.$$s).$conv_string_range(g["$[]"](0)),g["$[]"](1)]},{$$s:this}),this.$new(z["$[]"]("name"),z["$[]"]("type"),o)}),T(x,"$conv_string_range",function(d){var y,i=this;return null==i.name&&(i.name=P),M(v("Integer"),y=d)?d:M(v("String"),y)?R(d["$include?"](".."))?B(v("Range"),"new",E(B(d.$split("..",2),"map",[],function z(o){return null==o&&(o=P),(null==z.$$s?this:z.$$s).$Integer(o)},{$$s:i}))):i.$Integer(d):i.$raise(v("TypeError"),i.name+": "+d+" ("+d.$class()+") must be a String or an Integer")}),T(h,"$initialize",function x(p,l,v){var i,s=x.$$p||P,d=this,y=P;return x.$$p=null,d.name=p.$freeze(),d.formatter=R(i=s)?i:D("DEFAULT_FORMATTER"),y=D("DICE_ROLL_METHOD_RE").$match(l),R(y)||d.$raise(D("ArgumentError"),d.name+": invalid dice roll method: "+l),d.num_of_dice=y["$[]"](1).$to_i(),d.num_of_sides=y["$[]"](2).$to_i(),d.$store(v)}),T(h,"$fetch",function(p){var v,l=this;return v=B(l.items,"find",[],function(d){return null==d&&(d=P),d.$range()["$include?"](p)}),R(v)||l.$raise(D("RangeError"),l.name+": value is out of range: "+p),v}),T(h,"$roll",function(p){var s,l=this,v=P,d=P;return s=(v=p.$roll_barabara(l.num_of_dice,l.num_of_sides)).$sum(),(d=D("RollResult").$new(s,v,l.$fetch(s).$content()))["$formatted="](l.formatter["$[]"](l,d)),d}),h.$private(),T(h,"$store",function(p){var v,s,l=this;return v=B(p,"map",[],function d(i,y){return null==i&&(i=P),null==y&&(y=P),[(null==d.$$s?this:d.$$s).$coerce_to_int_range(i),y]},{$$s:l}),s=B(v,"sort_by",[],function(i,y){return null==i&&(i=P),null==y&&(y=P),i.$min()}),l.$assert_min_sum_is_covered(s),l.$assert_max_sum_is_covered(s),l.$assert_no_gap_or_overlap_in_ranges(s),l.items=B(s,"map",[],function(i,y){return null==i&&(i=P),null==y&&(y=P),D("Item").$new(i,y.$freeze()).$freeze()}).$freeze(),l}),T(h,"$coerce_to_int_range",function(p){var v;return M(D("Integer"),v=p)?D("Range").$new(p,p):M(D("Range"),v)&&R(p.$begin()["$is_a?"](D("Integer")))&&R(p.$end()["$is_a?"](D("Integer")))?p:this.$raise(D("TypeError"),this.name+": "+p+" ("+p.$class()+") must be an Integer or a Range with Integers ")}),T(h,"$assert_min_sum_is_covered",function(p){var v,l=this,s=P;return v=l.num_of_dice,s=p.$first()["$[]"](0),R(s["$include?"](v))||l.$raise(D("RangeError"),l.name+": min value ("+v+") is not covered: "+s),l}),T(h,"$assert_max_sum_is_covered",function(p){var v,l=this,s=P;return v=N(l.num_of_dice,l.num_of_sides),s=p.$last()["$[]"](0),R(s["$include?"](v))||l.$raise(D("RangeError"),l.name+": max value ("+v+") is not covered: "+s),l}),T(h,"$assert_no_gap_or_overlap_in_ranges",function(p){return B(p,"each_cons",[2],function v(s,d){var o,r,i=null==v.$$s?this:v.$$s,y=P,z=P;return null==i.name&&(i.name=P),null==s&&(s=P),null==d&&(d=P),y=s["$[]"](0),z=d["$[]"](0),o=y.$max(),r=H(o,1),R(z["$include?"](o))&&i.$raise(D("RangeError"),i.name+": Range overlap: "+y+" and "+z),R(z["$include?"](r))?P:i.$raise(D("RangeError"),i.name+": Range gap: "+y+" and "+z)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var H,A,m,h,I,D,C,q,Y,P,F=e.module,L=e.klass,_=e.send,B=e.def,w=e.rb_minus,T=e.return_ivar,M=[],R=e.nil,E=e.$$$;return H=M,A=P=[F(M[0],"BCDice")].concat(H),m=Y=[F(P[0],"DiceTable")].concat(A),h=q=[L(Y[0],null,"SaiFicSkillTable")].concat(m),D=[I=L(q[0],null,"Category")].concat(h),C=e.$r(D),B(I,"$initialize",function(p,l,v,s){var d=this;return d.name=p,d.skills=_(l.$map(),"with_index",[2],function(y,z){return null==y&&(y=R),null==z&&(z=R),E(C("SaiFicSkillTable"),"Skill").$new(p,y,v,z,s)}),d.dice=v}),B(I,"$roll",function(p){return this.$skills()["$[]"](w(p.$roll_sum(2,6),2))}),B(I,"$to_s",T("name")),I.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var R,j,Y,q,t,u,U,N,F=e.module,L=e.klass,_=e.def,B=e.hash2,w=[],T=e.nil;return R=w,j=N=[F(w[0],"BCDice")].concat(R),Y=U=[F(N[0],"DiceTable")].concat(j),u=[L(U[0],null,"SaiFicSkillTable")].concat(Y),(t=(q=L(u[0],null,"Skill")).$$prototype).s_format=t.category_dice=t.row_dice=t.category_name=t.name=T,_(q,"$initialize",function(h,I,D,C,x){var p=this;return p.category_name=h,p.name=I,p.category_dice=D,p.row_dice=C,p.s_format=x}),_(q,"$to_s",function(){var h=this;return h.$format(h.s_format,B(["category_dice","row_dice","category_name","skill_name"],{category_dice:h.category_dice,row_dice:h.row_dice,category_name:h.category_name,skill_name:h.name}))}),q.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var u,t,C,x,p,l,v,h,$,F=e.module,L=e.klass,_=e.ensure_kwargs,B=e.hash2,w=e.send,M=e.defs,R=e.const_set,E=e.to_ary,N=e.def,H=e.truthy,j=e.rb_minus,P=e.rb_plus,U=e.top,A=[],b=e.nil,Y=e.$$$;return U.$require("bcdice/dice_table/sai_fic_skill_table/category"),U.$require("bcdice/dice_table/sai_fic_skill_table/skill"),u=A,t=$=[F(A[0],"BCDice")].concat(u),C=h=[F($[0],"DiceTable")].concat(t),p=[x=L(h[0],null,"SaiFicSkillTable")].concat(C),l=e.$r(p),(v=x.$$prototype).rtt=v.rtt_format=v.rct=v.rct_format=v.rttn=v.rttn_format=v.categories=b,M(x,"$from_i18n",function(d,i,y){var z,o,r,a,f=b;return null==(z=(y=_(y)).$$smap.rtt)&&(z=b),null==(o=y.$$smap.rct)&&(o=b),null==(r=y.$$smap.rttn)&&(r=b),a=(f=l("I18n").$t("RTT",B(["locale","raise","default"],{locale:i,raise:!1,default:B([],{})})).$merge(l("I18n").$t(d,B(["locale","raise"],{locale:i,raise:!0}))))["$[]"]("items"),f=w(f,"select",[],function(Q,V){return null==Q&&(Q=b),null==V&&(V=b),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](Q)}),this.$new(a,e.to_hash(f).$merge(B(["rtt","rct","rttn"],{rtt:z,rct:o,rttn:r})))},-3),R(p[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),R(p[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),R(p[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),R(p[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),N(x,"$initialize",function(d,i){var y,z,o,r,g,n,f,a=this;return null==(y=(i=_(i)).$$smap.rtt)&&(y=b),null==(z=i.$$smap.rct)&&(z=b),null==(o=i.$$smap.rttn)&&(o=b),null==(r=i.$$smap.rtt_format)&&(r=l("DEFAULT_RTT")),null==(g=i.$$smap.rct_format)&&(g=l("DEFAULT_RCT")),null==(n=i.$$smap.rttn_format)&&(n=l("DEFAULT_RTTN")),null==(f=i.$$smap.s_format)&&(f=l("DEFAULT_S")),a.categories=w(d.$map(),"with_index",[1],function(Q,V){var ne,ue,ie;return null==Q&&(Q=b),null==V&&(V=b),ue=null==(ne=E(Q))[0]?b:ne[0],ie=null==ne[1]?b:ne[1],Y(l("SaiFicSkillTable"),"Category").$new(ue,ie,V,f)},{$$has_top_level_mlhs_arg:!0}),a.rtt=y,a.rct=z,a.rttn=o.$to_a(),a.rtt_format=r,a.rct_format=g,a.rttn_format=n},-2),R(p[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),x.$attr_reader("categories"),N(x,"$roll_command",function(d,i){var z,y=this,o=b,r=b;return H(["RTT",y.rtt]["$include?"](z=i))?y.$format_skill(y.rtt_format,y.$roll_skill(d)):H(["RCT",y.rct]["$include?"](z))?(o=y.$roll_category(d),y.$format(y.rct_format,B(["category_dice","category_name"],{category_dice:o.$dice(),category_name:o.$name()}))):H(r=l("RTTN").$index(z))||H(r=y.rttn.$index(z))?y.$format_skill(y.rttn_format,y.categories["$[]"](r).$roll(d)):b}),N(x,"$roll_category",function(d){return this.categories["$[]"](j(d.$roll_once(6),1))}),N(x,"$roll_skill",function(d){return this.$roll_category(d).$roll(d)}),N(x,"$prefixes",function(){var d=this;return P(["RTT[1-6]?","RCT",d.rtt,d.rct],d.rttn).$compact()}),x.$private(),N(x,"$format_skill",function(d,i){return this.$format(d,B(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:i.$category_dice(),row_dice:i.$row_dice(),category_name:i.$category_name(),skill_name:i.$name(),text:i.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var H,A,m,$,q,t,c,Y,P,F=e.module,L=e.klass,_=e.hash2,B=e.defs,w=e.truthy,T=e.def,M=e.rb_minus,R=[],E=e.nil;return H=R,A=P=[F(R[0],"BCDice")].concat(H),m=Y=[F(P[0],"DiceTable")].concat(A),q=[$=L(Y[0],null,"Table")].concat(m),t=e.$r(q),(c=$.$$prototype).times=c.sides=c.name=c.items=E,B($,"$from_i18n",function(I,D){var x=E;return x=t("I18n").$t(I,_(["locale"],{locale:D})),this.$new(x["$[]"]("name"),x["$[]"]("type"),x["$[]"]("items"))}),T($,"$initialize",function(I,D,C){var x=this,p=E;return x.name=I,x.items=C.$freeze(),p=/(\d+)D(\d+)/i.$match(D),w(p)||x.$raise(t("ArgumentError"),"Unexpected table type: "+D),x.times=p["$[]"](1).$to_i(),x.sides=p["$[]"](2).$to_i()}),T($,"$roll",function(I){var C,D=this;return C=I.$roll_sum(D.times,D.sides),D.$choice(C)}),T($,"$choice",function(I){var C,D=this;return C=M(I,D.times),t("RollResult").$new(D.name,I,D.items["$[]"](C))})},Opal.modules["bcdice/dice_table"]=function(e){var F=e.top;return F.$require("bcdice/dice_table/roll_result"),F.$require("bcdice/dice_table/chain_table"),F.$require("bcdice/dice_table/d66_grid_table"),F.$require("bcdice/dice_table/d66_half_grid_table"),F.$require("bcdice/dice_table/d66_one_third_table"),F.$require("bcdice/dice_table/d66_left_range_table"),F.$require("bcdice/dice_table/d66_parity_table"),F.$require("bcdice/dice_table/d66_range_table"),F.$require("bcdice/dice_table/d66_table"),F.$require("bcdice/dice_table/range_table"),F.$require("bcdice/dice_table/sai_fic_skill_table"),F.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var T,N,j,R,F=e.module,L=e.const_set,_=[];return T=_,N=R=[F(_[0],"BCDice")].concat(T),j=[F(R[0],"D66SortType")].concat(N),L(j[0],"NO_SORT","no_sort"),L(j[0],"ASC","asc"),L(j[0],"DESC","desc"),function(E,N){var j=[F(E,"RoundType")].concat(N);return L(j[0],"CEIL","ceil"),L(j[0],"FLOOR","floor"),L(j[0],"ROUND","round")}(R[0],R)},Opal.modules["bcdice/translate"]=function(e){var N,U,A,b,Y,j,F=e.module,L=e.ensure_kwargs,_=e.kwrestargs,w=e.hash2,T=e.def,M=[],R=e.nil;return N=M,U=j=[F(M[0],"BCDice")].concat(N),b=[A=F(j[0],"Translate")].concat(U),Y=e.$r(b),T(A,"$translate",function(u,m){var $,q=this;return null==q.locale&&(q.locale=R),m=L(m),$=_(m,{}),Y("I18n").$translate(u,w(["locale","raise"],{locale:q.locale,raise:!0}).$merge(e.to_hash($)))},-2)},Opal.modules["bcdice/result"]=function(e){var A,G,b,N,j,L=e.klass,_=e.send,B=e.def,w=e.return_val,T=e.return_ivar,M=[],R=e.nil;return N=M,A=j=[(0,e.module)(M[0],"BCDice")].concat(N),[b=L(j[0],null,"Result")].concat(A),B(G=e.get_singleton_class(b),"$success",function($){return _(this.$new(),"tap",[],function(c){var h;return null==c&&(c=R),c["$text="]($),_(c,"success=",h=[!0]),h[h.length-1]})}),B(G,"$failure",function($){return _(this.$new(),"tap",[],function(c){var h;return null==c&&(c=R),c["$text="]($),_(c,"failure=",h=[!0]),h[h.length-1]})}),B(G,"$critical",function($){return _(this.$new(),"tap",[],function(c){var h;return null==c&&(c=R),c["$text="]($),c["$critical="](!0),_(c,"success=",h=[!0]),h[h.length-1]})}),B(G,"$fumble",function($){return _(this.$new(),"tap",[],function(c){var h;return null==c&&(c=R),c["$text="]($),c["$fumble="](!0),_(c,"failure=",h=[!0]),h[h.length-1]})}),B(G,"$nothing",w("nothing")),B(b,"$initialize",function(u){var m=this;return null==u&&(u=R),m.text=u,m.rands=R,m.detailed_rands=R,m.secret=!1,m.success=!1,m.failure=!1,m.critical=!1,m.fumble=!1},-1),b.$attr_accessor("text","rands","detailed_rands"),b.$attr_writer("secret","success","failure","critical","fumble"),B(b,"$secret?",T("secret")),B(b,"$success?",T("success")),B(b,"$failure?",T("failure")),B(b,"$critical?",T("critical")),B(b,"$fumble?",T("fumble")),B(b,"$condition=",function(u){return this.success=u,this.failure=u["$!"]()})},Opal.modules["racc/parser"]=function(e){var I,C,x,F=e.module,L=e.klass,_=e.truthy,B=e.const_set,w=e.defs,T=e.gvars,M=e.rb_lt,R=e.def,E=e.to_ary,N=e.send,H=e.neqeq,j=e.rb_plus,P=e.eqeq,U=e.rb_ge,A=e.rb_gt,b=e.rb_minus,Y=e.rb_le,G=e.rb_times,u=e.assign_ivar_val,$=[],q=e.$r($),t=e.nil,c=e.$$$;return I=$,C=[F($[0],"Racc")].concat(I),x=e.$r(C),L(C[0],x("StandardError"),"ParseError"),_(c("::","ParseError","skip_raise")?"constant":t)||B($[0],"ParseError",c(q("Racc"),"ParseError")),function(h,I){var s,d,i,y,z,x=[F(h,"Racc")].concat(I),p=e.$r(x);return _(p("Racc_No_Extensions","skip_raise")?"constant":t)||B(x[0],"Racc_No_Extensions",!1),s=x,i=[d=L(x[0],null,"Parser")].concat(s),y=e.$r(i),(z=d.$$prototype).yydebug=z.racc_debug_out=z.racc_error_status=z.racc_t=z.racc_vstack=z.racc_val=z.racc_state=z.racc_tstack=t,B(i[0],"Racc_Runtime_Version","1.4.6"),B(i[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),B(i[0],"Racc_Runtime_Core_Version_R","1.4.6"),B(i[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),B(i[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),B(i[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),B(i[0],"Racc_Runtime_Core_Version",y("Racc_Runtime_Core_Version_R")),B(i[0],"Racc_Runtime_Core_Revision",y("Racc_Runtime_Core_Revision_R")),B(i[0],"Racc_Runtime_Type","ruby"),w(y("Parser"),"$racc_runtime_type",function(){return y("Racc_Runtime_Type")}),R(d,"$_racc_setup",function(){var r,g,n=this,f=t,a=t;return null==T.stderr&&(T.stderr=t),_(c(n.$class(),"Racc_debug_parser"))||(n.yydebug=!1),_(null!=(r=n.yydebug)&&r!==t?"instance-variable":t)||(n.yydebug=!1),_(n.yydebug)&&(_(null!=(g=n.racc_debug_out)&&g!==t?"instance-variable":t)||(n.racc_debug_out=T.stderr),n.racc_debug_out=_(f=n.racc_debug_out)?f:T.stderr),a=c(n.$class(),"Racc_arg"),_(M(a.$size(),14))&&a["$[]="](13,!0),a}),R(d,"$_racc_init_sysvars",function(){var r=this;return r.racc_state=[0],r.racc_tstack=[],r.racc_vstack=[],r.racc_t=t,r.racc_val=t,r.racc_read_next=!0,r.racc_user_yyerror=!1,r.racc_error_status=0}),R(d,"$do_parse",function(){return this.$__send__(y("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),R(d,"$next_token",function(){return this.$raise(y("NotImplementedError"),this.$class()+"#next_token is not defined")}),R(d,"$_racc_do_parse_rb",function(r,g){var n,a=this,W=t,Q=t,V=t,ne=t,ue=t,ie=t,ce=t,ae=t;return n=E(r),W=null==n[0]?t:n[0],Q=null==n[1]?t:n[1],V=null==n[2]?t:n[2],ne=null==n[3]?t:n[3],ue=null==n[10]?t:n[10],a.$_racc_init_sysvars(),ie=ce=ae=t,N(a,"catch",["racc_end_parse"],function re(){var se,K,k=null==re.$$s?this:re.$$s,Z=t;for(null==k.racc_state&&(k.racc_state=t),null==k.racc_read_next&&(k.racc_read_next=t),null==k.racc_t&&(k.racc_t=t),null==k.yydebug&&(k.yydebug=t),null==k.racc_val&&(k.racc_val=t);_(!0);)for(_(ae=ne["$[]"](k.racc_state["$[]"](-1)))?(_(k.racc_read_next)&&H(k.racc_t,0)&&(K=k.$next_token(),se=E(K),ie=null==se[0]?t:se[0],k.racc_val=null==se[1]?t:se[1],k.racc_t=_(ie)?_(Z=ue["$[]"](ie))?Z:1:0,_(k.yydebug)&&k.$racc_read_token(k.racc_t,ie,k.racc_val),k.racc_read_next=!1),ae=j(ae,k.racc_t),_(U(ae,0))&&_(ce=W["$[]"](ae))&&P(Q["$[]"](ae),k.racc_state["$[]"](-1))||(ce=V["$[]"](k.racc_state["$[]"](-1)))):ce=V["$[]"](k.racc_state["$[]"](-1));_(ce=k.$_racc_evalact(ce,r)););},{$$s:a})}),R(d,"$yyparse",function(r,g){return this.$__send__(y("Racc_YY_Parse_Method"),r,g,this.$_racc_setup(),!0)}),R(d,"$_racc_yyparse_rb",function(r,g,n,f){var a,Q=this,V=t,ne=t,$e=t,ue=t,ce=t,ae=t,re=t;return a=E(n),V=null==a[0]?t:a[0],ne=null==a[1]?t:a[1],$e=null==a[2]?t:a[2],ue=null==a[3]?t:a[3],ce=null==a[10]?t:a[10],Q.$_racc_init_sysvars(),ae=t,re=t,N(Q,"catch",["racc_end_parse"],function se(){var K=null==se.$$s?this:se.$$s;for(null==K.racc_state&&(K.racc_state=t);!_(re=ue["$[]"](K.racc_state["$[]"](-1)));)for(;_(ae=K.$_racc_evalact($e["$[]"](K.racc_state["$[]"](-1)),n)););return N(r,"__send__",[g],function k(Z,X){var S=null==k.$$s?this:k.$$s,O=t,te=t;for(null==S.racc_t&&(S.racc_t=t),null==S.racc_state&&(S.racc_state=t),null==S.racc_read_next&&(S.racc_read_next=t),null==Z&&(Z=t),null==X&&(X=t),S.racc_t=_(Z)?_(O=ce["$[]"](Z))?O:1:0,S.racc_val=X,S.racc_read_next=!1,re=j(re,S.racc_t),_(U(re,0))&&_(ae=V["$[]"](re))&&P(ne["$[]"](re),S.racc_state["$[]"](-1))||(ae=$e["$[]"](S.racc_state["$[]"](-1)));_(ae=S.$_racc_evalact(ae,n)););for(;_(_(O=_(te=(re=ue["$[]"](S.racc_state["$[]"](-1)))["$!"]())?te:S.racc_read_next["$!"]())?O:S.racc_t["$=="](0));)for(_(re)&&_(re=j(re,S.racc_t))&&_(U(re,0))&&_(ae=V["$[]"](re))&&P(ne["$[]"](re),S.racc_state["$[]"](-1))||(ae=$e["$[]"](S.racc_state["$[]"](-1)));_(ae=S.$_racc_evalact(ae,n)););},{$$s:K})},{$$s:Q})}),R(d,"$_racc_evalact",function(r,g){var n,$e,a=this,W=t,Q=t,ne=t,ue=t,ie=t,ce=t;if(W=null==(n=E(g))[0]?t:n[0],Q=null==n[1]?t:n[1],ne=null==n[3]?t:n[3],$e=null==n[11]?t:n[11],ue=null==n[12]?t:n[12],_(A(r,0))&&_(M(r,$e)))_(A(a.racc_error_status,0))&&(P(a.racc_t,1)||(a.racc_error_status=b(a.racc_error_status,1))),a.racc_vstack.$push(a.racc_val),a.racc_state.$push(r),a.racc_read_next=!0,_(a.yydebug)&&(a.racc_tstack.$push(a.racc_t),a.$racc_shift(a.racc_t,a.racc_tstack,a.racc_vstack));else if(_(M(r,0))&&_(A(r,ue["$-@"]()))){if(ie=N(a,"catch",["racc_jump"],function ae(){var re=null==ae.$$s?this:ae.$$s;return null==re.racc_state&&(re.racc_state=t),re.racc_state.$push(re.$_racc_do_reduce(g,r)),!1},{$$s:a}),_(ie))switch(ie.valueOf()){case 1:return a.racc_user_yyerror=!0,ue["$-@"]();case 2:return $e;default:a.$raise("[Racc Bug] unknown jump code")}}else if(P(r,$e))_(a.yydebug)&&a.$racc_accept(),a.$throw("racc_end_parse",a.racc_vstack["$[]"](0));else{if(P(r,ue["$-@"]())){switch(a.racc_error_status.valueOf()){case 0:_(g["$[]"](21))||a.$on_error(a.racc_t,a.racc_val,a.racc_vstack);break;case 3:P(a.racc_t,0)&&a.$throw("racc_end_parse",t),a.racc_read_next=!0}for(a.racc_user_yyerror=!1,a.racc_error_status=3;_(!0)&&!(_(ce=ne["$[]"](a.racc_state["$[]"](-1)))&&(ce=j(ce,1),_(U(ce,0))&&_(r=W["$[]"](ce))&&P(Q["$[]"](ce),a.racc_state["$[]"](-1))));)_(Y(a.racc_state.$size(),1))&&a.$throw("racc_end_parse",t),a.racc_state.$pop(),a.racc_vstack.$pop(),_(a.yydebug)&&(a.racc_tstack.$pop(),a.$racc_e_pop(a.racc_state,a.racc_tstack,a.racc_vstack));return r}a.$raise("[Racc Bug] unknown action "+r.$inspect())}return _(a.yydebug)&&a.$racc_next_state(a.racc_state["$[]"](-1),a.racc_state),t}),R(d,"$_racc_do_reduce",function(r,g){var n,ue,ce,Z,X,S,ee,a=this,Q=t,V=t,ne=t,$e=t,ie=t,ae=t,re=t,se=t,K=t,k=t,O=t,te=t,J=t;return Q=null==(n=E(r))[4]?t:n[4],V=null==n[5]?t:n[5],ne=null==n[6]?t:n[6],$e=null==n[7]?t:n[7],ue=null==n[8]?t:n[8],ie=null==n[9]?t:n[9],ce=null==n[13]?t:n[13],ae=a.racc_state,re=a.racc_vstack,se=a.racc_tstack,K=G(g,-3),k=ie["$[]"](K),Z=ie["$[]"](j(K,1)),X=ie["$[]"](j(K,2)),S=[],_(a.yydebug)&&(O=se["$[]"](k["$-@"](),k)),te=re["$[]"](k["$-@"](),k),_(a.yydebug)&&se["$[]="](k["$-@"](),k,S),re["$[]="](k["$-@"](),k,S),ae["$[]="](k["$-@"](),k,S),_(ce)?re.$push(a.$__send__(X,te,re,te["$[]"](0))):re.$push(a.$__send__(X,te,re)),se.$push(Z),_(a.yydebug)&&a.$racc_reduce(O,Z,se,re),ee=b(Z,ue),_(K=$e["$[]"](ee))&&(K=j(K,ae["$[]"](-1)),_(U(K,0))&&_(J=Q["$[]"](K))&&P(V["$[]"](K),ee))?J:ne["$[]"](ee)}),R(d,"$on_error",function(r,g,n){var a,f=this;return f.$raise(y("ParseError"),f.$sprintf("\nparse error on value %s (%s)",g.$inspect(),_(a=f.$token_to_str(r))?a:"?"))}),R(d,"$yyerror",function(){return this.$throw("racc_jump",1)}),R(d,"$yyaccept",function(){return this.$throw("racc_jump",2)}),R(d,"$yyerrok",u("racc_error_status",0)),R(d,"$racc_read_token",function(r,g,n){var f=this;return f.racc_debug_out.$print("read    "),f.racc_debug_out.$print(g.$inspect(),"(",f.$racc_token2str(r),") "),f.racc_debug_out.$puts(n.$inspect()),f.racc_debug_out.$puts()}),R(d,"$racc_shift",function(r,g,n){var f=this;return f.racc_debug_out.$puts("shift   "+f.$racc_token2str(r)),f.$racc_print_stacks(g,n),f.racc_debug_out.$puts()}),R(d,"$racc_reduce",function(r,g,n,f){var a=this,W=t;return(W=a.racc_debug_out).$print("reduce "),_(r["$empty?"]())?W.$print(" <none>"):N(r,"each",[],function Q(V){return null==V&&(V=t),W.$print(" ",(null==Q.$$s?this:Q.$$s).$racc_token2str(V))},{$$s:a}),W.$puts(" --\x3e "+a.$racc_token2str(g)),a.$racc_print_stacks(n,f),a.racc_debug_out.$puts()}),R(d,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),R(d,"$racc_e_pop",function(r,g,n){var f=this;return f.racc_debug_out.$puts("error recovering mode: pop token"),f.$racc_print_states(r),f.$racc_print_stacks(g,n),f.racc_debug_out.$puts()}),R(d,"$racc_next_state",function(r,g){var n=this;return n.racc_debug_out.$puts("goto    "+r),n.$racc_print_states(g),n.racc_debug_out.$puts()}),R(d,"$racc_print_stacks",function(r,g){var f=t;return(f=this.racc_debug_out).$print("        ["),N(r,"each_index",[],function a(W){return null==W&&(W=t),f.$print(" (",(null==a.$$s?this:a.$$s).$racc_token2str(r["$[]"](W))," ",g["$[]"](W).$inspect(),")")},{$$s:this}),f.$puts(" ]")}),R(d,"$racc_print_states",function(r){var n=t;return(n=this.racc_debug_out).$print("        ["),N(r,"each",[],function(a){return null==a&&(a=t),n.$print(" ",a)}),n.$puts(" ]")}),R(d,"$racc_token2str",function(r){var n;return _(n=c(this.$class(),"Racc_token_to_s_table")["$[]"](r))?n:this.$raise("[Racc Bug] can't convert token "+r+" to string")}),R(d,"$token_to_str",function(r){return c(this.$class(),"Racc_token_to_s_table")["$[]"](r)})}($[0],$)},Opal.modules["bcdice/arithmetic/node"]=function(e){var u,t,D,s,d,x,p,h,$,F=e.module,L=e.klass,_=e.def,B=e.thrower,w=e.return_ivar,T=e.send2,M=e.find_super,R=e.eqeq,E=e.const_set,N=e.eqeqeq,H=e.rb_divide,j=e.truthy,P=e.assign_ivar,U=e.alias,A=[],b=e.nil,Y=e.$$$;return u=A,t=$=[F(A[0],"BCDice")].concat(u),D=h=[F($[0],"Arithmetic")].concat(t),x=[F(h[0],"Node")].concat(D),p=e.$r(x),(d=(s=L(x[0],null,"BinaryOp")).$$prototype).lhs=d.rhs=d.op=b,_(s,"$initialize",function(y,z,o){var r=this;return r.lhs=y,r.op=z,r.rhs=o}),_(s,"$eval",function(y){try{B("eval_return");var g,o=this,r=b;return r=o.lhs.$eval(y),g=o.rhs.$eval(y),r.$send(o.op,g)}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),_(s,"$output",function(){var y=this;return""+y.lhs.$output()+y.op+y.rhs.$output()}),_(s,"$s_exp",function(){var y=this;return"("+y.$op_for_s_exp()+" "+y.lhs.$s_exp()+" "+y.rhs.$s_exp()+")"}),_(s,"$op_for_s_exp",w("op")),function(l,v,s){var d=L(l,v,"DivideBase"),i=[d].concat(s),y=e.$r(i),z=d.$$prototype;z.lhs=z.rhs=z.op=b,_(d,"$initialize",function o(r,g){return o.$$p=null,T(this,M(this,"initialize",o,!1,!0),"initialize",[r,"/",g],null)}),_(d,"$eval",function(r){try{B("eval_return");var f,a,n=this;return f=n.lhs.$eval(r),a=n.rhs.$eval(r),R(a,0)&&n.$raise(y("ZeroDivisionError")),n.$divide_and_round(f,a,r)}catch(W){if(W===e.t_eval_return)return W.$v;throw W}}),_(d,"$output",function o(){var r=o.$$p||b,g=this;return o.$$p=null,""+T(g,M(g,"output",o,!1,!0),"output",[],r)+g.$rounding_method()}),d.$private(),_(d,"$rounding_method",function(){return Y(this.$class(),"ROUNDING_METHOD")}),_(d,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),_(d,"$divide_and_round",function(r,g,n){return this.$raise(y("NotImplementedError"))})}(x[0],p("BinaryOp"),x),function(l,v,s){var d=L(l,v,"DivideWithGameSystemDefault"),i=[d].concat(s),y=e.$r(i);E(i[0],"ROUNDING_METHOD",""),d.$private(),_(d,"$divide_and_round",function(o,r,g){var n,f=b;return N(Y(y("RoundType"),"CEIL"),n=g)?H(o.$to_f(),r).$ceil():N(Y(y("RoundType"),"ROUND"),n)?(f=H(o.$to_f(),r),j(f["$negative?"]())?f.$abs().$round()["$-@"]():f.$round()):H(o,r).$floor()})}(x[0],p("DivideBase"),x),function(l,v,s){var d=L(l,v,"DivideWithCeil"),i=[d].concat(s);E(i[0],"ROUNDING_METHOD","C"),d.$private(),_(d,"$divide_and_round",function(z,o,r){return H(z.$to_f(),o).$ceil()})}(x[0],p("DivideBase"),x),function(l,v,s){var d=L(l,v,"DivideWithRound"),i=[d].concat(s);E(i[0],"ROUNDING_METHOD","R"),d.$private(),_(d,"$divide_and_round",function(z,o,r){var g=b;return g=H(z.$to_f(),o),j(g["$negative?"]())?g.$abs().$round()["$-@"]():g.$round()})}(x[0],p("DivideBase"),x),function(l,v,s){var d=L(l,v,"DivideWithFloor"),i=[d].concat(s);E(i[0],"ROUNDING_METHOD","F"),d.$private(),_(d,"$divide_and_round",function(z,o,r){return H(z,o).$floor()})}(x[0],p("DivideBase"),x),function(l,v){var s=L(l,null,"Negative");s.$$prototype.body=b,_(s,"$initialize",P("body")),_(s,"$eval",function(y){try{return B("eval_return"),this.body.$eval(y)["$-@"]()}catch(r){if(r===e.t_eval_return)return r.$v;throw r}}),_(s,"$output",function(){return"-"+this.body.$output()}),_(s,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(x[0]),function(l,v){var s=L(l,null,"Parenthesis");s.$$prototype.expr=b,_(s,"$initialize",P("expr")),_(s,"$eval",function(y){try{return B("eval_return"),this.expr.$eval(y)}catch(r){if(r===e.t_eval_return)return r.$v;throw r}}),_(s,"$output",function(){return"("+this.expr.$output()+")"}),_(s,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(x[0]),function(l,v){var s=L(l,null,"Number");return s.$$prototype.value=b,_(s,"$initialize",P("value")),_(s,"$eval",w("value")),_(s,"$output",function(){return this.value.$to_s()}),U(s,"s_exp","output")}(x[0])},Opal.modules.strscan=function(e){var P,U,A,b,Y,L=e.def,_=e.truthy,B=e.eqeqeq,w=e.Opal,T=e.return_ivar,M=e.send,R=e.alias,E=[],N=e.nil;return P=E,A=[U=(0,e.klass)(E[0],null,"StringScanner")].concat(P),b=e.$r(A),(Y=U.$$prototype).pos=Y.string=Y.working=Y.matched=Y.prev_pos=Y.match=N,U.$attr_reader("pos","matched"),L(U,"$initialize",function(u){var m=this;return m.string=u,m.pos=0,m.matched=N,m.working=u,m.match=[]}),U.$attr_reader("string"),L(U,"$beginning_of_line?",function(){var u=this;return 0===u.pos||"\n"===u.string.charAt(u.pos-1)}),L(U,"$scan",function(u){var m=this,$=(u=m.$anchor(u)).exec(m.working);return null==$?m.matched=N:(m.prev_pos=m.pos,m.pos+=$[0].length,m.working=m.working.substring($[0].length),m.matched=$[0],m.match=$,$[0])}),L(U,"$scan_until",function(u){var m=this;u=m.$anchor(u);for(var $=m.working,q=0;$.length!=q;++q){var t=u.exec($.substr(q));if(null!==t){var c=q+t[0].length,h=$.substr(0,c);return m.matched=t[0],m.match=t,m.prev_pos=m.pos+q,m.pos+=c,m.working=$.substr(c),h}}return m.matched=N}),L(U,"$[]",function(u){var $;if(_(this.match["$empty?"]()))return N;B(b("Symbol"),$=u)?u=u.$to_s():B(b("String"),$)||(u=w["$coerce_to!"](u,b("Integer"),"to_int"));var q=this.match;return u<0&&(u+=q.length),u<0||u>=q.length||null==q[u]?N:q[u]}),L(U,"$check",function(u){var m=this,$=(u=m.$anchor(u)).exec(m.working);return m.matched=null==$?N:$[0]}),L(U,"$check_until",function(u){var m=this,$=m.prev_pos,q=m.pos,t=m.working,c=m.$scan_until(u);return m.prev_pos=$,m.pos=q,m.working=t,c}),L(U,"$peek",function(u){return this.working.substring(0,u)}),L(U,"$eos?",function(){return 0===this.working.length}),L(U,"$exist?",function(u){var $=u.exec(this.working);return null==$?N:0==$.index?0:$.index+1}),L(U,"$skip",function(u){var m=this,$=(u=m.$anchor(u)).exec(m.working);if(null==$)return m.match=[],m.matched=N;var q=$[0],t=q.length;return m.matched=q,m.match=$,m.prev_pos=m.pos,m.pos+=t,m.working=m.working.substring(t),t}),L(U,"$skip_until",function(u){var $=this.$scan_until(u);return $===N?N:(this.matched=$.substr(-1),$.length)}),L(U,"$get_byte",function(){var u=this,m=N;return u.pos<u.string.length?(u.prev_pos=u.pos,u.pos+=1,m=u.matched=u.working.substring(0,1),u.working=u.working.substring(1)):u.matched=N,m}),L(U,"$match?",function(u){var m=this,$=(u=m.$anchor(u)).exec(m.working);return null==$?N:(m.prev_pos=m.pos,$[0].length)}),L(U,"$pos=",function(u){var m=this;return u<0&&(u+=m.string.$length()),m.pos=u,m.working=m.string.slice(u)}),L(U,"$matched_size",function(){return this.matched===N?N:this.matched.length}),L(U,"$post_match",function(){var u=this;return u.matched===N?N:u.string.substr(u.pos)}),L(U,"$pre_match",function(){var u=this;return u.matched===N?N:u.string.substr(0,u.prev_pos)}),L(U,"$reset",function(){var u=this;return u.working=u.string,u.matched=N,u.pos=0}),L(U,"$rest",T("working")),L(U,"$rest?",function(){return 0!==this.working.length}),L(U,"$rest_size",function(){return this.$rest().$size()}),L(U,"$terminate",function(){var u,m=this;return m.match=N,u=[m.string.$length()],M(m,"pos=",u),u[u.length-1]}),L(U,"$unscan",function(){var u=this;return u.pos=u.prev_pos,u.prev_pos=N,u.match=N,u}),R(U,"bol?","beginning_of_line?"),R(U,"getch","get_byte"),U.$private(),L(U,"$anchor",function(u){var m=u.toString().match(/\/([^\/]+)$/);return m=m?m[1]:void 0,new RegExp("^(?:"+u.source+")",m)})},Opal.modules["bcdice/normalize"]=function(e){var R,j,N,F=e.module,L=e.eqeqeq,_=e.def,B=e.eqeq,w=[],T=e.nil;return R=w,N=[F(w[0],"BCDice")].concat(R),(j=F(N[0],"Normalize")).$module_function(),_(j,"$comparison_operator",function(U){var A;return L(/<=|=</,A=U)?"<=":L(/>=|=>/,A)?">=":L(/<>|!=|=!/,A)?"!=":L(/</,A)?"<":L(/>/,A)?">":L(/=/,A)?"==":T}),_(j,"$target_number",function(U){return B(U,"?")?U:U.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var P,Y,q,t,c,h,I,u,A,F=e.module,L=e.klass,_=e.const_set,B=e.hash2,w=e.truthy,T=e.send,M=e.def,R=e.thrower,E=e.top,N=[],H=e.nil;return E.$require("strscan"),E.$require("bcdice/normalize"),P=N,Y=A=[F(N[0],"BCDice")].concat(P),q=u=[F(A[0],"Command")].concat(Y),c=[t=L(u[0],null,"Lexer")].concat(q),h=e.$r(c),(I=t.$$prototype).scanner=I.notations=H,_(c[0],"SYMBOLS",B(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),M(t,"$initialize",function(C,x){var p,l,s;return C=w(s=(p=(l=C)===H||null==l?H:l.$split(" ",2))===H||null==p?H:p.$first())?s:"",this.scanner=h("StringScanner").$new(C),this.notations=T(x,"map",[],function(i){return null==i&&(i=H),w(i["$is_a?"](h("String")))?h("Regexp").$new(i):i})}),M(t,"$next_token",function(){try{var C=R("return"),x=this,p=H,l=H,s=H,d=H;return w(x.scanner["$eos?"]())?[!1,"$"]:(T(x.notations,"each",[],function i(y){var o,z=null==i.$$s?this:i.$$s;if(null==z.scanner&&(z.scanner=H),null==y&&(y=H),o=z.scanner.$scan(y),!w(o))return H;C.$throw(["NOTATION",o])},{$$s:x,$$ret:C}),w(p=x.scanner.$scan(/\d+/))?["NUMBER",p.$to_i()]:w(l=x.scanner.$scan(/[<>!=]+/))?(l=h("Normalize").$comparison_operator(l),[w(l)?"CMP_OP":"ILLEGAL",l]):(s=x.scanner.$getch().$upcase(),[w(d=h("SYMBOLS")["$[]"](s))?d:s.$to_sym(),s]))}catch(i){if(i===C)return i.$v;throw i}}),M(t,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var E,P,G,u,m,$,q,A,H,F=e.module,L=e.klass,_=e.def,B=e.return_ivar,w=e.truthy,T=[],M=e.nil;return E=T,P=H=[F(T[0],"BCDice")].concat(E),G=A=[F(H[0],"Command")].concat(P),m=[u=L(A[0],null,"Parsed")].concat(G),$=e.$r(m),(q=u.$$prototype).critical=q.fumble=q.dollar=q.modify_number=q.question_target=q.target_number=q.prefix_number=q.command=q.suffix_number=q.cmp_op=M,u.$attr_accessor("command"),u.$attr_accessor("prefix_number"),u.$attr_accessor("suffix_number"),u.$attr_accessor("critical"),u.$attr_accessor("fumble"),u.$attr_accessor("dollar"),u.$attr_accessor("modify_number"),u.$attr_accessor("cmp_op"),u.$attr_accessor("target_number"),u.$attr_writer("question_target"),_(u,"$initialize",function(){var c=this;return c.prefix_number=M,c.suffix_number=M,c.critical=M,c.fumble=M,c.dollar=M,c.cmp_op=M,c.target_number=M,c.question_target=!1}),_(u,"$question_target?",B("question_target")),_(u,"$to_s",function(c){var h=this,I=M,D=M,C=M,x=M,p=M;switch(null==c&&(c="after_command"),I=w(h.critical)?"@"+h.critical:M,D=w(h.fumble)?"#"+h.fumble:M,C=w(h.dollar)?"$"+h.dollar:M,x=$("Format").$modifier(h.modify_number),p=w(h.question_target)?"?":h.target_number,c.valueOf()){case"after_command":return[h.prefix_number,h.command,h.suffix_number,I,D,C,x,h.cmp_op,p].$join();case"after_modify_number":return[h.prefix_number,h.command,h.suffix_number,x,I,D,C,h.cmp_op,p].$join();case"after_target_number":return[h.prefix_number,h.command,h.suffix_number,x,h.cmp_op,p,I,D,C].$join();default:return M}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var c,C,d,g,n,f,a,W,Q,V,ne,$e,ce,i,o,r,se,p,l,I,F=e.klass,L=e.module,_=e.slice,B=e.extract_kwargs,w=e.ensure_kwargs,T=e.get_kwarg,M=e.send2,R=e.find_super,E=e.def,N=e.send,H=e.eqeq,j=e.thrower,P=e.hash,U=e.const_set,A=e.truthy,b=e.to_ary,Y=e.hash2,G=e.top,u=[],m=e.$r(u),$=e.nil,q=e.$$$;return G.$require("racc/parser.rb"),G.$require("bcdice/arithmetic/node"),G.$require("bcdice/command/lexer"),G.$require("bcdice/command/parsed"),F(q(m("BCDice"),"Command"),q(m("Racc"),"Parser"),"Parser"),c=u,C=I=[L(u[0],"BCDice")].concat(c),p=[L(I[0],"Command")].concat(C),l=e.$r(p),d=p,o=[i=F(p[0],q(l("Racc"),"Parser"),"Parser")].concat(d),r=e.$r(o),(se=i.$$prototype).notations=se.lexer=se.modifier=se.suffix_number=se.prefix_number=se.need_suffix_number=se.need_prefix_number=se.critical=se.fumble=se.dollar=se.allowed_cmp_op=se.question_target=$,E(i,"$initialize",function K(k,Z){var X,S,O,te,J=this;return K.$$p=null,X=_(arguments),S=B(X),S=w(S),O=X,te=T(S,"round_type"),M(J,R(J,"initialize",K,!1,!0),"initialize",[],null),J.notations=O,J.round_type=te,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[$,">=",">","<=","<","==","!="],J.question_target=!1},-2),E(i,"$disable_modifier",function(){return this.modifier=!1,this}),E(i,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),E(i,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),E(i,"$has_prefix_number",function(){var k=this;return k.prefix_number=!0,k.need_prefix_number=!0,k}),E(i,"$has_suffix_number",function(){var k=this;return k.suffix_number=!0,k.need_suffix_number=!0,k}),E(i,"$enable_critical",function(){return this.critical=!0,this}),E(i,"$enable_fumble",function(){return this.fumble=!0,this}),E(i,"$enable_dollar",function(){return this.dollar=!0,this}),E(i,"$restrict_cmp_op_to",function(k){var Z;return Z=_(arguments),this.allowed_cmp_op=Z,this},-1),E(i,"$enable_question_target",function(){return this.question_target=!0,this}),E(i,"$parse",function(k){var Z=this;try{return Z.lexer=r("Lexer").$new(k,Z.notations),Z.$do_parse()}catch(X){if(!e.rescue(X,[r("ParseError"),r("ZeroDivisionError")]))throw X;try{return $}finally{e.pop_exception()}}}),i.$private(),E(i,"$parsed",function(k,Z,X,S){try{return j("eval_return"),N(r("Parsed").$new(),"tap",[],function ee(J){var _e,le,de,me,ve,fe,be,oe=null==ee.$$s?this:ee.$$s;return null==oe.round_type&&(oe.round_type=$),null==J&&(J=$),J["$command="](k["$[]"]("command")),J["$prefix_number="]((_e=k["$[]"]("prefix"))===$||null==_e?$:_e.$eval(oe.round_type)),J["$suffix_number="]((le=k["$[]"]("suffix"))===$||null==le?$:le.$eval(oe.round_type)),J["$critical="]((de=Z["$[]"]("critical"))===$||null==de?$:de.$eval(oe.round_type)),J["$fumble="]((me=Z["$[]"]("fumble"))===$||null==me?$:me.$eval(oe.round_type)),J["$dollar="]((ve=Z["$[]"]("dollar"))===$||null==ve?$:ve.$eval(oe.round_type)),J["$modify_number="](X.$eval(oe.round_type)),J["$cmp_op="](S["$[]"]("cmp_op")),H(S["$[]"]("target"),"?")?(J["$question_target="](!0),N(J,"target_number=",fe=[0]),fe[fe.length-1]):(J["$question_target="](!1),fe=[(be=S["$[]"]("target"),be===$||null==be?$:be.$eval(oe.round_type))],N(J,"target_number=",fe),fe[fe.length-1])},{$$s:this})}catch(ee){if(ee===e.t_eval_return)return ee.$v;throw ee}}),E(i,"$next_token",function(){return this.lexer.$next_token()}),g=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),n=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),f=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),a=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),W=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),Q=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),V=[$,6,13,3,9,-1,27,-15,-10,-1,-38],ne=[$,$,$,$,$,$,19,16,15,$,$],$e=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ce=P(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),U(o[0],"Racc_arg",[g,n,a,f,W,Q,ne,V,19,$e,ce,58,35,!0]),A(r("Ractor","skip_raise")?"constant":$)&&r("Ractor").$make_shareable(r("Racc_arg")),U(o[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),A(r("Ractor","skip_raise")?"constant":$)&&r("Ractor").$make_shareable(r("Racc_token_to_s_table")),U(o[0],"Racc_debug_parser",!1),E(i,"$_reduce_1",function(k,Z,X){var S;return A(this.modifier)||this.$raise(r("ParseError")),S=b(k),this.$parsed(null==S[0]?$:S[0],null==S[1]?$:S[1],null==S[2]?$:S[2],null==S[3]?$:S[3])}),E(i,"$_reduce_2",function(k,Z,X){var S;return A(this.modifier)||this.$raise(r("ParseError")),S=b(k),this.$parsed(null==S[0]?$:S[0],null==S[2]?$:S[2],null==S[1]?$:S[1],null==S[3]?$:S[3])}),E(i,"$_reduce_3",function(k,Z,X){var S,_e;return _e=null==(S=b(k))[2]?$:S[2],this.$parsed(null==S[0]?$:S[0],null==S[1]?$:S[1],q(q(r("Arithmetic"),"Node"),"Number").$new(0),_e)}),E(i,"$_reduce_4",function(k,Z,X){var S=this;return A(S.prefix_number)&&A(S.suffix_number)||S.$raise(r("ParseError")),Y(["command","prefix","suffix"],{command:k["$[]"](1),prefix:k["$[]"](0),suffix:k["$[]"](2)})}),E(i,"$_reduce_5",function(k,Z,X){var S=this;return A(S.prefix_number)||S.$raise(r("ParseError")),A(S.need_suffix_number)&&S.$raise(r("ParseError")),Y(["command","prefix"],{command:k["$[]"](1),prefix:k["$[]"](0)})}),E(i,"$_reduce_6",function(k,Z,X){var S=this;return A(S.suffix_number)||S.$raise(r("ParseError")),A(S.need_prefix_number)&&S.$raise(r("ParseError")),Y(["command","suffix"],{command:k["$[]"](0),suffix:k["$[]"](1)})}),E(i,"$_reduce_7",function(k,Z,X){var S=this;return(A(S.need_prefix_number)||A(S.need_suffix_number))&&S.$raise(r("ParseError")),Y(["command"],{command:k["$[]"](0)})}),E(i,"$_reduce_8",function(k,Z,X){return Y([],{})}),E(i,"$_reduce_9",function(k,Z,X){var S,_e,ee=$;return ee=null==(S=b(k))[0]?$:S[0],_e=null==S[2]?$:S[2],A(this.critical)&&A(ee["$[]"]("critical")["$nil?"]())||this.$raise(r("ParseError")),ee["$[]="]("critical",_e),ee}),E(i,"$_reduce_10",function(k,Z,X){var S,_e,ee=$;return ee=null==(S=b(k))[0]?$:S[0],_e=null==S[2]?$:S[2],A(this.fumble)&&A(ee["$[]"]("fumble")["$nil?"]())||this.$raise(r("ParseError")),ee["$[]="]("fumble",_e),ee}),E(i,"$_reduce_11",function(k,Z,X){var S,_e,ee=$;return ee=null==(S=b(k))[0]?$:S[0],_e=null==S[2]?$:S[2],A(this.dollar)&&A(ee["$[]"]("dollar")["$nil?"]())||this.$raise(r("ParseError")),ee["$[]="]("dollar",_e),ee}),E(i,"$_reduce_12",function(k,Z,X){return k["$[]"](1)}),E(i,"$_reduce_13",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"Negative").$new(k["$[]"](1))}),E(i,"$_reduce_14",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"BinaryOp").$new(k["$[]"](0),"+",k["$[]"](2))}),E(i,"$_reduce_15",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"BinaryOp").$new(k["$[]"](0),"-",k["$[]"](2))}),E(i,"$_reduce_16",function(k,Z,X){return A(this.allowed_cmp_op["$include?"]($))||this.$raise(r("ParseError")),Y([],{})}),E(i,"$_reduce_17",function(k,Z,X){var S,ee,J;return J=null==(S=b(k))[1]?$:S[1],A(this.allowed_cmp_op["$include?"](ee=null==S[0]?$:S[0]))||this.$raise(r("ParseError")),Y(["cmp_op","target"],{cmp_op:ee,target:J})}),E(i,"$_reduce_18",function(k,Z,X){var O,S=this;return O=k["$[]"](0),A(S.question_target)||S.$raise(r("ParseError")),A(S.allowed_cmp_op["$include?"](O))||S.$raise(r("ParseError")),Y(["cmp_op","target"],{cmp_op:O,target:"?"})}),E(i,"$_reduce_19",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"BinaryOp").$new(k["$[]"](0),"+",k["$[]"](2))}),E(i,"$_reduce_20",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"BinaryOp").$new(k["$[]"](0),"-",k["$[]"](2))}),E(i,"$_reduce_22",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"BinaryOp").$new(k["$[]"](0),"*",k["$[]"](2))}),E(i,"$_reduce_23",function(k,Z,X){return k["$[]"](3).$new(k["$[]"](0),k["$[]"](2))}),E(i,"$_reduce_25",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),E(i,"$_reduce_26",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"DivideWithCeil")}),E(i,"$_reduce_27",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"DivideWithCeil")}),E(i,"$_reduce_28",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"DivideWithRound")}),E(i,"$_reduce_29",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"DivideWithFloor")}),E(i,"$_reduce_30",function(k,Z,X){return k["$[]"](1)}),E(i,"$_reduce_31",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"Negative").$new(k["$[]"](1))}),E(i,"$_reduce_33",function(k,Z,X){return k["$[]"](1)}),E(i,"$_reduce_34",function(k,Z,X){return q(q(r("Arithmetic"),"Node"),"Number").$new(k["$[]"](0))}),E(i,"$_reduce_none",function(k,Z,X){return k["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var N,U,G,u,m,$,b,j,F=e.module,L=e.send,_=e.eqeqeq,B=e.truthy,w=e.def,T=e.return_val,M=[],R=e.nil;return N=M,U=j=[F(M[0],"BCDice")].concat(N),G=b=[F(j[0],"Deprecated")].concat(U),m=[u=F(b[0],"Checker")].concat(G),$=e.$r(m),u.$private(),w(u,"$check_result_legacy",function(t,c,h,I){var p,D=this,C=R,x=R,l=R,v=R;return C=L(c,"map",[],"sides".$to_proc()),p=(x=L(c,"map",[],"value".$to_proc())).$sum(),l=_([100],v=C)?D.$check_1D100(t,p,h,I):_([20],v)?D.$check_1D20(t,p,h,I):_([6,6],v)?D.$check_2D6(t,p,x,h,I):R,(B(l["$nil?"]())||B(l["$empty?"]()))&&(l=_([10],v=C.$uniq())?D.$check_nD10(t,p,x,h,I):_([6],v)?D.$check_nD6(t,p,x,h,I):R,B(l["$nil?"]())||B(l["$empty?"]()))?R:$("Result").$new(l.$delete_prefix(" \uff1e "))}),w(u,"$check_1D100",T(R)),w(u,"$check_1D20",T(R)),w(u,"$check_nD10",T(R)),w(u,"$check_2D6",T(R)),w(u,"$check_nD6",T(R))},Opal.modules["bcdice/base"]=function(e){var m,D,v,z,r,g,s,d,i,y,x,F=e.module,L=e.klass,_=e.slice,B=e.rb_plus,w=e.truthy,T=e.def,M=e.regexp,R=e.send,E=e.thrower,N=e.return_ivar,H=e.assign_ivar_val,j=e.eqeqeq,P=e.eqeq,U=e.return_val,A=e.range,b=e.rb_minus,Y=e.rb_divide,G=e.rb_times,u=e.rb_ge,$=e.top,q=[],t=e.$r(q),c=e.nil,h=e.$$$;return $.$require("i18n"),$.$require("i18n/backend/fallbacks"),$.$require("bcdice/randomizer"),$.$require("bcdice/dice_table"),$.$require("bcdice/enum"),$.$require("bcdice/translate"),$.$require("bcdice/result"),$.$require("bcdice/command/parser"),$.$require("bcdice/deprecated/checker"),D=q,v=x=[F(q[0],"BCDice")].concat(D),d=[s=L(x[0],null,"Base")].concat(v),i=e.$r(d),(y=s.$$prototype).raw_input=y.randomizer=y.enabled_upcase_input=y.debug=c,r=[z=e.get_singleton_class(s)].concat(d),g=e.$r(r),z.$attr_reader("prefixes"),T(z,"$register_prefix",function(f){var W,V,Q=this;return null==Q.prefixes&&(Q.prefixes=c),W=_(arguments),Q.prefixes=B(w(V=Q.prefixes)?V:[],W.$flatten())},-1),T(z,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),T(z,"$prefixes_pattern",function(){var f=this,a=c;return null==f.prefixes_pattern&&(f.prefixes_pattern=c),null==f.prefixes&&(f.prefixes=c),f.prefixes_pattern=w(a=f.prefixes_pattern)?a:c,w(f.prefixes_pattern)?f.prefixes_pattern:(f.prefixes=w(a=f.prefixes)?a:[],f.prefixes.$freeze(),f.prefixes_pattern=(w(f.prefixes["$empty?"]())?/(?!)/:M(["^(S)?(",f.prefixes.$join("|"),")"],"i")).$freeze())}),T(z,"$command_pattern",function(){var f=this,a=c,W=c;return null==f.command_pattern&&(f.command_pattern=c),null==f.prefixes&&(f.prefixes=c),f.command_pattern=w(a=f.command_pattern)?a:c,w(f.command_pattern)?f.command_pattern:(f.prefixes=w(a=f.prefixes)?a:[],f.prefixes.$freeze(),W=B(R(h(g("CommonCommand"),"COMMANDS"),"map",[],function(V){return null==V&&(V=c),h(V,"PREFIX_PATTERN").$source()}),f.prefixes),f.command_pattern=M(["^S?(",W.$join("|"),")"],"i").$freeze())}),T(z,"$eval",function(f){try{return E("eval_return"),this.$new(f).$eval()}catch(Q){if(Q===e.t_eval_return)return Q.$v;throw Q}}),s.$include(i("Translate")),s.$include(h(i("Deprecated"),"Checker")),T(s,"$initialize",function(o){var r=this;return r.raw_input=o,r.sort_add_dice=!1,r.sort_barabara_dice=!1,r.d66_sort_type=h(i("D66SortType"),"NO_SORT"),r.enabled_d9=!1,r.round_type=h(i("RoundType"),"FLOOR"),r.sides_implicit_d=6,r.upper_dice_reroll_threshold=c,r.reroll_dice_reroll_threshold=c,r.default_cmp_op=c,r.default_target_number=c,r.enabled_upcase_input=!0,r.locale="ja_jp",r.randomizer=h(i("BCDice"),"Randomizer").$new(),r.debug=!1}),s.$attr_accessor("randomizer"),s.$attr_reader("d66_sort_type"),s.$attr_reader("round_type"),s.$attr_reader("sides_implicit_d"),s.$attr_reader("upper_dice_reroll_threshold"),s.$attr_reader("reroll_dice_reroll_threshold"),s.$attr_reader("default_cmp_op"),s.$attr_reader("default_target_number"),T(s,"$sort_add_dice?",N("sort_add_dice")),T(s,"$sort_barabara_dice?",N("sort_barabara_dice")),T(s,"$enabled_d9?",N("enabled_d9")),T(s,"$enable_debug",H("debug",!0)),T(s,"$eval",function(){var r,n,o=this,g=c;return r=h(i("BCDice"),"Preprocessor").$process(o.raw_input,o),g=w(n=o.$dice_command(r))?n:o.$eval_common_command(o.raw_input),w(g)?(g["$rands="](o.randomizer.$rand_results()),g["$detailed_rands="](o.randomizer.$detailed_rand_results()),g):c}),T(s,"$change_text",function(o){return o}),T(s,"$check_result",function(o,r,g,n){var f=this,a=c,W=c,Q=c,V=c,ne=c;return a=f.$check_result_legacy(o,r,g,n),w(a)?a:(W=R(r,"map",[],"sides".$to_proc()),V=(Q=R(r,"map",[],"value".$to_proc())).$sum(),a=j([100],ne=W)?f.$result_1d100(o,V,g,n):j([20],ne)?f.$result_1d20(o,V,g,n):j([6,6],ne)?f.$result_2d6(o,V,Q,g,n):c,P(a,i("Result").$nothing())?c:w(a)?a:(a=j([10],ne=W.$uniq())?f.$result_nd10(o,V,Q,g,n):j([6],ne)?f.$result_nd6(o,V,Q,g,n):c,P(a,i("Result").$nothing())?c:w(a)?a:f.$result_ndx(o,g,n)))}),T(s,"$grich_text",U(c)),s.$private(),T(s,"$eval_common_command",function(o){try{E("eval_return");var g=E("return");return o=this.$change_text(o),R(h(i("CommonCommand"),"COMMANDS"),"each",[],function f(a){var Q,W=null==f.$$s?this:f.$$s;if(null==W.randomizer&&(W.randomizer=c),null==a&&(a=c),Q=a.$eval(o,W,W.randomizer),!w(Q))return c;g.$throw(Q)},{$$s:this,$$ret:g}),c}catch(f){if(f===e.t_eval_return||f===g)return f.$v;throw f}}),T(s,"$dice_command",function(o){var r=this,g=c,n=c,f=c,a=c;return w(r.enabled_upcase_input)&&(o=o.$upcase()),g=r.$class().$prefixes_pattern().$match(o),w(g)?(n=g["$[]"](1)["$nil?"]()["$!"](),w(n)&&(o=o["$[]"](A(1,-1,!1))),f=r.$eval_game_system_specific_command(o),w(f["$is_a?"](i("Result")))?(f["$secret="](w(a=f["$secret?"]())?a:n),f):w(f["$nil?"]())||w(f["$empty?"]())||P(f,"1")?c:R(i("Result").$new(),"tap",[],function(Q){var V;return null==Q&&(Q=c),Q["$text="](f.$to_s()),R(Q,"secret=",V=[n]),V[V.length-1]})):c}),T(s,"$eval_game_system_specific_command",U(c)),T(s,"$result_ndx",function(o,r,g){return w(g["$is_a?"](i("String")))?c:w(o.$send(r,g))?i("Result").$success(this.$translate("success")):i("Result").$failure(this.$translate("failure"))}),T(s,"$result_1d100",U(c)),T(s,"$result_1d20",U(c)),T(s,"$result_nd10",U(c)),T(s,"$result_2d6",U(c)),T(s,"$result_nd6",U(c)),T(s,"$get_table_by_2d6",function(o){return this.$get_table_by_nD6(o,2)}),T(s,"$get_table_by_1d6",function(o){return this.$get_table_by_nD6(o,1)}),T(s,"$get_table_by_nD6",function(o,r){return this.$get_table_by_nDx(o,r,6)}),T(s,"$get_table_by_nDx",function(o,r,g){var f,a=c;return f=this.randomizer.$roll_sum(r,g),a=this.$get_table_value(o["$[]"](b(f,r))),w(a["$nil?"]())?["1",0]:[a,f]}),T(s,"$get_table_by_1d3",function(o){var n,f,r=this,a=c;return r.$debug("get_table_by_1d3"),n=r.randomizer.$roll_sum(1,6),r.$debug("num",n),f=Y(b(n,1),2).$to_i(),r.$debug("index",f),a=o["$[]"](f),w(a["$nil?"]())?["1",0]:[a,n]}),T(s,"$get_table_by_d66_swap",function(o){var g;return g=this.randomizer.$roll_d66(h(i("D66SortType"),"ASC")),[this.$get_table_by_number(g,o),g]}),T(s,"$get_table_by_d66",function(o){var g,n,f,W,a=c;return g=this.randomizer.$roll_once(6),n=this.randomizer.$roll_once(6),f=B(G(b(g,1),6),b(n,1)),a=o["$[]"](f),W=""+g+n,w(a["$nil?"]())?["1",W]:[a,W]}),T(s,"$get_table_by_number",function(o,r,g){try{var n=E("return");return null==g&&(g="1"),R(r,"each",[],function a(W){var V,Q=null==a.$$s?this:a.$$s;if(null==W&&(W=c),V=W["$[]"](0),!w(u(V,o)))return c;n.$throw(Q.$get_table_value(W["$[]"](1)))},{$$s:this,$$ret:n}),this.$get_table_value(g)}catch(a){if(a===n)return a.$v;throw a}},-3),T(s,"$get_table_value",function(o){return w(o["$is_a?"](i("Proc")))?o.$call():o}),T(s,"$roll_tables",function(o,r){var n=c;return n=r["$[]"](o),w(n)?n.$roll(this.randomizer).$to_s():c}),T(s,"$debug",function(o,r){var n,f=this,a=c,W=c;return n=_(arguments,1),w(f.debug)?(a=w(o["$is_a?"](i("String")))?o:o.$inspect(),w(n["$empty?"]())?f.$warn(a):(W=R(n,"map",[],function(V){return null==V&&(V=c),w(V["$is_a?"](i("String")))?'"'+V+'"':V.$inspect()}),f.$warn(a+": "+W.$join(", ")))):c},-2),h(h(t("I18n"),"Backend"),"Simple").$include(h(h(t("I18n"),"Backend"),"Fallbacks")),t("I18n").$load_path()["$<<"](t("Dir")["$[]"](t("File").$join("bcdice","../../i18n/**/*.yml"))),t("I18n")["$default_locale="]("ja_jp"),m=[["ja_jp"]],R(t("I18n").$fallbacks(),"defaults=",m),m[m.length-1]},Opal.queue(function(e){var u,t,x,p,l,v,h,I,$,F=e.module,L=e.klass,_=e.const_set,B=e.hash2,w=e.truthy,T=e.eqeq,M=e.send,R=e.rb_plus,E=e.rb_times,N=e.def,H=e.not,j=e.rb_le,P=e.rb_ge,A=[],b=e.nil,Y=e.$$$;return e.top.$require("bcdice/base"),u=A,t=$=[F(A[0],"BCDice")].concat(u),h=[F($[0],"GameSystem")].concat(t),I=e.$r(h),x=h,l=[p=L(h[0],I("Base"),"SamsaraBallad")].concat(x),v=e.$r(l),p.$$prototype.randomizer=b,_(l[0],"ID","SamsaraBallad"),_(l[0],"NAME","\u30b5\u30f3\u30b5\u30fc\u30e9\u30fb\u30d0\u30e9\u30c3\u30c9"),_(l[0],"SORT_KEY","\u3055\u3093\u3055\u3042\u3089\u306f\u3089\u3064\u3068"),_(l[0],"HELP_MESSAGE","SB\t \u901a\u5e38\u306eD100\u30ed\u30fc\u30eb\u3092\u884c\u3046\nSBS\t \u30b9\u30ef\u30c3\u30d7\u30ed\u30fc\u30eb\u3067D100\u30ed\u30fc\u30eb\u3092\u884c\u3046\nSB#x@y\t F\u5024\u3092x\u3001C\u5024\u3092y\u3068\u3057\u3066\u901a\u5e38\u306eD100\u30ed\u30fc\u30eb\u3092\u884c\u3046\nSBS#x@y\t F\u5024\u3092x\u3001C\u5024\u3092y\u3068\u3057\u3066\u30b9\u30ef\u30c3\u30d7\u30ed\u30fc\u30eb\u3067D100\u30ed\u30fc\u30eb\u3092\u884c\u3046\n\n\u4f8b\uff1a\nSB<=85 \u901a\u5e38\u306e\u6280\u80fd\u3067\u6210\u529f\u738785%\u306e\u5224\u5b9a\nSBS<=70 \u7fd2\u719f\u3092\u5f97\u305f\u6280\u80fd\u3067\u6210\u529f\u738770%\u306e\u5224\u5b9a\nSBS#3@7<=80 \u7fd2\u719f\u3092\u5f97\u305f\u6280\u80fd\u3067\u3001F\u50243\u3001C\u50247\u3067\u6210\u529f\u738780%\u306e\u653b\u6483\u5224\u5b9a\nSB<57 \u901a\u5e38\u306e\u6280\u80fd\u3067\u3001\u80fd\u52d5\u5074\u306e\u9054\u6210\u5024\u304c57\u306e\u53d7\u52d5\u5224\u5b9a\nSBS<70 \u7fd2\u719f\u3092\u5f97\u305f\u6280\u80fd\u3067\u3001\u80fd\u52d5\u5074\u306e\u9054\u6210\u5024\u304c70\u306e\u53d7\u52d5\u5224\u5b9a\n"),p.$register_prefix("SBS?"),N(p,"$eval_game_system_specific_command",function(i){var y=this,o=b,r=b,g=b,n=b,f=b,a=b,W=b,Q=b,V=b,ne=b;return y.$debug("eval_game_system_specific_command Begin"),o=Y(v("Command"),"Parser").$new("SBS","SB",B(["round_type"],{round_type:y.$round_type()})).$enable_critical().$enable_fumble().$restrict_cmp_op_to(b,"<=","<").$parse(i),w(o)?(T(o.$command(),"SB")?(r=b,g=y.randomizer.$roll_once(100)):(r=(n=y.randomizer.$roll_once(10))+","+(f=y.randomizer.$roll_once(10)),a=M([n,f],"map",[],function(ue){return null==ue&&(ue=b),T(ue,10)?0:ue}).$sort(),g=R(E(a["$[]"](0),10),a["$[]"](1)),T(g,0)&&(g=100)),W=y.$compare(g,o),Q=w(W["$failure?"]())?"\u5931\u6557":w(W["$success?"]())?"\u6210\u529f":b,V=w(W["$fumble?"]())?"\u30d5\u30a1\u30f3\u30d6\u30eb":w(W["$critical?"]())?"\u30af\u30ea\u30c6\u30a3\u30ab\u30eb":b,ne=["(D100"+o.$cmp_op()+o.$target_number()+")",r,g.$to_s(),Q,V].$compact(),W["$text="](ne.$join(" \uff1e ")),W):b}),p.$private(),N(p,"$compare",function(i,y){var z=this;return w(["<=","<"]["$include?"](y.$cmp_op()))?H(i.$send(y.$cmp_op(),y.$target_number()))?v("Result").$failure(b):w(z["$fumble_?"](i,y.$fumble()))?M(v("Result").$new(),"tap",[],function(r){var g;return null==r&&(r=b),r["$success="](!0),M(r,"fumble=",g=[!0]),g[g.length-1]}):w(z["$critical_?"](i,y.$critical()))?v("Result").$critical(b):v("Result").$success(b):w(z["$fumble_?"](i,y.$fumble()))?M(v("Result").$new(),"tap",[],function(r){var g;return null==r&&(r=b),M(r,"fumble=",g=[!0]),g[g.length-1]}):w(z["$critical_?"](i,y.$critical()))?M(v("Result").$new(),"tap",[],function(r){var g;return null==r&&(r=b),M(r,"critical=",g=[!0]),g[g.length-1]}):v("Result").$new()}),N(p,"$fumble_?",function(i,y){var z;return w(z=y)?j(i["$%"](10),y):z}),N(p,"$critical_?",function(i,y){var z;return w(z=y)?P(i["$%"](10),y):z})})}}]);