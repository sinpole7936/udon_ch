(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[4969],{4508:(ge,ye,be)=>{be(5151),Opal.modules["i18n/backend/fallbacks"]=function(e){var G,$,t,c,u,v,F=e.module,L=e.class_variable_set,l=e.truthy,I=e.class_variable_get,S=e.def,q=e.send,U=e.send2,D=e.find_super,E=e.hash2,A=e.find_block_super,H=e.neqeq,j=e.thrower,N=e.return_val,M=[],B=e.nil,d=e.$$$;return G=M,v=[u=F(M[0],"I18n")].concat(G),L(v[0],"@@fallbacks",B),$=e.get_singleton_class(u),t=[$].concat(v),c=e.$r(t),S($,"$fallbacks",function(){var w=B;return L(t[1],"@@fallbacks",l(null!=t[1].$$cvars["@@fallbacks"]?"class variable":B)&&l(w=I(t[1],"@@fallbacks",!1))?w:d(d(c("I18n"),"Locale"),"Fallbacks").$new()),l(w=c("Thread").$current()["$[]"]("i18n_fallbacks"))?w:I(t[1],"@@fallbacks",!1)}),S($,"$fallbacks=",function(P){var w;return L(t[1],"@@fallbacks",l(P["$is_a?"](c("Array")))?d(d(c("I18n"),"Locale"),"Fallbacks").$new(P):P),w=["i18n_fallbacks",I(t[1],"@@fallbacks",!1)],q(c("Thread").$current(),"[]=",w),w[w.length-1]}),function($,T){var P,w,C,y,c=[F($,"Backend")].concat(T);return P=c,C=[w=F(c[0],"Fallbacks")].concat(P),y=e.$r(C),S(w,"$translate",function p(o,g,s){try{var _=j("return"),i=p.$$p||B,h=this,R=B,f=B;return p.$$p=null,null==s&&(s=y("EMPTY_HASH")),l(s.$fetch("fallback",!0))?l(s["$[]"]("fallback_in_progress"))?U(h,D(h,"translate",p,!1,!0),"translate",[o,g,s],i):(l(s["$[]"]("default"))&&(R=h["$extract_non_symbol_default!"](s)),f=s.$merge(E(["fallback_in_progress"],{fallback_in_progress:!0})),q(y("I18n").$fallbacks()["$[]"](o),"each",[],function r(x){var n=null==r.$$s?this:r.$$s;null==x&&(x=B);try{return q(n,"catch",["exception"],function m(){var a=null==m.$$s?this:m.$$s,W=B;if(W=U(a,A(a,"translate",m.$$def||r.$$def||p,!1,!1),"translate",[x,g,f],null),l(W["$nil?"]()))return B;H(o.$to_s(),x.$to_s())&&a.$on_fallback(o,x,g,s),_.$throw(W)},{$$s:n,$$ret:_})}catch(m){if(!e.rescue(m,[d(y("I18n"),"InvalidLocale")]))throw m;try{return B}finally{e.pop_exception()}}},{$$s:h}),l(s["$key?"]("default"))&&l(s["$[]"]("default")["$nil?"]())?B:l(R)?U(h,D(h,"translate",p,!1,!0),"translate",[o,B,s.$merge(E(["default"],{default:R}))],null):h.$throw("exception",d(y("I18n"),"MissingTranslation").$new(o,g,s))):U(h,D(h,"translate",p,!1,!0),"translate",[o,g,s],i)}catch(r){if(r===_)return r.$v;throw r}},-3),S(w,"$extract_non_symbol_default!",function(o){var s,g=B;return g=[o["$[]"]("default")].$flatten(),s=q(g,"detect",[],function(i){return null==i&&(i=B),i["$is_a?"](y("Symbol"))["$!"]()}),l(s)&&o["$[]="]("default",g["$[]"](0,g.$index(s))),s}),S(w,"$exists?",function p(o,g,s){try{var _=j("return"),i=p.$$p||B,h=this;return p.$$p=null,null==s&&(s=y("EMPTY_HASH")),l(s.$fetch("fallback",!0))?(q(y("I18n").$fallbacks()["$[]"](o),"each",[],function R(f){var r=null==R.$$s?this:R.$$s;null==f&&(f=B);try{if(!l(U(r,A(r,"exists?",R.$$def||p,!1,!1),"exists?",[f,g],null)))return B;_.$throw(!0)}catch(x){if(!e.rescue(x,[d(y("I18n"),"InvalidLocale")]))throw x;try{return B}finally{e.pop_exception()}}},{$$s:h,$$ret:_}),!1):U(h,D(h,"exists?",p,!1,!0),"exists?",[o,g,s],i)}catch(R){if(R===_)return R.$v;throw R}},-3),w.$private(),S(w,"$on_fallback",N(B))}(v[0],v)},Opal.modules["bcdice/randomizer"]=function(e){var u,b,P,w,C,y,$,T,L=e.klass,l=e.const_set,I=e.def,S=e.truthy,q=e.rb_gt,U=e.rb_plus,D=e.rb_le,E=e.send,A=e.rb_minus,H=e.eqeq,j=e.rb_times,N=e.eqeqeq,M=e.rb_ge,B=[],d=e.nil,Y=e.$$$;return u=B,$=[(0,e.module)(B[0],"BCDice")].concat(u),T=e.$r($),b=$,w=[P=L($[0],null,"Randomizer")].concat(b),C=e.$r(w),(y=P.$$prototype).rand_results=y.detailed_rand_results=d,l(w[0],"UPPER_LIMIT_DICE_TIMES",200),l(w[0],"UPPER_LIMIT_DICE_SIDES",1e4),l(w[0],"UPPER_LIMIT_RANDS",1e4),I(P,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),P.$attr_reader("rand_results"),P.$attr_reader("detailed_rand_results"),l(w[0],"DetailedRandResult",C("Struct").$new("kind","sides","value")),I(P,"$roll_barabara",function(o,g){var s=this;return S(q(U(s.rand_results.$size(),o),C("UPPER_LIMIT_RANDS")))&&s.$raise(C("TooManyRandsError")),S(D(o,0))||S(q(o,C("UPPER_LIMIT_DICE_TIMES")))?[]:E(C("Array"),"new",[o],function _(){return(null==_.$$s?this:_.$$s).$roll_once(g)},{$$s:s})}),I(P,"$roll_sum",function(o,g){return this.$roll_barabara(o,g).$sum()}),I(P,"$roll_once",function(o){var s=d;return S(D(o,0))||S(q(o,C("UPPER_LIMIT_DICE_SIDES")))?0:(s=this.$rand_inner(o),this.$push_to_detail("normal",o,s),s)}),I(P,"$roll_index",function(o){return A(this.$roll_once(o),1)}),I(P,"$roll_tens_d10",function(){var s,g=d;return g=this.$rand_inner(10),H(g,10)&&(g=0),s=j(g,10),this.$push_to_detail("tens_d10",10,s),s}),I(P,"$roll_d9",function(){var g;return g=A(this.$rand_inner(10),1),this.$push_to_detail("d9",10,g),g}),I(P,"$roll_d66",function(o){var _,s=d;return s=E(C("Array"),"new",[2],function i(){return(null==i.$$s?this:i.$$s).$roll_once(6)},{$$s:this}),N(Y(C("D66SortType"),"ASC"),_=o)?s["$sort!"]():N(Y(C("D66SortType"),"DESC"),_)&&s["$sort!"]()["$reverse!"](),U(j(s["$[]"](0),10),s["$[]"](1))}),P.$private(),I(P,"$rand_inner",function(o){var s,g=this;return S(M(g.rand_results.$size(),C("UPPER_LIMIT_RANDS")))&&g.$raise(C("TooManyRandsError")),s=g.$random(o),g.rand_results["$<<"]([s,o]),s}),I(P,"$random",function(o){return U(C("Kernel").$rand(o),1)}),I(P,"$push_to_detail",function(o,g,s){var i;return i=C("DetailedRandResult").$new(o,g,s),this.detailed_rand_results.$push(i)}),L($[0],T("StandardError"),"TooManyRandsError"),d},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var E,N,G,u,v,$,T,B,H,F=e.module,L=e.klass,l=e.def,I=e.truthy,S=e.return_val,q=[],U=e.nil;return E=q,N=H=[F(q[0],"BCDice")].concat(E),G=B=[F(H[0],"DiceTable")].concat(N),v=[u=L(B[0],null,"RollResult")].concat(G),$=e.$r(v),(T=u.$$prototype).table_name=T.value=T.body=U,l(u,"$initialize",function(c,b,P){var w=this;return w.table_name=c,w.value=b,w.body=P}),u.$attr_reader("table_name"),u.$attr_reader("value"),u.$attr_reader("body"),l(u,"$to_s",function(){var c=this;return c.table_name+"("+c.value+") \uff1e "+c.body}),l(u,"$last_body",function(){var c=this;return I(c.body["$is_a?"]($("RollResult")))?c.body.$last_body():c.body}),l(u,"$empty?",S(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var E,N,G,u,v,$,T,B,H,F=e.module,L=e.klass,l=e.truthy,I=e.def,S=e.rb_minus,q=[],U=e.nil;return E=q,N=H=[F(q[0],"BCDice")].concat(E),G=B=[F(H[0],"DiceTable")].concat(N),v=[u=L(B[0],null,"ChainTable")].concat(G),$=e.$r(v),(T=u.$$prototype).times=T.sides=T.items=T.name=U,I(u,"$initialize",function(c,b,P){var w=this,C=U;return w.name=c,w.items=P.$freeze(),C=/(\d+)D(\d+)/i.$match(b),l(C)||w.$raise($("ArgumentError"),"Unexpected table type: "+b),w.times=C["$[]"](1).$to_i(),w.sides=C["$[]"](2).$to_i()}),I(u,"$roll",function(c){var P,w,b=this,C=U;return P=c.$roll_sum(b.times,b.sides),w=S(P,b.times),C=b.items["$[]"](w),l(C["$respond_to?"]("roll"))&&(C=C.$roll(c)),$("RollResult").$new(b.name,P,C)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var j,d,$,T,t,c,b,G,M,F=e.module,L=e.klass,l=e.hash2,I=e.defs,S=e.def,q=e.rb_plus,U=e.rb_times,D=e.rb_minus,E=[],A=e.nil;return j=E,d=M=[F(E[0],"BCDice")].concat(j),$=G=[F(M[0],"DiceTable")].concat(d),t=[T=L(G[0],null,"D66GridTable")].concat($),c=e.$r(t),(b=T.$$prototype).name=b.items=A,I(T,"$from_i18n",function(w,C){var p=A;return p=c("I18n").$t(w,l(["locale","raise"],{locale:C,raise:!0})),this.$new(p["$[]"]("name"),p["$[]"]("items"))}),S(T,"$initialize",function(w,C){return this.name=w,this.items=C.$freeze()}),S(T,"$roll",function(w){var y,p,o,g,s;return y=w.$roll_once(6),p=w.$roll_once(6),o=q(U(y,10),p),g=D(y,1),s=D(p,1),c("RollResult").$new(this.name,o,this.items["$[]"](g)["$[]"](s))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var A,M,v,$,T,t,d,Y,j,F=e.module,L=e.klass,l=e.hash2,I=e.defs,S=e.def,U=[],D=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),A=U,M=j=[F(U[0],"BCDice")].concat(A),d=[F(j[0],"DiceTable")].concat(M),Y=e.$r(d),v=d,T=[$=L(d[0],Y("D66GridTable"),"D66HalfGridTable")].concat(v),t=e.$r(T),I($,"$from_i18n",function(b,P){var C=D;return C=t("I18n").$t(b,l(["locale","raise"],{locale:P,raise:!0})),this.$new(C["$[]"]("name"),C["$[]"]("items_1_2_3"),C["$[]"]("items_4_5_6"))}),S($,"$initialize",function(b,P,w){return this.name=b,this.items=[P,P,P,w,w,w].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var A,M,v,$,T,t,d,Y,j,F=e.module,L=e.klass,l=e.hash2,I=e.defs,S=e.def,U=[],D=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),A=U,M=j=[F(U[0],"BCDice")].concat(A),d=[F(j[0],"DiceTable")].concat(M),Y=e.$r(d),v=d,T=[$=L(d[0],Y("D66GridTable"),"D66OneThirdTable")].concat(v),t=e.$r(T),I($,"$from_i18n",function(b,P){var C=D;return C=t("I18n").$t(b,l(["locale","raise"],{locale:P,raise:!0})),this.$new(C["$[]"]("name"),C["$[]"]("items_1_2"),C["$[]"]("items_3_4"),C["$[]"]("items_5_6"))}),S($,"$initialize",function(b,P,w,C){return this.name=b,this.items=[P,P,w,w,C,C].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var M,G,t,c,b,P,w,v,d,F=e.module,L=e.klass,l=e.hash2,I=e.defs,S=e.def,q=e.eqeqeq,U=e.rb_plus,D=e.rb_times,E=e.truthy,A=[],H=e.nil,j=e.$$$;return M=A,G=d=[F(A[0],"BCDice")].concat(M),t=v=[F(d[0],"DiceTable")].concat(G),b=[c=L(v[0],null,"D66Table")].concat(t),P=e.$r(b),(w=c.$$prototype).sort_type=w.items=w.name=H,I(c,"$from_i18n",function(y,p){var s,g=H;return g=P("I18n").$t(y,l(["locale"],{locale:p})),s=P("D66SortType").$const_get(g["$[]"]("d66_sort_type")),this.$new(g["$[]"]("name"),s,g["$[]"]("items"))}),S(c,"$initialize",function(y,p,o){var g=this;return g.name=y,g.sort_type=p,g.items=o.$freeze()}),S(c,"$roll",function(y){var p=this,o=H,g=H,s=H,_=H;return o=y.$roll_barabara(2,6),q(j(P("D66SortType"),"ASC"),g=p.sort_type)?o["$sort!"]():q(j(P("D66SortType"),"DESC"),g)&&o["$sort!"]()["$reverse!"](),s=U(D(o["$[]"](0),10),o["$[]"](1)),_=E(g=p.items["$[]"](s))?g:p.items["$[]"](s.$to_s()),E(_["$respond_to?"]("roll"))&&(_=_.$roll(y)),P("RollResult").$new(p.name,s,_)}),S(c,"$choice",function(y){return P("RollResult").$new(this.name,y,this.items["$[]"](y))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var B,u,$,T,Y,F=e.module,L=e.klass,l=e.hash2,I=e.send,S=e.to_ary,q=e.rb_plus,U=e.rb_times,D=e.send2,E=e.find_super,A=e.def,j=[],N=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),B=j,u=Y=[F(j[0],"BCDice")].concat(B),$=[F(Y[0],"DiceTable")].concat(u),T=e.$r($),A(L($[0],T("D66Table"),"D66LeftRangeTable"),"$initialize",function P(w,C,y){var g;return P.$$p=null,g=l([],{}),I(y,"each",[],function(_){var i,f;return null==_&&(_=N),i=S(_),f=null==i[1]?N:i[1],I(null==i[0]?N:i[0],"each",[],function(x){return null==x&&(x=N),I(f,"each_with_index",[],function(m,a){var W,Q;return null==m&&(m=N),null==a&&(a=N),Q=q(U(x,10),q(a,1)),I(g,"[]=",W=[Q,m]),W[W.length-1]})})}),D(this,E(this,"initialize",P,!1,!0),"initialize",[w,C,g],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var N,Y,T,t,c,b,P,u,B,F=e.module,L=e.klass,l=e.hash2,I=e.defs,S=e.def,q=e.truthy,U=e.rb_minus,D=e.rb_plus,E=e.rb_times,A=[],H=e.nil;return N=A,Y=B=[F(A[0],"BCDice")].concat(N),T=u=[F(B[0],"DiceTable")].concat(Y),c=[t=L(u[0],null,"D66ParityTable")].concat(T),b=e.$r(c),(P=t.$$prototype).odd=P.even=P.name=H,I(t,"$from_i18n",function(C,y){var o=H;return o=b("I18n").$t(C,l(["locale","raise"],{locale:y,raise:!0})),this.$new(o["$[]"]("name"),o["$[]"]("odd"),o["$[]"]("even"))}),S(t,"$initialize",function(C,y,p){var o=this;return o.name=C,o.odd=y.$freeze(),o.even=p.$freeze()}),S(t,"$roll",function(C){var o,s,_,y=this,p=H;return p=C.$roll_once(6),o=C.$roll_once(6),s=(q(p["$odd?"]())?y.odd:y.even)["$[]"](U(o,1)),_=D(E(p,10),o),b("RollResult").$new(y.name,_,s)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var A,M,u,v,$,T,t,d,j,F=e.module,L=e.klass,l=e.def,I=e.rb_plus,S=e.rb_times,q=e.send,U=[],D=e.nil;return A=U,M=j=[F(U[0],"BCDice")].concat(A),u=d=[F(j[0],"DiceTable")].concat(M),$=[v=L(d[0],null,"D66RangeTable")].concat(u),T=e.$r($),(t=v.$$prototype).items=t.name=D,l(v,"$initialize",function(b,P){return this.name=b,this.items=P.$freeze()}),l(v,"$roll",function(b){var w,C,y,p=D;return w=b.$roll_once(6),C=b.$roll_once(6),y=I(S(w,10),C),p=q(this.items,"find",[],function(g){return null==g&&(g=D),g["$[]"](0)["$include?"](y)}),T("RollResult").$new(this.name,y,p["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var B,u,c,y,o,g,b,P,w,C,$,Y,F=e.module,L=e.klass,l=e.const_set,I=e.send,S=e.hash2,q=e.def,U=e.eqeqeq,D=e.truthy,E=e.to_a,A=e.rb_times,H=e.rb_plus,j=[],N=e.nil;return B=j,u=Y=[F(j[0],"BCDice")].concat(B),c=$=[F(Y[0],"DiceTable")].concat(u),P=[b=L($[0],null,"RangeTable")].concat(c),w=e.$r(P),(C=b.$$prototype).name=C.items=C.num_of_dice=C.num_of_sides=C.formatter=N,l(P[0],"RollResult",I(w("Struct"),"new",["sum","values","content","formatted"],function y(){return(null==y.$$s?this:y.$$s).$alias_method("to_s","formatted")},{$$s:b})),l(P[0],"Item",w("Struct").$new("range","content")),l(P[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),l(P[0],"DEFAULT_FORMATTER",I(b,"lambda",[],function(p,o){return null==p&&(p=N),null==o&&(o=N),p.$name()+"("+o.$sum()+") \uff1e "+o.$content()})),b.$attr_reader("name"),b.$attr_reader("num_of_dice"),b.$attr_reader("num_of_sides"),o=[y=e.get_singleton_class(b)].concat(P),g=e.$r(o),q(y,"$from_i18n",function(_,i){var f,R=N;return R=g("I18n").$t(_,S(["locale"],{locale:i})),f=I(R["$[]"]("items"),"map",[],function r(x){return null==x&&(x=N),[(null==r.$$s?this:r.$$s).$conv_string_range(x["$[]"](0)),x["$[]"](1)]},{$$s:this}),this.$new(R["$[]"]("name"),R["$[]"]("type"),f)}),q(y,"$conv_string_range",function(_){var h,i=this;return null==i.name&&(i.name=N),U(g("Integer"),h=_)?_:U(g("String"),h)?D(_["$include?"](".."))?I(g("Range"),"new",E(I(_.$split("..",2),"map",[],function R(f){return null==f&&(f=N),(null==R.$$s?this:R.$$s).$Integer(f)},{$$s:i}))):i.$Integer(_):i.$raise(g("TypeError"),i.name+": "+_+" ("+_.$class()+") must be a String or an Integer")}),q(b,"$initialize",function y(p,o,g){var i,s=y.$$p||N,_=this,h=N;return y.$$p=null,_.name=p.$freeze(),_.formatter=D(i=s)?i:w("DEFAULT_FORMATTER"),h=w("DICE_ROLL_METHOD_RE").$match(o),D(h)||_.$raise(w("ArgumentError"),_.name+": invalid dice roll method: "+o),_.num_of_dice=h["$[]"](1).$to_i(),_.num_of_sides=h["$[]"](2).$to_i(),_.$store(g)}),q(b,"$fetch",function(p){var g,o=this;return g=I(o.items,"find",[],function(_){return null==_&&(_=N),_.$range()["$include?"](p)}),D(g)||o.$raise(w("RangeError"),o.name+": value is out of range: "+p),g}),q(b,"$roll",function(p){var s,o=this,g=N,_=N;return s=(g=p.$roll_barabara(o.num_of_dice,o.num_of_sides)).$sum(),(_=w("RollResult").$new(s,g,o.$fetch(s).$content()))["$formatted="](o.formatter["$[]"](o,_)),_}),b.$private(),q(b,"$store",function(p){var g,s,o=this;return g=I(p,"map",[],function _(i,h){return null==i&&(i=N),null==h&&(h=N),[(null==_.$$s?this:_.$$s).$coerce_to_int_range(i),h]},{$$s:o}),s=I(g,"sort_by",[],function(i,h){return null==i&&(i=N),null==h&&(h=N),i.$min()}),o.$assert_min_sum_is_covered(s),o.$assert_max_sum_is_covered(s),o.$assert_no_gap_or_overlap_in_ranges(s),o.items=I(s,"map",[],function(i,h){return null==i&&(i=N),null==h&&(h=N),w("Item").$new(i,h.$freeze()).$freeze()}).$freeze(),o}),q(b,"$coerce_to_int_range",function(p){var g;return U(w("Integer"),g=p)?w("Range").$new(p,p):U(w("Range"),g)&&D(p.$begin()["$is_a?"](w("Integer")))&&D(p.$end()["$is_a?"](w("Integer")))?p:this.$raise(w("TypeError"),this.name+": "+p+" ("+p.$class()+") must be an Integer or a Range with Integers ")}),q(b,"$assert_min_sum_is_covered",function(p){var g,o=this,s=N;return g=o.num_of_dice,s=p.$first()["$[]"](0),D(s["$include?"](g))||o.$raise(w("RangeError"),o.name+": min value ("+g+") is not covered: "+s),o}),q(b,"$assert_max_sum_is_covered",function(p){var g,o=this,s=N;return g=A(o.num_of_dice,o.num_of_sides),s=p.$last()["$[]"](0),D(s["$include?"](g))||o.$raise(w("RangeError"),o.name+": max value ("+g+") is not covered: "+s),o}),q(b,"$assert_no_gap_or_overlap_in_ranges",function(p){return I(p,"each_cons",[2],function g(s,_){var f,r,i=null==g.$$s?this:g.$$s,h=N,R=N;return null==i.name&&(i.name=N),null==s&&(s=N),null==_&&(_=N),h=s["$[]"](0),R=_["$[]"](0),f=h.$max(),r=H(f,1),D(R["$include?"](f))&&i.$raise(w("RangeError"),i.name+": Range overlap: "+h+" and "+R),D(R["$include?"](r))?N:i.$raise(w("RangeError"),i.name+": Range gap: "+h+" and "+R)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var H,B,v,b,P,w,C,T,Y,N,F=e.module,L=e.klass,l=e.send,I=e.def,S=e.rb_minus,q=e.return_ivar,U=[],D=e.nil,E=e.$$$;return H=U,B=N=[F(U[0],"BCDice")].concat(H),v=Y=[F(N[0],"DiceTable")].concat(B),b=T=[L(Y[0],null,"SaiFicSkillTable")].concat(v),w=[P=L(T[0],null,"Category")].concat(b),C=e.$r(w),I(P,"$initialize",function(p,o,g,s){var _=this;return _.name=p,_.skills=l(o.$map(),"with_index",[2],function(h,R){return null==h&&(h=D),null==R&&(R=D),E(C("SaiFicSkillTable"),"Skill").$new(p,h,g,R,s)}),_.dice=g}),I(P,"$roll",function(p){return this.$skills()["$[]"](S(p.$roll_sum(2,6),2))}),I(P,"$to_s",q("name")),P.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var D,j,Y,T,t,u,M,A,F=e.module,L=e.klass,l=e.def,I=e.hash2,S=[],q=e.nil;return D=S,j=A=[F(S[0],"BCDice")].concat(D),Y=M=[F(A[0],"DiceTable")].concat(j),u=[L(M[0],null,"SaiFicSkillTable")].concat(Y),(t=(T=L(u[0],null,"Skill")).$$prototype).s_format=t.category_dice=t.row_dice=t.category_name=t.name=q,l(T,"$initialize",function(b,P,w,C,y){var p=this;return p.category_name=b,p.name=P,p.category_dice=w,p.row_dice=C,p.s_format=y}),l(T,"$to_s",function(){var b=this;return b.$format(b.s_format,I(["category_dice","row_dice","category_name","skill_name"],{category_dice:b.category_dice,row_dice:b.row_dice,category_name:b.category_name,skill_name:b.name}))}),T.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var u,t,C,y,p,o,g,b,$,F=e.module,L=e.klass,l=e.ensure_kwargs,I=e.hash2,S=e.send,U=e.defs,D=e.const_set,E=e.to_ary,A=e.def,H=e.truthy,j=e.rb_minus,N=e.rb_plus,M=e.top,B=[],d=e.nil,Y=e.$$$;return M.$require("bcdice/dice_table/sai_fic_skill_table/category"),M.$require("bcdice/dice_table/sai_fic_skill_table/skill"),u=B,t=$=[F(B[0],"BCDice")].concat(u),C=b=[F($[0],"DiceTable")].concat(t),p=[y=L(b[0],null,"SaiFicSkillTable")].concat(C),o=e.$r(p),(g=y.$$prototype).rtt=g.rtt_format=g.rct=g.rct_format=g.rttn=g.rttn_format=g.categories=d,U(y,"$from_i18n",function(_,i,h){var R,f,r,a,m=d;return null==(R=(h=l(h)).$$smap.rtt)&&(R=d),null==(f=h.$$smap.rct)&&(f=d),null==(r=h.$$smap.rttn)&&(r=d),a=(m=o("I18n").$t("RTT",I(["locale","raise","default"],{locale:i,raise:!1,default:I([],{})})).$merge(o("I18n").$t(_,I(["locale","raise"],{locale:i,raise:!0}))))["$[]"]("items"),m=S(m,"select",[],function(Q,Z){return null==Q&&(Q=d),null==Z&&(Z=d),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](Q)}),this.$new(a,e.to_hash(m).$merge(I(["rtt","rct","rttn"],{rtt:R,rct:f,rttn:r})))},-3),D(p[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),D(p[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),D(p[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),D(p[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),A(y,"$initialize",function(_,i){var h,R,f,r,x,n,m,a=this;return null==(h=(i=l(i)).$$smap.rtt)&&(h=d),null==(R=i.$$smap.rct)&&(R=d),null==(f=i.$$smap.rttn)&&(f=d),null==(r=i.$$smap.rtt_format)&&(r=o("DEFAULT_RTT")),null==(x=i.$$smap.rct_format)&&(x=o("DEFAULT_RCT")),null==(n=i.$$smap.rttn_format)&&(n=o("DEFAULT_RTTN")),null==(m=i.$$smap.s_format)&&(m=o("DEFAULT_S")),a.categories=S(_.$map(),"with_index",[1],function(Q,Z){var $e,ue,ie;return null==Q&&(Q=d),null==Z&&(Z=d),ue=null==($e=E(Q))[0]?d:$e[0],ie=null==$e[1]?d:$e[1],Y(o("SaiFicSkillTable"),"Category").$new(ue,ie,Z,m)},{$$has_top_level_mlhs_arg:!0}),a.rtt=h,a.rct=R,a.rttn=f.$to_a(),a.rtt_format=r,a.rct_format=x,a.rttn_format=n},-2),D(p[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),y.$attr_reader("categories"),A(y,"$roll_command",function(_,i){var R,h=this,f=d,r=d;return H(["RTT",h.rtt]["$include?"](R=i))?h.$format_skill(h.rtt_format,h.$roll_skill(_)):H(["RCT",h.rct]["$include?"](R))?(f=h.$roll_category(_),h.$format(h.rct_format,I(["category_dice","category_name"],{category_dice:f.$dice(),category_name:f.$name()}))):H(r=o("RTTN").$index(R))||H(r=h.rttn.$index(R))?h.$format_skill(h.rttn_format,h.categories["$[]"](r).$roll(_)):d}),A(y,"$roll_category",function(_){return this.categories["$[]"](j(_.$roll_once(6),1))}),A(y,"$roll_skill",function(_){return this.$roll_category(_).$roll(_)}),A(y,"$prefixes",function(){var _=this;return N(["RTT[1-6]?","RCT",_.rtt,_.rct],_.rttn).$compact()}),y.$private(),A(y,"$format_skill",function(_,i){return this.$format(_,I(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:i.$category_dice(),row_dice:i.$row_dice(),category_name:i.$category_name(),skill_name:i.$name(),text:i.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var H,B,v,$,T,t,c,Y,N,F=e.module,L=e.klass,l=e.hash2,I=e.defs,S=e.truthy,q=e.def,U=e.rb_minus,D=[],E=e.nil;return H=D,B=N=[F(D[0],"BCDice")].concat(H),v=Y=[F(N[0],"DiceTable")].concat(B),T=[$=L(Y[0],null,"Table")].concat(v),t=e.$r(T),(c=$.$$prototype).times=c.sides=c.name=c.items=E,I($,"$from_i18n",function(P,w){var y=E;return y=t("I18n").$t(P,l(["locale"],{locale:w})),this.$new(y["$[]"]("name"),y["$[]"]("type"),y["$[]"]("items"))}),q($,"$initialize",function(P,w,C){var y=this,p=E;return y.name=P,y.items=C.$freeze(),p=/(\d+)D(\d+)/i.$match(w),S(p)||y.$raise(t("ArgumentError"),"Unexpected table type: "+w),y.times=p["$[]"](1).$to_i(),y.sides=p["$[]"](2).$to_i()}),q($,"$roll",function(P){var C,w=this;return C=P.$roll_sum(w.times,w.sides),w.$choice(C)}),q($,"$choice",function(P){var C,w=this;return C=U(P,w.times),t("RollResult").$new(w.name,P,w.items["$[]"](C))})},Opal.modules["bcdice/dice_table"]=function(e){var F=e.top;return F.$require("bcdice/dice_table/roll_result"),F.$require("bcdice/dice_table/chain_table"),F.$require("bcdice/dice_table/d66_grid_table"),F.$require("bcdice/dice_table/d66_half_grid_table"),F.$require("bcdice/dice_table/d66_one_third_table"),F.$require("bcdice/dice_table/d66_left_range_table"),F.$require("bcdice/dice_table/d66_parity_table"),F.$require("bcdice/dice_table/d66_range_table"),F.$require("bcdice/dice_table/d66_table"),F.$require("bcdice/dice_table/range_table"),F.$require("bcdice/dice_table/sai_fic_skill_table"),F.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var q,A,j,D,F=e.module,L=e.const_set,l=[];return q=l,A=D=[F(l[0],"BCDice")].concat(q),j=[F(D[0],"D66SortType")].concat(A),L(j[0],"NO_SORT","no_sort"),L(j[0],"ASC","asc"),L(j[0],"DESC","desc"),function(E,A){var j=[F(E,"RoundType")].concat(A);return L(j[0],"CEIL","ceil"),L(j[0],"FLOOR","floor"),L(j[0],"ROUND","round")}(D[0],D)},Opal.modules["bcdice/translate"]=function(e){var A,M,B,d,Y,j,F=e.module,L=e.ensure_kwargs,l=e.kwrestargs,S=e.hash2,q=e.def,U=[],D=e.nil;return A=U,M=j=[F(U[0],"BCDice")].concat(A),d=[B=F(j[0],"Translate")].concat(M),Y=e.$r(d),q(B,"$translate",function(u,v){var $,T=this;return null==T.locale&&(T.locale=D),v=L(v),$=l(v,{}),Y("I18n").$translate(u,S(["locale","raise"],{locale:T.locale,raise:!0}).$merge(e.to_hash($)))},-2)},Opal.modules["bcdice/result"]=function(e){var B,G,d,A,j,L=e.klass,l=e.send,I=e.def,S=e.return_val,q=e.return_ivar,U=[],D=e.nil;return A=U,B=j=[(0,e.module)(U[0],"BCDice")].concat(A),[d=L(j[0],null,"Result")].concat(B),I(G=e.get_singleton_class(d),"$success",function($){return l(this.$new(),"tap",[],function(c){var b;return null==c&&(c=D),c["$text="]($),l(c,"success=",b=[!0]),b[b.length-1]})}),I(G,"$failure",function($){return l(this.$new(),"tap",[],function(c){var b;return null==c&&(c=D),c["$text="]($),l(c,"failure=",b=[!0]),b[b.length-1]})}),I(G,"$critical",function($){return l(this.$new(),"tap",[],function(c){var b;return null==c&&(c=D),c["$text="]($),c["$critical="](!0),l(c,"success=",b=[!0]),b[b.length-1]})}),I(G,"$fumble",function($){return l(this.$new(),"tap",[],function(c){var b;return null==c&&(c=D),c["$text="]($),c["$fumble="](!0),l(c,"failure=",b=[!0]),b[b.length-1]})}),I(G,"$nothing",S("nothing")),I(d,"$initialize",function(u){var v=this;return null==u&&(u=D),v.text=u,v.rands=D,v.detailed_rands=D,v.secret=!1,v.success=!1,v.failure=!1,v.critical=!1,v.fumble=!1},-1),d.$attr_accessor("text","rands","detailed_rands"),d.$attr_writer("secret","success","failure","critical","fumble"),I(d,"$secret?",q("secret")),I(d,"$success?",q("success")),I(d,"$failure?",q("failure")),I(d,"$critical?",q("critical")),I(d,"$fumble?",q("fumble")),I(d,"$condition=",function(u){return this.success=u,this.failure=u["$!"]()})},Opal.modules["racc/parser"]=function(e){var P,C,y,F=e.module,L=e.klass,l=e.truthy,I=e.const_set,S=e.defs,q=e.gvars,U=e.rb_lt,D=e.def,E=e.to_ary,A=e.send,H=e.neqeq,j=e.rb_plus,N=e.eqeq,M=e.rb_ge,B=e.rb_gt,d=e.rb_minus,Y=e.rb_le,G=e.rb_times,u=e.assign_ivar_val,$=[],T=e.$r($),t=e.nil,c=e.$$$;return P=$,C=[F($[0],"Racc")].concat(P),y=e.$r(C),L(C[0],y("StandardError"),"ParseError"),l(c("::","ParseError","skip_raise")?"constant":t)||I($[0],"ParseError",c(T("Racc"),"ParseError")),function(b,P){var s,_,i,h,R,y=[F(b,"Racc")].concat(P),p=e.$r(y);return l(p("Racc_No_Extensions","skip_raise")?"constant":t)||I(y[0],"Racc_No_Extensions",!1),s=y,i=[_=L(y[0],null,"Parser")].concat(s),h=e.$r(i),(R=_.$$prototype).yydebug=R.racc_debug_out=R.racc_error_status=R.racc_t=R.racc_vstack=R.racc_val=R.racc_state=R.racc_tstack=t,I(i[0],"Racc_Runtime_Version","1.4.6"),I(i[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),I(i[0],"Racc_Runtime_Core_Version_R","1.4.6"),I(i[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),I(i[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),I(i[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),I(i[0],"Racc_Runtime_Core_Version",h("Racc_Runtime_Core_Version_R")),I(i[0],"Racc_Runtime_Core_Revision",h("Racc_Runtime_Core_Revision_R")),I(i[0],"Racc_Runtime_Type","ruby"),S(h("Parser"),"$racc_runtime_type",function(){return h("Racc_Runtime_Type")}),D(_,"$_racc_setup",function(){var r,x,n=this,m=t,a=t;return null==q.stderr&&(q.stderr=t),l(c(n.$class(),"Racc_debug_parser"))||(n.yydebug=!1),l(null!=(r=n.yydebug)&&r!==t?"instance-variable":t)||(n.yydebug=!1),l(n.yydebug)&&(l(null!=(x=n.racc_debug_out)&&x!==t?"instance-variable":t)||(n.racc_debug_out=q.stderr),n.racc_debug_out=l(m=n.racc_debug_out)?m:q.stderr),a=c(n.$class(),"Racc_arg"),l(U(a.$size(),14))&&a["$[]="](13,!0),a}),D(_,"$_racc_init_sysvars",function(){var r=this;return r.racc_state=[0],r.racc_tstack=[],r.racc_vstack=[],r.racc_t=t,r.racc_val=t,r.racc_read_next=!0,r.racc_user_yyerror=!1,r.racc_error_status=0}),D(_,"$do_parse",function(){return this.$__send__(h("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),D(_,"$next_token",function(){return this.$raise(h("NotImplementedError"),this.$class()+"#next_token is not defined")}),D(_,"$_racc_do_parse_rb",function(r,x){var n,a=this,W=t,Q=t,Z=t,$e=t,ue=t,ie=t,ce=t,ae=t;return n=E(r),W=null==n[0]?t:n[0],Q=null==n[1]?t:n[1],Z=null==n[2]?t:n[2],$e=null==n[3]?t:n[3],ue=null==n[10]?t:n[10],a.$_racc_init_sysvars(),ie=ce=ae=t,A(a,"catch",["racc_end_parse"],function re(){var se,K,k=null==re.$$s?this:re.$$s,V=t;for(null==k.racc_state&&(k.racc_state=t),null==k.racc_read_next&&(k.racc_read_next=t),null==k.racc_t&&(k.racc_t=t),null==k.yydebug&&(k.yydebug=t),null==k.racc_val&&(k.racc_val=t);l(!0);)for(l(ae=$e["$[]"](k.racc_state["$[]"](-1)))?(l(k.racc_read_next)&&H(k.racc_t,0)&&(K=k.$next_token(),se=E(K),ie=null==se[0]?t:se[0],k.racc_val=null==se[1]?t:se[1],k.racc_t=l(ie)?l(V=ue["$[]"](ie))?V:1:0,l(k.yydebug)&&k.$racc_read_token(k.racc_t,ie,k.racc_val),k.racc_read_next=!1),ae=j(ae,k.racc_t),l(M(ae,0))&&l(ce=W["$[]"](ae))&&N(Q["$[]"](ae),k.racc_state["$[]"](-1))||(ce=Z["$[]"](k.racc_state["$[]"](-1)))):ce=Z["$[]"](k.racc_state["$[]"](-1));l(ce=k.$_racc_evalact(ce,r)););},{$$s:a})}),D(_,"$yyparse",function(r,x){return this.$__send__(h("Racc_YY_Parse_Method"),r,x,this.$_racc_setup(),!0)}),D(_,"$_racc_yyparse_rb",function(r,x,n,m){var a,Q=this,Z=t,$e=t,ne=t,ue=t,ce=t,ae=t,re=t;return a=E(n),Z=null==a[0]?t:a[0],$e=null==a[1]?t:a[1],ne=null==a[2]?t:a[2],ue=null==a[3]?t:a[3],ce=null==a[10]?t:a[10],Q.$_racc_init_sysvars(),ae=t,re=t,A(Q,"catch",["racc_end_parse"],function se(){var K=null==se.$$s?this:se.$$s;for(null==K.racc_state&&(K.racc_state=t);!l(re=ue["$[]"](K.racc_state["$[]"](-1)));)for(;l(ae=K.$_racc_evalact(ne["$[]"](K.racc_state["$[]"](-1)),n)););return A(r,"__send__",[x],function k(V,X){var z=null==k.$$s?this:k.$$s,O=t,te=t;for(null==z.racc_t&&(z.racc_t=t),null==z.racc_state&&(z.racc_state=t),null==z.racc_read_next&&(z.racc_read_next=t),null==V&&(V=t),null==X&&(X=t),z.racc_t=l(V)?l(O=ce["$[]"](V))?O:1:0,z.racc_val=X,z.racc_read_next=!1,re=j(re,z.racc_t),l(M(re,0))&&l(ae=Z["$[]"](re))&&N($e["$[]"](re),z.racc_state["$[]"](-1))||(ae=ne["$[]"](z.racc_state["$[]"](-1)));l(ae=z.$_racc_evalact(ae,n)););for(;l(l(O=l(te=(re=ue["$[]"](z.racc_state["$[]"](-1)))["$!"]())?te:z.racc_read_next["$!"]())?O:z.racc_t["$=="](0));)for(l(re)&&l(re=j(re,z.racc_t))&&l(M(re,0))&&l(ae=Z["$[]"](re))&&N($e["$[]"](re),z.racc_state["$[]"](-1))||(ae=ne["$[]"](z.racc_state["$[]"](-1)));l(ae=z.$_racc_evalact(ae,n)););},{$$s:K})},{$$s:Q})}),D(_,"$_racc_evalact",function(r,x){var n,ne,a=this,W=t,Q=t,$e=t,ue=t,ie=t,ce=t;if(W=null==(n=E(x))[0]?t:n[0],Q=null==n[1]?t:n[1],$e=null==n[3]?t:n[3],ne=null==n[11]?t:n[11],ue=null==n[12]?t:n[12],l(B(r,0))&&l(U(r,ne)))l(B(a.racc_error_status,0))&&(N(a.racc_t,1)||(a.racc_error_status=d(a.racc_error_status,1))),a.racc_vstack.$push(a.racc_val),a.racc_state.$push(r),a.racc_read_next=!0,l(a.yydebug)&&(a.racc_tstack.$push(a.racc_t),a.$racc_shift(a.racc_t,a.racc_tstack,a.racc_vstack));else if(l(U(r,0))&&l(B(r,ue["$-@"]()))){if(ie=A(a,"catch",["racc_jump"],function ae(){var re=null==ae.$$s?this:ae.$$s;return null==re.racc_state&&(re.racc_state=t),re.racc_state.$push(re.$_racc_do_reduce(x,r)),!1},{$$s:a}),l(ie))switch(ie.valueOf()){case 1:return a.racc_user_yyerror=!0,ue["$-@"]();case 2:return ne;default:a.$raise("[Racc Bug] unknown jump code")}}else if(N(r,ne))l(a.yydebug)&&a.$racc_accept(),a.$throw("racc_end_parse",a.racc_vstack["$[]"](0));else{if(N(r,ue["$-@"]())){switch(a.racc_error_status.valueOf()){case 0:l(x["$[]"](21))||a.$on_error(a.racc_t,a.racc_val,a.racc_vstack);break;case 3:N(a.racc_t,0)&&a.$throw("racc_end_parse",t),a.racc_read_next=!0}for(a.racc_user_yyerror=!1,a.racc_error_status=3;l(!0)&&!(l(ce=$e["$[]"](a.racc_state["$[]"](-1)))&&(ce=j(ce,1),l(M(ce,0))&&l(r=W["$[]"](ce))&&N(Q["$[]"](ce),a.racc_state["$[]"](-1))));)l(Y(a.racc_state.$size(),1))&&a.$throw("racc_end_parse",t),a.racc_state.$pop(),a.racc_vstack.$pop(),l(a.yydebug)&&(a.racc_tstack.$pop(),a.$racc_e_pop(a.racc_state,a.racc_tstack,a.racc_vstack));return r}a.$raise("[Racc Bug] unknown action "+r.$inspect())}return l(a.yydebug)&&a.$racc_next_state(a.racc_state["$[]"](-1),a.racc_state),t}),D(_,"$_racc_do_reduce",function(r,x){var n,ue,ce,V,X,z,ee,a=this,Q=t,Z=t,$e=t,ne=t,ie=t,ae=t,re=t,se=t,K=t,k=t,O=t,te=t,J=t;return Q=null==(n=E(r))[4]?t:n[4],Z=null==n[5]?t:n[5],$e=null==n[6]?t:n[6],ne=null==n[7]?t:n[7],ue=null==n[8]?t:n[8],ie=null==n[9]?t:n[9],ce=null==n[13]?t:n[13],ae=a.racc_state,re=a.racc_vstack,se=a.racc_tstack,K=G(x,-3),k=ie["$[]"](K),V=ie["$[]"](j(K,1)),X=ie["$[]"](j(K,2)),z=[],l(a.yydebug)&&(O=se["$[]"](k["$-@"](),k)),te=re["$[]"](k["$-@"](),k),l(a.yydebug)&&se["$[]="](k["$-@"](),k,z),re["$[]="](k["$-@"](),k,z),ae["$[]="](k["$-@"](),k,z),l(ce)?re.$push(a.$__send__(X,te,re,te["$[]"](0))):re.$push(a.$__send__(X,te,re)),se.$push(V),l(a.yydebug)&&a.$racc_reduce(O,V,se,re),ee=d(V,ue),l(K=ne["$[]"](ee))&&(K=j(K,ae["$[]"](-1)),l(M(K,0))&&l(J=Q["$[]"](K))&&N(Z["$[]"](K),ee))?J:$e["$[]"](ee)}),D(_,"$on_error",function(r,x,n){var a,m=this;return m.$raise(h("ParseError"),m.$sprintf("\nparse error on value %s (%s)",x.$inspect(),l(a=m.$token_to_str(r))?a:"?"))}),D(_,"$yyerror",function(){return this.$throw("racc_jump",1)}),D(_,"$yyaccept",function(){return this.$throw("racc_jump",2)}),D(_,"$yyerrok",u("racc_error_status",0)),D(_,"$racc_read_token",function(r,x,n){var m=this;return m.racc_debug_out.$print("read    "),m.racc_debug_out.$print(x.$inspect(),"(",m.$racc_token2str(r),") "),m.racc_debug_out.$puts(n.$inspect()),m.racc_debug_out.$puts()}),D(_,"$racc_shift",function(r,x,n){var m=this;return m.racc_debug_out.$puts("shift   "+m.$racc_token2str(r)),m.$racc_print_stacks(x,n),m.racc_debug_out.$puts()}),D(_,"$racc_reduce",function(r,x,n,m){var a=this,W=t;return(W=a.racc_debug_out).$print("reduce "),l(r["$empty?"]())?W.$print(" <none>"):A(r,"each",[],function Q(Z){return null==Z&&(Z=t),W.$print(" ",(null==Q.$$s?this:Q.$$s).$racc_token2str(Z))},{$$s:a}),W.$puts(" --\x3e "+a.$racc_token2str(x)),a.$racc_print_stacks(n,m),a.racc_debug_out.$puts()}),D(_,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),D(_,"$racc_e_pop",function(r,x,n){var m=this;return m.racc_debug_out.$puts("error recovering mode: pop token"),m.$racc_print_states(r),m.$racc_print_stacks(x,n),m.racc_debug_out.$puts()}),D(_,"$racc_next_state",function(r,x){var n=this;return n.racc_debug_out.$puts("goto    "+r),n.$racc_print_states(x),n.racc_debug_out.$puts()}),D(_,"$racc_print_stacks",function(r,x){var m=t;return(m=this.racc_debug_out).$print("        ["),A(r,"each_index",[],function a(W){return null==W&&(W=t),m.$print(" (",(null==a.$$s?this:a.$$s).$racc_token2str(r["$[]"](W))," ",x["$[]"](W).$inspect(),")")},{$$s:this}),m.$puts(" ]")}),D(_,"$racc_print_states",function(r){var n=t;return(n=this.racc_debug_out).$print("        ["),A(r,"each",[],function(a){return null==a&&(a=t),n.$print(" ",a)}),n.$puts(" ]")}),D(_,"$racc_token2str",function(r){var n;return l(n=c(this.$class(),"Racc_token_to_s_table")["$[]"](r))?n:this.$raise("[Racc Bug] can't convert token "+r+" to string")}),D(_,"$token_to_str",function(r){return c(this.$class(),"Racc_token_to_s_table")["$[]"](r)})}($[0],$)},Opal.modules["bcdice/arithmetic/node"]=function(e){var u,t,w,s,_,y,p,b,$,F=e.module,L=e.klass,l=e.def,I=e.thrower,S=e.return_ivar,q=e.send2,U=e.find_super,D=e.eqeq,E=e.const_set,A=e.eqeqeq,H=e.rb_divide,j=e.truthy,N=e.assign_ivar,M=e.alias,B=[],d=e.nil,Y=e.$$$;return u=B,t=$=[F(B[0],"BCDice")].concat(u),w=b=[F($[0],"Arithmetic")].concat(t),y=[F(b[0],"Node")].concat(w),p=e.$r(y),(_=(s=L(y[0],null,"BinaryOp")).$$prototype).lhs=_.rhs=_.op=d,l(s,"$initialize",function(h,R,f){var r=this;return r.lhs=h,r.op=R,r.rhs=f}),l(s,"$eval",function(h){try{I("eval_return");var x,f=this,r=d;return r=f.lhs.$eval(h),x=f.rhs.$eval(h),r.$send(f.op,x)}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),l(s,"$output",function(){var h=this;return""+h.lhs.$output()+h.op+h.rhs.$output()}),l(s,"$s_exp",function(){var h=this;return"("+h.$op_for_s_exp()+" "+h.lhs.$s_exp()+" "+h.rhs.$s_exp()+")"}),l(s,"$op_for_s_exp",S("op")),function(o,g,s){var _=L(o,g,"DivideBase"),i=[_].concat(s),h=e.$r(i),R=_.$$prototype;R.lhs=R.rhs=R.op=d,l(_,"$initialize",function f(r,x){return f.$$p=null,q(this,U(this,"initialize",f,!1,!0),"initialize",[r,"/",x],null)}),l(_,"$eval",function(r){try{I("eval_return");var m,a,n=this;return m=n.lhs.$eval(r),a=n.rhs.$eval(r),D(a,0)&&n.$raise(h("ZeroDivisionError")),n.$divide_and_round(m,a,r)}catch(W){if(W===e.t_eval_return)return W.$v;throw W}}),l(_,"$output",function f(){var r=f.$$p||d,x=this;return f.$$p=null,""+q(x,U(x,"output",f,!1,!0),"output",[],r)+x.$rounding_method()}),_.$private(),l(_,"$rounding_method",function(){return Y(this.$class(),"ROUNDING_METHOD")}),l(_,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),l(_,"$divide_and_round",function(r,x,n){return this.$raise(h("NotImplementedError"))})}(y[0],p("BinaryOp"),y),function(o,g,s){var _=L(o,g,"DivideWithGameSystemDefault"),i=[_].concat(s),h=e.$r(i);E(i[0],"ROUNDING_METHOD",""),_.$private(),l(_,"$divide_and_round",function(f,r,x){var n,m=d;return A(Y(h("RoundType"),"CEIL"),n=x)?H(f.$to_f(),r).$ceil():A(Y(h("RoundType"),"ROUND"),n)?(m=H(f.$to_f(),r),j(m["$negative?"]())?m.$abs().$round()["$-@"]():m.$round()):H(f,r).$floor()})}(y[0],p("DivideBase"),y),function(o,g,s){var _=L(o,g,"DivideWithCeil"),i=[_].concat(s);E(i[0],"ROUNDING_METHOD","C"),_.$private(),l(_,"$divide_and_round",function(R,f,r){return H(R.$to_f(),f).$ceil()})}(y[0],p("DivideBase"),y),function(o,g,s){var _=L(o,g,"DivideWithRound"),i=[_].concat(s);E(i[0],"ROUNDING_METHOD","R"),_.$private(),l(_,"$divide_and_round",function(R,f,r){var x=d;return x=H(R.$to_f(),f),j(x["$negative?"]())?x.$abs().$round()["$-@"]():x.$round()})}(y[0],p("DivideBase"),y),function(o,g,s){var _=L(o,g,"DivideWithFloor"),i=[_].concat(s);E(i[0],"ROUNDING_METHOD","F"),_.$private(),l(_,"$divide_and_round",function(R,f,r){return H(R,f).$floor()})}(y[0],p("DivideBase"),y),function(o,g){var s=L(o,null,"Negative");s.$$prototype.body=d,l(s,"$initialize",N("body")),l(s,"$eval",function(h){try{return I("eval_return"),this.body.$eval(h)["$-@"]()}catch(r){if(r===e.t_eval_return)return r.$v;throw r}}),l(s,"$output",function(){return"-"+this.body.$output()}),l(s,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(y[0]),function(o,g){var s=L(o,null,"Parenthesis");s.$$prototype.expr=d,l(s,"$initialize",N("expr")),l(s,"$eval",function(h){try{return I("eval_return"),this.expr.$eval(h)}catch(r){if(r===e.t_eval_return)return r.$v;throw r}}),l(s,"$output",function(){return"("+this.expr.$output()+")"}),l(s,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(y[0]),function(o,g){var s=L(o,null,"Number");return s.$$prototype.value=d,l(s,"$initialize",N("value")),l(s,"$eval",S("value")),l(s,"$output",function(){return this.value.$to_s()}),M(s,"s_exp","output")}(y[0])},Opal.modules.strscan=function(e){var N,M,B,d,Y,L=e.def,l=e.truthy,I=e.eqeqeq,S=e.Opal,q=e.return_ivar,U=e.send,D=e.alias,E=[],A=e.nil;return N=E,B=[M=(0,e.klass)(E[0],null,"StringScanner")].concat(N),d=e.$r(B),(Y=M.$$prototype).pos=Y.string=Y.working=Y.matched=Y.prev_pos=Y.match=A,M.$attr_reader("pos","matched"),L(M,"$initialize",function(u){var v=this;return v.string=u,v.pos=0,v.matched=A,v.working=u,v.match=[]}),M.$attr_reader("string"),L(M,"$beginning_of_line?",function(){var u=this;return 0===u.pos||"\n"===u.string.charAt(u.pos-1)}),L(M,"$scan",function(u){var v=this,$=(u=v.$anchor(u)).exec(v.working);return null==$?v.matched=A:(v.prev_pos=v.pos,v.pos+=$[0].length,v.working=v.working.substring($[0].length),v.matched=$[0],v.match=$,$[0])}),L(M,"$scan_until",function(u){var v=this;u=v.$anchor(u);for(var $=v.working,T=0;$.length!=T;++T){var t=u.exec($.substr(T));if(null!==t){var c=T+t[0].length,b=$.substr(0,c);return v.matched=t[0],v.match=t,v.prev_pos=v.pos+T,v.pos+=c,v.working=$.substr(c),b}}return v.matched=A}),L(M,"$[]",function(u){var $;if(l(this.match["$empty?"]()))return A;I(d("Symbol"),$=u)?u=u.$to_s():I(d("String"),$)||(u=S["$coerce_to!"](u,d("Integer"),"to_int"));var T=this.match;return u<0&&(u+=T.length),u<0||u>=T.length||null==T[u]?A:T[u]}),L(M,"$check",function(u){var v=this,$=(u=v.$anchor(u)).exec(v.working);return v.matched=null==$?A:$[0]}),L(M,"$check_until",function(u){var v=this,$=v.prev_pos,T=v.pos,t=v.working,c=v.$scan_until(u);return v.prev_pos=$,v.pos=T,v.working=t,c}),L(M,"$peek",function(u){return this.working.substring(0,u)}),L(M,"$eos?",function(){return 0===this.working.length}),L(M,"$exist?",function(u){var $=u.exec(this.working);return null==$?A:0==$.index?0:$.index+1}),L(M,"$skip",function(u){var v=this,$=(u=v.$anchor(u)).exec(v.working);if(null==$)return v.match=[],v.matched=A;var T=$[0],t=T.length;return v.matched=T,v.match=$,v.prev_pos=v.pos,v.pos+=t,v.working=v.working.substring(t),t}),L(M,"$skip_until",function(u){var $=this.$scan_until(u);return $===A?A:(this.matched=$.substr(-1),$.length)}),L(M,"$get_byte",function(){var u=this,v=A;return u.pos<u.string.length?(u.prev_pos=u.pos,u.pos+=1,v=u.matched=u.working.substring(0,1),u.working=u.working.substring(1)):u.matched=A,v}),L(M,"$match?",function(u){var v=this,$=(u=v.$anchor(u)).exec(v.working);return null==$?A:(v.prev_pos=v.pos,$[0].length)}),L(M,"$pos=",function(u){var v=this;return u<0&&(u+=v.string.$length()),v.pos=u,v.working=v.string.slice(u)}),L(M,"$matched_size",function(){return this.matched===A?A:this.matched.length}),L(M,"$post_match",function(){var u=this;return u.matched===A?A:u.string.substr(u.pos)}),L(M,"$pre_match",function(){var u=this;return u.matched===A?A:u.string.substr(0,u.prev_pos)}),L(M,"$reset",function(){var u=this;return u.working=u.string,u.matched=A,u.pos=0}),L(M,"$rest",q("working")),L(M,"$rest?",function(){return 0!==this.working.length}),L(M,"$rest_size",function(){return this.$rest().$size()}),L(M,"$terminate",function(){var u,v=this;return v.match=A,u=[v.string.$length()],U(v,"pos=",u),u[u.length-1]}),L(M,"$unscan",function(){var u=this;return u.pos=u.prev_pos,u.prev_pos=A,u.match=A,u}),D(M,"bol?","beginning_of_line?"),D(M,"getch","get_byte"),M.$private(),L(M,"$anchor",function(u){var v=u.toString().match(/\/([^\/]+)$/);return v=v?v[1]:void 0,new RegExp("^(?:"+u.source+")",v)})},Opal.modules["bcdice/normalize"]=function(e){var D,j,A,F=e.module,L=e.eqeqeq,l=e.def,I=e.eqeq,S=[],q=e.nil;return D=S,A=[F(S[0],"BCDice")].concat(D),(j=F(A[0],"Normalize")).$module_function(),l(j,"$comparison_operator",function(M){var B;return L(/<=|=</,B=M)?"<=":L(/>=|=>/,B)?">=":L(/<>|!=|=!/,B)?"!=":L(/</,B)?"<":L(/>/,B)?">":L(/=/,B)?"==":q}),l(j,"$target_number",function(M){return I(M,"?")?M:M.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var N,Y,T,t,c,b,P,u,B,F=e.module,L=e.klass,l=e.const_set,I=e.hash2,S=e.truthy,q=e.send,U=e.def,D=e.thrower,E=e.top,A=[],H=e.nil;return E.$require("strscan"),E.$require("bcdice/normalize"),N=A,Y=B=[F(A[0],"BCDice")].concat(N),T=u=[F(B[0],"Command")].concat(Y),c=[t=L(u[0],null,"Lexer")].concat(T),b=e.$r(c),(P=t.$$prototype).scanner=P.notations=H,l(c[0],"SYMBOLS",I(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),U(t,"$initialize",function(C,y){var p,o,s;return C=S(s=(p=(o=C)===H||null==o?H:o.$split(" ",2))===H||null==p?H:p.$first())?s:"",this.scanner=b("StringScanner").$new(C),this.notations=q(y,"map",[],function(i){return null==i&&(i=H),S(i["$is_a?"](b("String")))?b("Regexp").$new(i):i})}),U(t,"$next_token",function(){try{var C=D("return"),y=this,p=H,o=H,s=H,_=H;return S(y.scanner["$eos?"]())?[!1,"$"]:(q(y.notations,"each",[],function i(h){var f,R=null==i.$$s?this:i.$$s;if(null==R.scanner&&(R.scanner=H),null==h&&(h=H),f=R.scanner.$scan(h),!S(f))return H;C.$throw(["NOTATION",f])},{$$s:y,$$ret:C}),S(p=y.scanner.$scan(/\d+/))?["NUMBER",p.$to_i()]:S(o=y.scanner.$scan(/[<>!=]+/))?(o=b("Normalize").$comparison_operator(o),[S(o)?"CMP_OP":"ILLEGAL",o]):(s=y.scanner.$getch().$upcase(),[S(_=b("SYMBOLS")["$[]"](s))?_:s.$to_sym(),s]))}catch(i){if(i===C)return i.$v;throw i}}),U(t,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var E,N,G,u,v,$,T,B,H,F=e.module,L=e.klass,l=e.def,I=e.return_ivar,S=e.truthy,q=[],U=e.nil;return E=q,N=H=[F(q[0],"BCDice")].concat(E),G=B=[F(H[0],"Command")].concat(N),v=[u=L(B[0],null,"Parsed")].concat(G),$=e.$r(v),(T=u.$$prototype).critical=T.fumble=T.dollar=T.modify_number=T.question_target=T.target_number=T.prefix_number=T.command=T.suffix_number=T.cmp_op=U,u.$attr_accessor("command"),u.$attr_accessor("prefix_number"),u.$attr_accessor("suffix_number"),u.$attr_accessor("critical"),u.$attr_accessor("fumble"),u.$attr_accessor("dollar"),u.$attr_accessor("modify_number"),u.$attr_accessor("cmp_op"),u.$attr_accessor("target_number"),u.$attr_writer("question_target"),l(u,"$initialize",function(){var c=this;return c.prefix_number=U,c.suffix_number=U,c.critical=U,c.fumble=U,c.dollar=U,c.cmp_op=U,c.target_number=U,c.question_target=!1}),l(u,"$question_target?",I("question_target")),l(u,"$to_s",function(c){var b=this,P=U,w=U,C=U,y=U,p=U;switch(null==c&&(c="after_command"),P=S(b.critical)?"@"+b.critical:U,w=S(b.fumble)?"#"+b.fumble:U,C=S(b.dollar)?"$"+b.dollar:U,y=$("Format").$modifier(b.modify_number),p=S(b.question_target)?"?":b.target_number,c.valueOf()){case"after_command":return[b.prefix_number,b.command,b.suffix_number,P,w,C,y,b.cmp_op,p].$join();case"after_modify_number":return[b.prefix_number,b.command,b.suffix_number,y,P,w,C,b.cmp_op,p].$join();case"after_target_number":return[b.prefix_number,b.command,b.suffix_number,y,b.cmp_op,p,P,w,C].$join();default:return U}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var c,C,_,x,n,m,a,W,Q,Z,$e,ne,ce,i,f,r,se,p,o,P,F=e.klass,L=e.module,l=e.slice,I=e.extract_kwargs,S=e.ensure_kwargs,q=e.get_kwarg,U=e.send2,D=e.find_super,E=e.def,A=e.send,H=e.eqeq,j=e.thrower,N=e.hash,M=e.const_set,B=e.truthy,d=e.to_ary,Y=e.hash2,G=e.top,u=[],v=e.$r(u),$=e.nil,T=e.$$$;return G.$require("racc/parser.rb"),G.$require("bcdice/arithmetic/node"),G.$require("bcdice/command/lexer"),G.$require("bcdice/command/parsed"),F(T(v("BCDice"),"Command"),T(v("Racc"),"Parser"),"Parser"),c=u,C=P=[L(u[0],"BCDice")].concat(c),p=[L(P[0],"Command")].concat(C),o=e.$r(p),_=p,f=[i=F(p[0],T(o("Racc"),"Parser"),"Parser")].concat(_),r=e.$r(f),(se=i.$$prototype).notations=se.lexer=se.modifier=se.suffix_number=se.prefix_number=se.need_suffix_number=se.need_prefix_number=se.critical=se.fumble=se.dollar=se.allowed_cmp_op=se.question_target=$,E(i,"$initialize",function K(k,V){var X,z,O,te,J=this;return K.$$p=null,X=l(arguments),z=I(X),z=S(z),O=X,te=q(z,"round_type"),U(J,D(J,"initialize",K,!1,!0),"initialize",[],null),J.notations=O,J.round_type=te,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[$,">=",">","<=","<","==","!="],J.question_target=!1},-2),E(i,"$disable_modifier",function(){return this.modifier=!1,this}),E(i,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),E(i,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),E(i,"$has_prefix_number",function(){var k=this;return k.prefix_number=!0,k.need_prefix_number=!0,k}),E(i,"$has_suffix_number",function(){var k=this;return k.suffix_number=!0,k.need_suffix_number=!0,k}),E(i,"$enable_critical",function(){return this.critical=!0,this}),E(i,"$enable_fumble",function(){return this.fumble=!0,this}),E(i,"$enable_dollar",function(){return this.dollar=!0,this}),E(i,"$restrict_cmp_op_to",function(k){var V;return V=l(arguments),this.allowed_cmp_op=V,this},-1),E(i,"$enable_question_target",function(){return this.question_target=!0,this}),E(i,"$parse",function(k){var V=this;try{return V.lexer=r("Lexer").$new(k,V.notations),V.$do_parse()}catch(X){if(!e.rescue(X,[r("ParseError"),r("ZeroDivisionError")]))throw X;try{return $}finally{e.pop_exception()}}}),i.$private(),E(i,"$parsed",function(k,V,X,z){try{return j("eval_return"),A(r("Parsed").$new(),"tap",[],function ee(J){var _e,le,de,me,ve,fe,he,oe=null==ee.$$s?this:ee.$$s;return null==oe.round_type&&(oe.round_type=$),null==J&&(J=$),J["$command="](k["$[]"]("command")),J["$prefix_number="]((_e=k["$[]"]("prefix"))===$||null==_e?$:_e.$eval(oe.round_type)),J["$suffix_number="]((le=k["$[]"]("suffix"))===$||null==le?$:le.$eval(oe.round_type)),J["$critical="]((de=V["$[]"]("critical"))===$||null==de?$:de.$eval(oe.round_type)),J["$fumble="]((me=V["$[]"]("fumble"))===$||null==me?$:me.$eval(oe.round_type)),J["$dollar="]((ve=V["$[]"]("dollar"))===$||null==ve?$:ve.$eval(oe.round_type)),J["$modify_number="](X.$eval(oe.round_type)),J["$cmp_op="](z["$[]"]("cmp_op")),H(z["$[]"]("target"),"?")?(J["$question_target="](!0),A(J,"target_number=",fe=[0]),fe[fe.length-1]):(J["$question_target="](!1),fe=[(he=z["$[]"]("target"),he===$||null==he?$:he.$eval(oe.round_type))],A(J,"target_number=",fe),fe[fe.length-1])},{$$s:this})}catch(ee){if(ee===e.t_eval_return)return ee.$v;throw ee}}),E(i,"$next_token",function(){return this.lexer.$next_token()}),x=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),n=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),m=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),a=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),W=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),Q=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),Z=[$,6,13,3,9,-1,27,-15,-10,-1,-38],$e=[$,$,$,$,$,$,19,16,15,$,$],ne=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ce=N(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),M(f[0],"Racc_arg",[x,n,a,m,W,Q,$e,Z,19,ne,ce,58,35,!0]),B(r("Ractor","skip_raise")?"constant":$)&&r("Ractor").$make_shareable(r("Racc_arg")),M(f[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),B(r("Ractor","skip_raise")?"constant":$)&&r("Ractor").$make_shareable(r("Racc_token_to_s_table")),M(f[0],"Racc_debug_parser",!1),E(i,"$_reduce_1",function(k,V,X){var z;return B(this.modifier)||this.$raise(r("ParseError")),z=d(k),this.$parsed(null==z[0]?$:z[0],null==z[1]?$:z[1],null==z[2]?$:z[2],null==z[3]?$:z[3])}),E(i,"$_reduce_2",function(k,V,X){var z;return B(this.modifier)||this.$raise(r("ParseError")),z=d(k),this.$parsed(null==z[0]?$:z[0],null==z[2]?$:z[2],null==z[1]?$:z[1],null==z[3]?$:z[3])}),E(i,"$_reduce_3",function(k,V,X){var z,_e;return _e=null==(z=d(k))[2]?$:z[2],this.$parsed(null==z[0]?$:z[0],null==z[1]?$:z[1],T(T(r("Arithmetic"),"Node"),"Number").$new(0),_e)}),E(i,"$_reduce_4",function(k,V,X){var z=this;return B(z.prefix_number)&&B(z.suffix_number)||z.$raise(r("ParseError")),Y(["command","prefix","suffix"],{command:k["$[]"](1),prefix:k["$[]"](0),suffix:k["$[]"](2)})}),E(i,"$_reduce_5",function(k,V,X){var z=this;return B(z.prefix_number)||z.$raise(r("ParseError")),B(z.need_suffix_number)&&z.$raise(r("ParseError")),Y(["command","prefix"],{command:k["$[]"](1),prefix:k["$[]"](0)})}),E(i,"$_reduce_6",function(k,V,X){var z=this;return B(z.suffix_number)||z.$raise(r("ParseError")),B(z.need_prefix_number)&&z.$raise(r("ParseError")),Y(["command","suffix"],{command:k["$[]"](0),suffix:k["$[]"](1)})}),E(i,"$_reduce_7",function(k,V,X){var z=this;return(B(z.need_prefix_number)||B(z.need_suffix_number))&&z.$raise(r("ParseError")),Y(["command"],{command:k["$[]"](0)})}),E(i,"$_reduce_8",function(k,V,X){return Y([],{})}),E(i,"$_reduce_9",function(k,V,X){var z,_e,ee=$;return ee=null==(z=d(k))[0]?$:z[0],_e=null==z[2]?$:z[2],B(this.critical)&&B(ee["$[]"]("critical")["$nil?"]())||this.$raise(r("ParseError")),ee["$[]="]("critical",_e),ee}),E(i,"$_reduce_10",function(k,V,X){var z,_e,ee=$;return ee=null==(z=d(k))[0]?$:z[0],_e=null==z[2]?$:z[2],B(this.fumble)&&B(ee["$[]"]("fumble")["$nil?"]())||this.$raise(r("ParseError")),ee["$[]="]("fumble",_e),ee}),E(i,"$_reduce_11",function(k,V,X){var z,_e,ee=$;return ee=null==(z=d(k))[0]?$:z[0],_e=null==z[2]?$:z[2],B(this.dollar)&&B(ee["$[]"]("dollar")["$nil?"]())||this.$raise(r("ParseError")),ee["$[]="]("dollar",_e),ee}),E(i,"$_reduce_12",function(k,V,X){return k["$[]"](1)}),E(i,"$_reduce_13",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"Negative").$new(k["$[]"](1))}),E(i,"$_reduce_14",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"BinaryOp").$new(k["$[]"](0),"+",k["$[]"](2))}),E(i,"$_reduce_15",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"BinaryOp").$new(k["$[]"](0),"-",k["$[]"](2))}),E(i,"$_reduce_16",function(k,V,X){return B(this.allowed_cmp_op["$include?"]($))||this.$raise(r("ParseError")),Y([],{})}),E(i,"$_reduce_17",function(k,V,X){var z,ee,J;return J=null==(z=d(k))[1]?$:z[1],B(this.allowed_cmp_op["$include?"](ee=null==z[0]?$:z[0]))||this.$raise(r("ParseError")),Y(["cmp_op","target"],{cmp_op:ee,target:J})}),E(i,"$_reduce_18",function(k,V,X){var O,z=this;return O=k["$[]"](0),B(z.question_target)||z.$raise(r("ParseError")),B(z.allowed_cmp_op["$include?"](O))||z.$raise(r("ParseError")),Y(["cmp_op","target"],{cmp_op:O,target:"?"})}),E(i,"$_reduce_19",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"BinaryOp").$new(k["$[]"](0),"+",k["$[]"](2))}),E(i,"$_reduce_20",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"BinaryOp").$new(k["$[]"](0),"-",k["$[]"](2))}),E(i,"$_reduce_22",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"BinaryOp").$new(k["$[]"](0),"*",k["$[]"](2))}),E(i,"$_reduce_23",function(k,V,X){return k["$[]"](3).$new(k["$[]"](0),k["$[]"](2))}),E(i,"$_reduce_25",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),E(i,"$_reduce_26",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"DivideWithCeil")}),E(i,"$_reduce_27",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"DivideWithCeil")}),E(i,"$_reduce_28",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"DivideWithRound")}),E(i,"$_reduce_29",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"DivideWithFloor")}),E(i,"$_reduce_30",function(k,V,X){return k["$[]"](1)}),E(i,"$_reduce_31",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"Negative").$new(k["$[]"](1))}),E(i,"$_reduce_33",function(k,V,X){return k["$[]"](1)}),E(i,"$_reduce_34",function(k,V,X){return T(T(r("Arithmetic"),"Node"),"Number").$new(k["$[]"](0))}),E(i,"$_reduce_none",function(k,V,X){return k["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var A,M,G,u,v,$,d,j,F=e.module,L=e.send,l=e.eqeqeq,I=e.truthy,S=e.def,q=e.return_val,U=[],D=e.nil;return A=U,M=j=[F(U[0],"BCDice")].concat(A),G=d=[F(j[0],"Deprecated")].concat(M),v=[u=F(d[0],"Checker")].concat(G),$=e.$r(v),u.$private(),S(u,"$check_result_legacy",function(t,c,b,P){var p,w=this,C=D,y=D,o=D,g=D;return C=L(c,"map",[],"sides".$to_proc()),p=(y=L(c,"map",[],"value".$to_proc())).$sum(),o=l([100],g=C)?w.$check_1D100(t,p,b,P):l([20],g)?w.$check_1D20(t,p,b,P):l([6,6],g)?w.$check_2D6(t,p,y,b,P):D,(I(o["$nil?"]())||I(o["$empty?"]()))&&(o=l([10],g=C.$uniq())?w.$check_nD10(t,p,y,b,P):l([6],g)?w.$check_nD6(t,p,y,b,P):D,I(o["$nil?"]())||I(o["$empty?"]()))?D:$("Result").$new(o.$delete_prefix(" \uff1e "))}),S(u,"$check_1D100",q(D)),S(u,"$check_1D20",q(D)),S(u,"$check_nD10",q(D)),S(u,"$check_2D6",q(D)),S(u,"$check_nD6",q(D))},Opal.modules["bcdice/base"]=function(e){var v,w,g,R,r,x,s,_,i,h,y,F=e.module,L=e.klass,l=e.slice,I=e.rb_plus,S=e.truthy,q=e.def,U=e.regexp,D=e.send,E=e.thrower,A=e.return_ivar,H=e.assign_ivar_val,j=e.eqeqeq,N=e.eqeq,M=e.return_val,B=e.range,d=e.rb_minus,Y=e.rb_divide,G=e.rb_times,u=e.rb_ge,$=e.top,T=[],t=e.$r(T),c=e.nil,b=e.$$$;return $.$require("i18n"),$.$require("i18n/backend/fallbacks"),$.$require("bcdice/randomizer"),$.$require("bcdice/dice_table"),$.$require("bcdice/enum"),$.$require("bcdice/translate"),$.$require("bcdice/result"),$.$require("bcdice/command/parser"),$.$require("bcdice/deprecated/checker"),w=T,g=y=[F(T[0],"BCDice")].concat(w),_=[s=L(y[0],null,"Base")].concat(g),i=e.$r(_),(h=s.$$prototype).raw_input=h.randomizer=h.enabled_upcase_input=h.debug=c,r=[R=e.get_singleton_class(s)].concat(_),x=e.$r(r),R.$attr_reader("prefixes"),q(R,"$register_prefix",function(m){var W,Z,Q=this;return null==Q.prefixes&&(Q.prefixes=c),W=l(arguments),Q.prefixes=I(S(Z=Q.prefixes)?Z:[],W.$flatten())},-1),q(R,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),q(R,"$prefixes_pattern",function(){var m=this,a=c;return null==m.prefixes_pattern&&(m.prefixes_pattern=c),null==m.prefixes&&(m.prefixes=c),m.prefixes_pattern=S(a=m.prefixes_pattern)?a:c,S(m.prefixes_pattern)?m.prefixes_pattern:(m.prefixes=S(a=m.prefixes)?a:[],m.prefixes.$freeze(),m.prefixes_pattern=(S(m.prefixes["$empty?"]())?/(?!)/:U(["^(S)?(",m.prefixes.$join("|"),")"],"i")).$freeze())}),q(R,"$command_pattern",function(){var m=this,a=c,W=c;return null==m.command_pattern&&(m.command_pattern=c),null==m.prefixes&&(m.prefixes=c),m.command_pattern=S(a=m.command_pattern)?a:c,S(m.command_pattern)?m.command_pattern:(m.prefixes=S(a=m.prefixes)?a:[],m.prefixes.$freeze(),W=I(D(b(x("CommonCommand"),"COMMANDS"),"map",[],function(Z){return null==Z&&(Z=c),b(Z,"PREFIX_PATTERN").$source()}),m.prefixes),m.command_pattern=U(["^S?(",W.$join("|"),")"],"i").$freeze())}),q(R,"$eval",function(m){try{return E("eval_return"),this.$new(m).$eval()}catch(Q){if(Q===e.t_eval_return)return Q.$v;throw Q}}),s.$include(i("Translate")),s.$include(b(i("Deprecated"),"Checker")),q(s,"$initialize",function(f){var r=this;return r.raw_input=f,r.sort_add_dice=!1,r.sort_barabara_dice=!1,r.d66_sort_type=b(i("D66SortType"),"NO_SORT"),r.enabled_d9=!1,r.round_type=b(i("RoundType"),"FLOOR"),r.sides_implicit_d=6,r.upper_dice_reroll_threshold=c,r.reroll_dice_reroll_threshold=c,r.default_cmp_op=c,r.default_target_number=c,r.enabled_upcase_input=!0,r.locale="ja_jp",r.randomizer=b(i("BCDice"),"Randomizer").$new(),r.debug=!1}),s.$attr_accessor("randomizer"),s.$attr_reader("d66_sort_type"),s.$attr_reader("round_type"),s.$attr_reader("sides_implicit_d"),s.$attr_reader("upper_dice_reroll_threshold"),s.$attr_reader("reroll_dice_reroll_threshold"),s.$attr_reader("default_cmp_op"),s.$attr_reader("default_target_number"),q(s,"$sort_add_dice?",A("sort_add_dice")),q(s,"$sort_barabara_dice?",A("sort_barabara_dice")),q(s,"$enabled_d9?",A("enabled_d9")),q(s,"$enable_debug",H("debug",!0)),q(s,"$eval",function(){var r,n,f=this,x=c;return r=b(i("BCDice"),"Preprocessor").$process(f.raw_input,f),x=S(n=f.$dice_command(r))?n:f.$eval_common_command(f.raw_input),S(x)?(x["$rands="](f.randomizer.$rand_results()),x["$detailed_rands="](f.randomizer.$detailed_rand_results()),x):c}),q(s,"$change_text",function(f){return f}),q(s,"$check_result",function(f,r,x,n){var m=this,a=c,W=c,Q=c,Z=c,$e=c;return a=m.$check_result_legacy(f,r,x,n),S(a)?a:(W=D(r,"map",[],"sides".$to_proc()),Z=(Q=D(r,"map",[],"value".$to_proc())).$sum(),a=j([100],$e=W)?m.$result_1d100(f,Z,x,n):j([20],$e)?m.$result_1d20(f,Z,x,n):j([6,6],$e)?m.$result_2d6(f,Z,Q,x,n):c,N(a,i("Result").$nothing())?c:S(a)?a:(a=j([10],$e=W.$uniq())?m.$result_nd10(f,Z,Q,x,n):j([6],$e)?m.$result_nd6(f,Z,Q,x,n):c,N(a,i("Result").$nothing())?c:S(a)?a:m.$result_ndx(f,x,n)))}),q(s,"$grich_text",M(c)),s.$private(),q(s,"$eval_common_command",function(f){try{E("eval_return");var x=E("return");return f=this.$change_text(f),D(b(i("CommonCommand"),"COMMANDS"),"each",[],function m(a){var Q,W=null==m.$$s?this:m.$$s;if(null==W.randomizer&&(W.randomizer=c),null==a&&(a=c),Q=a.$eval(f,W,W.randomizer),!S(Q))return c;x.$throw(Q)},{$$s:this,$$ret:x}),c}catch(m){if(m===e.t_eval_return||m===x)return m.$v;throw m}}),q(s,"$dice_command",function(f){var r=this,x=c,n=c,m=c,a=c;return S(r.enabled_upcase_input)&&(f=f.$upcase()),x=r.$class().$prefixes_pattern().$match(f),S(x)?(n=x["$[]"](1)["$nil?"]()["$!"](),S(n)&&(f=f["$[]"](B(1,-1,!1))),m=r.$eval_game_system_specific_command(f),S(m["$is_a?"](i("Result")))?(m["$secret="](S(a=m["$secret?"]())?a:n),m):S(m["$nil?"]())||S(m["$empty?"]())||N(m,"1")?c:D(i("Result").$new(),"tap",[],function(Q){var Z;return null==Q&&(Q=c),Q["$text="](m.$to_s()),D(Q,"secret=",Z=[n]),Z[Z.length-1]})):c}),q(s,"$eval_game_system_specific_command",M(c)),q(s,"$result_ndx",function(f,r,x){return S(x["$is_a?"](i("String")))?c:S(f.$send(r,x))?i("Result").$success(this.$translate("success")):i("Result").$failure(this.$translate("failure"))}),q(s,"$result_1d100",M(c)),q(s,"$result_1d20",M(c)),q(s,"$result_nd10",M(c)),q(s,"$result_2d6",M(c)),q(s,"$result_nd6",M(c)),q(s,"$get_table_by_2d6",function(f){return this.$get_table_by_nD6(f,2)}),q(s,"$get_table_by_1d6",function(f){return this.$get_table_by_nD6(f,1)}),q(s,"$get_table_by_nD6",function(f,r){return this.$get_table_by_nDx(f,r,6)}),q(s,"$get_table_by_nDx",function(f,r,x){var m,a=c;return m=this.randomizer.$roll_sum(r,x),a=this.$get_table_value(f["$[]"](d(m,r))),S(a["$nil?"]())?["1",0]:[a,m]}),q(s,"$get_table_by_1d3",function(f){var n,m,r=this,a=c;return r.$debug("get_table_by_1d3"),n=r.randomizer.$roll_sum(1,6),r.$debug("num",n),m=Y(d(n,1),2).$to_i(),r.$debug("index",m),a=f["$[]"](m),S(a["$nil?"]())?["1",0]:[a,n]}),q(s,"$get_table_by_d66_swap",function(f){var x;return x=this.randomizer.$roll_d66(b(i("D66SortType"),"ASC")),[this.$get_table_by_number(x,f),x]}),q(s,"$get_table_by_d66",function(f){var x,n,m,W,a=c;return x=this.randomizer.$roll_once(6),n=this.randomizer.$roll_once(6),m=I(G(d(x,1),6),d(n,1)),a=f["$[]"](m),W=""+x+n,S(a["$nil?"]())?["1",W]:[a,W]}),q(s,"$get_table_by_number",function(f,r,x){try{var n=E("return");return null==x&&(x="1"),D(r,"each",[],function a(W){var Z,Q=null==a.$$s?this:a.$$s;if(null==W&&(W=c),Z=W["$[]"](0),!S(u(Z,f)))return c;n.$throw(Q.$get_table_value(W["$[]"](1)))},{$$s:this,$$ret:n}),this.$get_table_value(x)}catch(a){if(a===n)return a.$v;throw a}},-3),q(s,"$get_table_value",function(f){return S(f["$is_a?"](i("Proc")))?f.$call():f}),q(s,"$roll_tables",function(f,r){var n=c;return n=r["$[]"](f),S(n)?n.$roll(this.randomizer).$to_s():c}),q(s,"$debug",function(f,r){var n,m=this,a=c,W=c;return n=l(arguments,1),S(m.debug)?(a=S(f["$is_a?"](i("String")))?f:f.$inspect(),S(n["$empty?"]())?m.$warn(a):(W=D(n,"map",[],function(Z){return null==Z&&(Z=c),S(Z["$is_a?"](i("String")))?'"'+Z+'"':Z.$inspect()}),m.$warn(a+": "+W.$join(", ")))):c},-2),b(b(t("I18n"),"Backend"),"Simple").$include(b(b(t("I18n"),"Backend"),"Fallbacks")),t("I18n").$load_path()["$<<"](t("Dir")["$[]"](t("File").$join("bcdice","../../i18n/**/*.yml"))),t("I18n")["$default_locale="]("ja_jp"),v=[["ja_jp"]],D(t("I18n").$fallbacks(),"defaults=",v),v[v.length-1]},Opal.queue(function(e){var G,T,C,y,p,o,c,b,v,F=e.module,L=e.klass,l=e.const_set,I=e.truthy,S=e.def,q=e.to_ary,U=e.rb_plus,D=e.rb_minus,E=e.rb_gt,A=e.eqeq,H=e.rb_lt,j=e.thrower,N=e.rb_ge,B=[],d=e.nil;return e.top.$require("bcdice/base"),G=B,T=v=[F(B[0],"BCDice")].concat(G),c=[F(v[0],"GameSystem")].concat(T),b=e.$r(c),C=c,p=[y=L(c[0],b("Base"),"ZettaiReido")].concat(C),o=e.$r(p),y.$$prototype.randomizer=d,l(p[0],"ID","ZettaiReido"),l(p[0],"NAME","\u7d76\u5bfe\u96b7\u5974"),l(p[0],"SORT_KEY","\u305b\u3064\u305f\u3044\u308c\u3044\u3068"),l(p[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\nm-2DR+n>=x\nm(\u57fa\u672c\u80fd\u529b),n(\u4fee\u6b63\u5024),x(\u76ee\u6a19\u5024)\nDP\u306e\u53d6\u5f97\u306e\u6709\u7121\u3082\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n"),y.$register_prefix("\\d+\\-2DR"),S(y,"$eval_game_system_specific_command",function(_){var h=d,R=d,f=d;return I(_["$=~"](/^(\d+)-2DR([+\-\d]*)(>=(\d+))?$/i))?(h=o("Regexp").$last_match(1).$to_i(),R=o("Regexp").$last_match(2),f=o("Regexp").$last_match(4),this.$roll2DR(h,R,f)):d}),S(y,"$roll2DR",function(_,i,h){var R,f,x,n,m,a,W,r=this,Z=d,$e=d,ne=d,ue=d,ie=d;return f=r.$roll2DarkDice(),x=null==(R=q(f))[0]?d:R[0],n=null==R[1]?d:R[1],m=null==R[2]?d:R[2],f=r.$getModInfo(i),a=null==(R=q(f))[0]?d:R[0],i=null==R[1]?d:R[1],f=r.$getDiffInfo(h),W=null==(R=q(f))[0]?d:R[0],Z="("+_+"-2DR"+i+(null==R[1]?d:R[1])+")",$e=_+"-"+x+"["+n+"]"+i,ne=U(D(_,x),a),ue=r.$getResult(x,ne,W),I(E(m,0))&&(ie=m+"DP"),ue["$text="]([Z,$e,ne.$to_i(),ue.$text(),ie].$compact().$join(" \uff1e ")),ue}),S(y,"$roll2DarkDice",function(){var _,i,R,f,r,x,n,h=this,a=d;return R=h.randomizer.$roll_once(6),f=h.randomizer.$roll_once(6),i=h.$changeDiceToDarkDice(R),r=null==(_=q(i))[0]?d:_[0],x=null==_[1]?d:_[1],i=h.$changeDiceToDarkDice(f),n=null==(_=q(i))[0]?d:_[0],a=U(x,null==_[1]?d:_[1]),A(a,2)&&(a=4),[U(r,n),r+","+n,a]}),S(y,"$changeDiceToDarkDice",function(_){var i=d,h=d;return i=0,h=_,A(_,6)&&(h=0,i=1),[h,i]}),S(y,"$getModInfo",function(_){try{j("eval_return");var h=d,R=d;return h=o("ArithmeticEvaluator").$eval(_),R="",I(H(h,0))?R=h.$to_s():I(E(h,0))&&(R=U("+",h.$to_s())),[h,R]}catch(f){if(f===e.t_eval_return)return f.$v;throw f}}),S(y,"$getDiffInfo",function(_){var i=d;return i="",I(_["$nil?"]())||(i=">="+(_=_.$to_i()).$to_i()),[_,i]}),S(y,"$getResult",function(_,i,h){var R=d;return A(_,0)?o("Result").$critical("\u30af\u30ea\u30c6\u30a3\u30ab\u30eb"):A(_,10)?o("Result").$fumble("\u30d5\u30a1\u30f3\u30d6\u30eb"):(I(h["$nil?"]())&&(h=0),R=D(i,h),I(N(R,0))?o("Result").$success(R+" \u6210\u529f"):o("Result").$failure("\u5931\u6557"))})})}}]);