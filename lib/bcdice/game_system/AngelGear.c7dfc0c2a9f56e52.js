(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[4367],{8506:(oe,le,_e)=>{_e(5151),Opal.modules["bcdice/dice_table/table"]=function(t){var w,H,s,o,B,e,y,A,I,F=t.module,v=t.klass,i=t.hash2,R=t.defs,Q=t.truthy,P=t.def,j=t.rb_minus,x=[],D=t.nil;return w=x,H=I=[F(x[0],"BCDice")].concat(w),s=A=[F(I[0],"DiceTable")].concat(H),B=[o=v(A[0],null,"Table")].concat(s),e=t.$r(B),(y=o.$$prototype).times=y.sides=y.name=y.items=D,R(o,"$from_i18n",function(G,z){var m=D;return m=e("I18n").$t(G,i(["locale"],{locale:z})),this.$new(m["$[]"]("name"),m["$[]"]("type"),m["$[]"]("items"))}),P(o,"$initialize",function(G,z,k){var m=this,Z=D;return m.name=G,m.items=k.$freeze(),Z=/(\d+)D(\d+)/i.$match(z),Q(Z)||m.$raise(e("ArgumentError"),"Unexpected table type: "+z),m.times=Z["$[]"](1).$to_i(),m.sides=Z["$[]"](2).$to_i()}),P(o,"$roll",function(G){var k,z=this;return k=G.$roll_sum(z.times,z.sides),z.$choice(k)}),P(o,"$choice",function(G){var k,z=this;return k=j(G,z.times),e("RollResult").$new(z.name,G,z.items["$[]"](k))})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(t){var V,M,o,B,e,y,K,q,f,F=t.module,v=t.klass,i=t.hash2,R=t.defs,Q=t.def,P=t.rb_plus,j=t.rb_times,x=t.rb_minus,D=[],a=t.nil;return V=D,M=f=[F(D[0],"BCDice")].concat(V),o=q=[F(f[0],"DiceTable")].concat(M),e=[B=v(q[0],null,"D66GridTable")].concat(o),y=t.$r(e),(K=B.$$prototype).name=K.items=a,R(B,"$from_i18n",function(z,k){var Z=a;return Z=y("I18n").$t(z,i(["locale","raise"],{locale:k,raise:!0})),this.$new(Z["$[]"]("name"),Z["$[]"]("items"))}),Q(B,"$initialize",function(z,k){return this.name=z,this.items=k.$freeze()}),Q(B,"$roll",function(z){var m,Z,L,U,b;return m=z.$roll_once(6),Z=z.$roll_once(6),L=P(j(m,10),Z),U=x(m,1),b=x(Z,1),y("RollResult").$new(this.name,L,this.items["$[]"](U)["$[]"](b))})},Opal.modules["bcdice/arithmetic/node"]=function(t){var c,e,z,b,_,m,Z,K,o,F=t.module,v=t.klass,i=t.def,R=t.thrower,Q=t.return_ivar,P=t.send2,j=t.find_super,x=t.eqeq,D=t.const_set,a=t.eqeqeq,w=t.rb_divide,V=t.truthy,I=t.assign_ivar,f=t.alias,H=[],M=t.nil,A=t.$$$;return c=H,e=o=[F(H[0],"BCDice")].concat(c),z=K=[F(o[0],"Arithmetic")].concat(e),m=[F(K[0],"Node")].concat(z),Z=t.$r(m),(_=(b=v(m[0],null,"BinaryOp")).$$prototype).lhs=_.rhs=_.op=M,i(b,"$initialize",function(p,T,u){var $=this;return $.lhs=p,$.op=T,$.rhs=u}),i(b,"$eval",function(p){try{R("eval_return");var h,u=this,$=M;return $=u.lhs.$eval(p),h=u.rhs.$eval(p),$.$send(u.op,h)}catch(r){if(r===t.t_eval_return)return r.$v;throw r}}),i(b,"$output",function(){var p=this;return""+p.lhs.$output()+p.op+p.rhs.$output()}),i(b,"$s_exp",function(){var p=this;return"("+p.$op_for_s_exp()+" "+p.lhs.$s_exp()+" "+p.rhs.$s_exp()+")"}),i(b,"$op_for_s_exp",Q("op")),function(L,U,b){var _=v(L,U,"DivideBase"),N=[_].concat(b),p=t.$r(N),T=_.$$prototype;T.lhs=T.rhs=T.op=M,i(_,"$initialize",function u($,h){return u.$$p=null,P(this,j(this,"initialize",u,!1,!0),"initialize",[$,"/",h],null)}),i(_,"$eval",function($){try{R("eval_return");var l,n,r=this;return l=r.lhs.$eval($),n=r.rhs.$eval($),x(n,0)&&r.$raise(p("ZeroDivisionError")),r.$divide_and_round(l,n,$)}catch(g){if(g===t.t_eval_return)return g.$v;throw g}}),i(_,"$output",function u(){var $=u.$$p||M,h=this;return u.$$p=null,""+P(h,j(h,"output",u,!1,!0),"output",[],$)+h.$rounding_method()}),_.$private(),i(_,"$rounding_method",function(){return A(this.$class(),"ROUNDING_METHOD")}),i(_,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),i(_,"$divide_and_round",function($,h,r){return this.$raise(p("NotImplementedError"))})}(m[0],Z("BinaryOp"),m),function(L,U,b){var _=v(L,U,"DivideWithGameSystemDefault"),N=[_].concat(b),p=t.$r(N);D(N[0],"ROUNDING_METHOD",""),_.$private(),i(_,"$divide_and_round",function(u,$,h){var r,l=M;return a(A(p("RoundType"),"CEIL"),r=h)?w(u.$to_f(),$).$ceil():a(A(p("RoundType"),"ROUND"),r)?(l=w(u.$to_f(),$),V(l["$negative?"]())?l.$abs().$round()["$-@"]():l.$round()):w(u,$).$floor()})}(m[0],Z("DivideBase"),m),function(L,U,b){var _=v(L,U,"DivideWithCeil"),N=[_].concat(b);D(N[0],"ROUNDING_METHOD","C"),_.$private(),i(_,"$divide_and_round",function(T,u,$){return w(T.$to_f(),u).$ceil()})}(m[0],Z("DivideBase"),m),function(L,U,b){var _=v(L,U,"DivideWithRound"),N=[_].concat(b);D(N[0],"ROUNDING_METHOD","R"),_.$private(),i(_,"$divide_and_round",function(T,u,$){var h=M;return h=w(T.$to_f(),u),V(h["$negative?"]())?h.$abs().$round()["$-@"]():h.$round()})}(m[0],Z("DivideBase"),m),function(L,U,b){var _=v(L,U,"DivideWithFloor"),N=[_].concat(b);D(N[0],"ROUNDING_METHOD","F"),_.$private(),i(_,"$divide_and_round",function(T,u,$){return w(T,u).$floor()})}(m[0],Z("DivideBase"),m),function(L,U){var b=v(L,null,"Negative");b.$$prototype.body=M,i(b,"$initialize",I("body")),i(b,"$eval",function(p){try{return R("eval_return"),this.body.$eval(p)["$-@"]()}catch($){if($===t.t_eval_return)return $.$v;throw $}}),i(b,"$output",function(){return"-"+this.body.$output()}),i(b,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(m[0]),function(L,U){var b=v(L,null,"Parenthesis");b.$$prototype.expr=M,i(b,"$initialize",I("expr")),i(b,"$eval",function(p){try{return R("eval_return"),this.expr.$eval(p)}catch($){if($===t.t_eval_return)return $.$v;throw $}}),i(b,"$output",function(){return"("+this.expr.$output()+")"}),i(b,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(m[0]),function(L,U){var b=v(L,null,"Number");return b.$$prototype.value=M,i(b,"$initialize",I("value")),i(b,"$eval",Q("value")),i(b,"$output",function(){return this.value.$to_s()}),f(b,"s_exp","output")}(m[0])},Opal.modules["racc/parser"]=function(t){var G,k,m,F=t.module,v=t.klass,i=t.truthy,R=t.const_set,Q=t.defs,P=t.gvars,j=t.rb_lt,x=t.def,D=t.to_ary,a=t.send,w=t.neqeq,V=t.rb_plus,I=t.eqeq,f=t.rb_ge,H=t.rb_gt,M=t.rb_minus,A=t.rb_le,q=t.rb_times,c=t.assign_ivar_val,o=[],B=t.$r(o),e=t.nil,y=t.$$$;return G=o,k=[F(o[0],"Racc")].concat(G),m=t.$r(k),v(k[0],m("StandardError"),"ParseError"),i(y("::","ParseError","skip_raise")?"constant":e)||R(o[0],"ParseError",y(B("Racc"),"ParseError")),function(K,G){var b,_,N,p,T,m=[F(K,"Racc")].concat(G),Z=t.$r(m);return i(Z("Racc_No_Extensions","skip_raise")?"constant":e)||R(m[0],"Racc_No_Extensions",!1),b=m,N=[_=v(m[0],null,"Parser")].concat(b),p=t.$r(N),(T=_.$$prototype).yydebug=T.racc_debug_out=T.racc_error_status=T.racc_t=T.racc_vstack=T.racc_val=T.racc_state=T.racc_tstack=e,R(N[0],"Racc_Runtime_Version","1.4.6"),R(N[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),R(N[0],"Racc_Runtime_Core_Version_R","1.4.6"),R(N[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),R(N[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),R(N[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),R(N[0],"Racc_Runtime_Core_Version",p("Racc_Runtime_Core_Version_R")),R(N[0],"Racc_Runtime_Core_Revision",p("Racc_Runtime_Core_Revision_R")),R(N[0],"Racc_Runtime_Type","ruby"),Q(p("Parser"),"$racc_runtime_type",function(){return p("Racc_Runtime_Type")}),x(_,"$_racc_setup",function(){var $,h,r=this,l=e,n=e;return null==P.stderr&&(P.stderr=e),i(y(r.$class(),"Racc_debug_parser"))||(r.yydebug=!1),i(null!=($=r.yydebug)&&$!==e?"instance-variable":e)||(r.yydebug=!1),i(r.yydebug)&&(i(null!=(h=r.racc_debug_out)&&h!==e?"instance-variable":e)||(r.racc_debug_out=P.stderr),r.racc_debug_out=i(l=r.racc_debug_out)?l:P.stderr),n=y(r.$class(),"Racc_arg"),i(j(n.$size(),14))&&n["$[]="](13,!0),n}),x(_,"$_racc_init_sysvars",function(){var $=this;return $.racc_state=[0],$.racc_tstack=[],$.racc_vstack=[],$.racc_t=e,$.racc_val=e,$.racc_read_next=!0,$.racc_user_yyerror=!1,$.racc_error_status=0}),x(_,"$do_parse",function(){return this.$__send__(p("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),x(_,"$next_token",function(){return this.$raise(p("NotImplementedError"),this.$class()+"#next_token is not defined")}),x(_,"$_racc_do_parse_rb",function($,h){var r,n=this,g=e,d=e,S=e,C=e,te=e,O=e,re=e,X=e;return r=D($),g=null==r[0]?e:r[0],d=null==r[1]?e:r[1],S=null==r[2]?e:r[2],C=null==r[3]?e:r[3],te=null==r[10]?e:r[10],n.$_racc_init_sysvars(),O=re=X=e,a(n,"catch",["racc_end_parse"],function W(){var ne,ee,E=null==W.$$s?this:W.$$s,ce=e;for(null==E.racc_state&&(E.racc_state=e),null==E.racc_read_next&&(E.racc_read_next=e),null==E.racc_t&&(E.racc_t=e),null==E.yydebug&&(E.yydebug=e),null==E.racc_val&&(E.racc_val=e);i(!0);)for(i(X=C["$[]"](E.racc_state["$[]"](-1)))?(i(E.racc_read_next)&&w(E.racc_t,0)&&(ee=E.$next_token(),ne=D(ee),O=null==ne[0]?e:ne[0],E.racc_val=null==ne[1]?e:ne[1],E.racc_t=i(O)?i(ce=te["$[]"](O))?ce:1:0,i(E.yydebug)&&E.$racc_read_token(E.racc_t,O,E.racc_val),E.racc_read_next=!1),X=V(X,E.racc_t),i(f(X,0))&&i(re=g["$[]"](X))&&I(d["$[]"](X),E.racc_state["$[]"](-1))||(re=S["$[]"](E.racc_state["$[]"](-1)))):re=S["$[]"](E.racc_state["$[]"](-1));i(re=E.$_racc_evalact(re,$)););},{$$s:n})}),x(_,"$yyparse",function($,h){return this.$__send__(p("Racc_YY_Parse_Method"),$,h,this.$_racc_setup(),!0)}),x(_,"$_racc_yyparse_rb",function($,h,r,l){var n,d=this,S=e,C=e,Y=e,te=e,re=e,X=e,W=e;return n=D(r),S=null==n[0]?e:n[0],C=null==n[1]?e:n[1],Y=null==n[2]?e:n[2],te=null==n[3]?e:n[3],re=null==n[10]?e:n[10],d.$_racc_init_sysvars(),X=e,W=e,a(d,"catch",["racc_end_parse"],function ne(){var ee=null==ne.$$s?this:ne.$$s;for(null==ee.racc_state&&(ee.racc_state=e);!i(W=te["$[]"](ee.racc_state["$[]"](-1)));)for(;i(X=ee.$_racc_evalact(Y["$[]"](ee.racc_state["$[]"](-1)),r)););return a($,"__send__",[h],function E(ce,$e){var J=null==E.$$s?this:E.$$s,ie=e,ae=e;for(null==J.racc_t&&(J.racc_t=e),null==J.racc_state&&(J.racc_state=e),null==J.racc_read_next&&(J.racc_read_next=e),null==ce&&(ce=e),null==$e&&($e=e),J.racc_t=i(ce)?i(ie=re["$[]"](ce))?ie:1:0,J.racc_val=$e,J.racc_read_next=!1,W=V(W,J.racc_t),i(f(W,0))&&i(X=S["$[]"](W))&&I(C["$[]"](W),J.racc_state["$[]"](-1))||(X=Y["$[]"](J.racc_state["$[]"](-1)));i(X=J.$_racc_evalact(X,r)););for(;i(i(ie=i(ae=(W=te["$[]"](J.racc_state["$[]"](-1)))["$!"]())?ae:J.racc_read_next["$!"]())?ie:J.racc_t["$=="](0));)for(i(W)&&i(W=V(W,J.racc_t))&&i(f(W,0))&&i(X=S["$[]"](W))&&I(C["$[]"](W),J.racc_state["$[]"](-1))||(X=Y["$[]"](J.racc_state["$[]"](-1)));i(X=J.$_racc_evalact(X,r)););},{$$s:ee})},{$$s:d})}),x(_,"$_racc_evalact",function($,h){var r,Y,n=this,g=e,d=e,C=e,te=e,O=e,re=e;if(g=null==(r=D(h))[0]?e:r[0],d=null==r[1]?e:r[1],C=null==r[3]?e:r[3],Y=null==r[11]?e:r[11],te=null==r[12]?e:r[12],i(H($,0))&&i(j($,Y)))i(H(n.racc_error_status,0))&&(I(n.racc_t,1)||(n.racc_error_status=M(n.racc_error_status,1))),n.racc_vstack.$push(n.racc_val),n.racc_state.$push($),n.racc_read_next=!0,i(n.yydebug)&&(n.racc_tstack.$push(n.racc_t),n.$racc_shift(n.racc_t,n.racc_tstack,n.racc_vstack));else if(i(j($,0))&&i(H($,te["$-@"]()))){if(O=a(n,"catch",["racc_jump"],function X(){var W=null==X.$$s?this:X.$$s;return null==W.racc_state&&(W.racc_state=e),W.racc_state.$push(W.$_racc_do_reduce(h,$)),!1},{$$s:n}),i(O))switch(O.valueOf()){case 1:return n.racc_user_yyerror=!0,te["$-@"]();case 2:return Y;default:n.$raise("[Racc Bug] unknown jump code")}}else if(I($,Y))i(n.yydebug)&&n.$racc_accept(),n.$throw("racc_end_parse",n.racc_vstack["$[]"](0));else{if(I($,te["$-@"]())){switch(n.racc_error_status.valueOf()){case 0:i(h["$[]"](21))||n.$on_error(n.racc_t,n.racc_val,n.racc_vstack);break;case 3:I(n.racc_t,0)&&n.$throw("racc_end_parse",e),n.racc_read_next=!0}for(n.racc_user_yyerror=!1,n.racc_error_status=3;i(!0)&&!(i(re=C["$[]"](n.racc_state["$[]"](-1)))&&(re=V(re,1),i(f(re,0))&&i($=g["$[]"](re))&&I(d["$[]"](re),n.racc_state["$[]"](-1))));)i(A(n.racc_state.$size(),1))&&n.$throw("racc_end_parse",e),n.racc_state.$pop(),n.racc_vstack.$pop(),i(n.yydebug)&&(n.racc_tstack.$pop(),n.$racc_e_pop(n.racc_state,n.racc_tstack,n.racc_vstack));return $}n.$raise("[Racc Bug] unknown action "+$.$inspect())}return i(n.yydebug)&&n.$racc_next_state(n.racc_state["$[]"](-1),n.racc_state),e}),x(_,"$_racc_do_reduce",function($,h){var r,te,re,ce,$e,J,se,n=this,d=e,S=e,C=e,Y=e,O=e,X=e,W=e,ne=e,ee=e,E=e,ie=e,ae=e,ue=e;return d=null==(r=D($))[4]?e:r[4],S=null==r[5]?e:r[5],C=null==r[6]?e:r[6],Y=null==r[7]?e:r[7],te=null==r[8]?e:r[8],O=null==r[9]?e:r[9],re=null==r[13]?e:r[13],X=n.racc_state,W=n.racc_vstack,ne=n.racc_tstack,ee=q(h,-3),E=O["$[]"](ee),ce=O["$[]"](V(ee,1)),$e=O["$[]"](V(ee,2)),J=[],i(n.yydebug)&&(ie=ne["$[]"](E["$-@"](),E)),ae=W["$[]"](E["$-@"](),E),i(n.yydebug)&&ne["$[]="](E["$-@"](),E,J),W["$[]="](E["$-@"](),E,J),X["$[]="](E["$-@"](),E,J),i(re)?W.$push(n.$__send__($e,ae,W,ae["$[]"](0))):W.$push(n.$__send__($e,ae,W)),ne.$push(ce),i(n.yydebug)&&n.$racc_reduce(ie,ce,ne,W),se=M(ce,te),i(ee=Y["$[]"](se))&&(ee=V(ee,X["$[]"](-1)),i(f(ee,0))&&i(ue=d["$[]"](ee))&&I(S["$[]"](ee),se))?ue:C["$[]"](se)}),x(_,"$on_error",function($,h,r){var n,l=this;return l.$raise(p("ParseError"),l.$sprintf("\nparse error on value %s (%s)",h.$inspect(),i(n=l.$token_to_str($))?n:"?"))}),x(_,"$yyerror",function(){return this.$throw("racc_jump",1)}),x(_,"$yyaccept",function(){return this.$throw("racc_jump",2)}),x(_,"$yyerrok",c("racc_error_status",0)),x(_,"$racc_read_token",function($,h,r){var l=this;return l.racc_debug_out.$print("read    "),l.racc_debug_out.$print(h.$inspect(),"(",l.$racc_token2str($),") "),l.racc_debug_out.$puts(r.$inspect()),l.racc_debug_out.$puts()}),x(_,"$racc_shift",function($,h,r){var l=this;return l.racc_debug_out.$puts("shift   "+l.$racc_token2str($)),l.$racc_print_stacks(h,r),l.racc_debug_out.$puts()}),x(_,"$racc_reduce",function($,h,r,l){var n=this,g=e;return(g=n.racc_debug_out).$print("reduce "),i($["$empty?"]())?g.$print(" <none>"):a($,"each",[],function d(S){return null==S&&(S=e),g.$print(" ",(null==d.$$s?this:d.$$s).$racc_token2str(S))},{$$s:n}),g.$puts(" --\x3e "+n.$racc_token2str(h)),n.$racc_print_stacks(r,l),n.racc_debug_out.$puts()}),x(_,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),x(_,"$racc_e_pop",function($,h,r){var l=this;return l.racc_debug_out.$puts("error recovering mode: pop token"),l.$racc_print_states($),l.$racc_print_stacks(h,r),l.racc_debug_out.$puts()}),x(_,"$racc_next_state",function($,h){var r=this;return r.racc_debug_out.$puts("goto    "+$),r.$racc_print_states(h),r.racc_debug_out.$puts()}),x(_,"$racc_print_stacks",function($,h){var l=e;return(l=this.racc_debug_out).$print("        ["),a($,"each_index",[],function n(g){return null==g&&(g=e),l.$print(" (",(null==n.$$s?this:n.$$s).$racc_token2str($["$[]"](g))," ",h["$[]"](g).$inspect(),")")},{$$s:this}),l.$puts(" ]")}),x(_,"$racc_print_states",function($){var r=e;return(r=this.racc_debug_out).$print("        ["),a($,"each",[],function(n){return null==n&&(n=e),r.$print(" ",n)}),r.$puts(" ]")}),x(_,"$racc_token2str",function($){var r;return i(r=y(this.$class(),"Racc_token_to_s_table")["$[]"]($))?r:this.$raise("[Racc Bug] can't convert token "+$+" to string")}),x(_,"$token_to_str",function($){return y(this.$class(),"Racc_token_to_s_table")["$[]"]($)})}(o[0],o)},Opal.modules.strscan=function(t){var I,f,H,M,A,v=t.def,i=t.truthy,R=t.eqeqeq,Q=t.Opal,P=t.return_ivar,j=t.send,x=t.alias,D=[],a=t.nil;return I=D,H=[f=(0,t.klass)(D[0],null,"StringScanner")].concat(I),M=t.$r(H),(A=f.$$prototype).pos=A.string=A.working=A.matched=A.prev_pos=A.match=a,f.$attr_reader("pos","matched"),v(f,"$initialize",function(c){var s=this;return s.string=c,s.pos=0,s.matched=a,s.working=c,s.match=[]}),f.$attr_reader("string"),v(f,"$beginning_of_line?",function(){var c=this;return 0===c.pos||"\n"===c.string.charAt(c.pos-1)}),v(f,"$scan",function(c){var s=this,o=(c=s.$anchor(c)).exec(s.working);return null==o?s.matched=a:(s.prev_pos=s.pos,s.pos+=o[0].length,s.working=s.working.substring(o[0].length),s.matched=o[0],s.match=o,o[0])}),v(f,"$scan_until",function(c){var s=this;c=s.$anchor(c);for(var o=s.working,B=0;o.length!=B;++B){var e=c.exec(o.substr(B));if(null!==e){var y=B+e[0].length,K=o.substr(0,y);return s.matched=e[0],s.match=e,s.prev_pos=s.pos+B,s.pos+=y,s.working=o.substr(y),K}}return s.matched=a}),v(f,"$[]",function(c){var o;if(i(this.match["$empty?"]()))return a;R(M("Symbol"),o=c)?c=c.$to_s():R(M("String"),o)||(c=Q["$coerce_to!"](c,M("Integer"),"to_int"));var B=this.match;return c<0&&(c+=B.length),c<0||c>=B.length||null==B[c]?a:B[c]}),v(f,"$check",function(c){var s=this,o=(c=s.$anchor(c)).exec(s.working);return s.matched=null==o?a:o[0]}),v(f,"$check_until",function(c){var s=this,o=s.prev_pos,B=s.pos,e=s.working,y=s.$scan_until(c);return s.prev_pos=o,s.pos=B,s.working=e,y}),v(f,"$peek",function(c){return this.working.substring(0,c)}),v(f,"$eos?",function(){return 0===this.working.length}),v(f,"$exist?",function(c){var o=c.exec(this.working);return null==o?a:0==o.index?0:o.index+1}),v(f,"$skip",function(c){var s=this,o=(c=s.$anchor(c)).exec(s.working);if(null==o)return s.match=[],s.matched=a;var B=o[0],e=B.length;return s.matched=B,s.match=o,s.prev_pos=s.pos,s.pos+=e,s.working=s.working.substring(e),e}),v(f,"$skip_until",function(c){var o=this.$scan_until(c);return o===a?a:(this.matched=o.substr(-1),o.length)}),v(f,"$get_byte",function(){var c=this,s=a;return c.pos<c.string.length?(c.prev_pos=c.pos,c.pos+=1,s=c.matched=c.working.substring(0,1),c.working=c.working.substring(1)):c.matched=a,s}),v(f,"$match?",function(c){var s=this,o=(c=s.$anchor(c)).exec(s.working);return null==o?a:(s.prev_pos=s.pos,o[0].length)}),v(f,"$pos=",function(c){var s=this;return c<0&&(c+=s.string.$length()),s.pos=c,s.working=s.string.slice(c)}),v(f,"$matched_size",function(){return this.matched===a?a:this.matched.length}),v(f,"$post_match",function(){var c=this;return c.matched===a?a:c.string.substr(c.pos)}),v(f,"$pre_match",function(){var c=this;return c.matched===a?a:c.string.substr(0,c.prev_pos)}),v(f,"$reset",function(){var c=this;return c.working=c.string,c.matched=a,c.pos=0}),v(f,"$rest",P("working")),v(f,"$rest?",function(){return 0!==this.working.length}),v(f,"$rest_size",function(){return this.$rest().$size()}),v(f,"$terminate",function(){var c,s=this;return s.match=a,c=[s.string.$length()],j(s,"pos=",c),c[c.length-1]}),v(f,"$unscan",function(){var c=this;return c.pos=c.prev_pos,c.prev_pos=a,c.match=a,c}),x(f,"bol?","beginning_of_line?"),x(f,"getch","get_byte"),f.$private(),v(f,"$anchor",function(c){var s=c.toString().match(/\/([^\/]+)$/);return s=s?s[1]:void 0,new RegExp("^(?:"+c.source+")",s)})},Opal.modules["bcdice/normalize"]=function(t){var x,V,a,F=t.module,v=t.eqeqeq,i=t.def,R=t.eqeq,Q=[],P=t.nil;return x=Q,a=[F(Q[0],"BCDice")].concat(x),(V=F(a[0],"Normalize")).$module_function(),i(V,"$comparison_operator",function(f){var H;return v(/<=|=</,H=f)?"<=":v(/>=|=>/,H)?">=":v(/<>|!=|=!/,H)?"!=":v(/</,H)?"<":v(/>/,H)?">":v(/=/,H)?"==":P}),i(V,"$target_number",function(f){return R(f,"?")?f:f.$to_i()})},Opal.modules["bcdice/common_command/lexer"]=function(t){var w,H,s,o,B,e,A,I,F=t.module,v=t.klass,i=t.const_set,R=t.hash2,Q=t.truthy,P=t.def,j=t.top,x=[],D=t.nil;return j.$require("strscan"),j.$require("bcdice/normalize"),w=x,H=I=[F(x[0],"BCDice")].concat(w),s=A=[F(I[0],"CommonCommand")].concat(H),B=[o=v(A[0],null,"Lexer")].concat(s),e=t.$r(B),o.$$prototype.scanner=D,i(B[0],"SYMBOLS",R(["+","-","*","/","(",")","[","]","?","@"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","?":"QUESTION","@":"AT"}).$freeze()),P(o,"$initialize",function(G){var k;return G=Q(k=G.$split(" ",2).$first())?k:"",this.scanner=e("StringScanner").$new(G)}),P(o,"$next_token",function(){var G=this,z=D,k=D,m=D,L=D;return Q(G.scanner["$eos?"]())?[!1,"$"]:Q(z=G.scanner.$scan(/\d+/))?["NUMBER",z.$to_i()]:Q(k=G.scanner.$scan(/[<>!=]+/))?["CMP_OP",e("Normalize").$comparison_operator(k)]:(m=G.scanner.$getch().$upcase(),[Q(L=e("SYMBOLS")["$[]"](m))?L:m.$to_sym(),m])}),P(o,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/arithmetic/parser"]=function(t){var I,A,e,m,Z,L,U,b,_,N,p,T,h,y,z,k,c,s,H,F=t.module,v=t.klass,i=t.defs,R=t.def,Q=t.hash,P=t.const_set,j=t.truthy,x=t.top,D=[],a=t.nil,w=t.$$$;return x.$require("racc/parser.rb"),x.$require("bcdice/common_command/lexer"),x.$require("bcdice/arithmetic/node"),I=D,A=H=[F(D[0],"BCDice")].concat(I),c=[F(H[0],"Arithmetic")].concat(A),s=t.$r(c),e=c,z=[y=v(c[0],w(s("Racc"),"Parser"),"Parser")].concat(e),k=t.$r(z),y.$$prototype.lexer=a,i(y,"$parse",function(d){return this.$new().$parse(d)}),R(y,"$parse",function(d){try{return this.lexer=w(w(k("BCDice"),"CommonCommand"),"Lexer").$new(d),this.$do_parse()}catch(C){if(!t.rescue(C,[k("ParseError")]))throw C;try{return a}finally{t.pop_exception()}}}),y.$private(),R(y,"$next_token",function(){return this.lexer.$next_token()}),m=t.large_array_unpack("8,17,8,12,13,4,5,4,5,7,8,7,8,12,13,4,5,4,5,7,8,7,8,12,13,4,5,4,5,7,8,7,8,,,4,5,4,5,7,9,7,,,10,11,,10,11,22,26,24,25,27"),Z=t.large_array_unpack("0,9,4,2,2,0,0,4,4,0,5,4,7,18,18,5,5,7,7,5,10,7,11,19,19,10,10,11,11,10,12,11,13,,,12,12,13,13,12,1,13,,,16,16,,1,1,16,21,21,21,21"),L=[-2,40,-6,a,0,8,a,10,a,1,18,20,28,30,a,a,37,a,4,14,a,47,a,a,a,a,a,a],U=[-17,-17,-3,-6,-17,-17,-14,-17,-16,-17,-17,-17,-17,-17,-12,-13,-17,28,-1,-2,-4,-7,-15,-5,-8,-9,-10,-11],b=[14,15,23,1,18,19,a,a,20,21,16],_=[3,3,4,1,2,2,a,a,3,3,1],N=[a,3,-6,-4,-19,a],p=[a,a,2,3,a,6],T=t.large_array_unpack("0,0,racc_error,3,14,_reduce_1,3,14,_reduce_2,1,14,_reduce_none,3,15,_reduce_4,4,15,_reduce_5,1,15,_reduce_none,0,17,_reduce_7,1,17,_reduce_8,1,17,_reduce_9,1,17,_reduce_10,1,17,_reduce_11,2,16,_reduce_12,2,16,_reduce_13,1,16,_reduce_none,3,18,_reduce_15,1,18,_reduce_16"),h=Q(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12),P(z[0],"Racc_arg",[m,Z,U,L,b,_,p,N,13,T,h,28,17,!0]),j(k("Ractor","skip_raise")?"constant":a)&&k("Ractor").$make_shareable(k("Racc_arg")),P(z[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","$start","add","mul","unary","round_type","term"]),j(k("Ractor","skip_raise")?"constant":a)&&k("Ractor").$make_shareable(k("Racc_token_to_s_table")),P(z[0],"Racc_debug_parser",!1),R(y,"$_reduce_1",function(d,S,C){return w(w(k("Arithmetic"),"Node"),"BinaryOp").$new(d["$[]"](0),"+",d["$[]"](2))}),R(y,"$_reduce_2",function(d,S,C){return w(w(k("Arithmetic"),"Node"),"BinaryOp").$new(d["$[]"](0),"-",d["$[]"](2))}),R(y,"$_reduce_4",function(d,S,C){return w(w(k("Arithmetic"),"Node"),"BinaryOp").$new(d["$[]"](0),"*",d["$[]"](2))}),R(y,"$_reduce_5",function(d,S,C){return d["$[]"](3).$new(d["$[]"](0),d["$[]"](2))}),R(y,"$_reduce_7",function(d,S,C){return w(w(k("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),R(y,"$_reduce_8",function(d,S,C){return w(w(k("Arithmetic"),"Node"),"DivideWithCeil")}),R(y,"$_reduce_9",function(d,S,C){return w(w(k("Arithmetic"),"Node"),"DivideWithCeil")}),R(y,"$_reduce_10",function(d,S,C){return w(w(k("Arithmetic"),"Node"),"DivideWithRound")}),R(y,"$_reduce_11",function(d,S,C){return w(w(k("Arithmetic"),"Node"),"DivideWithFloor")}),R(y,"$_reduce_12",function(d,S,C){return d["$[]"](1)}),R(y,"$_reduce_13",function(d,S,C){return w(w(k("Arithmetic"),"Node"),"Negative").$new(d["$[]"](1))}),R(y,"$_reduce_15",function(d,S,C){return d["$[]"](1)}),R(y,"$_reduce_16",function(d,S,C){return w(w(k("Arithmetic"),"Node"),"Number").$new(d["$[]"](0))}),R(y,"$_reduce_none",function(d,S,C){return d["$[]"](0)})},Opal.modules["bcdice/arithmetic"]=function(t){var x,V,H,A,q,I,f,a,F=t.module,v=t.thrower,i=t.def,R=t.top,Q=[],P=t.nil;return R.$require("bcdice/arithmetic/node"),R.$require("bcdice/arithmetic/parser"),x=Q,V=a=[F(Q[0],"BCDice")].concat(x),f=[I=F(a[0],"Arithmetic")].concat(V),A=[H=t.get_singleton_class(I)].concat(f),q=t.$r(A),i(H,"$eval",function(s,o){try{var e;v("eval_return");try{return(e=q("Parser").$parse(s))===P||null==e?P:e.$eval(o)}catch(K){if(!t.rescue(K,[q("ZeroDivisionError")]))throw K;try{return P}finally{t.pop_exception()}}}catch(K){if(K===t.t_eval_return)return K.$v;throw K}})},Opal.queue(function(t){var s,y,Z,L,U,b,G,z,B,F=t.module,v=t.klass,i=t.const_set,R=t.send2,Q=t.find_super,P=t.def,j=t.truthy,x=t.send,D=t.rb_le,a=t.rb_ge,w=t.rb_plus,V=t.rb_lt,I=t.thrower,f=t.hash2,H=t.top,M=[],A=t.nil,q=t.$$$;return H.$require("bcdice/dice_table/table"),H.$require("bcdice/dice_table/d66_grid_table"),H.$require("bcdice/arithmetic"),s=M,y=B=[F(M[0],"BCDice")].concat(s),G=[F(B[0],"GameSystem")].concat(y),z=t.$r(G),Z=G,U=[L=v(G[0],z("Base"),"AngelGear")].concat(Z),b=t.$r(U),L.$$prototype.randomizer=A,i(U[0],"ID","AngelGear"),i(U[0],"NAME","\u30a8\u30f3\u30bc\u30eb\u30ae\u30a2 \u5929\u4f7f\u5927\u6226TRPG The 2nd Editon"),i(U[0],"SORT_KEY","\u3048\u3093\u305b\u308b\u304d\u30422"),i(U[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\u3000nAG[s][\xb1a]\n[]\u5185\u306f\u7701\u7565\u53ef\u80fd\u3002\nn:\u5224\u5b9a\u5024\ns:\u6280\u80fd\u5024\na:\u4fee\u6b63\n\uff08\u4f8b\uff09\n12AG 10AG3\xb120\n\n\u30fb\u611f\u60c5\u8868\u3000ET\n"),P(L,"$initialize",function N(p){var u=this;return N.$$p=null,R(u,Q(u,"initialize",N,!1,!0),"initialize",[p],null),u.sort_barabara_dice=!0}),P(L,"$eval_game_system_specific_command",function(p){var T,$=A;return j($=/^(\d+)AG(\d+)?(([+-]\d+)*)$/.$match(p))?this.$resolute_action($["$[]"](1).$to_i(),(T=$["$[]"](2))===A||null==T?A:T.$to_i(),$["$[]"](3),p):this.$roll_tables(p,b("TABLES"))}),P(L,"$resolute_action",function(p,T,u,$){try{I("eval_return");var n,C,l=A,g=A,d=A,S=A;return n=(l=this.randomizer.$roll_barabara(p,6).$sort()).$join(","),g=0,d=0,j(T)&&(d=x(l,"count",[],function(te){return null==te&&(te=A),D(te,T)}),j(u["$empty?"]())||(g=b("Arithmetic").$eval(u,q(b("RoundType"),"FLOOR")))),j(a(w(d,g),100))&&(S="(\u798f\u97f3\u767a\u751f)"),C="("+$+") \uff1e "+d+"["+n+"]"+this.$format("%+d",g)+" \uff1e \u6210\u529f\u6570: "+w(d,g)+S,j(a(w(d,g),100))?b("Result").$critical(C):V(0,w(d,g))?b("Result").$success(C):b("Result").$failure(C)}catch(Y){if(Y===t.t_eval_return)return Y.$v;throw Y}}),i(U[0],"TABLES",f(["ET"],{ET:q(b("DiceTable"),"D66GridTable").$new("\u611f\u60c5\u8868",[["\u597d\u5947\u5fc3\uff08\u597d\u5947\u5fc3\uff09","\u61a7\u308c\uff08\u3042\u3053\u304c\u308c\uff09","\u5c0a\u656c\uff08\u305d\u3093\u3051\u3044\uff09","\u4ef2\u9593\u610f\u8b58\uff08\u306a\u304b\u307e\u3044\u3057\u304d\uff09","\u6bcd\u6027\u611b\uff08\u307c\u305b\u3044\u3042\u3044\uff09","\u611f\u5fc3\uff08\u304b\u3093\u3057\u3093\uff09"],["\u7d14\u611b\uff08\u3058\u3085\u3093\u3042\u3044\uff09","\u53cb\u60c5\uff08\u3086\u3046\u3058\u3087\u3046\uff09","\u540c\u60c5\uff08\u3069\u3046\u3058\u3087\u3046\uff09","\u7236\u6027\u611b\uff08\u3075\u305b\u3044\u3042\u3044\uff09","\u5e78\u798f\u611f\uff08\u3053\u3046\u3075\u304f\u304b\u3093\uff09","\u4fe1\u983c\uff08\u3057\u3093\u3089\u3044\uff09"],["\u7af6\u4e89\u5fc3\uff08\u304d\u3087\u3046\u305d\u3046\u3057\u3093\uff09","\u89aa\u8fd1\u611f\uff08\u3057\u3093\u304d\u3093\u304b\u3093\uff09","\u307e\u3054\u3053\u308d","\u597d\u610f\uff08\u3053\u3046\u3044\uff09","\u6709\u70ba\uff08\u3086\u3046\u3044\uff09","\u5d07\u62dd\uff08\u3059\u3046\u306f\u3044\uff09"],["\u5927\u5acc\u3044\uff08\u3060\u3044\u304d\u3089\u3044\uff09","\u59ac\u307f\uff08\u306d\u305f\u307f\uff09","\u4fae\u8511\uff08\u3076\u3079\u3064\uff09","\u8150\u308c\u7e01\uff08\u304f\u3055\u308c\u3048\u3093\uff09","\u6050\u6016\uff08\u304d\u3087\u3046\u3075\uff09","\u52a3\u7b49\u611f\uff08\u308c\u3063\u3068\u3046\u304b\u3093\uff09"],["\u504f\u611b\uff08\u3078\u3093\u3042\u3044\uff09","\u5bc2\u3057\u3055\uff08\u3055\u3073\u3057\u3055\uff09","\u6190\u61ab\uff08\u308c\u3093\u3073\u3093\uff09","\u95d8\u4e89\u5fc3\uff08\u3068\u3046\u305d\u3046\u3057\u3093\uff09","\u98df\u50b7\uff08\u3057\u3087\u304f\u3057\u3087\u3046\uff09","\u5618\u3064\u304d\uff08\u3046\u305d\u3064\u304d\uff09"],["\u7518\u3048\uff08\u3042\u307e\u3048\uff09","\u82db\u7acb\u3061\uff08\u3044\u3089\u3060\u3061\uff09","\u4e0b\u5fc3\uff08\u3057\u305f\u3054\u3053\u308d\uff09","\u618e\u60aa\uff08\u305e\u3046\u304a\uff09","\u7591\u60d1\uff08\u304e\u308f\u304f\uff09","\u652f\u914d\uff08\u3057\u306f\u3044\uff09"]])}).$freeze()),L.$register_prefix("\\d+AG",b("TABLES").$keys())})}}]);