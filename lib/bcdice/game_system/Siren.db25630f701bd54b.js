(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[9050],{3741:(ge,be,pe)=>{pe(5151),Opal.modules["racc/parser"]=function(u){var ie,O,N,te=u.module,x=u.klass,_=u.truthy,j=u.const_set,F=u.defs,ne=u.gvars,E=u.rb_lt,C=u.def,d=u.to_ary,R=u.send,T=u.neqeq,re=u.rb_plus,X=u.eqeq,y=u.rb_ge,p=u.rb_gt,I=u.rb_minus,Q=u.rb_le,L=u.rb_times,a=u.assign_ivar_val,c=[],g=u.$r(c),e=u.nil,M=u.$$$;return ie=c,O=[te(c[0],"Racc")].concat(ie),N=u.$r(O),x(O[0],N("StandardError"),"ParseError"),_(M("::","ParseError","skip_raise")?"constant":e)||j(c[0],"ParseError",M(g("Racc"),"ParseError")),function(D,ie){var S,l,s,b,A,N=[te(D,"Racc")].concat(ie),Y=u.$r(N);return _(Y("Racc_No_Extensions","skip_raise")?"constant":e)||j(N[0],"Racc_No_Extensions",!1),S=N,s=[l=x(N[0],null,"Parser")].concat(S),b=u.$r(s),(A=l.$$prototype).yydebug=A.racc_debug_out=A.racc_error_status=A.racc_t=A.racc_vstack=A.racc_val=A.racc_state=A.racc_tstack=e,j(s[0],"Racc_Runtime_Version","1.4.6"),j(s[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),j(s[0],"Racc_Runtime_Core_Version_R","1.4.6"),j(s[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),j(s[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),j(s[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),j(s[0],"Racc_Runtime_Core_Version",b("Racc_Runtime_Core_Version_R")),j(s[0],"Racc_Runtime_Core_Revision",b("Racc_Runtime_Core_Revision_R")),j(s[0],"Racc_Runtime_Type","ruby"),F(b("Parser"),"$racc_runtime_type",function(){return b("Racc_Runtime_Type")}),C(l,"$_racc_setup",function(){var t,h,r=this,m=e,i=e;return null==ne.stderr&&(ne.stderr=e),_(M(r.$class(),"Racc_debug_parser"))||(r.yydebug=!1),_(null!=(t=r.yydebug)&&t!==e?"instance-variable":e)||(r.yydebug=!1),_(r.yydebug)&&(_(null!=(h=r.racc_debug_out)&&h!==e?"instance-variable":e)||(r.racc_debug_out=ne.stderr),r.racc_debug_out=_(m=r.racc_debug_out)?m:ne.stderr),i=M(r.$class(),"Racc_arg"),_(E(i.$size(),14))&&i["$[]="](13,!0),i}),C(l,"$_racc_init_sysvars",function(){var t=this;return t.racc_state=[0],t.racc_tstack=[],t.racc_vstack=[],t.racc_t=e,t.racc_val=e,t.racc_read_next=!0,t.racc_user_yyerror=!1,t.racc_error_status=0}),C(l,"$do_parse",function(){return this.$__send__(b("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),C(l,"$next_token",function(){return this.$raise(b("NotImplementedError"),this.$class()+"#next_token is not defined")}),C(l,"$_racc_do_parse_rb",function(t,h){var r,i=this,U=e,ae=e,K=e,_e=e,se=e,Z=e,ce=e,V=e;return r=d(t),U=null==r[0]?e:r[0],ae=null==r[1]?e:r[1],K=null==r[2]?e:r[2],_e=null==r[3]?e:r[3],se=null==r[10]?e:r[10],i.$_racc_init_sysvars(),Z=ce=V=e,R(i,"catch",["racc_end_parse"],function H(){var J,v,n=null==H.$$s?this:H.$$s,k=e;for(null==n.racc_state&&(n.racc_state=e),null==n.racc_read_next&&(n.racc_read_next=e),null==n.racc_t&&(n.racc_t=e),null==n.yydebug&&(n.yydebug=e),null==n.racc_val&&(n.racc_val=e);_(!0);)for(_(V=_e["$[]"](n.racc_state["$[]"](-1)))?(_(n.racc_read_next)&&T(n.racc_t,0)&&(v=n.$next_token(),J=d(v),Z=null==J[0]?e:J[0],n.racc_val=null==J[1]?e:J[1],n.racc_t=_(Z)?_(k=se["$[]"](Z))?k:1:0,_(n.yydebug)&&n.$racc_read_token(n.racc_t,Z,n.racc_val),n.racc_read_next=!1),V=re(V,n.racc_t),_(y(V,0))&&_(ce=U["$[]"](V))&&X(ae["$[]"](V),n.racc_state["$[]"](-1))||(ce=K["$[]"](n.racc_state["$[]"](-1)))):ce=K["$[]"](n.racc_state["$[]"](-1));_(ce=n.$_racc_evalact(ce,t)););},{$$s:i})}),C(l,"$yyparse",function(t,h){return this.$__send__(b("Racc_YY_Parse_Method"),t,h,this.$_racc_setup(),!0)}),C(l,"$_racc_yyparse_rb",function(t,h,r,m){var i,K=e,_e=e,ee=e,se=e,ce=e,V=e,H=e;return i=d(r),K=null==i[0]?e:i[0],_e=null==i[1]?e:i[1],ee=null==i[2]?e:i[2],se=null==i[3]?e:i[3],ce=null==i[10]?e:i[10],this.$_racc_init_sysvars(),V=e,H=e,R(this,"catch",["racc_end_parse"],function J(){var v=null==J.$$s?this:J.$$s;for(null==v.racc_state&&(v.racc_state=e);!_(H=se["$[]"](v.racc_state["$[]"](-1)));)for(;_(V=v.$_racc_evalact(ee["$[]"](v.racc_state["$[]"](-1)),r)););return R(t,"__send__",[h],function n(k,w){var $=null==n.$$s?this:n.$$s,P=e,G=e;for(null==$.racc_t&&($.racc_t=e),null==$.racc_state&&($.racc_state=e),null==$.racc_read_next&&($.racc_read_next=e),null==k&&(k=e),null==w&&(w=e),$.racc_t=_(k)?_(P=ce["$[]"](k))?P:1:0,$.racc_val=w,$.racc_read_next=!1,H=re(H,$.racc_t),_(y(H,0))&&_(V=K["$[]"](H))&&X(_e["$[]"](H),$.racc_state["$[]"](-1))||(V=ee["$[]"]($.racc_state["$[]"](-1)));_(V=$.$_racc_evalact(V,r)););for(;_(_(P=_(G=(H=se["$[]"]($.racc_state["$[]"](-1)))["$!"]())?G:$.racc_read_next["$!"]())?P:$.racc_t["$=="](0));)for(_(H)&&_(H=re(H,$.racc_t))&&_(y(H,0))&&_(V=K["$[]"](H))&&X(_e["$[]"](H),$.racc_state["$[]"](-1))||(V=ee["$[]"]($.racc_state["$[]"](-1)));_(V=$.$_racc_evalact(V,r)););},{$$s:v})},{$$s:this})}),C(l,"$_racc_evalact",function(t,h){var r,ee,i=this,U=e,ae=e,_e=e,se=e,Z=e,ce=e;if(U=null==(r=d(h))[0]?e:r[0],ae=null==r[1]?e:r[1],_e=null==r[3]?e:r[3],ee=null==r[11]?e:r[11],se=null==r[12]?e:r[12],_(p(t,0))&&_(E(t,ee)))_(p(i.racc_error_status,0))&&(X(i.racc_t,1)||(i.racc_error_status=I(i.racc_error_status,1))),i.racc_vstack.$push(i.racc_val),i.racc_state.$push(t),i.racc_read_next=!0,_(i.yydebug)&&(i.racc_tstack.$push(i.racc_t),i.$racc_shift(i.racc_t,i.racc_tstack,i.racc_vstack));else if(_(E(t,0))&&_(p(t,se["$-@"]()))){if(Z=R(i,"catch",["racc_jump"],function V(){var H=null==V.$$s?this:V.$$s;return null==H.racc_state&&(H.racc_state=e),H.racc_state.$push(H.$_racc_do_reduce(h,t)),!1},{$$s:i}),_(Z))switch(Z.valueOf()){case 1:return i.racc_user_yyerror=!0,se["$-@"]();case 2:return ee;default:i.$raise("[Racc Bug] unknown jump code")}}else if(X(t,ee))_(i.yydebug)&&i.$racc_accept(),i.$throw("racc_end_parse",i.racc_vstack["$[]"](0));else{if(X(t,se["$-@"]())){switch(i.racc_error_status.valueOf()){case 0:_(h["$[]"](21))||i.$on_error(i.racc_t,i.racc_val,i.racc_vstack);break;case 3:X(i.racc_t,0)&&i.$throw("racc_end_parse",e),i.racc_read_next=!0}for(i.racc_user_yyerror=!1,i.racc_error_status=3;_(!0)&&!(_(ce=_e["$[]"](i.racc_state["$[]"](-1)))&&(ce=re(ce,1),_(y(ce,0))&&_(t=U["$[]"](ce))&&X(ae["$[]"](ce),i.racc_state["$[]"](-1))));)_(Q(i.racc_state.$size(),1))&&i.$throw("racc_end_parse",e),i.racc_state.$pop(),i.racc_vstack.$pop(),_(i.yydebug)&&(i.racc_tstack.$pop(),i.$racc_e_pop(i.racc_state,i.racc_tstack,i.racc_vstack));return t}i.$raise("[Racc Bug] unknown action "+t.$inspect())}return _(i.yydebug)&&i.$racc_next_state(i.racc_state["$[]"](-1),i.racc_state),e}),C(l,"$_racc_do_reduce",function(t,h){var r,se,ce,k,w,$,z,i=this,ae=e,K=e,_e=e,ee=e,Z=e,V=e,H=e,J=e,v=e,n=e,P=e,G=e,q=e;return ae=null==(r=d(t))[4]?e:r[4],K=null==r[5]?e:r[5],_e=null==r[6]?e:r[6],ee=null==r[7]?e:r[7],se=null==r[8]?e:r[8],Z=null==r[9]?e:r[9],ce=null==r[13]?e:r[13],V=i.racc_state,H=i.racc_vstack,J=i.racc_tstack,v=L(h,-3),n=Z["$[]"](v),k=Z["$[]"](re(v,1)),w=Z["$[]"](re(v,2)),$=[],_(i.yydebug)&&(P=J["$[]"](n["$-@"](),n)),G=H["$[]"](n["$-@"](),n),_(i.yydebug)&&J["$[]="](n["$-@"](),n,$),H["$[]="](n["$-@"](),n,$),V["$[]="](n["$-@"](),n,$),_(ce)?H.$push(i.$__send__(w,G,H,G["$[]"](0))):H.$push(i.$__send__(w,G,H)),J.$push(k),_(i.yydebug)&&i.$racc_reduce(P,k,J,H),z=I(k,se),_(v=ee["$[]"](z))&&(v=re(v,V["$[]"](-1)),_(y(v,0))&&_(q=ae["$[]"](v))&&X(K["$[]"](v),z))?q:_e["$[]"](z)}),C(l,"$on_error",function(t,h,r){var i,m=this;return m.$raise(b("ParseError"),m.$sprintf("\nparse error on value %s (%s)",h.$inspect(),_(i=m.$token_to_str(t))?i:"?"))}),C(l,"$yyerror",function(){return this.$throw("racc_jump",1)}),C(l,"$yyaccept",function(){return this.$throw("racc_jump",2)}),C(l,"$yyerrok",a("racc_error_status",0)),C(l,"$racc_read_token",function(t,h,r){var m=this;return m.racc_debug_out.$print("read    "),m.racc_debug_out.$print(h.$inspect(),"(",m.$racc_token2str(t),") "),m.racc_debug_out.$puts(r.$inspect()),m.racc_debug_out.$puts()}),C(l,"$racc_shift",function(t,h,r){var m=this;return m.racc_debug_out.$puts("shift   "+m.$racc_token2str(t)),m.$racc_print_stacks(h,r),m.racc_debug_out.$puts()}),C(l,"$racc_reduce",function(t,h,r,m){var i=this,U=e;return(U=i.racc_debug_out).$print("reduce "),_(t["$empty?"]())?U.$print(" <none>"):R(t,"each",[],function ae(K){return null==K&&(K=e),U.$print(" ",(null==ae.$$s?this:ae.$$s).$racc_token2str(K))},{$$s:i}),U.$puts(" --\x3e "+i.$racc_token2str(h)),i.$racc_print_stacks(r,m),i.racc_debug_out.$puts()}),C(l,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),C(l,"$racc_e_pop",function(t,h,r){var m=this;return m.racc_debug_out.$puts("error recovering mode: pop token"),m.$racc_print_states(t),m.$racc_print_stacks(h,r),m.racc_debug_out.$puts()}),C(l,"$racc_next_state",function(t,h){var r=this;return r.racc_debug_out.$puts("goto    "+t),r.$racc_print_states(h),r.racc_debug_out.$puts()}),C(l,"$racc_print_stacks",function(t,h){var m=e;return(m=this.racc_debug_out).$print("        ["),R(t,"each_index",[],function i(U){return null==U&&(U=e),m.$print(" (",(null==i.$$s?this:i.$$s).$racc_token2str(t["$[]"](U))," ",h["$[]"](U).$inspect(),")")},{$$s:this}),m.$puts(" ]")}),C(l,"$racc_print_states",function(t){var r=e;return(r=this.racc_debug_out).$print("        ["),R(t,"each",[],function(i){return null==i&&(i=e),r.$print(" ",i)}),r.$puts(" ]")}),C(l,"$racc_token2str",function(t){var r;return _(r=M(this.$class(),"Racc_token_to_s_table")["$[]"](t))?r:this.$raise("[Racc Bug] can't convert token "+t+" to string")}),C(l,"$token_to_str",function(t){return M(this.$class(),"Racc_token_to_s_table")["$[]"](t)})}(c[0],c)},Opal.modules["bcdice/arithmetic/node"]=function(u){var a,e,$e,S,l,N,Y,D,c,te=u.module,x=u.klass,_=u.def,j=u.thrower,F=u.return_ivar,ne=u.send2,E=u.find_super,C=u.eqeq,d=u.const_set,R=u.eqeqeq,T=u.rb_divide,re=u.truthy,X=u.assign_ivar,y=u.alias,p=[],I=u.nil,Q=u.$$$;return a=p,e=c=[te(p[0],"BCDice")].concat(a),$e=D=[te(c[0],"Arithmetic")].concat(e),N=[te(D[0],"Node")].concat($e),Y=u.$r(N),(l=(S=x(N[0],null,"BinaryOp")).$$prototype).lhs=l.rhs=l.op=I,_(S,"$initialize",function(b,A,f){var t=this;return t.lhs=b,t.op=A,t.rhs=f}),_(S,"$eval",function(b){try{j("eval_return");var h,f=this,t=I;return t=f.lhs.$eval(b),h=f.rhs.$eval(b),t.$send(f.op,h)}catch(r){if(r===u.t_eval_return)return r.$v;throw r}}),_(S,"$output",function(){var b=this;return""+b.lhs.$output()+b.op+b.rhs.$output()}),_(S,"$s_exp",function(){var b=this;return"("+b.$op_for_s_exp()+" "+b.lhs.$s_exp()+" "+b.rhs.$s_exp()+")"}),_(S,"$op_for_s_exp",F("op")),function(B,W,S){var l=x(B,W,"DivideBase"),s=[l].concat(S),b=u.$r(s),A=l.$$prototype;A.lhs=A.rhs=A.op=I,_(l,"$initialize",function f(t,h){return f.$$p=null,ne(this,E(this,"initialize",f,!1,!0),"initialize",[t,"/",h],null)}),_(l,"$eval",function(t){try{j("eval_return");var m,i,r=this;return m=r.lhs.$eval(t),i=r.rhs.$eval(t),C(i,0)&&r.$raise(b("ZeroDivisionError")),r.$divide_and_round(m,i,t)}catch(U){if(U===u.t_eval_return)return U.$v;throw U}}),_(l,"$output",function f(){var t=f.$$p||I,h=this;return f.$$p=null,""+ne(h,E(h,"output",f,!1,!0),"output",[],t)+h.$rounding_method()}),l.$private(),_(l,"$rounding_method",function(){return Q(this.$class(),"ROUNDING_METHOD")}),_(l,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),_(l,"$divide_and_round",function(t,h,r){return this.$raise(b("NotImplementedError"))})}(N[0],Y("BinaryOp"),N),function(B,W,S){var l=x(B,W,"DivideWithGameSystemDefault"),s=[l].concat(S),b=u.$r(s);d(s[0],"ROUNDING_METHOD",""),l.$private(),_(l,"$divide_and_round",function(f,t,h){var r,m=I;return R(Q(b("RoundType"),"CEIL"),r=h)?T(f.$to_f(),t).$ceil():R(Q(b("RoundType"),"ROUND"),r)?(m=T(f.$to_f(),t),re(m["$negative?"]())?m.$abs().$round()["$-@"]():m.$round()):T(f,t).$floor()})}(N[0],Y("DivideBase"),N),function(B,W,S){var l=x(B,W,"DivideWithCeil"),s=[l].concat(S);d(s[0],"ROUNDING_METHOD","C"),l.$private(),_(l,"$divide_and_round",function(A,f,t){return T(A.$to_f(),f).$ceil()})}(N[0],Y("DivideBase"),N),function(B,W,S){var l=x(B,W,"DivideWithRound"),s=[l].concat(S);d(s[0],"ROUNDING_METHOD","R"),l.$private(),_(l,"$divide_and_round",function(A,f,t){var h=I;return h=T(A.$to_f(),f),re(h["$negative?"]())?h.$abs().$round()["$-@"]():h.$round()})}(N[0],Y("DivideBase"),N),function(B,W,S){var l=x(B,W,"DivideWithFloor"),s=[l].concat(S);d(s[0],"ROUNDING_METHOD","F"),l.$private(),_(l,"$divide_and_round",function(A,f,t){return T(A,f).$floor()})}(N[0],Y("DivideBase"),N),function(B,W){var S=x(B,null,"Negative");S.$$prototype.body=I,_(S,"$initialize",X("body")),_(S,"$eval",function(b){try{return j("eval_return"),this.body.$eval(b)["$-@"]()}catch(t){if(t===u.t_eval_return)return t.$v;throw t}}),_(S,"$output",function(){return"-"+this.body.$output()}),_(S,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(N[0]),function(B,W){var S=x(B,null,"Parenthesis");S.$$prototype.expr=I,_(S,"$initialize",X("expr")),_(S,"$eval",function(b){try{return j("eval_return"),this.expr.$eval(b)}catch(t){if(t===u.t_eval_return)return t.$v;throw t}}),_(S,"$output",function(){return"("+this.expr.$output()+")"}),_(S,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(N[0]),function(B,W){var S=x(B,null,"Number");return S.$$prototype.value=I,_(S,"$initialize",X("value")),_(S,"$eval",F("value")),_(S,"$output",function(){return this.value.$to_s()}),y(S,"s_exp","output")}(N[0])},Opal.modules.strscan=function(u){var X,y,p,I,Q,x=u.def,_=u.truthy,j=u.eqeqeq,F=u.Opal,ne=u.return_ivar,E=u.send,C=u.alias,d=[],R=u.nil;return X=d,p=[y=(0,u.klass)(d[0],null,"StringScanner")].concat(X),I=u.$r(p),(Q=y.$$prototype).pos=Q.string=Q.working=Q.matched=Q.prev_pos=Q.match=R,y.$attr_reader("pos","matched"),x(y,"$initialize",function(a){var o=this;return o.string=a,o.pos=0,o.matched=R,o.working=a,o.match=[]}),y.$attr_reader("string"),x(y,"$beginning_of_line?",function(){var a=this;return 0===a.pos||"\n"===a.string.charAt(a.pos-1)}),x(y,"$scan",function(a){var o=this,c=(a=o.$anchor(a)).exec(o.working);return null==c?o.matched=R:(o.prev_pos=o.pos,o.pos+=c[0].length,o.working=o.working.substring(c[0].length),o.matched=c[0],o.match=c,c[0])}),x(y,"$scan_until",function(a){var o=this;a=o.$anchor(a);for(var c=o.working,g=0;c.length!=g;++g){var e=a.exec(c.substr(g));if(null!==e){var M=g+e[0].length,D=c.substr(0,M);return o.matched=e[0],o.match=e,o.prev_pos=o.pos+g,o.pos+=M,o.working=c.substr(M),D}}return o.matched=R}),x(y,"$[]",function(a){var c;if(_(this.match["$empty?"]()))return R;j(I("Symbol"),c=a)?a=a.$to_s():j(I("String"),c)||(a=F["$coerce_to!"](a,I("Integer"),"to_int"));var g=this.match;return a<0&&(a+=g.length),a<0||a>=g.length||null==g[a]?R:g[a]}),x(y,"$check",function(a){var o=this,c=(a=o.$anchor(a)).exec(o.working);return o.matched=null==c?R:c[0]}),x(y,"$check_until",function(a){var o=this,c=o.prev_pos,g=o.pos,e=o.working,M=o.$scan_until(a);return o.prev_pos=c,o.pos=g,o.working=e,M}),x(y,"$peek",function(a){return this.working.substring(0,a)}),x(y,"$eos?",function(){return 0===this.working.length}),x(y,"$exist?",function(a){var c=a.exec(this.working);return null==c?R:0==c.index?0:c.index+1}),x(y,"$skip",function(a){var o=this,c=(a=o.$anchor(a)).exec(o.working);if(null==c)return o.match=[],o.matched=R;var g=c[0],e=g.length;return o.matched=g,o.match=c,o.prev_pos=o.pos,o.pos+=e,o.working=o.working.substring(e),e}),x(y,"$skip_until",function(a){var c=this.$scan_until(a);return c===R?R:(this.matched=c.substr(-1),c.length)}),x(y,"$get_byte",function(){var a=this,o=R;return a.pos<a.string.length?(a.prev_pos=a.pos,a.pos+=1,o=a.matched=a.working.substring(0,1),a.working=a.working.substring(1)):a.matched=R,o}),x(y,"$match?",function(a){var o=this,c=(a=o.$anchor(a)).exec(o.working);return null==c?R:(o.prev_pos=o.pos,c[0].length)}),x(y,"$pos=",function(a){var o=this;return a<0&&(a+=o.string.$length()),o.pos=a,o.working=o.string.slice(a)}),x(y,"$matched_size",function(){return this.matched===R?R:this.matched.length}),x(y,"$post_match",function(){var a=this;return a.matched===R?R:a.string.substr(a.pos)}),x(y,"$pre_match",function(){var a=this;return a.matched===R?R:a.string.substr(0,a.prev_pos)}),x(y,"$reset",function(){var a=this;return a.working=a.string,a.matched=R,a.pos=0}),x(y,"$rest",ne("working")),x(y,"$rest?",function(){return 0!==this.working.length}),x(y,"$rest_size",function(){return this.$rest().$size()}),x(y,"$terminate",function(){var a,o=this;return o.match=R,a=[o.string.$length()],E(o,"pos=",a),a[a.length-1]}),x(y,"$unscan",function(){var a=this;return a.pos=a.prev_pos,a.prev_pos=R,a.match=R,a}),C(y,"bol?","beginning_of_line?"),C(y,"getch","get_byte"),y.$private(),x(y,"$anchor",function(a){var o=a.toString().match(/\/([^\/]+)$/);return o=o?o[1]:void 0,new RegExp("^(?:"+a.source+")",o)})},Opal.modules["bcdice/normalize"]=function(u){var C,re,R,te=u.module,x=u.eqeqeq,_=u.def,j=u.eqeq,F=[],ne=u.nil;return C=F,R=[te(F[0],"BCDice")].concat(C),(re=te(R[0],"Normalize")).$module_function(),_(re,"$comparison_operator",function(y){var p;return x(/<=|=</,p=y)?"<=":x(/>=|=>/,p)?">=":x(/<>|!=|=!/,p)?"!=":x(/</,p)?"<":x(/>/,p)?">":x(/=/,p)?"==":ne}),_(re,"$target_number",function(y){return j(y,"?")?y:y.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(u){var X,Q,g,e,M,D,ie,a,p,te=u.module,x=u.klass,_=u.const_set,j=u.hash2,F=u.truthy,ne=u.send,E=u.def,C=u.thrower,d=u.top,R=[],T=u.nil;return d.$require("strscan"),d.$require("bcdice/normalize"),X=R,Q=p=[te(R[0],"BCDice")].concat(X),g=a=[te(p[0],"Command")].concat(Q),M=[e=x(a[0],null,"Lexer")].concat(g),D=u.$r(M),(ie=e.$$prototype).scanner=ie.notations=T,_(M[0],"SYMBOLS",j(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),E(e,"$initialize",function(O,N){var Y,B,S;return O=F(S=(Y=(B=O)===T||null==B?T:B.$split(" ",2))===T||null==Y?T:Y.$first())?S:"",this.scanner=D("StringScanner").$new(O),this.notations=ne(N,"map",[],function(s){return null==s&&(s=T),F(s["$is_a?"](D("String")))?D("Regexp").$new(s):s})}),E(e,"$next_token",function(){try{var O=C("return"),N=this,Y=T,B=T,S=T,l=T;return F(N.scanner["$eos?"]())?[!1,"$"]:(ne(N.notations,"each",[],function s(b){var f,A=null==s.$$s?this:s.$$s;if(null==A.scanner&&(A.scanner=T),null==b&&(b=T),f=A.scanner.$scan(b),!F(f))return T;O.$throw(["NOTATION",f])},{$$s:N,$$ret:O}),F(Y=N.scanner.$scan(/\d+/))?["NUMBER",Y.$to_i()]:F(B=N.scanner.$scan(/[<>!=]+/))?(B=D("Normalize").$comparison_operator(B),[F(B)?"CMP_OP":"ILLEGAL",B]):(S=N.scanner.$getch().$upcase(),[F(l=D("SYMBOLS")["$[]"](S))?l:S.$to_sym(),S]))}catch(s){if(s===O)return s.$v;throw s}}),E(e,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(u){var d,X,L,a,o,c,g,p,T,te=u.module,x=u.klass,_=u.def,j=u.return_ivar,F=u.truthy,ne=[],E=u.nil;return d=ne,X=T=[te(ne[0],"BCDice")].concat(d),L=p=[te(T[0],"Command")].concat(X),o=[a=x(p[0],null,"Parsed")].concat(L),c=u.$r(o),(g=a.$$prototype).critical=g.fumble=g.dollar=g.modify_number=g.question_target=g.target_number=g.prefix_number=g.command=g.suffix_number=g.cmp_op=E,a.$attr_accessor("command"),a.$attr_accessor("prefix_number"),a.$attr_accessor("suffix_number"),a.$attr_accessor("critical"),a.$attr_accessor("fumble"),a.$attr_accessor("dollar"),a.$attr_accessor("modify_number"),a.$attr_accessor("cmp_op"),a.$attr_accessor("target_number"),a.$attr_writer("question_target"),_(a,"$initialize",function(){var M=this;return M.prefix_number=E,M.suffix_number=E,M.critical=E,M.fumble=E,M.dollar=E,M.cmp_op=E,M.target_number=E,M.question_target=!1}),_(a,"$question_target?",j("question_target")),_(a,"$to_s",function(M){var D=this,ie=E,$e=E,O=E,N=E,Y=E;switch(null==M&&(M="after_command"),ie=F(D.critical)?"@"+D.critical:E,$e=F(D.fumble)?"#"+D.fumble:E,O=F(D.dollar)?"$"+D.dollar:E,N=c("Format").$modifier(D.modify_number),Y=F(D.question_target)?"?":D.target_number,M.valueOf()){case"after_command":return[D.prefix_number,D.command,D.suffix_number,ie,$e,O,N,D.cmp_op,Y].$join();case"after_modify_number":return[D.prefix_number,D.command,D.suffix_number,N,ie,$e,O,D.cmp_op,Y].$join();case"after_target_number":return[D.prefix_number,D.command,D.suffix_number,N,D.cmp_op,Y,ie,$e,O].$join();default:return E}},-1)},Opal.modules["bcdice/command/parser"]=function(u){var M,O,l,h,r,m,i,U,ae,K,_e,ee,ce,s,f,t,J,Y,B,ie,te=u.klass,x=u.module,_=u.slice,j=u.extract_kwargs,F=u.ensure_kwargs,ne=u.get_kwarg,E=u.send2,C=u.find_super,d=u.def,R=u.send,T=u.eqeq,re=u.thrower,X=u.hash,y=u.const_set,p=u.truthy,I=u.to_ary,Q=u.hash2,L=u.top,a=[],o=u.$r(a),c=u.nil,g=u.$$$;return L.$require("racc/parser.rb"),L.$require("bcdice/arithmetic/node"),L.$require("bcdice/command/lexer"),L.$require("bcdice/command/parsed"),te(g(o("BCDice"),"Command"),g(o("Racc"),"Parser"),"Parser"),M=a,O=ie=[x(a[0],"BCDice")].concat(M),Y=[x(ie[0],"Command")].concat(O),B=u.$r(Y),l=Y,f=[s=te(Y[0],g(B("Racc"),"Parser"),"Parser")].concat(l),t=u.$r(f),(J=s.$$prototype).notations=J.lexer=J.modifier=J.suffix_number=J.prefix_number=J.need_suffix_number=J.need_prefix_number=J.critical=J.fumble=J.dollar=J.allowed_cmp_op=J.question_target=c,d(s,"$initialize",function v(n,k){var w,$,P,G,q=this;return v.$$p=null,w=_(arguments),$=j(w),$=F($),P=w,G=ne($,"round_type"),E(q,C(q,"initialize",v,!1,!0),"initialize",[],null),q.notations=P,q.round_type=G,q.prefix_number=!1,q.suffix_number=!1,q.need_prefix_number=!1,q.need_suffix_number=!1,q.modifier=!0,q.critical=!1,q.fumble=!1,q.dollar=!1,q.allowed_cmp_op=[c,">=",">","<=","<","==","!="],q.question_target=!1},-2),d(s,"$disable_modifier",function(){return this.modifier=!1,this}),d(s,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),d(s,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),d(s,"$has_prefix_number",function(){var n=this;return n.prefix_number=!0,n.need_prefix_number=!0,n}),d(s,"$has_suffix_number",function(){var n=this;return n.suffix_number=!0,n.need_suffix_number=!0,n}),d(s,"$enable_critical",function(){return this.critical=!0,this}),d(s,"$enable_fumble",function(){return this.fumble=!0,this}),d(s,"$enable_dollar",function(){return this.dollar=!0,this}),d(s,"$restrict_cmp_op_to",function(n){var k;return k=_(arguments),this.allowed_cmp_op=k,this},-1),d(s,"$enable_question_target",function(){return this.question_target=!0,this}),d(s,"$parse",function(n){var k=this;try{return k.lexer=t("Lexer").$new(n,k.notations),k.$do_parse()}catch(w){if(!u.rescue(w,[t("ParseError"),t("ZeroDivisionError")]))throw w;try{return c}finally{u.pop_exception()}}}),s.$private(),d(s,"$parsed",function(n,k,w,$){try{return re("eval_return"),R(t("Parsed").$new(),"tap",[],function z(q){var ue,oe,de,ve,he,fe,me,le=null==z.$$s?this:z.$$s;return null==le.round_type&&(le.round_type=c),null==q&&(q=c),q["$command="](n["$[]"]("command")),q["$prefix_number="]((ue=n["$[]"]("prefix"))===c||null==ue?c:ue.$eval(le.round_type)),q["$suffix_number="]((oe=n["$[]"]("suffix"))===c||null==oe?c:oe.$eval(le.round_type)),q["$critical="]((de=k["$[]"]("critical"))===c||null==de?c:de.$eval(le.round_type)),q["$fumble="]((ve=k["$[]"]("fumble"))===c||null==ve?c:ve.$eval(le.round_type)),q["$dollar="]((he=k["$[]"]("dollar"))===c||null==he?c:he.$eval(le.round_type)),q["$modify_number="](w.$eval(le.round_type)),q["$cmp_op="]($["$[]"]("cmp_op")),T($["$[]"]("target"),"?")?(q["$question_target="](!0),R(q,"target_number=",fe=[0]),fe[fe.length-1]):(q["$question_target="](!1),fe=[(me=$["$[]"]("target"),me===c||null==me?c:me.$eval(le.round_type))],R(q,"target_number=",fe),fe[fe.length-1])},{$$s:this})}catch(z){if(z===u.t_eval_return)return z.$v;throw z}}),d(s,"$next_token",function(){return this.lexer.$next_token()}),h=u.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),r=u.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),m=u.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),i=u.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),U=u.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),ae=u.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),K=[c,6,13,3,9,-1,27,-15,-10,-1,-38],_e=[c,c,c,c,c,c,19,16,15,c,c],ee=u.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ce=X(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),y(f[0],"Racc_arg",[h,r,i,m,U,ae,_e,K,19,ee,ce,58,35,!0]),p(t("Ractor","skip_raise")?"constant":c)&&t("Ractor").$make_shareable(t("Racc_arg")),y(f[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),p(t("Ractor","skip_raise")?"constant":c)&&t("Ractor").$make_shareable(t("Racc_token_to_s_table")),y(f[0],"Racc_debug_parser",!1),d(s,"$_reduce_1",function(n,k,w){var $,G=this;return p(G.modifier)||G.$raise(t("ParseError")),$=I(n),G.$parsed(null==$[0]?c:$[0],null==$[1]?c:$[1],null==$[2]?c:$[2],null==$[3]?c:$[3])}),d(s,"$_reduce_2",function(n,k,w){var $,G=this;return p(G.modifier)||G.$raise(t("ParseError")),$=I(n),G.$parsed(null==$[0]?c:$[0],null==$[2]?c:$[2],null==$[1]?c:$[1],null==$[3]?c:$[3])}),d(s,"$_reduce_3",function(n,k,w){var $,ue;return ue=null==($=I(n))[2]?c:$[2],this.$parsed(null==$[0]?c:$[0],null==$[1]?c:$[1],g(g(t("Arithmetic"),"Node"),"Number").$new(0),ue)}),d(s,"$_reduce_4",function(n,k,w){var $=this;return p($.prefix_number)&&p($.suffix_number)||$.$raise(t("ParseError")),Q(["command","prefix","suffix"],{command:n["$[]"](1),prefix:n["$[]"](0),suffix:n["$[]"](2)})}),d(s,"$_reduce_5",function(n,k,w){var $=this;return p($.prefix_number)||$.$raise(t("ParseError")),p($.need_suffix_number)&&$.$raise(t("ParseError")),Q(["command","prefix"],{command:n["$[]"](1),prefix:n["$[]"](0)})}),d(s,"$_reduce_6",function(n,k,w){var $=this;return p($.suffix_number)||$.$raise(t("ParseError")),p($.need_prefix_number)&&$.$raise(t("ParseError")),Q(["command","suffix"],{command:n["$[]"](0),suffix:n["$[]"](1)})}),d(s,"$_reduce_7",function(n,k,w){var $=this;return(p($.need_prefix_number)||p($.need_suffix_number))&&$.$raise(t("ParseError")),Q(["command"],{command:n["$[]"](0)})}),d(s,"$_reduce_8",function(n,k,w){return Q([],{})}),d(s,"$_reduce_9",function(n,k,w){var $,ue,z=c;return z=null==($=I(n))[0]?c:$[0],ue=null==$[2]?c:$[2],p(this.critical)&&p(z["$[]"]("critical")["$nil?"]())||this.$raise(t("ParseError")),z["$[]="]("critical",ue),z}),d(s,"$_reduce_10",function(n,k,w){var $,ue,z=c;return z=null==($=I(n))[0]?c:$[0],ue=null==$[2]?c:$[2],p(this.fumble)&&p(z["$[]"]("fumble")["$nil?"]())||this.$raise(t("ParseError")),z["$[]="]("fumble",ue),z}),d(s,"$_reduce_11",function(n,k,w){var $,ue,z=c;return z=null==($=I(n))[0]?c:$[0],ue=null==$[2]?c:$[2],p(this.dollar)&&p(z["$[]"]("dollar")["$nil?"]())||this.$raise(t("ParseError")),z["$[]="]("dollar",ue),z}),d(s,"$_reduce_12",function(n,k,w){return n["$[]"](1)}),d(s,"$_reduce_13",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"Negative").$new(n["$[]"](1))}),d(s,"$_reduce_14",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"BinaryOp").$new(n["$[]"](0),"+",n["$[]"](2))}),d(s,"$_reduce_15",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"BinaryOp").$new(n["$[]"](0),"-",n["$[]"](2))}),d(s,"$_reduce_16",function(n,k,w){return p(this.allowed_cmp_op["$include?"](c))||this.$raise(t("ParseError")),Q([],{})}),d(s,"$_reduce_17",function(n,k,w){var $,z,q;return q=null==($=I(n))[1]?c:$[1],p(this.allowed_cmp_op["$include?"](z=null==$[0]?c:$[0]))||this.$raise(t("ParseError")),Q(["cmp_op","target"],{cmp_op:z,target:q})}),d(s,"$_reduce_18",function(n,k,w){var P,$=this;return P=n["$[]"](0),p($.question_target)||$.$raise(t("ParseError")),p($.allowed_cmp_op["$include?"](P))||$.$raise(t("ParseError")),Q(["cmp_op","target"],{cmp_op:P,target:"?"})}),d(s,"$_reduce_19",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"BinaryOp").$new(n["$[]"](0),"+",n["$[]"](2))}),d(s,"$_reduce_20",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"BinaryOp").$new(n["$[]"](0),"-",n["$[]"](2))}),d(s,"$_reduce_22",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"BinaryOp").$new(n["$[]"](0),"*",n["$[]"](2))}),d(s,"$_reduce_23",function(n,k,w){return n["$[]"](3).$new(n["$[]"](0),n["$[]"](2))}),d(s,"$_reduce_25",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),d(s,"$_reduce_26",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"DivideWithCeil")}),d(s,"$_reduce_27",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"DivideWithCeil")}),d(s,"$_reduce_28",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"DivideWithRound")}),d(s,"$_reduce_29",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"DivideWithFloor")}),d(s,"$_reduce_30",function(n,k,w){return n["$[]"](1)}),d(s,"$_reduce_31",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"Negative").$new(n["$[]"](1))}),d(s,"$_reduce_33",function(n,k,w){return n["$[]"](1)}),d(s,"$_reduce_34",function(n,k,w){return g(g(t("Arithmetic"),"Node"),"Number").$new(n["$[]"](0))}),d(s,"$_reduce_none",function(n,k,w){return n["$[]"](0)})},Opal.queue(function(u){var L,g,O,N,Y,B,W,M,D,o,te=u.module,x=u.klass,_=u.const_set,j=u.eqeqeq,F=u.def,ne=u.hash2,E=u.truthy,C=u.rb_gt,d=u.rb_divide,R=u.eqeq,T=u.rb_plus,re=u.rb_times,y=[],p=u.nil,I=u.$$$;return u.top.$require("bcdice/command/parser"),L=y,g=o=[te(y[0],"BCDice")].concat(L),M=[te(o[0],"GameSystem")].concat(g),D=u.$r(M),O=M,Y=[N=x(M[0],D("Base"),"Siren")].concat(O),B=u.$r(Y),(W=N.$$prototype).round_type=W.randomizer=p,_(Y[0],"ID","Siren"),_(Y[0],"NAME","\u7d42\u672b\u30a2\u30a4\u30c9\u30eb\u80b2\u6210TRPG \u30bb\u30a4\u30ec\u30fc\u30f3"),_(Y[0],"SORT_KEY","\u305b\u3044\u308c\u3048\u3093"),_(Y[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a: SL+a<=b\xb1c\n  a=\u9054\u6210\u5024\u3078\u306e\u4fee\u6b63(0\u306e\u5834\u5408\u306f\u7701\u7565)\n  b=\u80fd\u529b\u5024\n  c=\u5224\u5b9a\u3078\u306e\u4fee\u6b63(0\u306e\u5834\u5408\u306f\u7701\u7565\u3001\u8907\u6570\u53ef)\n\u4f8b)\u5224\u5b9a\u4fee\u6b63-10\u306e\u88c5\u5099\u3092\u88c5\u7740\u3057\u306a\u304c\u3089\u3010\u6280\u8853\uff1a60\u3011\u3008\u5175\u5668\uff1a2\u3009\u3067\u5224\u5b9a\u3059\u308b\u5834\u5408\u3002\nSL+2<=60+40-10\n\n\u30fb\u80b2\u6210: TR$a<=b\n  a=\u80b2\u6210\u3057\u305f\u56de\u6570\n  b=\u30d8\u30eb\u30b9\n\u4f8b\uff09\u30d8\u30eb\u30b9\u306e\u73fe\u5728\u5024\u304c60\u30672\u56de\u76ee\u306e\u3010\u8eab\u4f53\u3011\u306e\u80b2\u6210\u3092\u884c\u3046\u5834\u5408\u3002\nTR$2<=60\n"),F(N,"$eval_game_system_specific_command",function(l){var b;return j(/^SL/,b=l)?this.$check_action(l):j(/^TR/,b)?this.$check_training(l):p}),F(N,"$check_action",function(l){var A=p,f=p,t=p,h=p,r=p,m=p;return A=I(B("Command"),"Parser").$new("SL",ne(["round_type"],{round_type:this.round_type})).$restrict_cmp_op_to("<=").$parse(l),E(A["$nil?"]())?p:(f=A.$target_number(),t=this.randomizer.$roll_once(100),E(C(t,f))?B("Result").$failure("(1D100<="+f+") \uff1e "+t+" \uff1e \u5931\u6557"):(h=d(t,10).$floor(),r=t["$%"](10),R(h,0)&&(h=10),R(r,0)&&(r=10),m=T(T(h,r),A.$modify_number()),B("Result").$success("(1D100<="+f+") \uff1e "+t+" \uff1e \u6210\u529f(\u9054\u6210\u5024\uff1a"+m+")")))}),F(N,"$check_training",function(l){var A=p,f=p,t=p,h=p,r=p,m=p,i=p;return A=I(B("Command"),"Parser").$new("TR",ne(["round_type"],{round_type:this.round_type})).$restrict_cmp_op_to("<=").$enable_dollar().$disable_modifier().$parse(l),E(A["$nil?"]())||(f=A.$dollar(),E(f["$nil?"]()))?p:(t=A.$target_number(),h=this.randomizer.$roll_once(100),r=d(h,10).$floor(),m=h["$%"](10),R(r,0)&&(r=10),R(m,0)&&(m=10),i=T(r,m),E(C(h,t))?B("Result").$failure("(1D100<="+t+") \uff1e "+h+" \uff1e \u5931\u6557(\u80fd\u529b\u5024\u6e1b\u5c11\uff1a10 / \u30d8\u30eb\u30b9\u6e1b\u5c11\uff1a"+i+")"):B("Result").$success("(1D100<="+t+") \uff1e "+h+" \uff1e \u6210\u529f(\u80fd\u529b\u5024\u4e0a\u6607\uff1a"+T(re(f,5),i)+" / \u30d8\u30eb\u30b9\u6e1b\u5c11\uff1a"+i+")"))}),N.$register_prefix("SL","TR")})}}]);