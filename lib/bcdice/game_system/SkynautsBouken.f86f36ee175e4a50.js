(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[6841],{8780:(ge,pe,he)=>{he(5151),Opal.modules["i18n/backend/fallbacks"]=function(e){var Y,a,i,l,c,$,H=e.module,F=e.class_variable_set,o=e.truthy,B=e.class_variable_get,D=e.def,S=e.send,j=e.send2,T=e.find_super,R=e.hash2,A=e.find_block_super,U=e.neqeq,G=e.thrower,N=e.return_val,M=[],P=e.nil,g=e.$$$;return Y=M,$=[c=H(M[0],"I18n")].concat(Y),F($[0],"@@fallbacks",P),a=e.get_singleton_class(c),i=[a].concat($),l=e.$r(i),D(a,"$fallbacks",function(){var w=P;return F(i[1],"@@fallbacks",o(null!=i[1].$$cvars["@@fallbacks"]?"class variable":P)&&o(w=B(i[1],"@@fallbacks",!1))?w:g(g(l("I18n"),"Locale"),"Fallbacks").$new()),o(w=l("Thread").$current()["$[]"]("i18n_fallbacks"))?w:B(i[1],"@@fallbacks",!1)}),D(a,"$fallbacks=",function(z){var w;return F(i[1],"@@fallbacks",o(z["$is_a?"](l("Array")))?g(g(l("I18n"),"Locale"),"Fallbacks").$new(z):z),w=["i18n_fallbacks",B(i[1],"@@fallbacks",!1)],S(l("Thread").$current(),"[]=",w),w[w.length-1]}),function(a,E){var z,w,I,x,l=[H(a,"Backend")].concat(E);return z=l,I=[w=H(l[0],"Fallbacks")].concat(z),x=e.$r(I),D(w,"$translate",function k(m,h,_){try{var f=G("return"),u=k.$$p||P,y=this,L=P,v=P;return k.$$p=null,null==_&&(_=x("EMPTY_HASH")),o(_.$fetch("fallback",!0))?o(_["$[]"]("fallback_in_progress"))?j(y,T(y,"translate",k,!1,!0),"translate",[m,h,_],u):(o(_["$[]"]("default"))&&(L=y["$extract_non_symbol_default!"](_)),v=_.$merge(R(["fallback_in_progress"],{fallback_in_progress:!0})),S(x("I18n").$fallbacks()["$[]"](m),"each",[],function r(d){var t=null==r.$$s?this:r.$$s;null==d&&(d=P);try{return S(t,"catch",["exception"],function s(){var n=null==s.$$s?this:s.$$s,C=P;if(C=j(n,A(n,"translate",s.$$def||r.$$def||k,!1,!1),"translate",[d,h,v],null),o(C["$nil?"]()))return P;U(m.$to_s(),d.$to_s())&&n.$on_fallback(m,d,h,_),f.$throw(C)},{$$s:t,$$ret:f})}catch(s){if(!e.rescue(s,[g(x("I18n"),"InvalidLocale")]))throw s;try{return P}finally{e.pop_exception()}}},{$$s:y}),o(_["$key?"]("default"))&&o(_["$[]"]("default")["$nil?"]())?P:o(L)?j(y,T(y,"translate",k,!1,!0),"translate",[m,P,_.$merge(R(["default"],{default:L}))],null):y.$throw("exception",g(x("I18n"),"MissingTranslation").$new(m,h,_))):j(y,T(y,"translate",k,!1,!0),"translate",[m,h,_],u)}catch(r){if(r===f)return r.$v;throw r}},-3),D(w,"$extract_non_symbol_default!",function(m){var _,h=P;return h=[m["$[]"]("default")].$flatten(),_=S(h,"detect",[],function(u){return null==u&&(u=P),u["$is_a?"](x("Symbol"))["$!"]()}),o(_)&&m["$[]="]("default",h["$[]"](0,h.$index(_))),_}),D(w,"$exists?",function k(m,h,_){try{var f=G("return"),u=k.$$p||P,y=this;return k.$$p=null,null==_&&(_=x("EMPTY_HASH")),o(_.$fetch("fallback",!0))?(S(x("I18n").$fallbacks()["$[]"](m),"each",[],function L(v){var r=null==L.$$s?this:L.$$s;null==v&&(v=P);try{if(!o(j(r,A(r,"exists?",L.$$def||k,!1,!1),"exists?",[v,h],null)))return P;f.$throw(!0)}catch(d){if(!e.rescue(d,[g(x("I18n"),"InvalidLocale")]))throw d;try{return P}finally{e.pop_exception()}}},{$$s:y,$$ret:f}),!1):j(y,T(y,"exists?",k,!1,!0),"exists?",[m,h,_],u)}catch(L){if(L===f)return L.$v;throw L}},-3),w.$private(),D(w,"$on_fallback",N(P))}($[0],$)},Opal.modules["bcdice/randomizer"]=function(e){var c,b,z,w,I,x,a,E,F=e.klass,o=e.const_set,B=e.def,D=e.truthy,S=e.rb_gt,j=e.rb_plus,T=e.rb_le,R=e.send,A=e.rb_minus,U=e.eqeq,G=e.rb_times,N=e.eqeqeq,M=e.rb_ge,P=[],g=e.nil,K=e.$$$;return c=P,a=[(0,e.module)(P[0],"BCDice")].concat(c),E=e.$r(a),b=a,w=[z=F(a[0],null,"Randomizer")].concat(b),I=e.$r(w),(x=z.$$prototype).rand_results=x.detailed_rand_results=g,o(w[0],"UPPER_LIMIT_DICE_TIMES",200),o(w[0],"UPPER_LIMIT_DICE_SIDES",1e4),o(w[0],"UPPER_LIMIT_RANDS",1e4),B(z,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),z.$attr_reader("rand_results"),z.$attr_reader("detailed_rand_results"),o(w[0],"DetailedRandResult",I("Struct").$new("kind","sides","value")),B(z,"$roll_barabara",function(m,h){var _=this;return D(S(j(_.rand_results.$size(),m),I("UPPER_LIMIT_RANDS")))&&_.$raise(I("TooManyRandsError")),D(T(m,0))||D(S(m,I("UPPER_LIMIT_DICE_TIMES")))?[]:R(I("Array"),"new",[m],function f(){return(null==f.$$s?this:f.$$s).$roll_once(h)},{$$s:_})}),B(z,"$roll_sum",function(m,h){return this.$roll_barabara(m,h).$sum()}),B(z,"$roll_once",function(m){var _=g;return D(T(m,0))||D(S(m,I("UPPER_LIMIT_DICE_SIDES")))?0:(_=this.$rand_inner(m),this.$push_to_detail("normal",m,_),_)}),B(z,"$roll_index",function(m){return A(this.$roll_once(m),1)}),B(z,"$roll_tens_d10",function(){var _,h=g;return h=this.$rand_inner(10),U(h,10)&&(h=0),_=G(h,10),this.$push_to_detail("tens_d10",10,_),_}),B(z,"$roll_d9",function(){var h;return h=A(this.$rand_inner(10),1),this.$push_to_detail("d9",10,h),h}),B(z,"$roll_d66",function(m){var f,_=g;return _=R(I("Array"),"new",[2],function u(){return(null==u.$$s?this:u.$$s).$roll_once(6)},{$$s:this}),N(K(I("D66SortType"),"ASC"),f=m)?_["$sort!"]():N(K(I("D66SortType"),"DESC"),f)&&_["$sort!"]()["$reverse!"](),j(G(_["$[]"](0),10),_["$[]"](1))}),z.$private(),B(z,"$rand_inner",function(m){var _,h=this;return D(M(h.rand_results.$size(),I("UPPER_LIMIT_RANDS")))&&h.$raise(I("TooManyRandsError")),_=h.$random(m),h.rand_results["$<<"]([_,m]),_}),B(z,"$random",function(m){return j(I("Kernel").$rand(m),1)}),B(z,"$push_to_detail",function(m,h,_){var u;return u=I("DetailedRandResult").$new(m,h,_),this.detailed_rand_results.$push(u)}),F(a[0],E("StandardError"),"TooManyRandsError"),g},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var R,N,Y,c,$,a,E,P,U,H=e.module,F=e.klass,o=e.def,B=e.truthy,D=e.return_val,S=[],j=e.nil;return R=S,N=U=[H(S[0],"BCDice")].concat(R),Y=P=[H(U[0],"DiceTable")].concat(N),$=[c=F(P[0],null,"RollResult")].concat(Y),a=e.$r($),(E=c.$$prototype).table_name=E.value=E.body=j,o(c,"$initialize",function(l,b,z){var w=this;return w.table_name=l,w.value=b,w.body=z}),c.$attr_reader("table_name"),c.$attr_reader("value"),c.$attr_reader("body"),o(c,"$to_s",function(){var l=this;return l.table_name+"("+l.value+") \uff1e "+l.body}),o(c,"$last_body",function(){var l=this;return B(l.body["$is_a?"](a("RollResult")))?l.body.$last_body():l.body}),o(c,"$empty?",D(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var R,N,Y,c,$,a,E,P,U,H=e.module,F=e.klass,o=e.truthy,B=e.def,D=e.rb_minus,S=[],j=e.nil;return R=S,N=U=[H(S[0],"BCDice")].concat(R),Y=P=[H(U[0],"DiceTable")].concat(N),$=[c=F(P[0],null,"ChainTable")].concat(Y),a=e.$r($),(E=c.$$prototype).times=E.sides=E.items=E.name=j,B(c,"$initialize",function(l,b,z){var w=this,I=j;return w.name=l,w.items=z.$freeze(),I=/(\d+)D(\d+)/i.$match(b),o(I)||w.$raise(a("ArgumentError"),"Unexpected table type: "+b),w.times=I["$[]"](1).$to_i(),w.sides=I["$[]"](2).$to_i()}),B(c,"$roll",function(l){var z,w,b=this,I=j;return z=l.$roll_sum(b.times,b.sides),w=D(z,b.times),I=b.items["$[]"](w),o(I["$respond_to?"]("roll"))&&(I=I.$roll(l)),a("RollResult").$new(b.name,z,I)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var G,g,a,E,i,l,b,Y,M,H=e.module,F=e.klass,o=e.hash2,B=e.defs,D=e.def,S=e.rb_plus,j=e.rb_times,T=e.rb_minus,R=[],A=e.nil;return G=R,g=M=[H(R[0],"BCDice")].concat(G),a=Y=[H(M[0],"DiceTable")].concat(g),i=[E=F(Y[0],null,"D66GridTable")].concat(a),l=e.$r(i),(b=E.$$prototype).name=b.items=A,B(E,"$from_i18n",function(w,I){var k=A;return k=l("I18n").$t(w,o(["locale","raise"],{locale:I,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items"))}),D(E,"$initialize",function(w,I){return this.name=w,this.items=I.$freeze()}),D(E,"$roll",function(w){var x,k,m,h,_;return x=w.$roll_once(6),k=w.$roll_once(6),m=S(j(x,10),k),h=T(x,1),_=T(k,1),l("RollResult").$new(this.name,m,this.items["$[]"](h)["$[]"](_))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var A,M,$,a,E,i,g,K,G,H=e.module,F=e.klass,o=e.hash2,B=e.defs,D=e.def,j=[],T=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),A=j,M=G=[H(j[0],"BCDice")].concat(A),g=[H(G[0],"DiceTable")].concat(M),K=e.$r(g),$=g,E=[a=F(g[0],K("D66GridTable"),"D66HalfGridTable")].concat($),i=e.$r(E),B(a,"$from_i18n",function(b,z){var I=T;return I=i("I18n").$t(b,o(["locale","raise"],{locale:z,raise:!0})),this.$new(I["$[]"]("name"),I["$[]"]("items_1_2_3"),I["$[]"]("items_4_5_6"))}),D(a,"$initialize",function(b,z,w){return this.name=b,this.items=[z,z,z,w,w,w].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var A,M,$,a,E,i,g,K,G,H=e.module,F=e.klass,o=e.hash2,B=e.defs,D=e.def,j=[],T=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),A=j,M=G=[H(j[0],"BCDice")].concat(A),g=[H(G[0],"DiceTable")].concat(M),K=e.$r(g),$=g,E=[a=F(g[0],K("D66GridTable"),"D66OneThirdTable")].concat($),i=e.$r(E),B(a,"$from_i18n",function(b,z){var I=T;return I=i("I18n").$t(b,o(["locale","raise"],{locale:z,raise:!0})),this.$new(I["$[]"]("name"),I["$[]"]("items_1_2"),I["$[]"]("items_3_4"),I["$[]"]("items_5_6"))}),D(a,"$initialize",function(b,z,w,I){return this.name=b,this.items=[z,z,w,w,I,I].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var M,Y,i,l,b,z,w,$,g,H=e.module,F=e.klass,o=e.hash2,B=e.defs,D=e.def,S=e.eqeqeq,j=e.rb_plus,T=e.rb_times,R=e.truthy,A=[],U=e.nil,G=e.$$$;return M=A,Y=g=[H(A[0],"BCDice")].concat(M),i=$=[H(g[0],"DiceTable")].concat(Y),b=[l=F($[0],null,"D66Table")].concat(i),z=e.$r(b),(w=l.$$prototype).sort_type=w.items=w.name=U,B(l,"$from_i18n",function(x,k){var _,h=U;return h=z("I18n").$t(x,o(["locale"],{locale:k})),_=z("D66SortType").$const_get(h["$[]"]("d66_sort_type")),this.$new(h["$[]"]("name"),_,h["$[]"]("items"))}),D(l,"$initialize",function(x,k,m){var h=this;return h.name=x,h.sort_type=k,h.items=m.$freeze()}),D(l,"$roll",function(x){var k=this,m=U,h=U,_=U,f=U;return m=x.$roll_barabara(2,6),S(G(z("D66SortType"),"ASC"),h=k.sort_type)?m["$sort!"]():S(G(z("D66SortType"),"DESC"),h)&&m["$sort!"]()["$reverse!"](),_=j(T(m["$[]"](0),10),m["$[]"](1)),f=R(h=k.items["$[]"](_))?h:k.items["$[]"](_.$to_s()),R(f["$respond_to?"]("roll"))&&(f=f.$roll(x)),z("RollResult").$new(k.name,_,f)}),D(l,"$choice",function(x){return z("RollResult").$new(this.name,x,this.items["$[]"](x))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var P,c,a,E,K,H=e.module,F=e.klass,o=e.hash2,B=e.send,D=e.to_ary,S=e.rb_plus,j=e.rb_times,T=e.send2,R=e.find_super,A=e.def,G=[],N=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),P=G,c=K=[H(G[0],"BCDice")].concat(P),a=[H(K[0],"DiceTable")].concat(c),E=e.$r(a),A(F(a[0],E("D66Table"),"D66LeftRangeTable"),"$initialize",function z(w,I,x){var h;return z.$$p=null,h=o([],{}),B(x,"each",[],function(f){var u,v;return null==f&&(f=N),u=D(f),v=null==u[1]?N:u[1],B(null==u[0]?N:u[0],"each",[],function(d){return null==d&&(d=N),B(v,"each_with_index",[],function(s,n){var C,W;return null==s&&(s=N),null==n&&(n=N),W=S(j(d,10),S(n,1)),B(h,"[]=",C=[W,s]),C[C.length-1]})})}),T(this,R(this,"initialize",z,!1,!0),"initialize",[w,I,h],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var N,K,E,i,l,b,z,c,P,H=e.module,F=e.klass,o=e.hash2,B=e.defs,D=e.def,S=e.truthy,j=e.rb_minus,T=e.rb_plus,R=e.rb_times,A=[],U=e.nil;return N=A,K=P=[H(A[0],"BCDice")].concat(N),E=c=[H(P[0],"DiceTable")].concat(K),l=[i=F(c[0],null,"D66ParityTable")].concat(E),b=e.$r(l),(z=i.$$prototype).odd=z.even=z.name=U,B(i,"$from_i18n",function(I,x){var m=U;return m=b("I18n").$t(I,o(["locale","raise"],{locale:x,raise:!0})),this.$new(m["$[]"]("name"),m["$[]"]("odd"),m["$[]"]("even"))}),D(i,"$initialize",function(I,x,k){var m=this;return m.name=I,m.odd=x.$freeze(),m.even=k.$freeze()}),D(i,"$roll",function(I){var m,_,f,x=this,k=U;return k=I.$roll_once(6),m=I.$roll_once(6),_=(S(k["$odd?"]())?x.odd:x.even)["$[]"](j(m,1)),f=T(R(k,10),m),b("RollResult").$new(x.name,f,_)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var A,M,c,$,a,E,i,g,G,H=e.module,F=e.klass,o=e.def,B=e.rb_plus,D=e.rb_times,S=e.send,j=[],T=e.nil;return A=j,M=G=[H(j[0],"BCDice")].concat(A),c=g=[H(G[0],"DiceTable")].concat(M),a=[$=F(g[0],null,"D66RangeTable")].concat(c),E=e.$r(a),(i=$.$$prototype).items=i.name=T,o($,"$initialize",function(b,z){return this.name=b,this.items=z.$freeze()}),o($,"$roll",function(b){var w,I,x,k=T;return w=b.$roll_once(6),I=b.$roll_once(6),x=B(D(w,10),I),k=S(this.items,"find",[],function(h){return null==h&&(h=T),h["$[]"](0)["$include?"](x)}),E("RollResult").$new(this.name,x,k["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var P,c,l,x,m,h,b,z,w,I,a,K,H=e.module,F=e.klass,o=e.const_set,B=e.send,D=e.hash2,S=e.def,j=e.eqeqeq,T=e.truthy,R=e.to_a,A=e.rb_times,U=e.rb_plus,G=[],N=e.nil;return P=G,c=K=[H(G[0],"BCDice")].concat(P),l=a=[H(K[0],"DiceTable")].concat(c),z=[b=F(a[0],null,"RangeTable")].concat(l),w=e.$r(z),(I=b.$$prototype).name=I.items=I.num_of_dice=I.num_of_sides=I.formatter=N,o(z[0],"RollResult",B(w("Struct"),"new",["sum","values","content","formatted"],function x(){return(null==x.$$s?this:x.$$s).$alias_method("to_s","formatted")},{$$s:b})),o(z[0],"Item",w("Struct").$new("range","content")),o(z[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),o(z[0],"DEFAULT_FORMATTER",B(b,"lambda",[],function(k,m){return null==k&&(k=N),null==m&&(m=N),k.$name()+"("+m.$sum()+") \uff1e "+m.$content()})),b.$attr_reader("name"),b.$attr_reader("num_of_dice"),b.$attr_reader("num_of_sides"),m=[x=e.get_singleton_class(b)].concat(z),h=e.$r(m),S(x,"$from_i18n",function(f,u){var v,L=N;return L=h("I18n").$t(f,D(["locale"],{locale:u})),v=B(L["$[]"]("items"),"map",[],function r(d){return null==d&&(d=N),[(null==r.$$s?this:r.$$s).$conv_string_range(d["$[]"](0)),d["$[]"](1)]},{$$s:this}),this.$new(L["$[]"]("name"),L["$[]"]("type"),v)}),S(x,"$conv_string_range",function(f){var y,u=this;return null==u.name&&(u.name=N),j(h("Integer"),y=f)?f:j(h("String"),y)?T(f["$include?"](".."))?B(h("Range"),"new",R(B(f.$split("..",2),"map",[],function L(v){return null==v&&(v=N),(null==L.$$s?this:L.$$s).$Integer(v)},{$$s:u}))):u.$Integer(f):u.$raise(h("TypeError"),u.name+": "+f+" ("+f.$class()+") must be a String or an Integer")}),S(b,"$initialize",function x(k,m,h){var u,_=x.$$p||N,f=this,y=N;return x.$$p=null,f.name=k.$freeze(),f.formatter=T(u=_)?u:w("DEFAULT_FORMATTER"),y=w("DICE_ROLL_METHOD_RE").$match(m),T(y)||f.$raise(w("ArgumentError"),f.name+": invalid dice roll method: "+m),f.num_of_dice=y["$[]"](1).$to_i(),f.num_of_sides=y["$[]"](2).$to_i(),f.$store(h)}),S(b,"$fetch",function(k){var h,m=this;return h=B(m.items,"find",[],function(f){return null==f&&(f=N),f.$range()["$include?"](k)}),T(h)||m.$raise(w("RangeError"),m.name+": value is out of range: "+k),h}),S(b,"$roll",function(k){var _,m=this,h=N,f=N;return _=(h=k.$roll_barabara(m.num_of_dice,m.num_of_sides)).$sum(),(f=w("RollResult").$new(_,h,m.$fetch(_).$content()))["$formatted="](m.formatter["$[]"](m,f)),f}),b.$private(),S(b,"$store",function(k){var h,_,m=this;return h=B(k,"map",[],function f(u,y){return null==u&&(u=N),null==y&&(y=N),[(null==f.$$s?this:f.$$s).$coerce_to_int_range(u),y]},{$$s:m}),_=B(h,"sort_by",[],function(u,y){return null==u&&(u=N),null==y&&(y=N),u.$min()}),m.$assert_min_sum_is_covered(_),m.$assert_max_sum_is_covered(_),m.$assert_no_gap_or_overlap_in_ranges(_),m.items=B(_,"map",[],function(u,y){return null==u&&(u=N),null==y&&(y=N),w("Item").$new(u,y.$freeze()).$freeze()}).$freeze(),m}),S(b,"$coerce_to_int_range",function(k){var h;return j(w("Integer"),h=k)?w("Range").$new(k,k):j(w("Range"),h)&&T(k.$begin()["$is_a?"](w("Integer")))&&T(k.$end()["$is_a?"](w("Integer")))?k:this.$raise(w("TypeError"),this.name+": "+k+" ("+k.$class()+") must be an Integer or a Range with Integers ")}),S(b,"$assert_min_sum_is_covered",function(k){var h,m=this,_=N;return h=m.num_of_dice,_=k.$first()["$[]"](0),T(_["$include?"](h))||m.$raise(w("RangeError"),m.name+": min value ("+h+") is not covered: "+_),m}),S(b,"$assert_max_sum_is_covered",function(k){var h,m=this,_=N;return h=A(m.num_of_dice,m.num_of_sides),_=k.$last()["$[]"](0),T(_["$include?"](h))||m.$raise(w("RangeError"),m.name+": max value ("+h+") is not covered: "+_),m}),S(b,"$assert_no_gap_or_overlap_in_ranges",function(k){return B(k,"each_cons",[2],function h(_,f){var v,r,u=null==h.$$s?this:h.$$s,y=N,L=N;return null==u.name&&(u.name=N),null==_&&(_=N),null==f&&(f=N),y=_["$[]"](0),L=f["$[]"](0),v=y.$max(),r=U(v,1),T(L["$include?"](v))&&u.$raise(w("RangeError"),u.name+": Range overlap: "+y+" and "+L),T(L["$include?"](r))?N:u.$raise(w("RangeError"),u.name+": Range gap: "+y+" and "+L)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var U,P,$,b,z,w,I,E,K,N,H=e.module,F=e.klass,o=e.send,B=e.def,D=e.rb_minus,S=e.return_ivar,j=[],T=e.nil,R=e.$$$;return U=j,P=N=[H(j[0],"BCDice")].concat(U),$=K=[H(N[0],"DiceTable")].concat(P),b=E=[F(K[0],null,"SaiFicSkillTable")].concat($),w=[z=F(E[0],null,"Category")].concat(b),I=e.$r(w),B(z,"$initialize",function(k,m,h,_){var f=this;return f.name=k,f.skills=o(m.$map(),"with_index",[2],function(y,L){return null==y&&(y=T),null==L&&(L=T),R(I("SaiFicSkillTable"),"Skill").$new(k,y,h,L,_)}),f.dice=h}),B(z,"$roll",function(k){return this.$skills()["$[]"](D(k.$roll_sum(2,6),2))}),B(z,"$to_s",S("name")),z.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var T,G,K,E,i,c,M,A,H=e.module,F=e.klass,o=e.def,B=e.hash2,D=[],S=e.nil;return T=D,G=A=[H(D[0],"BCDice")].concat(T),K=M=[H(A[0],"DiceTable")].concat(G),c=[F(M[0],null,"SaiFicSkillTable")].concat(K),(i=(E=F(c[0],null,"Skill")).$$prototype).s_format=i.category_dice=i.row_dice=i.category_name=i.name=S,o(E,"$initialize",function(b,z,w,I,x){var k=this;return k.category_name=b,k.name=z,k.category_dice=w,k.row_dice=I,k.s_format=x}),o(E,"$to_s",function(){var b=this;return b.$format(b.s_format,B(["category_dice","row_dice","category_name","skill_name"],{category_dice:b.category_dice,row_dice:b.row_dice,category_name:b.category_name,skill_name:b.name}))}),E.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var c,i,I,x,k,m,h,b,a,H=e.module,F=e.klass,o=e.ensure_kwargs,B=e.hash2,D=e.send,j=e.defs,T=e.const_set,R=e.to_ary,A=e.def,U=e.truthy,G=e.rb_minus,N=e.rb_plus,M=e.top,P=[],g=e.nil,K=e.$$$;return M.$require("bcdice/dice_table/sai_fic_skill_table/category"),M.$require("bcdice/dice_table/sai_fic_skill_table/skill"),c=P,i=a=[H(P[0],"BCDice")].concat(c),I=b=[H(a[0],"DiceTable")].concat(i),k=[x=F(b[0],null,"SaiFicSkillTable")].concat(I),m=e.$r(k),(h=x.$$prototype).rtt=h.rtt_format=h.rct=h.rct_format=h.rttn=h.rttn_format=h.categories=g,j(x,"$from_i18n",function(f,u,y){var L,v,r,n,s=g;return null==(L=(y=o(y)).$$smap.rtt)&&(L=g),null==(v=y.$$smap.rct)&&(v=g),null==(r=y.$$smap.rttn)&&(r=g),n=(s=m("I18n").$t("RTT",B(["locale","raise","default"],{locale:u,raise:!1,default:B([],{})})).$merge(m("I18n").$t(f,B(["locale","raise"],{locale:u,raise:!0}))))["$[]"]("items"),s=D(s,"select",[],function(W,V){return null==W&&(W=g),null==V&&(V=g),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](W)}),this.$new(n,e.to_hash(s).$merge(B(["rtt","rct","rttn"],{rtt:L,rct:v,rttn:r})))},-3),T(k[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),T(k[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),T(k[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),T(k[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),A(x,"$initialize",function(f,u){var y,L,v,r,d,t,s,n=this;return null==(y=(u=o(u)).$$smap.rtt)&&(y=g),null==(L=u.$$smap.rct)&&(L=g),null==(v=u.$$smap.rttn)&&(v=g),null==(r=u.$$smap.rtt_format)&&(r=m("DEFAULT_RTT")),null==(d=u.$$smap.rct_format)&&(d=m("DEFAULT_RCT")),null==(t=u.$$smap.rttn_format)&&(t=m("DEFAULT_RTTN")),null==(s=u.$$smap.s_format)&&(s=m("DEFAULT_S")),n.categories=D(f.$map(),"with_index",[1],function(W,V){var ee,te,ne;return null==W&&(W=g),null==V&&(V=g),te=null==(ee=R(W))[0]?g:ee[0],ne=null==ee[1]?g:ee[1],K(m("SaiFicSkillTable"),"Category").$new(te,ne,V,s)},{$$has_top_level_mlhs_arg:!0}),n.rtt=y,n.rct=L,n.rttn=v.$to_a(),n.rtt_format=r,n.rct_format=d,n.rttn_format=t},-2),T(k[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),x.$attr_reader("categories"),A(x,"$roll_command",function(f,u){var L,y=this,v=g,r=g;return U(["RTT",y.rtt]["$include?"](L=u))?y.$format_skill(y.rtt_format,y.$roll_skill(f)):U(["RCT",y.rct]["$include?"](L))?(v=y.$roll_category(f),y.$format(y.rct_format,B(["category_dice","category_name"],{category_dice:v.$dice(),category_name:v.$name()}))):U(r=m("RTTN").$index(L))||U(r=y.rttn.$index(L))?y.$format_skill(y.rttn_format,y.categories["$[]"](r).$roll(f)):g}),A(x,"$roll_category",function(f){return this.categories["$[]"](G(f.$roll_once(6),1))}),A(x,"$roll_skill",function(f){return this.$roll_category(f).$roll(f)}),A(x,"$prefixes",function(){var f=this;return N(["RTT[1-6]?","RCT",f.rtt,f.rct],f.rttn).$compact()}),x.$private(),A(x,"$format_skill",function(f,u){return this.$format(f,B(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:u.$category_dice(),row_dice:u.$row_dice(),category_name:u.$category_name(),skill_name:u.$name(),text:u.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var U,P,$,a,E,i,l,K,N,H=e.module,F=e.klass,o=e.hash2,B=e.defs,D=e.truthy,S=e.def,j=e.rb_minus,T=[],R=e.nil;return U=T,P=N=[H(T[0],"BCDice")].concat(U),$=K=[H(N[0],"DiceTable")].concat(P),E=[a=F(K[0],null,"Table")].concat($),i=e.$r(E),(l=a.$$prototype).times=l.sides=l.name=l.items=R,B(a,"$from_i18n",function(z,w){var x=R;return x=i("I18n").$t(z,o(["locale"],{locale:w})),this.$new(x["$[]"]("name"),x["$[]"]("type"),x["$[]"]("items"))}),S(a,"$initialize",function(z,w,I){var x=this,k=R;return x.name=z,x.items=I.$freeze(),k=/(\d+)D(\d+)/i.$match(w),D(k)||x.$raise(i("ArgumentError"),"Unexpected table type: "+w),x.times=k["$[]"](1).$to_i(),x.sides=k["$[]"](2).$to_i()}),S(a,"$roll",function(z){var I,w=this;return I=z.$roll_sum(w.times,w.sides),w.$choice(I)}),S(a,"$choice",function(z){var I,w=this;return I=j(z,w.times),i("RollResult").$new(w.name,z,w.items["$[]"](I))})},Opal.modules["bcdice/dice_table"]=function(e){var H=e.top;return H.$require("bcdice/dice_table/roll_result"),H.$require("bcdice/dice_table/chain_table"),H.$require("bcdice/dice_table/d66_grid_table"),H.$require("bcdice/dice_table/d66_half_grid_table"),H.$require("bcdice/dice_table/d66_one_third_table"),H.$require("bcdice/dice_table/d66_left_range_table"),H.$require("bcdice/dice_table/d66_parity_table"),H.$require("bcdice/dice_table/d66_range_table"),H.$require("bcdice/dice_table/d66_table"),H.$require("bcdice/dice_table/range_table"),H.$require("bcdice/dice_table/sai_fic_skill_table"),H.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var S,A,G,T,H=e.module,F=e.const_set,o=[];return S=o,A=T=[H(o[0],"BCDice")].concat(S),G=[H(T[0],"D66SortType")].concat(A),F(G[0],"NO_SORT","no_sort"),F(G[0],"ASC","asc"),F(G[0],"DESC","desc"),function(R,A){var G=[H(R,"RoundType")].concat(A);return F(G[0],"CEIL","ceil"),F(G[0],"FLOOR","floor"),F(G[0],"ROUND","round")}(T[0],T)},Opal.modules["bcdice/translate"]=function(e){var A,M,P,g,K,G,H=e.module,F=e.ensure_kwargs,o=e.kwrestargs,D=e.hash2,S=e.def,j=[],T=e.nil;return A=j,M=G=[H(j[0],"BCDice")].concat(A),g=[P=H(G[0],"Translate")].concat(M),K=e.$r(g),S(P,"$translate",function(c,$){var a,E=this;return null==E.locale&&(E.locale=T),$=F($),a=o($,{}),K("I18n").$translate(c,D(["locale","raise"],{locale:E.locale,raise:!0}).$merge(e.to_hash(a)))},-2)},Opal.modules["bcdice/result"]=function(e){var P,Y,g,A,G,F=e.klass,o=e.send,B=e.def,D=e.return_val,S=e.return_ivar,j=[],T=e.nil;return A=j,P=G=[(0,e.module)(j[0],"BCDice")].concat(A),[g=F(G[0],null,"Result")].concat(P),B(Y=e.get_singleton_class(g),"$success",function(a){return o(this.$new(),"tap",[],function(l){var b;return null==l&&(l=T),l["$text="](a),o(l,"success=",b=[!0]),b[b.length-1]})}),B(Y,"$failure",function(a){return o(this.$new(),"tap",[],function(l){var b;return null==l&&(l=T),l["$text="](a),o(l,"failure=",b=[!0]),b[b.length-1]})}),B(Y,"$critical",function(a){return o(this.$new(),"tap",[],function(l){var b;return null==l&&(l=T),l["$text="](a),l["$critical="](!0),o(l,"success=",b=[!0]),b[b.length-1]})}),B(Y,"$fumble",function(a){return o(this.$new(),"tap",[],function(l){var b;return null==l&&(l=T),l["$text="](a),l["$fumble="](!0),o(l,"failure=",b=[!0]),b[b.length-1]})}),B(Y,"$nothing",D("nothing")),B(g,"$initialize",function(c){var $=this;return null==c&&(c=T),$.text=c,$.rands=T,$.detailed_rands=T,$.secret=!1,$.success=!1,$.failure=!1,$.critical=!1,$.fumble=!1},-1),g.$attr_accessor("text","rands","detailed_rands"),g.$attr_writer("secret","success","failure","critical","fumble"),B(g,"$secret?",S("secret")),B(g,"$success?",S("success")),B(g,"$failure?",S("failure")),B(g,"$critical?",S("critical")),B(g,"$fumble?",S("fumble")),B(g,"$condition=",function(c){return this.success=c,this.failure=c["$!"]()})},Opal.modules["racc/parser"]=function(e){var z,I,x,H=e.module,F=e.klass,o=e.truthy,B=e.const_set,D=e.defs,S=e.gvars,j=e.rb_lt,T=e.def,R=e.to_ary,A=e.send,U=e.neqeq,G=e.rb_plus,N=e.eqeq,M=e.rb_ge,P=e.rb_gt,g=e.rb_minus,K=e.rb_le,Y=e.rb_times,c=e.assign_ivar_val,a=[],E=e.$r(a),i=e.nil,l=e.$$$;return z=a,I=[H(a[0],"Racc")].concat(z),x=e.$r(I),F(I[0],x("StandardError"),"ParseError"),o(l("::","ParseError","skip_raise")?"constant":i)||B(a[0],"ParseError",l(E("Racc"),"ParseError")),function(b,z){var _,f,u,y,L,x=[H(b,"Racc")].concat(z),k=e.$r(x);return o(k("Racc_No_Extensions","skip_raise")?"constant":i)||B(x[0],"Racc_No_Extensions",!1),_=x,u=[f=F(x[0],null,"Parser")].concat(_),y=e.$r(u),(L=f.$$prototype).yydebug=L.racc_debug_out=L.racc_error_status=L.racc_t=L.racc_vstack=L.racc_val=L.racc_state=L.racc_tstack=i,B(u[0],"Racc_Runtime_Version","1.4.6"),B(u[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),B(u[0],"Racc_Runtime_Core_Version_R","1.4.6"),B(u[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),B(u[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),B(u[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),B(u[0],"Racc_Runtime_Core_Version",y("Racc_Runtime_Core_Version_R")),B(u[0],"Racc_Runtime_Core_Revision",y("Racc_Runtime_Core_Revision_R")),B(u[0],"Racc_Runtime_Type","ruby"),D(y("Parser"),"$racc_runtime_type",function(){return y("Racc_Runtime_Type")}),T(f,"$_racc_setup",function(){var r,d,t=this,s=i,n=i;return null==S.stderr&&(S.stderr=i),o(l(t.$class(),"Racc_debug_parser"))||(t.yydebug=!1),o(null!=(r=t.yydebug)&&r!==i?"instance-variable":i)||(t.yydebug=!1),o(t.yydebug)&&(o(null!=(d=t.racc_debug_out)&&d!==i?"instance-variable":i)||(t.racc_debug_out=S.stderr),t.racc_debug_out=o(s=t.racc_debug_out)?s:S.stderr),n=l(t.$class(),"Racc_arg"),o(j(n.$size(),14))&&n["$[]="](13,!0),n}),T(f,"$_racc_init_sysvars",function(){var r=this;return r.racc_state=[0],r.racc_tstack=[],r.racc_vstack=[],r.racc_t=i,r.racc_val=i,r.racc_read_next=!0,r.racc_user_yyerror=!1,r.racc_error_status=0}),T(f,"$do_parse",function(){return this.$__send__(y("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),T(f,"$next_token",function(){return this.$raise(y("NotImplementedError"),this.$class()+"#next_token is not defined")}),T(f,"$_racc_do_parse_rb",function(r,d){var t,n=this,C=i,W=i,V=i,ee=i,te=i,ne=i,ue=i,se=i;return t=R(r),C=null==t[0]?i:t[0],W=null==t[1]?i:t[1],V=null==t[2]?i:t[2],ee=null==t[3]?i:t[3],te=null==t[10]?i:t[10],n.$_racc_init_sysvars(),ne=ue=se=i,A(n,"catch",["racc_end_parse"],function $e(){var ce,X,p=null==$e.$$s?this:$e.$$s,Q=i;for(null==p.racc_state&&(p.racc_state=i),null==p.racc_read_next&&(p.racc_read_next=i),null==p.racc_t&&(p.racc_t=i),null==p.yydebug&&(p.yydebug=i),null==p.racc_val&&(p.racc_val=i);o(!0);)for(o(se=ee["$[]"](p.racc_state["$[]"](-1)))?(o(p.racc_read_next)&&U(p.racc_t,0)&&(X=p.$next_token(),ce=R(X),ne=null==ce[0]?i:ce[0],p.racc_val=null==ce[1]?i:ce[1],p.racc_t=o(ne)?o(Q=te["$[]"](ne))?Q:1:0,o(p.yydebug)&&p.$racc_read_token(p.racc_t,ne,p.racc_val),p.racc_read_next=!1),se=G(se,p.racc_t),o(M(se,0))&&o(ue=C["$[]"](se))&&N(W["$[]"](se),p.racc_state["$[]"](-1))||(ue=V["$[]"](p.racc_state["$[]"](-1)))):ue=V["$[]"](p.racc_state["$[]"](-1));o(ue=p.$_racc_evalact(ue,r)););},{$$s:n})}),T(f,"$yyparse",function(r,d){return this.$__send__(y("Racc_YY_Parse_Method"),r,d,this.$_racc_setup(),!0)}),T(f,"$_racc_yyparse_rb",function(r,d,t,s){var n,W=this,V=i,ee=i,Z=i,te=i,ue=i,se=i,$e=i;return n=R(t),V=null==n[0]?i:n[0],ee=null==n[1]?i:n[1],Z=null==n[2]?i:n[2],te=null==n[3]?i:n[3],ue=null==n[10]?i:n[10],W.$_racc_init_sysvars(),se=i,$e=i,A(W,"catch",["racc_end_parse"],function ce(){var X=null==ce.$$s?this:ce.$$s;for(null==X.racc_state&&(X.racc_state=i);!o($e=te["$[]"](X.racc_state["$[]"](-1)));)for(;o(se=X.$_racc_evalact(Z["$[]"](X.racc_state["$[]"](-1)),t)););return A(r,"__send__",[d],function p(Q,J){var q=null==p.$$s?this:p.$$s,re=i,ae=i;for(null==q.racc_t&&(q.racc_t=i),null==q.racc_state&&(q.racc_state=i),null==q.racc_read_next&&(q.racc_read_next=i),null==Q&&(Q=i),null==J&&(J=i),q.racc_t=o(Q)?o(re=ue["$[]"](Q))?re:1:0,q.racc_val=J,q.racc_read_next=!1,$e=G($e,q.racc_t),o(M($e,0))&&o(se=V["$[]"]($e))&&N(ee["$[]"]($e),q.racc_state["$[]"](-1))||(se=Z["$[]"](q.racc_state["$[]"](-1)));o(se=q.$_racc_evalact(se,t)););for(;o(o(re=o(ae=($e=te["$[]"](q.racc_state["$[]"](-1)))["$!"]())?ae:q.racc_read_next["$!"]())?re:q.racc_t["$=="](0));)for(o($e)&&o($e=G($e,q.racc_t))&&o(M($e,0))&&o(se=V["$[]"]($e))&&N(ee["$[]"]($e),q.racc_state["$[]"](-1))||(se=Z["$[]"](q.racc_state["$[]"](-1)));o(se=q.$_racc_evalact(se,t)););},{$$s:X})},{$$s:W})}),T(f,"$_racc_evalact",function(r,d){var t,Z,n=this,C=i,W=i,ee=i,te=i,ne=i,ue=i;if(C=null==(t=R(d))[0]?i:t[0],W=null==t[1]?i:t[1],ee=null==t[3]?i:t[3],Z=null==t[11]?i:t[11],te=null==t[12]?i:t[12],o(P(r,0))&&o(j(r,Z)))o(P(n.racc_error_status,0))&&(N(n.racc_t,1)||(n.racc_error_status=g(n.racc_error_status,1))),n.racc_vstack.$push(n.racc_val),n.racc_state.$push(r),n.racc_read_next=!0,o(n.yydebug)&&(n.racc_tstack.$push(n.racc_t),n.$racc_shift(n.racc_t,n.racc_tstack,n.racc_vstack));else if(o(j(r,0))&&o(P(r,te["$-@"]()))){if(ne=A(n,"catch",["racc_jump"],function se(){var $e=null==se.$$s?this:se.$$s;return null==$e.racc_state&&($e.racc_state=i),$e.racc_state.$push($e.$_racc_do_reduce(d,r)),!1},{$$s:n}),o(ne))switch(ne.valueOf()){case 1:return n.racc_user_yyerror=!0,te["$-@"]();case 2:return Z;default:n.$raise("[Racc Bug] unknown jump code")}}else if(N(r,Z))o(n.yydebug)&&n.$racc_accept(),n.$throw("racc_end_parse",n.racc_vstack["$[]"](0));else{if(N(r,te["$-@"]())){switch(n.racc_error_status.valueOf()){case 0:o(d["$[]"](21))||n.$on_error(n.racc_t,n.racc_val,n.racc_vstack);break;case 3:N(n.racc_t,0)&&n.$throw("racc_end_parse",i),n.racc_read_next=!0}for(n.racc_user_yyerror=!1,n.racc_error_status=3;o(!0)&&!(o(ue=ee["$[]"](n.racc_state["$[]"](-1)))&&(ue=G(ue,1),o(M(ue,0))&&o(r=C["$[]"](ue))&&N(W["$[]"](ue),n.racc_state["$[]"](-1))));)o(K(n.racc_state.$size(),1))&&n.$throw("racc_end_parse",i),n.racc_state.$pop(),n.racc_vstack.$pop(),o(n.yydebug)&&(n.racc_tstack.$pop(),n.$racc_e_pop(n.racc_state,n.racc_tstack,n.racc_vstack));return r}n.$raise("[Racc Bug] unknown action "+r.$inspect())}return o(n.yydebug)&&n.$racc_next_state(n.racc_state["$[]"](-1),n.racc_state),i}),T(f,"$_racc_do_reduce",function(r,d){var t,te,ue,Q,J,q,ie,n=this,W=i,V=i,ee=i,Z=i,ne=i,se=i,$e=i,ce=i,X=i,p=i,re=i,ae=i,O=i;return W=null==(t=R(r))[4]?i:t[4],V=null==t[5]?i:t[5],ee=null==t[6]?i:t[6],Z=null==t[7]?i:t[7],te=null==t[8]?i:t[8],ne=null==t[9]?i:t[9],ue=null==t[13]?i:t[13],se=n.racc_state,$e=n.racc_vstack,ce=n.racc_tstack,X=Y(d,-3),p=ne["$[]"](X),Q=ne["$[]"](G(X,1)),J=ne["$[]"](G(X,2)),q=[],o(n.yydebug)&&(re=ce["$[]"](p["$-@"](),p)),ae=$e["$[]"](p["$-@"](),p),o(n.yydebug)&&ce["$[]="](p["$-@"](),p,q),$e["$[]="](p["$-@"](),p,q),se["$[]="](p["$-@"](),p,q),o(ue)?$e.$push(n.$__send__(J,ae,$e,ae["$[]"](0))):$e.$push(n.$__send__(J,ae,$e)),ce.$push(Q),o(n.yydebug)&&n.$racc_reduce(re,Q,ce,$e),ie=g(Q,te),o(X=Z["$[]"](ie))&&(X=G(X,se["$[]"](-1)),o(M(X,0))&&o(O=W["$[]"](X))&&N(V["$[]"](X),ie))?O:ee["$[]"](ie)}),T(f,"$on_error",function(r,d,t){var n,s=this;return s.$raise(y("ParseError"),s.$sprintf("\nparse error on value %s (%s)",d.$inspect(),o(n=s.$token_to_str(r))?n:"?"))}),T(f,"$yyerror",function(){return this.$throw("racc_jump",1)}),T(f,"$yyaccept",function(){return this.$throw("racc_jump",2)}),T(f,"$yyerrok",c("racc_error_status",0)),T(f,"$racc_read_token",function(r,d,t){var s=this;return s.racc_debug_out.$print("read    "),s.racc_debug_out.$print(d.$inspect(),"(",s.$racc_token2str(r),") "),s.racc_debug_out.$puts(t.$inspect()),s.racc_debug_out.$puts()}),T(f,"$racc_shift",function(r,d,t){var s=this;return s.racc_debug_out.$puts("shift   "+s.$racc_token2str(r)),s.$racc_print_stacks(d,t),s.racc_debug_out.$puts()}),T(f,"$racc_reduce",function(r,d,t,s){var n=this,C=i;return(C=n.racc_debug_out).$print("reduce "),o(r["$empty?"]())?C.$print(" <none>"):A(r,"each",[],function W(V){return null==V&&(V=i),C.$print(" ",(null==W.$$s?this:W.$$s).$racc_token2str(V))},{$$s:n}),C.$puts(" --\x3e "+n.$racc_token2str(d)),n.$racc_print_stacks(t,s),n.racc_debug_out.$puts()}),T(f,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),T(f,"$racc_e_pop",function(r,d,t){var s=this;return s.racc_debug_out.$puts("error recovering mode: pop token"),s.$racc_print_states(r),s.$racc_print_stacks(d,t),s.racc_debug_out.$puts()}),T(f,"$racc_next_state",function(r,d){var t=this;return t.racc_debug_out.$puts("goto    "+r),t.$racc_print_states(d),t.racc_debug_out.$puts()}),T(f,"$racc_print_stacks",function(r,d){var s=i;return(s=this.racc_debug_out).$print("        ["),A(r,"each_index",[],function n(C){return null==C&&(C=i),s.$print(" (",(null==n.$$s?this:n.$$s).$racc_token2str(r["$[]"](C))," ",d["$[]"](C).$inspect(),")")},{$$s:this}),s.$puts(" ]")}),T(f,"$racc_print_states",function(r){var t=i;return(t=this.racc_debug_out).$print("        ["),A(r,"each",[],function(n){return null==n&&(n=i),t.$print(" ",n)}),t.$puts(" ]")}),T(f,"$racc_token2str",function(r){var t;return o(t=l(this.$class(),"Racc_token_to_s_table")["$[]"](r))?t:this.$raise("[Racc Bug] can't convert token "+r+" to string")}),T(f,"$token_to_str",function(r){return l(this.$class(),"Racc_token_to_s_table")["$[]"](r)})}(a[0],a)},Opal.modules["bcdice/arithmetic/node"]=function(e){var c,i,w,_,f,x,k,b,a,H=e.module,F=e.klass,o=e.def,B=e.thrower,D=e.return_ivar,S=e.send2,j=e.find_super,T=e.eqeq,R=e.const_set,A=e.eqeqeq,U=e.rb_divide,G=e.truthy,N=e.assign_ivar,M=e.alias,P=[],g=e.nil,K=e.$$$;return c=P,i=a=[H(P[0],"BCDice")].concat(c),w=b=[H(a[0],"Arithmetic")].concat(i),x=[H(b[0],"Node")].concat(w),k=e.$r(x),(f=(_=F(x[0],null,"BinaryOp")).$$prototype).lhs=f.rhs=f.op=g,o(_,"$initialize",function(y,L,v){var r=this;return r.lhs=y,r.op=L,r.rhs=v}),o(_,"$eval",function(y){try{B("eval_return");var d,v=this,r=g;return r=v.lhs.$eval(y),d=v.rhs.$eval(y),r.$send(v.op,d)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),o(_,"$output",function(){var y=this;return""+y.lhs.$output()+y.op+y.rhs.$output()}),o(_,"$s_exp",function(){var y=this;return"("+y.$op_for_s_exp()+" "+y.lhs.$s_exp()+" "+y.rhs.$s_exp()+")"}),o(_,"$op_for_s_exp",D("op")),function(m,h,_){var f=F(m,h,"DivideBase"),u=[f].concat(_),y=e.$r(u),L=f.$$prototype;L.lhs=L.rhs=L.op=g,o(f,"$initialize",function v(r,d){return v.$$p=null,S(this,j(this,"initialize",v,!1,!0),"initialize",[r,"/",d],null)}),o(f,"$eval",function(r){try{B("eval_return");var s,n,t=this;return s=t.lhs.$eval(r),n=t.rhs.$eval(r),T(n,0)&&t.$raise(y("ZeroDivisionError")),t.$divide_and_round(s,n,r)}catch(C){if(C===e.t_eval_return)return C.$v;throw C}}),o(f,"$output",function v(){var r=v.$$p||g,d=this;return v.$$p=null,""+S(d,j(d,"output",v,!1,!0),"output",[],r)+d.$rounding_method()}),f.$private(),o(f,"$rounding_method",function(){return K(this.$class(),"ROUNDING_METHOD")}),o(f,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),o(f,"$divide_and_round",function(r,d,t){return this.$raise(y("NotImplementedError"))})}(x[0],k("BinaryOp"),x),function(m,h,_){var f=F(m,h,"DivideWithGameSystemDefault"),u=[f].concat(_),y=e.$r(u);R(u[0],"ROUNDING_METHOD",""),f.$private(),o(f,"$divide_and_round",function(v,r,d){var t,s=g;return A(K(y("RoundType"),"CEIL"),t=d)?U(v.$to_f(),r).$ceil():A(K(y("RoundType"),"ROUND"),t)?(s=U(v.$to_f(),r),G(s["$negative?"]())?s.$abs().$round()["$-@"]():s.$round()):U(v,r).$floor()})}(x[0],k("DivideBase"),x),function(m,h,_){var f=F(m,h,"DivideWithCeil"),u=[f].concat(_);R(u[0],"ROUNDING_METHOD","C"),f.$private(),o(f,"$divide_and_round",function(L,v,r){return U(L.$to_f(),v).$ceil()})}(x[0],k("DivideBase"),x),function(m,h,_){var f=F(m,h,"DivideWithRound"),u=[f].concat(_);R(u[0],"ROUNDING_METHOD","R"),f.$private(),o(f,"$divide_and_round",function(L,v,r){var d=g;return d=U(L.$to_f(),v),G(d["$negative?"]())?d.$abs().$round()["$-@"]():d.$round()})}(x[0],k("DivideBase"),x),function(m,h,_){var f=F(m,h,"DivideWithFloor"),u=[f].concat(_);R(u[0],"ROUNDING_METHOD","F"),f.$private(),o(f,"$divide_and_round",function(L,v,r){return U(L,v).$floor()})}(x[0],k("DivideBase"),x),function(m,h){var _=F(m,null,"Negative");_.$$prototype.body=g,o(_,"$initialize",N("body")),o(_,"$eval",function(y){try{return B("eval_return"),this.body.$eval(y)["$-@"]()}catch(r){if(r===e.t_eval_return)return r.$v;throw r}}),o(_,"$output",function(){return"-"+this.body.$output()}),o(_,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(x[0]),function(m,h){var _=F(m,null,"Parenthesis");_.$$prototype.expr=g,o(_,"$initialize",N("expr")),o(_,"$eval",function(y){try{return B("eval_return"),this.expr.$eval(y)}catch(r){if(r===e.t_eval_return)return r.$v;throw r}}),o(_,"$output",function(){return"("+this.expr.$output()+")"}),o(_,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(x[0]),function(m,h){var _=F(m,null,"Number");return _.$$prototype.value=g,o(_,"$initialize",N("value")),o(_,"$eval",D("value")),o(_,"$output",function(){return this.value.$to_s()}),M(_,"s_exp","output")}(x[0])},Opal.modules.strscan=function(e){var N,M,P,g,K,F=e.def,o=e.truthy,B=e.eqeqeq,D=e.Opal,S=e.return_ivar,j=e.send,T=e.alias,R=[],A=e.nil;return N=R,P=[M=(0,e.klass)(R[0],null,"StringScanner")].concat(N),g=e.$r(P),(K=M.$$prototype).pos=K.string=K.working=K.matched=K.prev_pos=K.match=A,M.$attr_reader("pos","matched"),F(M,"$initialize",function(c){var $=this;return $.string=c,$.pos=0,$.matched=A,$.working=c,$.match=[]}),M.$attr_reader("string"),F(M,"$beginning_of_line?",function(){var c=this;return 0===c.pos||"\n"===c.string.charAt(c.pos-1)}),F(M,"$scan",function(c){var $=this,a=(c=$.$anchor(c)).exec($.working);return null==a?$.matched=A:($.prev_pos=$.pos,$.pos+=a[0].length,$.working=$.working.substring(a[0].length),$.matched=a[0],$.match=a,a[0])}),F(M,"$scan_until",function(c){var $=this;c=$.$anchor(c);for(var a=$.working,E=0;a.length!=E;++E){var i=c.exec(a.substr(E));if(null!==i){var l=E+i[0].length,b=a.substr(0,l);return $.matched=i[0],$.match=i,$.prev_pos=$.pos+E,$.pos+=l,$.working=a.substr(l),b}}return $.matched=A}),F(M,"$[]",function(c){var a;if(o(this.match["$empty?"]()))return A;B(g("Symbol"),a=c)?c=c.$to_s():B(g("String"),a)||(c=D["$coerce_to!"](c,g("Integer"),"to_int"));var E=this.match;return c<0&&(c+=E.length),c<0||c>=E.length||null==E[c]?A:E[c]}),F(M,"$check",function(c){var $=this,a=(c=$.$anchor(c)).exec($.working);return $.matched=null==a?A:a[0]}),F(M,"$check_until",function(c){var $=this,a=$.prev_pos,E=$.pos,i=$.working,l=$.$scan_until(c);return $.prev_pos=a,$.pos=E,$.working=i,l}),F(M,"$peek",function(c){return this.working.substring(0,c)}),F(M,"$eos?",function(){return 0===this.working.length}),F(M,"$exist?",function(c){var a=c.exec(this.working);return null==a?A:0==a.index?0:a.index+1}),F(M,"$skip",function(c){var $=this,a=(c=$.$anchor(c)).exec($.working);if(null==a)return $.match=[],$.matched=A;var E=a[0],i=E.length;return $.matched=E,$.match=a,$.prev_pos=$.pos,$.pos+=i,$.working=$.working.substring(i),i}),F(M,"$skip_until",function(c){var a=this.$scan_until(c);return a===A?A:(this.matched=a.substr(-1),a.length)}),F(M,"$get_byte",function(){var c=this,$=A;return c.pos<c.string.length?(c.prev_pos=c.pos,c.pos+=1,$=c.matched=c.working.substring(0,1),c.working=c.working.substring(1)):c.matched=A,$}),F(M,"$match?",function(c){var $=this,a=(c=$.$anchor(c)).exec($.working);return null==a?A:($.prev_pos=$.pos,a[0].length)}),F(M,"$pos=",function(c){var $=this;return c<0&&(c+=$.string.$length()),$.pos=c,$.working=$.string.slice(c)}),F(M,"$matched_size",function(){return this.matched===A?A:this.matched.length}),F(M,"$post_match",function(){var c=this;return c.matched===A?A:c.string.substr(c.pos)}),F(M,"$pre_match",function(){var c=this;return c.matched===A?A:c.string.substr(0,c.prev_pos)}),F(M,"$reset",function(){var c=this;return c.working=c.string,c.matched=A,c.pos=0}),F(M,"$rest",S("working")),F(M,"$rest?",function(){return 0!==this.working.length}),F(M,"$rest_size",function(){return this.$rest().$size()}),F(M,"$terminate",function(){var c,$=this;return $.match=A,c=[$.string.$length()],j($,"pos=",c),c[c.length-1]}),F(M,"$unscan",function(){var c=this;return c.pos=c.prev_pos,c.prev_pos=A,c.match=A,c}),T(M,"bol?","beginning_of_line?"),T(M,"getch","get_byte"),M.$private(),F(M,"$anchor",function(c){var $=c.toString().match(/\/([^\/]+)$/);return $=$?$[1]:void 0,new RegExp("^(?:"+c.source+")",$)})},Opal.modules["bcdice/normalize"]=function(e){var T,G,A,H=e.module,F=e.eqeqeq,o=e.def,B=e.eqeq,D=[],S=e.nil;return T=D,A=[H(D[0],"BCDice")].concat(T),(G=H(A[0],"Normalize")).$module_function(),o(G,"$comparison_operator",function(M){var P;return F(/<=|=</,P=M)?"<=":F(/>=|=>/,P)?">=":F(/<>|!=|=!/,P)?"!=":F(/</,P)?"<":F(/>/,P)?">":F(/=/,P)?"==":S}),o(G,"$target_number",function(M){return B(M,"?")?M:M.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var N,K,E,i,l,b,z,c,P,H=e.module,F=e.klass,o=e.const_set,B=e.hash2,D=e.truthy,S=e.send,j=e.def,T=e.thrower,R=e.top,A=[],U=e.nil;return R.$require("strscan"),R.$require("bcdice/normalize"),N=A,K=P=[H(A[0],"BCDice")].concat(N),E=c=[H(P[0],"Command")].concat(K),l=[i=F(c[0],null,"Lexer")].concat(E),b=e.$r(l),(z=i.$$prototype).scanner=z.notations=U,o(l[0],"SYMBOLS",B(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),j(i,"$initialize",function(I,x){var k,m,_;return I=D(_=(k=(m=I)===U||null==m?U:m.$split(" ",2))===U||null==k?U:k.$first())?_:"",this.scanner=b("StringScanner").$new(I),this.notations=S(x,"map",[],function(u){return null==u&&(u=U),D(u["$is_a?"](b("String")))?b("Regexp").$new(u):u})}),j(i,"$next_token",function(){try{var I=T("return"),x=this,k=U,m=U,_=U,f=U;return D(x.scanner["$eos?"]())?[!1,"$"]:(S(x.notations,"each",[],function u(y){var v,L=null==u.$$s?this:u.$$s;if(null==L.scanner&&(L.scanner=U),null==y&&(y=U),v=L.scanner.$scan(y),!D(v))return U;I.$throw(["NOTATION",v])},{$$s:x,$$ret:I}),D(k=x.scanner.$scan(/\d+/))?["NUMBER",k.$to_i()]:D(m=x.scanner.$scan(/[<>!=]+/))?(m=b("Normalize").$comparison_operator(m),[D(m)?"CMP_OP":"ILLEGAL",m]):(_=x.scanner.$getch().$upcase(),[D(f=b("SYMBOLS")["$[]"](_))?f:_.$to_sym(),_]))}catch(u){if(u===I)return u.$v;throw u}}),j(i,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var R,N,Y,c,$,a,E,P,U,H=e.module,F=e.klass,o=e.def,B=e.return_ivar,D=e.truthy,S=[],j=e.nil;return R=S,N=U=[H(S[0],"BCDice")].concat(R),Y=P=[H(U[0],"Command")].concat(N),$=[c=F(P[0],null,"Parsed")].concat(Y),a=e.$r($),(E=c.$$prototype).critical=E.fumble=E.dollar=E.modify_number=E.question_target=E.target_number=E.prefix_number=E.command=E.suffix_number=E.cmp_op=j,c.$attr_accessor("command"),c.$attr_accessor("prefix_number"),c.$attr_accessor("suffix_number"),c.$attr_accessor("critical"),c.$attr_accessor("fumble"),c.$attr_accessor("dollar"),c.$attr_accessor("modify_number"),c.$attr_accessor("cmp_op"),c.$attr_accessor("target_number"),c.$attr_writer("question_target"),o(c,"$initialize",function(){var l=this;return l.prefix_number=j,l.suffix_number=j,l.critical=j,l.fumble=j,l.dollar=j,l.cmp_op=j,l.target_number=j,l.question_target=!1}),o(c,"$question_target?",B("question_target")),o(c,"$to_s",function(l){var b=this,z=j,w=j,I=j,x=j,k=j;switch(null==l&&(l="after_command"),z=D(b.critical)?"@"+b.critical:j,w=D(b.fumble)?"#"+b.fumble:j,I=D(b.dollar)?"$"+b.dollar:j,x=a("Format").$modifier(b.modify_number),k=D(b.question_target)?"?":b.target_number,l.valueOf()){case"after_command":return[b.prefix_number,b.command,b.suffix_number,z,w,I,x,b.cmp_op,k].$join();case"after_modify_number":return[b.prefix_number,b.command,b.suffix_number,x,z,w,I,b.cmp_op,k].$join();case"after_target_number":return[b.prefix_number,b.command,b.suffix_number,x,b.cmp_op,k,z,w,I].$join();default:return j}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var l,I,f,d,t,s,n,C,W,V,ee,Z,ue,u,v,r,ce,k,m,z,H=e.klass,F=e.module,o=e.slice,B=e.extract_kwargs,D=e.ensure_kwargs,S=e.get_kwarg,j=e.send2,T=e.find_super,R=e.def,A=e.send,U=e.eqeq,G=e.thrower,N=e.hash,M=e.const_set,P=e.truthy,g=e.to_ary,K=e.hash2,Y=e.top,c=[],$=e.$r(c),a=e.nil,E=e.$$$;return Y.$require("racc/parser.rb"),Y.$require("bcdice/arithmetic/node"),Y.$require("bcdice/command/lexer"),Y.$require("bcdice/command/parsed"),H(E($("BCDice"),"Command"),E($("Racc"),"Parser"),"Parser"),l=c,I=z=[F(c[0],"BCDice")].concat(l),k=[F(z[0],"Command")].concat(I),m=e.$r(k),f=k,v=[u=H(k[0],E(m("Racc"),"Parser"),"Parser")].concat(f),r=e.$r(v),(ce=u.$$prototype).notations=ce.lexer=ce.modifier=ce.suffix_number=ce.prefix_number=ce.need_suffix_number=ce.need_prefix_number=ce.critical=ce.fumble=ce.dollar=ce.allowed_cmp_op=ce.question_target=a,R(u,"$initialize",function X(p,Q){var J,q,re,ae,O=this;return X.$$p=null,J=o(arguments),q=B(J),q=D(q),re=J,ae=S(q,"round_type"),j(O,T(O,"initialize",X,!1,!0),"initialize",[],null),O.notations=re,O.round_type=ae,O.prefix_number=!1,O.suffix_number=!1,O.need_prefix_number=!1,O.need_suffix_number=!1,O.modifier=!0,O.critical=!1,O.fumble=!1,O.dollar=!1,O.allowed_cmp_op=[a,">=",">","<=","<","==","!="],O.question_target=!1},-2),R(u,"$disable_modifier",function(){return this.modifier=!1,this}),R(u,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),R(u,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),R(u,"$has_prefix_number",function(){var p=this;return p.prefix_number=!0,p.need_prefix_number=!0,p}),R(u,"$has_suffix_number",function(){var p=this;return p.suffix_number=!0,p.need_suffix_number=!0,p}),R(u,"$enable_critical",function(){return this.critical=!0,this}),R(u,"$enable_fumble",function(){return this.fumble=!0,this}),R(u,"$enable_dollar",function(){return this.dollar=!0,this}),R(u,"$restrict_cmp_op_to",function(p){var Q;return Q=o(arguments),this.allowed_cmp_op=Q,this},-1),R(u,"$enable_question_target",function(){return this.question_target=!0,this}),R(u,"$parse",function(p){var Q=this;try{return Q.lexer=r("Lexer").$new(p,Q.notations),Q.$do_parse()}catch(J){if(!e.rescue(J,[r("ParseError"),r("ZeroDivisionError")]))throw J;try{return a}finally{e.pop_exception()}}}),u.$private(),R(u,"$parsed",function(p,Q,J,q){try{return G("eval_return"),A(r("Parsed").$new(),"tap",[],function ie(O){var _e,le,de,me,ve,fe,be,oe=null==ie.$$s?this:ie.$$s;return null==oe.round_type&&(oe.round_type=a),null==O&&(O=a),O["$command="](p["$[]"]("command")),O["$prefix_number="]((_e=p["$[]"]("prefix"))===a||null==_e?a:_e.$eval(oe.round_type)),O["$suffix_number="]((le=p["$[]"]("suffix"))===a||null==le?a:le.$eval(oe.round_type)),O["$critical="]((de=Q["$[]"]("critical"))===a||null==de?a:de.$eval(oe.round_type)),O["$fumble="]((me=Q["$[]"]("fumble"))===a||null==me?a:me.$eval(oe.round_type)),O["$dollar="]((ve=Q["$[]"]("dollar"))===a||null==ve?a:ve.$eval(oe.round_type)),O["$modify_number="](J.$eval(oe.round_type)),O["$cmp_op="](q["$[]"]("cmp_op")),U(q["$[]"]("target"),"?")?(O["$question_target="](!0),A(O,"target_number=",fe=[0]),fe[fe.length-1]):(O["$question_target="](!1),fe=[(be=q["$[]"]("target"),be===a||null==be?a:be.$eval(oe.round_type))],A(O,"target_number=",fe),fe[fe.length-1])},{$$s:this})}catch(ie){if(ie===e.t_eval_return)return ie.$v;throw ie}}),R(u,"$next_token",function(){return this.lexer.$next_token()}),d=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),t=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),s=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),n=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),C=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),W=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),V=[a,6,13,3,9,-1,27,-15,-10,-1,-38],ee=[a,a,a,a,a,a,19,16,15,a,a],Z=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ue=N(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),M(v[0],"Racc_arg",[d,t,n,s,C,W,ee,V,19,Z,ue,58,35,!0]),P(r("Ractor","skip_raise")?"constant":a)&&r("Ractor").$make_shareable(r("Racc_arg")),M(v[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),P(r("Ractor","skip_raise")?"constant":a)&&r("Ractor").$make_shareable(r("Racc_token_to_s_table")),M(v[0],"Racc_debug_parser",!1),R(u,"$_reduce_1",function(p,Q,J){var q;return P(this.modifier)||this.$raise(r("ParseError")),q=g(p),this.$parsed(null==q[0]?a:q[0],null==q[1]?a:q[1],null==q[2]?a:q[2],null==q[3]?a:q[3])}),R(u,"$_reduce_2",function(p,Q,J){var q;return P(this.modifier)||this.$raise(r("ParseError")),q=g(p),this.$parsed(null==q[0]?a:q[0],null==q[2]?a:q[2],null==q[1]?a:q[1],null==q[3]?a:q[3])}),R(u,"$_reduce_3",function(p,Q,J){var q,_e;return _e=null==(q=g(p))[2]?a:q[2],this.$parsed(null==q[0]?a:q[0],null==q[1]?a:q[1],E(E(r("Arithmetic"),"Node"),"Number").$new(0),_e)}),R(u,"$_reduce_4",function(p,Q,J){var q=this;return P(q.prefix_number)&&P(q.suffix_number)||q.$raise(r("ParseError")),K(["command","prefix","suffix"],{command:p["$[]"](1),prefix:p["$[]"](0),suffix:p["$[]"](2)})}),R(u,"$_reduce_5",function(p,Q,J){var q=this;return P(q.prefix_number)||q.$raise(r("ParseError")),P(q.need_suffix_number)&&q.$raise(r("ParseError")),K(["command","prefix"],{command:p["$[]"](1),prefix:p["$[]"](0)})}),R(u,"$_reduce_6",function(p,Q,J){var q=this;return P(q.suffix_number)||q.$raise(r("ParseError")),P(q.need_prefix_number)&&q.$raise(r("ParseError")),K(["command","suffix"],{command:p["$[]"](0),suffix:p["$[]"](1)})}),R(u,"$_reduce_7",function(p,Q,J){var q=this;return(P(q.need_prefix_number)||P(q.need_suffix_number))&&q.$raise(r("ParseError")),K(["command"],{command:p["$[]"](0)})}),R(u,"$_reduce_8",function(p,Q,J){return K([],{})}),R(u,"$_reduce_9",function(p,Q,J){var q,_e,ie=a;return ie=null==(q=g(p))[0]?a:q[0],_e=null==q[2]?a:q[2],P(this.critical)&&P(ie["$[]"]("critical")["$nil?"]())||this.$raise(r("ParseError")),ie["$[]="]("critical",_e),ie}),R(u,"$_reduce_10",function(p,Q,J){var q,_e,ie=a;return ie=null==(q=g(p))[0]?a:q[0],_e=null==q[2]?a:q[2],P(this.fumble)&&P(ie["$[]"]("fumble")["$nil?"]())||this.$raise(r("ParseError")),ie["$[]="]("fumble",_e),ie}),R(u,"$_reduce_11",function(p,Q,J){var q,_e,ie=a;return ie=null==(q=g(p))[0]?a:q[0],_e=null==q[2]?a:q[2],P(this.dollar)&&P(ie["$[]"]("dollar")["$nil?"]())||this.$raise(r("ParseError")),ie["$[]="]("dollar",_e),ie}),R(u,"$_reduce_12",function(p,Q,J){return p["$[]"](1)}),R(u,"$_reduce_13",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"Negative").$new(p["$[]"](1))}),R(u,"$_reduce_14",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"BinaryOp").$new(p["$[]"](0),"+",p["$[]"](2))}),R(u,"$_reduce_15",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"BinaryOp").$new(p["$[]"](0),"-",p["$[]"](2))}),R(u,"$_reduce_16",function(p,Q,J){return P(this.allowed_cmp_op["$include?"](a))||this.$raise(r("ParseError")),K([],{})}),R(u,"$_reduce_17",function(p,Q,J){var q,ie,O;return O=null==(q=g(p))[1]?a:q[1],P(this.allowed_cmp_op["$include?"](ie=null==q[0]?a:q[0]))||this.$raise(r("ParseError")),K(["cmp_op","target"],{cmp_op:ie,target:O})}),R(u,"$_reduce_18",function(p,Q,J){var re,q=this;return re=p["$[]"](0),P(q.question_target)||q.$raise(r("ParseError")),P(q.allowed_cmp_op["$include?"](re))||q.$raise(r("ParseError")),K(["cmp_op","target"],{cmp_op:re,target:"?"})}),R(u,"$_reduce_19",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"BinaryOp").$new(p["$[]"](0),"+",p["$[]"](2))}),R(u,"$_reduce_20",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"BinaryOp").$new(p["$[]"](0),"-",p["$[]"](2))}),R(u,"$_reduce_22",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"BinaryOp").$new(p["$[]"](0),"*",p["$[]"](2))}),R(u,"$_reduce_23",function(p,Q,J){return p["$[]"](3).$new(p["$[]"](0),p["$[]"](2))}),R(u,"$_reduce_25",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),R(u,"$_reduce_26",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"DivideWithCeil")}),R(u,"$_reduce_27",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"DivideWithCeil")}),R(u,"$_reduce_28",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"DivideWithRound")}),R(u,"$_reduce_29",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"DivideWithFloor")}),R(u,"$_reduce_30",function(p,Q,J){return p["$[]"](1)}),R(u,"$_reduce_31",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"Negative").$new(p["$[]"](1))}),R(u,"$_reduce_33",function(p,Q,J){return p["$[]"](1)}),R(u,"$_reduce_34",function(p,Q,J){return E(E(r("Arithmetic"),"Node"),"Number").$new(p["$[]"](0))}),R(u,"$_reduce_none",function(p,Q,J){return p["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var A,M,Y,c,$,a,g,G,H=e.module,F=e.send,o=e.eqeqeq,B=e.truthy,D=e.def,S=e.return_val,j=[],T=e.nil;return A=j,M=G=[H(j[0],"BCDice")].concat(A),Y=g=[H(G[0],"Deprecated")].concat(M),$=[c=H(g[0],"Checker")].concat(Y),a=e.$r($),c.$private(),D(c,"$check_result_legacy",function(i,l,b,z){var k,w=this,I=T,x=T,m=T,h=T;return I=F(l,"map",[],"sides".$to_proc()),k=(x=F(l,"map",[],"value".$to_proc())).$sum(),m=o([100],h=I)?w.$check_1D100(i,k,b,z):o([20],h)?w.$check_1D20(i,k,b,z):o([6,6],h)?w.$check_2D6(i,k,x,b,z):T,(B(m["$nil?"]())||B(m["$empty?"]()))&&(m=o([10],h=I.$uniq())?w.$check_nD10(i,k,x,b,z):o([6],h)?w.$check_nD6(i,k,x,b,z):T,B(m["$nil?"]())||B(m["$empty?"]()))?T:a("Result").$new(m.$delete_prefix(" \uff1e "))}),D(c,"$check_1D100",S(T)),D(c,"$check_1D20",S(T)),D(c,"$check_nD10",S(T)),D(c,"$check_2D6",S(T)),D(c,"$check_nD6",S(T))},Opal.modules["bcdice/base"]=function(e){var $,w,h,L,r,d,_,f,u,y,x,H=e.module,F=e.klass,o=e.slice,B=e.rb_plus,D=e.truthy,S=e.def,j=e.regexp,T=e.send,R=e.thrower,A=e.return_ivar,U=e.assign_ivar_val,G=e.eqeqeq,N=e.eqeq,M=e.return_val,P=e.range,g=e.rb_minus,K=e.rb_divide,Y=e.rb_times,c=e.rb_ge,a=e.top,E=[],i=e.$r(E),l=e.nil,b=e.$$$;return a.$require("i18n"),a.$require("i18n/backend/fallbacks"),a.$require("bcdice/randomizer"),a.$require("bcdice/dice_table"),a.$require("bcdice/enum"),a.$require("bcdice/translate"),a.$require("bcdice/result"),a.$require("bcdice/command/parser"),a.$require("bcdice/deprecated/checker"),w=E,h=x=[H(E[0],"BCDice")].concat(w),f=[_=F(x[0],null,"Base")].concat(h),u=e.$r(f),(y=_.$$prototype).raw_input=y.randomizer=y.enabled_upcase_input=y.debug=l,r=[L=e.get_singleton_class(_)].concat(f),d=e.$r(r),L.$attr_reader("prefixes"),S(L,"$register_prefix",function(s){var C,V,W=this;return null==W.prefixes&&(W.prefixes=l),C=o(arguments),W.prefixes=B(D(V=W.prefixes)?V:[],C.$flatten())},-1),S(L,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),S(L,"$prefixes_pattern",function(){var s=this,n=l;return null==s.prefixes_pattern&&(s.prefixes_pattern=l),null==s.prefixes&&(s.prefixes=l),s.prefixes_pattern=D(n=s.prefixes_pattern)?n:l,D(s.prefixes_pattern)?s.prefixes_pattern:(s.prefixes=D(n=s.prefixes)?n:[],s.prefixes.$freeze(),s.prefixes_pattern=(D(s.prefixes["$empty?"]())?/(?!)/:j(["^(S)?(",s.prefixes.$join("|"),")"],"i")).$freeze())}),S(L,"$command_pattern",function(){var s=this,n=l,C=l;return null==s.command_pattern&&(s.command_pattern=l),null==s.prefixes&&(s.prefixes=l),s.command_pattern=D(n=s.command_pattern)?n:l,D(s.command_pattern)?s.command_pattern:(s.prefixes=D(n=s.prefixes)?n:[],s.prefixes.$freeze(),C=B(T(b(d("CommonCommand"),"COMMANDS"),"map",[],function(V){return null==V&&(V=l),b(V,"PREFIX_PATTERN").$source()}),s.prefixes),s.command_pattern=j(["^S?(",C.$join("|"),")"],"i").$freeze())}),S(L,"$eval",function(s){try{return R("eval_return"),this.$new(s).$eval()}catch(W){if(W===e.t_eval_return)return W.$v;throw W}}),_.$include(u("Translate")),_.$include(b(u("Deprecated"),"Checker")),S(_,"$initialize",function(v){var r=this;return r.raw_input=v,r.sort_add_dice=!1,r.sort_barabara_dice=!1,r.d66_sort_type=b(u("D66SortType"),"NO_SORT"),r.enabled_d9=!1,r.round_type=b(u("RoundType"),"FLOOR"),r.sides_implicit_d=6,r.upper_dice_reroll_threshold=l,r.reroll_dice_reroll_threshold=l,r.default_cmp_op=l,r.default_target_number=l,r.enabled_upcase_input=!0,r.locale="ja_jp",r.randomizer=b(u("BCDice"),"Randomizer").$new(),r.debug=!1}),_.$attr_accessor("randomizer"),_.$attr_reader("d66_sort_type"),_.$attr_reader("round_type"),_.$attr_reader("sides_implicit_d"),_.$attr_reader("upper_dice_reroll_threshold"),_.$attr_reader("reroll_dice_reroll_threshold"),_.$attr_reader("default_cmp_op"),_.$attr_reader("default_target_number"),S(_,"$sort_add_dice?",A("sort_add_dice")),S(_,"$sort_barabara_dice?",A("sort_barabara_dice")),S(_,"$enabled_d9?",A("enabled_d9")),S(_,"$enable_debug",U("debug",!0)),S(_,"$eval",function(){var r,t,v=this,d=l;return r=b(u("BCDice"),"Preprocessor").$process(v.raw_input,v),d=D(t=v.$dice_command(r))?t:v.$eval_common_command(v.raw_input),D(d)?(d["$rands="](v.randomizer.$rand_results()),d["$detailed_rands="](v.randomizer.$detailed_rand_results()),d):l}),S(_,"$change_text",function(v){return v}),S(_,"$check_result",function(v,r,d,t){var s=this,n=l,C=l,W=l,V=l,ee=l;return n=s.$check_result_legacy(v,r,d,t),D(n)?n:(C=T(r,"map",[],"sides".$to_proc()),V=(W=T(r,"map",[],"value".$to_proc())).$sum(),n=G([100],ee=C)?s.$result_1d100(v,V,d,t):G([20],ee)?s.$result_1d20(v,V,d,t):G([6,6],ee)?s.$result_2d6(v,V,W,d,t):l,N(n,u("Result").$nothing())?l:D(n)?n:(n=G([10],ee=C.$uniq())?s.$result_nd10(v,V,W,d,t):G([6],ee)?s.$result_nd6(v,V,W,d,t):l,N(n,u("Result").$nothing())?l:D(n)?n:s.$result_ndx(v,d,t)))}),S(_,"$grich_text",M(l)),_.$private(),S(_,"$eval_common_command",function(v){try{R("eval_return");var d=R("return");return v=this.$change_text(v),T(b(u("CommonCommand"),"COMMANDS"),"each",[],function s(n){var W,C=null==s.$$s?this:s.$$s;if(null==C.randomizer&&(C.randomizer=l),null==n&&(n=l),W=n.$eval(v,C,C.randomizer),!D(W))return l;d.$throw(W)},{$$s:this,$$ret:d}),l}catch(s){if(s===e.t_eval_return||s===d)return s.$v;throw s}}),S(_,"$dice_command",function(v){var r=this,d=l,t=l,s=l,n=l;return D(r.enabled_upcase_input)&&(v=v.$upcase()),d=r.$class().$prefixes_pattern().$match(v),D(d)?(t=d["$[]"](1)["$nil?"]()["$!"](),D(t)&&(v=v["$[]"](P(1,-1,!1))),s=r.$eval_game_system_specific_command(v),D(s["$is_a?"](u("Result")))?(s["$secret="](D(n=s["$secret?"]())?n:t),s):D(s["$nil?"]())||D(s["$empty?"]())||N(s,"1")?l:T(u("Result").$new(),"tap",[],function(W){var V;return null==W&&(W=l),W["$text="](s.$to_s()),T(W,"secret=",V=[t]),V[V.length-1]})):l}),S(_,"$eval_game_system_specific_command",M(l)),S(_,"$result_ndx",function(v,r,d){return D(d["$is_a?"](u("String")))?l:D(v.$send(r,d))?u("Result").$success(this.$translate("success")):u("Result").$failure(this.$translate("failure"))}),S(_,"$result_1d100",M(l)),S(_,"$result_1d20",M(l)),S(_,"$result_nd10",M(l)),S(_,"$result_2d6",M(l)),S(_,"$result_nd6",M(l)),S(_,"$get_table_by_2d6",function(v){return this.$get_table_by_nD6(v,2)}),S(_,"$get_table_by_1d6",function(v){return this.$get_table_by_nD6(v,1)}),S(_,"$get_table_by_nD6",function(v,r){return this.$get_table_by_nDx(v,r,6)}),S(_,"$get_table_by_nDx",function(v,r,d){var s,n=l;return s=this.randomizer.$roll_sum(r,d),n=this.$get_table_value(v["$[]"](g(s,r))),D(n["$nil?"]())?["1",0]:[n,s]}),S(_,"$get_table_by_1d3",function(v){var t,s,r=this,n=l;return r.$debug("get_table_by_1d3"),t=r.randomizer.$roll_sum(1,6),r.$debug("num",t),s=K(g(t,1),2).$to_i(),r.$debug("index",s),n=v["$[]"](s),D(n["$nil?"]())?["1",0]:[n,t]}),S(_,"$get_table_by_d66_swap",function(v){var d;return d=this.randomizer.$roll_d66(b(u("D66SortType"),"ASC")),[this.$get_table_by_number(d,v),d]}),S(_,"$get_table_by_d66",function(v){var d,t,s,C,n=l;return d=this.randomizer.$roll_once(6),t=this.randomizer.$roll_once(6),s=B(Y(g(d,1),6),g(t,1)),n=v["$[]"](s),C=""+d+t,D(n["$nil?"]())?["1",C]:[n,C]}),S(_,"$get_table_by_number",function(v,r,d){try{var t=R("return");return null==d&&(d="1"),T(r,"each",[],function n(C){var V,W=null==n.$$s?this:n.$$s;if(null==C&&(C=l),V=C["$[]"](0),!D(c(V,v)))return l;t.$throw(W.$get_table_value(C["$[]"](1)))},{$$s:this,$$ret:t}),this.$get_table_value(d)}catch(n){if(n===t)return n.$v;throw n}},-3),S(_,"$get_table_value",function(v){return D(v["$is_a?"](u("Proc")))?v.$call():v}),S(_,"$roll_tables",function(v,r){var t=l;return t=r["$[]"](v),D(t)?t.$roll(this.randomizer).$to_s():l}),S(_,"$debug",function(v,r){var t,s=this,n=l,C=l;return t=o(arguments,1),D(s.debug)?(n=D(v["$is_a?"](u("String")))?v:v.$inspect(),D(t["$empty?"]())?s.$warn(n):(C=T(t,"map",[],function(V){return null==V&&(V=l),D(V["$is_a?"](u("String")))?'"'+V+'"':V.$inspect()}),s.$warn(n+": "+C.$join(", ")))):l},-2),b(b(i("I18n"),"Backend"),"Simple").$include(b(b(i("I18n"),"Backend"),"Fallbacks")),i("I18n").$load_path()["$<<"](i("Dir")["$[]"](i("File").$join("bcdice","../../i18n/**/*.yml"))),i("I18n")["$default_locale="]("ja_jp"),$=[["ja_jp"]],T(i("I18n").$fallbacks(),"defaults=",$),$[$.length-1]},Opal.queue(function(e){var i,w,_,v,d,t,f,u,y,L,x,k,b,H=e.module,F=e.klass,o=e.const_set,B=e.hash,D=e.hash2,S=e.def,j=e.send2,T=e.find_super,R=e.truthy,A=e.to_ary,U=e.send,G=e.eqeq,N=e.range,M=e.rb_le,P=e.rb_ge,g=e.rb_plus,K=e.neqeq,c=[],$=e.nil,a=e.$$$;return e.top.$require("bcdice/base"),i=c,w=b=[H(c[0],"BCDice")].concat(i),x=[H(b[0],"GameSystem")].concat(w),k=e.$r(x),_=x,u=[f=F(x[0],k("Base"),"SkynautsBouken")].concat(_),y=e.$r(u),L=f.$$prototype,null==f.locale&&(f.locale=$),L.randomizer=$,o(u[0],"ID","SkynautsBouken"),o(u[0],"NAME","\u6b6f\u8eca\u306e\u5854\u306e\u63a2\u7a7a\u58eb\uff08\u5192\u967a\u4f01\u753b\u5c40\uff09"),o(u[0],"SORT_KEY","\u306f\u304f\u308b\u307e\u306e\u3068\u3046\u306e\u3059\u304b\u3044\u306e\u304a\u30642"),o(u[0],"HELP_MESSAGE","\u30fb\u884c\u70ba\u5224\u5b9a\uff08nSNt#f\uff09 n:\u30c0\u30a4\u30b9\u6570(\u7701\u7565\u66422)\u3001t:\u76ee\u6a19\u5024(\u7701\u7565\u66427)\u3001f:\u30d5\u30a1\u30f3\u30d6\u30eb\u5024(\u7701\u7565\u66421)\n    \u4f8b\uff09SN6#2\u30003SN\n\u30fb\u30c0\u30e1\u30fc\u30b8\u30c1\u30a7\u30c3\u30af (Dx/y@m) x:\u30c0\u30e1\u30fc\u30b8\u7bc4\u56f2\u3001y:\u653b\u6483\u56de\u6570\n\u3000\u3000m:\u300a\u5f3e\u9053\u5b66\u300b\uff08\u7701\u7565\u53ef\uff09\u4e0a:8\u3001\u4e0b:2\u3001\u5de6:4\u3001\u53f3:6\n\u3000\u3000\u4f8b\uff09 D/4\u3000D19/2\u3000D/3@8\u3000D[\u5927\u63fa\u308c]/2\n\u30fb\u56de\u907f(AVO@m\u30c0\u30e1\u30fc\u30b8)\n\u3000\u3000m:\u56de\u907f\u65b9\u5411\uff08\u4e0a:8\u3001\u4e0b:2\u3001\u5de6:4\u3001\u53f3:6\uff09\u3001\u30c0\u30e1\u30fc\u30b8\uff1a\u30c0\u30e1\u30fc\u30b8\u30c1\u30a7\u30c3\u30af\u7d50\u679c\n\u3000\u3000\u4f8b\uff09AVO@8[1,4],[2,6],[3,8]\u3000AVO@2[6,4],[2,6]\n\u30fbFT \u30d5\u30a1\u30f3\u30d6\u30eb\u8868(p76)\n\u30fbNV \u822a\u884c\u8868\n\u30fb\u822a\u884c\u30a4\u30d9\u30f3\u30c8\u8868\n\u3000\u30fbNEN \u822a\u884c\u7cfb\n\u3000\u30fbNEE \u906d\u9047\u7cfb\n\u3000\u30fbNEO \u8239\u5185\u7cfb\n\u3000\u30fbNEH \u56f0\u96e3\u7cfb\n\u3000\u30fbNEL \u9577\u65c5\u7cfb\n\n\u25a0 \u5224\u5b9a\u30bb\u30c3\u30c8\n\u30fb\u300a\u56de\u907f\u904b\u52d5\u300b\u5224\u5b9a+\u56de\u907f\uff08nSNt#f/AVO@\u30c0\u30e1\u30fc\u30b8\uff09\n\u3000\u3000nSNt#f \u2192 \u6210\u529f\u306a\u3089 AVO@m\n\u3000\u3000\u4f8b\uff09SN/AVO@8[1,4],[2,6],[3,8]\u30003SN#2/AVO@2[6,4],[2,6]\n\u30fb\u7832\u6483\u5224\u5b9a+\u30c0\u30e1\u30fc\u30b8\u30c1\u30a7\u30c3\u30af\u3000(nSNt#f/Dx/y@m)\n\u3000\u3000\u884c\u70ba\u5224\u5b9a\u306e\u51fa\u76ee\u5909\u66f4\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u9003\u3059\u306e\u3067\u8981GM\u306e\u8a31\u53ef\n\u3000\u3000nSNt#f \u2192 \u6210\u529f\u306a\u3089 Dx/y@m\n\u3000\u3000\u4f8b\uff09SN/D/4\u30003SN#2/D[\u5927\u63fa\u308c]/2\n"),d=[v=e.get_singleton_class(f)].concat(u),t=e.$r(d),v.$private(),S(v,"$translate_direction_infos",function(n){return B(0,D(["name","position_diff"],{name:"",position_diff:[0,0]}),1,D(["name","position_diff"],{name:t("I18n").$translate("SkynautsBouken.directions.lower_left",D(["locale","raise"],{locale:n,raise:!0})),position_diff:[-1,1]}),2,D(["name","position_diff"],{name:t("I18n").$translate("SkynautsBouken.directions.lower",D(["locale","raise"],{locale:n,raise:!0})),position_diff:[0,1]}),3,D(["name","position_diff"],{name:t("I18n").$translate("SkynautsBouken.directions.lower_right",D(["locale","raise"],{locale:n,raise:!0})),position_diff:[1,1]}),4,D(["name","position_diff"],{name:t("I18n").$translate("SkynautsBouken.directions.left",D(["locale","raise"],{locale:n,raise:!0})),position_diff:[-1,0]}),5,D(["name","position_diff"],{name:"",position_diff:[0,0]}),6,D(["name","position_diff"],{name:t("I18n").$translate("SkynautsBouken.directions.right",D(["locale","raise"],{locale:n,raise:!0})),position_diff:[1,0]}),7,D(["name","position_diff"],{name:t("I18n").$translate("SkynautsBouken.directions.upper_left",D(["locale","raise"],{locale:n,raise:!0})),position_diff:[-1,-1]}),8,D(["name","position_diff"],{name:t("I18n").$translate("SkynautsBouken.directions.upper",D(["locale","raise"],{locale:n,raise:!0})),position_diff:[0,-1]}),9,D(["name","position_diff"],{name:t("I18n").$translate("SkynautsBouken.directions.upper_right",D(["locale","raise"],{locale:n,raise:!0})),position_diff:[1,-1]})).$freeze()}),S(v,"$translate_tables",function(n){return D(["FT","NV","NEN","NEE","NEO","NEH","NEL"],{FT:a(t("DiceTable"),"Table").$from_i18n("SkynautsBouken.FumbleTable",n),NV:a(t("DiceTable"),"Table").$from_i18n("SkynautsBouken.VoyageTable",n),NEN:a(t("DiceTable"),"Table").$from_i18n("SkynautsBouken.NavigationEventNavigationTable",n),NEE:a(t("DiceTable"),"Table").$from_i18n("SkynautsBouken.NavigationEventEncounterTable",n),NEO:a(t("DiceTable"),"Table").$from_i18n("SkynautsBouken.NavigationEventOnBoardTable",n),NEH:a(t("DiceTable"),"Table").$from_i18n("SkynautsBouken.NavigationEventHardTable",n),NEL:a(t("DiceTable"),"Table").$from_i18n("SkynautsBouken.NavigationEventLongJourneyTable",n)}).$freeze()}),o(u[0],"TABLES",f.$translate_tables(f.locale)),f.$register_prefix("D","\\d?SN","AVO",y("TABLES").$keys()),S(f,"$initialize",function v(r){var t=this;return v.$$p=null,j(t,T(t,"initialize",v,!1,!0),"initialize",[r],null),t.round_type=a(y("RoundType"),"FLOOR")}),S(f,"$eval_game_system_specific_command",function(r){var t,s,n,C,W,d=this;return R(t=R(s=R(n=R(C=R(W=d.$command_sn(r))?W:d.$command_d(r))?C:d.$command_avo(r))?n:d.$command_snavo(r))?s:d.$command_snd(r))?t:d.$roll_tables(r,y("TABLES"))}),f.$private(),o(u[0],"DIRECTION_INFOS",f.$translate_direction_infos(f.locale)),o(u[0],"D_REGEXP",/^D([1-46-9]{0,8})(\[.+\]|S|F|SF|FS)?\/(\d{1,2})(@([2468]))?$/.$freeze()),S(f,"$command_sn",function(r){var d,t,s=this,n=$,C=$,W=$,V=$,ee=$,Z=$,te=$;return s.$debug("SN",r),n=a(y("Command"),"Parser").$new(/[1-9]?SN(\d{0,2})/,D(["round_type"],{round_type:s.$round_type()})).$restrict_cmp_op_to($).$enable_fumble().$parse(r),R(n)?(t=U(n.$command().$split("SN",2),"map",[],"to_i".$to_proc()),W=null==(d=A(t))[1]?$:d[1],G(C=null==d[0]?$:d[0],0)&&(C=2),G(W,0)&&(W=7),V=R(n.$fumble()["$nil?"]())?1:n.$fumble(),s.$debug("SN Parsed",C,W,V),Z=(ee=s.randomizer.$roll_barabara(C,6)).$sort()["$[]"](N(-2,-1,!1)),te=G(Z,[6,6])?y("Result").$critical(s.$translate("SkynautsBouken.special")):R(M(ee.$max(),V))?y("Result").$fumble(s.$translate("SkynautsBouken.fumble")):R(P(Z.$sum(),W))?y("Result").$success(s.$translate("success")):y("Result").$failure(s.$translate("failure")),G(C,2)?te["$text="](["("+C+"SN"+W+"#"+V+")",Z.$sum()+"["+ee.$join(",")+"]",te.$text()].$compact().$join(" \uff1e ")):te["$text="](["("+C+"SN"+W+"#"+V+")",g(g("[",ee.$join(",")),"]"),Z.$sum()+"["+Z.$join(",")+"]",te.$text()].$compact().$join(" \uff1e ")),te):$}),S(f,"$command_d",function(r){var d,t,s=this,n=$,C=$,W=$,V=$,ee=$,Z=$,te=$,ne=$,ue=$;return n=y("D_REGEXP").$match(r),R(n)?(C=n["$[]"](3).$to_i(),W=n["$[]"](1).$to_s(),V=n["$[]"](5).$to_i(),ee=s.$get_fire_points(C,W),Z=["("+(r=r.$sub("SF/","["+s.$translate("SkynautsBouken.big_shake")+","+s.$translate("SkynautsBouken.fire")+"]/").$sub("FS/","["+s.$translate("SkynautsBouken.fire")+","+s.$translate("SkynautsBouken.big_shake")+"]/").$sub("F/","["+s.$translate("SkynautsBouken.fire")+"]/").$sub("S/","["+s.$translate("SkynautsBouken.big_shake")+"]/"))+")",s.$get_points_text(ee,0,0)],K(V,0)&&(t=(te=y("DIRECTION_INFOS")["$[]"](V))["$[]"]("position_diff"),ne=null==(d=A(t))[0]?$:d[0],ue=null==d[1]?$:d[1],Z["$[]="](-1,g(Z["$[]"](-1),"\n")),Z["$<<"]("\u300a"+s.$translate("SkynautsBouken.ballistics")+"\u300b"+te["$[]"]("name")),Z["$<<"](s.$get_points_text(ee,ne,ue))),Z.$compact().$join(" \uff1e ")):$}),S(f,"$command_avo",function(r){var d,t,s=this,n=$,C=$,W=$,V=$;return s.$debug("AVO",r),n=r.$match(/^AVO@([2468])(.*?)$/),R(n)?(t=(C=y("DIRECTION_INFOS")["$[]"](n["$[]"](1).$to_i()))["$[]"]("position_diff"),d=A(t),W=null==d[0]?$:d[0],V=null==d[1]?$:d[1],g("\u300a"+s.$translate("SkynautsBouken.avoidance")+"\u300b"+C["$[]"]("name")+" \uff1e ",U(n["$[]"](2),"gsub",[/\(?\[(\d),(\d{1,2})\]\)?/],function ee(){var te,ne,Z=null==ee.$$s?this:ee.$$s;return te=g(y("Regexp").$last_match(1).$to_i(),V),ne=g(y("Regexp").$last_match(2).$to_i(),W),Z.$get_xy_text(ne,te)},{$$s:s}))):$}),S(f,"$command_snavo",function(r){var d,t,n,C,W,s=this,V=$;return t=r.$split(/\/?AVO/,2),d=A(t),s.$debug("SNAVO",n=null==d[0]?$:d[0],C=null==d[1]?$:d[1]),W=/^@([2468])(.*?)$/.$match(C),R(W)&&(V=s.$command_sn(n),R(V))?(R(V["$success?"]())&&V["$text="](g(V.$text(),g("\n \uff1e ",s.$command_avo(g("AVO",C))))),V):$}),S(f,"$command_snd",function(r){var d,t,n,C,W,s=this,V=$;return t=r.$split(/\/?D/,2),d=A(t),s.$debug("SND",n=null==d[0]?$:d[0],C=null==d[1]?$:d[1]),W=y("D_REGEXP").$match("D"+C),R(W)&&(V=s.$command_sn(n),R(V))?(R(V["$success?"]())&&V["$text="](g(V.$text(),"\n \uff1e "+s.$command_d(g("D",C)))),V):$}),S(f,"$get_points_text",function(r,d,t){var s=this;return g("["+s.$translate("SkynautsBouken.y")+","+s.$translate("SkynautsBouken.x")+"]=",U(r,"map",[],function n(C){return null==C&&(C=$),U(C,"map",[],function V(ee,Z){return null==ee&&(ee=$),null==Z&&(Z=$),(null==V.$$s?this:V.$$s).$get_xy_text(g(ee,d),g(Z,t))},{$$s:null==n.$$s?this:n.$$s}).$join()},{$$s:s}).$join(","))}),S(f,"$get_xy_text",function(r,d){return R(N(2,12,!1)["$include?"](r))&&R(N(1,6,!1)["$include?"](d))?"["+d+","+r+"]":"(["+d+","+r+"])"}),S(f,"$get_fire_points",function(r,d){var s;return s=U(d.$chars(),"map",[],"to_i".$to_proc()),U(r.$times(),"map",[],function n(){var W,V,C=null==n.$$s?this:n.$$s;return null==C.randomizer&&(C.randomizer=$),W=C.randomizer.$roll_once(6),V=C.randomizer.$roll_sum(2,6),g([[V,W]],U(s,"map",[],function(Z){var te,ne,se;return null==Z&&(Z=$),ne=y("DIRECTION_INFOS")["$[]"](Z)["$[]"]("position_diff"),se=null==(te=A(ne))[1]?$:te[1],[g(V,null==te[0]?$:te[0]),g(W,se)]}))},{$$s:this})})})}}]);