"use strict";(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[7299],{1652:(l0,Ss,vt)=>{vt.r(Ss),vt.d(Ss,{SkyWayConnection:()=>cf});var Be=vt(467),Wo=vt(9138),ws=vt(750),ni=vt(8161),ur=vt(2306),zo=vt(8848),Mt=vt(8518),$o=vt(1788),Go=vt(4356),Jo=vt(1185),vn=vt(6609),Ti=vt(5643),_s=vt(4136);class Wi extends Go.EventEmitter{get open(){return this.peer.isOpen}get member(){return this.skyWay.room?.members.find(i=>i.name===this.peer.peerId)}get timestamp(){return this._timestamp}set timestamp(i){this._timestamp=i}get ping(){return this._ping}set ping(i){this._ping=i}get candidateType(){return this._candidateType}set candidateType(i){this._candidateType=i}constructor(i,n){super(),this.skyWay=i,this.chunkSize=15872,this.receivedMap=new Map,this.isQueuing=!1,this.sendQueue=new Set,this._timestamp=performance.now(),this._ping=0,this._candidateType=Ti.a.UNKNOWN,this.sortKey="",this.isPublication=!1,this.isCanceled=!1,this.isRejected=!1,this.isOpend=!1,this.state="new",this.onopen=()=>{console.log(`peer ${this.peer.peerId} dataChannel is open`),this.refresh()},this.onmessage=a=>{this.onData(a.data)},this.execQueue=()=>{if(!this.dataChannel||"open"!==this.dataChannel.readyState)return this.sendQueue.size&&console.warn(`peer Connection not open; queueing; ${this.dataChannel?.readyState} -> ${this.member.name} `),void(this.isQueuing=!1);for(let a of this.sendQueue){try{this.dataChannel.send(a),this.sendQueue.delete(a)}catch(c){console.error(c)}break}this.isQueuing=0<this.sendQueue.size,this.isQueuing&&(0,ur.W)(this.execQueue)},this.peer=Mt.y.parse(n.peerId),this.peer.userId=n.userId,this.peer.password=n.password}static createPublication(i,n){let a=new Wi(i,n);return a.sortKey=a.skyWay.peer.peerId,a.isPublication=!0,a}static createSubscription(i,n){let a=new Wi(i,n);return a.sortKey=a.peer.peerId,a.isPublication=!1,a}connect(){return console.log(`connect ${this.peer.peerId}, isPublication: ${this.isPublication}`),this.isPublication?this.initializePublication():this.initializeSubscription()}disconnect(){console.log(`disconnect ${this.peer.peerId}, isPublication: ${this.isPublication}`),this.isCanceled=!0,this.isOpend?this.dispose():this.refresh()}reject(){console.log(`reject ${this.peer.peerId}, isPublication: ${this.isPublication}`),this.isRejected=!0,this.refresh()}dispose(){console.log(`dispose ${this.peer.peerId}, isPublication: ${this.isPublication}`),this.peer.isOpen=!1,this.stopMonitoring(),this.removeAllListeners(),this.onStreamAdded&&this.onStreamAdded.removeListener(),this.onStreamPublished&&this.onStreamPublished.removeListener(),this.onConnectionStateChanged&&this.onConnectionStateChanged.removeListener(),this.onStreamAdded=null,this.onStreamPublished=null,this.onConnectionStateChanged=null,this.subscription=null,this.dataChannel?.removeEventListener("open",this.onopen),this.dataChannel?.removeEventListener("message",this.onmessage),this.dataChannel?.close(),this.dataChannel=null}initializePublication(){let i=this.member,n=i?.subscriptions.find(a=>"data"===a.publication.contentType&&"udonarium-data-stream"===a.publication.metadata&&a.publication.publisher.name===this.skyWay.peer.peerId);n||console.error(`subscription is not found ${this.peer.peerId}`),this.onConnectionStateChanged&&this.onConnectionStateChanged.removeListener(),this.skyWay.publication.onConnectionStateChanged.add(a=>{a.remoteMember.name===this.peer.peerId&&this.onStateChanged(a.state)}),console.log(`initializePublication ${i.name} ${n.id}`),this.subscription=n,this.refresh()}initializeSubscription(){var i=this;return(0,Be.A)(function*(){let n=i.member,a=n.publications.find(c=>"data"===c.contentType&&"udonarium-data-stream"===c.metadata);if(!a)return i.onStreamPublished&&i.onStreamPublished.removeListener(),void(i.onStreamPublished=i.skyWay.room.onStreamPublished.add(c=>{"data"===c.publication.contentType&&"udonarium-data-stream"===c.publication.metadata&&c.publication.publisher.name===i.peer.peerId&&(console.log(`onStreamPublished: ${c.publication.publisher.name} <${c.publication.metadata}>`),i.onStreamPublished&&i.onStreamPublished.removeListener(),i.initializeSubscription())}));i.refresh(),console.log(`initializeSubscription ready ${n.name}`);try{let{subscription:c}=yield i.skyWay.roomPerson.subscribe(a.id);i.onConnectionStateChanged&&i.onConnectionStateChanged.removeListener(),c.onConnectionStateChanged.add(p=>{i.onStateChanged(p)}),console.log(`initializeSubscription done ${n.name} ${a.id}`),i.subscription=c,i.refresh()}catch(c){c instanceof Error?console.log(`${c.name}: ${c.message}`):console.error(c),i.subscription=null,i.state="disconnected",i.emit("close")}})()}onStateChanged(i){switch(console.log(`onStateChanged isPublication: ${this.isPublication}, ${this.peer.peerId} ${this.state} -> ${i}`),i){case"new":case"connecting":case"reconnecting":break;case"connected":"reconnecting"==this.state&&(this.peer.isOpen=!1);break;case"disconnected":return this.subscription=null,void this.emit("close")}this.refresh(),this.state=i}refresh(){let i=this.member,n=i?._getOrCreateConnection(this.skyWay.roomPerson?._impl),a=i?.publications.find(S=>"udonarium-data-stream"===S.metadata),c=this.isPublication?n?.sender.datachannels[this.skyWay.publication?.id]:n?.receiver.streams[a?.id]?._datachannel,u="open"===c?.readyState;if(console.log(`refresh ${i?.name}, isPublication: ${this.isPublication}, isOpen: ${u}, dataChannel: ${c?.readyState}`),c&&(this.isCanceled&&u||this.isRejected))return c.close(),this.dispose(),this.state="disconnected",void this.emit("close");c&&this.dataChannel&&c!==this.dataChannel&&(console.warn(`dataChannel is change: ${this.dataChannel?.id} -> ${c.id}`),this.peer.isOpen=!1),this.dataChannel&&(this.dataChannel.removeEventListener("open",this.onopen),this.dataChannel.removeEventListener("message",this.onmessage)),c&&(c.binaryType="arraybuffer",c.addEventListener("open",this.onopen),c.addEventListener("message",this.onmessage)),this.dataChannel=c,console.log(`p2pconnection: ${n?.id}`),this.onStreamAdded&&this.onStreamAdded.removeListener(),n&&!c&&(this.onStreamAdded=n?.receiver.onStreamAdded.add(S=>{console.log(`receiver.onStreamAdded: ${S.stream.id} ${S.stream?._datachannel?.readyState}`),this.refresh()})),u!==this.peer.isOpen&&(this.peer.isOpen=u,u?(this.isOpend=!0,this.state="connected",this.emit("open")):(this.subscription=null,this.state="disconnected",this.emit("close")));let p=this.getPeerConnection();this.stats=p?new Ti.X(p):null,u?(this.startMonitoring(),this.isQueuing||this.execQueue()):this.stopMonitoring()}send(i){let n=ni.$.encode(i),a=Math.ceil(n.byteLength/this.chunkSize);if(a<=1)return void this.addSendQueue(n);let c=Jo.k.generateUuid(),u=null,p=null;for(let S=0;S<a;S++)u=n.slice(S*this.chunkSize,(S+1)*this.chunkSize),p={id:c,data:u,index:S,total:a},this.addSendQueue(ni.$.encode(p))}addSendQueue(i){this.sendQueue.add(i),this.isQueuing||this.execQueue()}getPeerConnection(){return this.isPublication?this.subscription?.publication?.stream?._getRTCPeerConnection(this.member):this.subscription?.stream?._getRTCPeerConnection()}startMonitoring(){_s.p.add(this)}stopMonitoring(){_s.p.remove(this)}updateStatsAsync(){var i=this;return(0,Be.A)(function*(){if(null==i.stats)return;i.sendPing(),yield i.stats.updateAsync(),i.candidateType=i.stats.candidateType;let n=performance.now()-i.timestamp,a=n<=1e4?1:5e3/(n-1e4+5e3),c=a<1?n:i.ping,u=500/(c+500);switch(i.peer.session.health=a,i.peer.session.ping=c,i.peer.session.speed=u*a,i.candidateType){case Ti.a.HOST:i.peer.session.grade=vn.s.HIGH;break;case Ti.a.SRFLX:case Ti.a.PRFLX:i.peer.session.grade=vn.s.MIDDLE;break;case Ti.a.RELAY:i.peer.session.grade=vn.s.LOW;break;default:i.peer.session.grade=vn.s.UNSPECIFIED}i.peer.session.description=i.candidateType,i.emit("stats",i.stats)})()}sendPing(){let i=ni.$.encode({from:this.skyWay.peer.peerId,ping:performance.now()});this.addSendQueue(i)}receivePing(i){if(i.from===this.skyWay.peer.peerId){let a=performance.now()-i.ping;this.ping=a<=this.ping?.5*this.ping+.5*a:a}else{let n=ni.$.encode(i);this.addSendQueue(n)}}onData(i){this.timestamp=performance.now();let n=ni.$.decode(new Uint8Array(i));if(null!=n.ping)return void this.receivePing(n);let c=n;if(null==c.id)return void this.emit("data",n);let u=this.receivedMap.get(c.id);if(null==u&&(u={id:c.id,chanks:new Array(c.total),length:0,byteLength:0},this.receivedMap.set(c.id,u)),null!=u.chanks[c.index]||(u.length++,u.byteLength+=c.data.byteLength,u.chanks[c.index]=c.data,u.length<c.total))return;this.receivedMap.delete(c.id);let p=new Uint8Array(u.byteLength),S=0;for(let b of u.chanks)p.set(b,S),S+=b.byteLength;let C=ni.$.decode(p);this.emit("data",C)}}class Xo{constructor(){this.streams=[],this.needsRefreshPeers=!1,this._peers=[],this.needsRefreshPeerIds=!1,this._peerIds=[]}get length(){return this.streams.length}[Symbol.iterator](){let i=this.streams.concat(),n=0;return{next:()=>({value:i[n++],done:i.length+1<=n})}}get peers(){return this.needsRefreshPeers&&(this.needsRefreshPeers=!1,this._peers=this.streams.map(i=>i.peer),this._peers.sort((i,n)=>i.peerId>n.peerId?1:i.peerId<n.peerId?-1:0)),this._peers}get peerIds(){if(this.needsRefreshPeerIds){this.needsRefreshPeerIds=!1;let i=[];for(let n of this.streams)n.open&&i.push(n.peer.peerId);i.sort((n,a)=>n>a?1:n<a?-1:0),this._peerIds=i}return this._peerIds}add(i){let n=this.find(i.peer.peerId);if(n){if(n!==i){if(!(n.sortKey<i.sortKey))return console.log("add() is Fail. "+i.peer.peerId+" is already connecting. exchange.",i,n),n.removeAllListeners(),n.disconnect(),this.remove(n),this.add(i);console.log("add() is Fail. "+i.peer.peerId+" is already connecting.",i,n),i.removeAllListeners(),i.disconnect(),this.remove(i)}return null}return this.streams.push(i),this.refresh(),console.log("<add()> Peer:"+i.peer.peerId+" length:"+this.streams.length),i}remove(i){let n=this.streams.indexOf(i);return 0<=n&&(console.log(i.peer.peerId+" is \u3048\u3093\u3044\u30fcindex:"+n+" length:"+this.streams.length),this.streams.splice(n,1),this.refresh(),console.log("<close()> Peer:"+i.peer.peerId+" length:"+this.streams.length)),0<=n?i:null}find(i){return this.streams.find(n=>n.peer.peerId===i)}refresh(){this.needsRefreshPeers=!0,this.needsRefreshPeerIds=!0}}var fr,t,i,Qo=Object.create,gn=Object.defineProperty,Yo=Object.defineProperties,Zo=Object.getOwnPropertyDescriptor,ec=Object.getOwnPropertyDescriptors,lr=Object.getOwnPropertyNames,mn=Object.getOwnPropertySymbols,tc=Object.getPrototypeOf,hr=Object.prototype.hasOwnProperty,xs=Object.prototype.propertyIsEnumerable,zi=(t,i)=>{if(i=Symbol[t])return i;throw Error("Symbol."+t+" is not defined")},ui=Math.pow,Es=(t,i,n)=>i in t?gn(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n,re=(t,i)=>{for(var n in i||(i={}))hr.call(i,n)&&Es(t,n,i[n]);if(mn)for(var n of mn(i))xs.call(i,n)&&Es(t,n,i[n]);return t},ae=(t,i)=>Yo(t,ec(i)),dr=(t,i)=>{var n={};for(var a in t)hr.call(t,a)&&i.indexOf(a)<0&&(n[a]=t[a]);if(null!=t&&mn)for(var a of mn(t))i.indexOf(a)<0&&xs.call(t,a)&&(n[a]=t[a]);return n},oe=(t,i)=>function(){return i||(0,t[lr(t)[0]])((i={exports:{}}).exports,i),i.exports},jt=(t,i,n)=>(n=null!=t?Qo(tc(t)):{},((t,i,n,a)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let c of lr(i))!hr.call(t,c)&&undefined!==c&&gn(t,c,{get:()=>i[c],enumerable:!(a=Zo(i,c))||a.enumerable});return t})(!i&&t&&t.__esModule?n:gn(n,"default",{value:t,enumerable:!0}),t)),K=(t,i,n)=>new Promise((a,c)=>{var u=C=>{try{S(n.next(C))}catch(b){c(b)}},p=C=>{try{S(n.throw(C))}catch(b){c(b)}},S=C=>C.done?a(C.value):Promise.resolve(C.value).then(u,p);S((n=n.apply(t,i)).next())}),Ri=function(t,i){this[0]=t,this[1]=i},Cs=(t,i,n)=>{var a=(p,S,C,b)=>{try{var E=n[p](S),k=(S=E.value)instanceof Ri,q=E.done;Promise.resolve(k?S[0]:S).then(V=>k?a("return"===p?p:"next",S[1]?{done:V.done,value:V.value}:V,C,b):C({value:V,done:q})).catch(V=>a("throw",V,C,b))}catch(V){b(V)}},c=p=>u[p]=S=>new Promise((C,b)=>a(p,S,C,b)),u={};return n=n.apply(t,i),u[Symbol.asyncIterator]=()=>u,c("next"),c("throw"),c("return"),u},As=t=>{var a,i=t[zi("asyncIterator")],n=!1,c={};return null==i?(i=t[zi("iterator")](),a=u=>c[u]=p=>i[u](p)):(i=i.call(t),a=u=>c[u]=p=>{if(n){if(n=!1,"throw"===u)throw p;return p}return n=!0,{done:!1,value:new Ri(new Promise(S=>{var C=i[u](p);if(!(C instanceof Object))throw TypeError("Object expected");S(C)}),1)}}),c[zi("iterator")]=()=>c,a("next"),"throw"in i?a("throw"):c.throw=u=>{throw u},"return"in i&&a("return"),c},U=(t={"shims/process.js"(){fr=void 0}},function(){return t&&(i=(0,t[lr(t)[0]])(t=0)),i}),ac=oe({"../../node_modules/bowser/es5.js"(t,i){var n,a;U(),n=t,a=function(){return function(n){var a={};function c(u){if(a[u])return a[u].exports;var p=a[u]={i:u,l:!1,exports:{}};return n[u].call(p.exports,p,p.exports,c),p.l=!0,p.exports}return c.m=n,c.c=a,c.d=function(u,p,S){c.o(u,p)||Object.defineProperty(u,p,{enumerable:!0,get:S})},c.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},c.t=function(u,p){if(1&p&&(u=c(u)),8&p||4&p&&"object"==typeof u&&u&&u.__esModule)return u;var S=Object.create(null);if(c.r(S),Object.defineProperty(S,"default",{enumerable:!0,value:u}),2&p&&"string"!=typeof u)for(var C in u)c.d(S,C,function(b){return u[b]}.bind(null,C));return S},c.n=function(u){var p=u&&u.__esModule?function(){return u.default}:function(){return u};return c.d(p,"a",p),p},c.o=function(u,p){return Object.prototype.hasOwnProperty.call(u,p)},c.p="",c(c.s=90)}({17:function(n,a,c){a.__esModule=!0,a.default=void 0;var u=c(18),p=function(){function S(){}return S.getFirstMatch=function(C,b){var E=b.match(C);return E&&E.length>0&&E[1]||""},S.getSecondMatch=function(C,b){var E=b.match(C);return E&&E.length>1&&E[2]||""},S.matchAndReturnConst=function(C,b,E){if(C.test(b))return E},S.getWindowsVersionName=function(C){switch(C){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},S.getMacOSVersionName=function(C){var b=C.split(".").splice(0,2).map(function(E){return parseInt(E,10)||0});if(b.push(0),10===b[0])switch(b[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},S.getAndroidVersionName=function(C){var b=C.split(".").splice(0,2).map(function(E){return parseInt(E,10)||0});if(b.push(0),!(1===b[0]&&b[1]<5))return 1===b[0]&&b[1]<6?"Cupcake":1===b[0]&&b[1]>=6?"Donut":2===b[0]&&b[1]<2?"Eclair":2===b[0]&&2===b[1]?"Froyo":2===b[0]&&b[1]>2?"Gingerbread":3===b[0]?"Honeycomb":4===b[0]&&b[1]<1?"Ice Cream Sandwich":4===b[0]&&b[1]<4?"Jelly Bean":4===b[0]&&b[1]>=4?"KitKat":5===b[0]?"Lollipop":6===b[0]?"Marshmallow":7===b[0]?"Nougat":8===b[0]?"Oreo":9===b[0]?"Pie":void 0},S.getVersionPrecision=function(C){return C.split(".").length},S.compareVersions=function(C,b,E){void 0===E&&(E=!1);var k=S.getVersionPrecision(C),q=S.getVersionPrecision(b),V=Math.max(k,q),F=0,O=S.map([C,b],function(G){var se=V-S.getVersionPrecision(G),ce=G+new Array(se+1).join(".0");return S.map(ce.split("."),function(Z){return new Array(20-Z.length).join("0")+Z}).reverse()});for(E&&(F=V-Math.min(k,q)),V-=1;V>=F;){if(O[0][V]>O[1][V])return 1;if(O[0][V]===O[1][V]){if(V===F)return 0;V-=1}else if(O[0][V]<O[1][V])return-1}},S.map=function(C,b){var E,k=[];if(Array.prototype.map)return Array.prototype.map.call(C,b);for(E=0;E<C.length;E+=1)k.push(b(C[E]));return k},S.find=function(C,b){var E,k;if(Array.prototype.find)return Array.prototype.find.call(C,b);for(E=0,k=C.length;E<k;E+=1){var q=C[E];if(b(q,E))return q}},S.assign=function(C){for(var b,E,k=C,q=arguments.length,V=new Array(q>1?q-1:0),F=1;F<q;F++)V[F-1]=arguments[F];if(Object.assign)return Object.assign.apply(Object,[C].concat(V));var O=function(){var G=V[b];"object"==typeof G&&null!==G&&Object.keys(G).forEach(function(se){k[se]=G[se]})};for(b=0,E=V.length;b<E;b+=1)O();return C},S.getBrowserAlias=function(C){return u.BROWSER_ALIASES_MAP[C]},S.getBrowserTypeByAlias=function(C){return u.BROWSER_MAP[C]||""},S}();a.default=p,n.exports=a.default},18:function(n,a,c){a.__esModule=!0,a.ENGINE_MAP=a.OS_MAP=a.PLATFORMS_MAP=a.BROWSER_MAP=a.BROWSER_ALIASES_MAP=void 0,a.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},a.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},a.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},a.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},a.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(n,a,c){a.__esModule=!0,a.default=void 0;var u,p=(u=c(91))&&u.__esModule?u:{default:u},S=c(18);var b=function(){function E(){}var V;return E.getParser=function(F,O){if(void 0===O&&(O=!1),"string"!=typeof F)throw new Error("UserAgent should be a string");return new p.default(F,O)},E.parse=function(F){return new p.default(F).getResult()},(V=[{key:"BROWSER_MAP",get:function(){return S.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return S.ENGINE_MAP}},{key:"OS_MAP",get:function(){return S.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return S.PLATFORMS_MAP}}])&&function C(E,k){for(var q=0;q<k.length;q++){var V=k[q];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(E,V.key,V)}}(E,V),E}();a.default=b,n.exports=a.default},91:function(n,a,c){a.__esModule=!0,a.default=void 0;var u=E(c(92)),p=E(c(93)),S=E(c(94)),C=E(c(95)),b=E(c(17));function E(q){return q&&q.__esModule?q:{default:q}}var k=function(){function q(F,O){if(void 0===O&&(O=!1),null==F||""===F)throw new Error("UserAgent parameter can't be empty");this._ua=F,this.parsedResult={},!0!==O&&this.parse()}var V=q.prototype;return V.getUA=function(){return this._ua},V.test=function(F){return F.test(this._ua)},V.parseBrowser=function(){var F=this;this.parsedResult.browser={};var O=b.default.find(u.default,function(G){if("function"==typeof G.test)return G.test(F);if(G.test instanceof Array)return G.test.some(function(se){return F.test(se)});throw new Error("Browser's test function is not valid")});return O&&(this.parsedResult.browser=O.describe(this.getUA())),this.parsedResult.browser},V.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},V.getBrowserName=function(F){return F?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},V.getBrowserVersion=function(){return this.getBrowser().version},V.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},V.parseOS=function(){var F=this;this.parsedResult.os={};var O=b.default.find(p.default,function(G){if("function"==typeof G.test)return G.test(F);if(G.test instanceof Array)return G.test.some(function(se){return F.test(se)});throw new Error("Browser's test function is not valid")});return O&&(this.parsedResult.os=O.describe(this.getUA())),this.parsedResult.os},V.getOSName=function(F){var O=this.getOS().name;return F?String(O).toLowerCase()||"":O||""},V.getOSVersion=function(){return this.getOS().version},V.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},V.getPlatformType=function(F){void 0===F&&(F=!1);var O=this.getPlatform().type;return F?String(O).toLowerCase()||"":O||""},V.parsePlatform=function(){var F=this;this.parsedResult.platform={};var O=b.default.find(S.default,function(G){if("function"==typeof G.test)return G.test(F);if(G.test instanceof Array)return G.test.some(function(se){return F.test(se)});throw new Error("Browser's test function is not valid")});return O&&(this.parsedResult.platform=O.describe(this.getUA())),this.parsedResult.platform},V.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},V.getEngineName=function(F){return F?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},V.parseEngine=function(){var F=this;this.parsedResult.engine={};var O=b.default.find(C.default,function(G){if("function"==typeof G.test)return G.test(F);if(G.test instanceof Array)return G.test.some(function(se){return F.test(se)});throw new Error("Browser's test function is not valid")});return O&&(this.parsedResult.engine=O.describe(this.getUA())),this.parsedResult.engine},V.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},V.getResult=function(){return b.default.assign({},this.parsedResult)},V.satisfies=function(F){var O=this,G={},se=0,ce={},Z=0;if(Object.keys(F).forEach(function(Ke){var Ge=F[Ke];"string"==typeof Ge?(ce[Ke]=Ge,Z+=1):"object"==typeof Ge&&(G[Ke]=Ge,se+=1)}),se>0){var ie=Object.keys(G),he=b.default.find(ie,function(Ke){return O.isOS(Ke)});if(he){var fe=this.satisfies(G[he]);if(void 0!==fe)return fe}var pe=b.default.find(ie,function(Ke){return O.isPlatform(Ke)});if(pe){var me=this.satisfies(G[pe]);if(void 0!==me)return me}}if(Z>0){var Ce=Object.keys(ce),Qe=b.default.find(Ce,function(Ke){return O.isBrowser(Ke,!0)});if(void 0!==Qe)return this.compareVersion(ce[Qe])}},V.isBrowser=function(F,O){void 0===O&&(O=!1);var G=this.getBrowserName().toLowerCase(),se=F.toLowerCase(),ce=b.default.getBrowserTypeByAlias(se);return O&&ce&&(se=ce.toLowerCase()),se===G},V.compareVersion=function(F){var O=[0],G=F,se=!1,ce=this.getBrowserVersion();if("string"==typeof ce)return">"===F[0]||"<"===F[0]?(G=F.substr(1),"="===F[1]?(se=!0,G=F.substr(2)):O=[],O.push(">"===F[0]?1:-1)):"="===F[0]?G=F.substr(1):"~"===F[0]&&(se=!0,G=F.substr(1)),O.indexOf(b.default.compareVersions(ce,G,se))>-1},V.isOS=function(F){return this.getOSName(!0)===String(F).toLowerCase()},V.isPlatform=function(F){return this.getPlatformType(!0)===String(F).toLowerCase()},V.isEngine=function(F){return this.getEngineName(!0)===String(F).toLowerCase()},V.is=function(F,O){return void 0===O&&(O=!1),this.isBrowser(F,O)||this.isOS(F)||this.isPlatform(F)},V.some=function(F){var O=this;return void 0===F&&(F=[]),F.some(function(G){return O.is(G)})},q}();a.default=k,n.exports=a.default},92:function(n,a,c){a.__esModule=!0,a.default=void 0;var u,p=(u=c(17))&&u.__esModule?u:{default:u},S=/version\/(\d+(\.?_?\d+)+)/i;a.default=[{test:[/googlebot/i],describe:function(b){var E={name:"Googlebot"},k=p.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,b)||p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/opera/i],describe:function(b){var E={name:"Opera"},k=p.default.getFirstMatch(S,b)||p.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/opr\/|opios/i],describe:function(b){var E={name:"Opera"},k=p.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,b)||p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/SamsungBrowser/i],describe:function(b){var E={name:"Samsung Internet for Android"},k=p.default.getFirstMatch(S,b)||p.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/Whale/i],describe:function(b){var E={name:"NAVER Whale Browser"},k=p.default.getFirstMatch(S,b)||p.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/MZBrowser/i],describe:function(b){var E={name:"MZ Browser"},k=p.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,b)||p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/focus/i],describe:function(b){var E={name:"Focus"},k=p.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,b)||p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/swing/i],describe:function(b){var E={name:"Swing"},k=p.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,b)||p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/coast/i],describe:function(b){var E={name:"Opera Coast"},k=p.default.getFirstMatch(S,b)||p.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(b){var E={name:"Opera Touch"},k=p.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,b)||p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/yabrowser/i],describe:function(b){var E={name:"Yandex Browser"},k=p.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,b)||p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/ucbrowser/i],describe:function(b){var E={name:"UC Browser"},k=p.default.getFirstMatch(S,b)||p.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/Maxthon|mxios/i],describe:function(b){var E={name:"Maxthon"},k=p.default.getFirstMatch(S,b)||p.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/epiphany/i],describe:function(b){var E={name:"Epiphany"},k=p.default.getFirstMatch(S,b)||p.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/puffin/i],describe:function(b){var E={name:"Puffin"},k=p.default.getFirstMatch(S,b)||p.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/sleipnir/i],describe:function(b){var E={name:"Sleipnir"},k=p.default.getFirstMatch(S,b)||p.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/k-meleon/i],describe:function(b){var E={name:"K-Meleon"},k=p.default.getFirstMatch(S,b)||p.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/micromessenger/i],describe:function(b){var E={name:"WeChat"},k=p.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,b)||p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/qqbrowser/i],describe:function(b){var E={name:/qqbrowserlite/i.test(b)?"QQ Browser Lite":"QQ Browser"},k=p.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,b)||p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/msie|trident/i],describe:function(b){var E={name:"Internet Explorer"},k=p.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/\sedg\//i],describe:function(b){var E={name:"Microsoft Edge"},k=p.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/edg([ea]|ios)/i],describe:function(b){var E={name:"Microsoft Edge"},k=p.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/vivaldi/i],describe:function(b){var E={name:"Vivaldi"},k=p.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/seamonkey/i],describe:function(b){var E={name:"SeaMonkey"},k=p.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/sailfish/i],describe:function(b){var E={name:"Sailfish"},k=p.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,b);return k&&(E.version=k),E}},{test:[/silk/i],describe:function(b){var E={name:"Amazon Silk"},k=p.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/phantom/i],describe:function(b){var E={name:"PhantomJS"},k=p.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/slimerjs/i],describe:function(b){var E={name:"SlimerJS"},k=p.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(b){var E={name:"BlackBerry"},k=p.default.getFirstMatch(S,b)||p.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/(web|hpw)[o0]s/i],describe:function(b){var E={name:"WebOS Browser"},k=p.default.getFirstMatch(S,b)||p.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/bada/i],describe:function(b){var E={name:"Bada"},k=p.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/tizen/i],describe:function(b){var E={name:"Tizen"},k=p.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,b)||p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/qupzilla/i],describe:function(b){var E={name:"QupZilla"},k=p.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,b)||p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/firefox|iceweasel|fxios/i],describe:function(b){var E={name:"Firefox"},k=p.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/electron/i],describe:function(b){var E={name:"Electron"},k=p.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/MiuiBrowser/i],describe:function(b){var E={name:"Miui"},k=p.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/chromium/i],describe:function(b){var E={name:"Chromium"},k=p.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,b)||p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/chrome|crios|crmo/i],describe:function(b){var E={name:"Chrome"},k=p.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/GSA/i],describe:function(b){var E={name:"Google Search"},k=p.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:function(b){var E=!b.test(/like android/i),k=b.test(/android/i);return E&&k},describe:function(b){var E={name:"Android Browser"},k=p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/playstation 4/i],describe:function(b){var E={name:"PlayStation 4"},k=p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/safari|applewebkit/i],describe:function(b){var E={name:"Safari"},k=p.default.getFirstMatch(S,b);return k&&(E.version=k),E}},{test:[/.*/i],describe:function(b){var E=-1!==b.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:p.default.getFirstMatch(E,b),version:p.default.getSecondMatch(E,b)}}}],n.exports=a.default},93:function(n,a,c){a.__esModule=!0,a.default=void 0;var u,p=(u=c(17))&&u.__esModule?u:{default:u},S=c(18);a.default=[{test:[/Roku\/DVP/],describe:function(b){var E=p.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,b);return{name:S.OS_MAP.Roku,version:E}}},{test:[/windows phone/i],describe:function(b){var E=p.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,b);return{name:S.OS_MAP.WindowsPhone,version:E}}},{test:[/windows /i],describe:function(b){var E=p.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,b),k=p.default.getWindowsVersionName(E);return{name:S.OS_MAP.Windows,version:E,versionName:k}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(b){var E={name:S.OS_MAP.iOS},k=p.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,b);return k&&(E.version=k),E}},{test:[/macintosh/i],describe:function(b){var E=p.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,b).replace(/[_\s]/g,"."),k=p.default.getMacOSVersionName(E),q={name:S.OS_MAP.MacOS,version:E};return k&&(q.versionName=k),q}},{test:[/(ipod|iphone|ipad)/i],describe:function(b){var E=p.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,b).replace(/[_\s]/g,".");return{name:S.OS_MAP.iOS,version:E}}},{test:function(b){var E=!b.test(/like android/i),k=b.test(/android/i);return E&&k},describe:function(b){var E=p.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,b),k=p.default.getAndroidVersionName(E),q={name:S.OS_MAP.Android,version:E};return k&&(q.versionName=k),q}},{test:[/(web|hpw)[o0]s/i],describe:function(b){var E=p.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,b),k={name:S.OS_MAP.WebOS};return E&&E.length&&(k.version=E),k}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(b){var E=p.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,b)||p.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,b)||p.default.getFirstMatch(/\bbb(\d+)/i,b);return{name:S.OS_MAP.BlackBerry,version:E}}},{test:[/bada/i],describe:function(b){var E=p.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,b);return{name:S.OS_MAP.Bada,version:E}}},{test:[/tizen/i],describe:function(b){var E=p.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,b);return{name:S.OS_MAP.Tizen,version:E}}},{test:[/linux/i],describe:function(){return{name:S.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:S.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(b){var E=p.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,b);return{name:S.OS_MAP.PlayStation4,version:E}}}],n.exports=a.default},94:function(n,a,c){a.__esModule=!0,a.default=void 0;var u,p=(u=c(17))&&u.__esModule?u:{default:u},S=c(18);a.default=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(b){var E=p.default.getFirstMatch(/(can-l01)/i,b)&&"Nova",k={type:S.PLATFORMS_MAP.mobile,vendor:"Huawei"};return E&&(k.model=E),k}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:S.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:S.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:S.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:S.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:S.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:S.PLATFORMS_MAP.tablet}}},{test:function(b){var E=b.test(/ipod|iphone/i),k=b.test(/like (ipod|iphone)/i);return E&&!k},describe:function(b){var E=p.default.getFirstMatch(/(ipod|iphone)/i,b);return{type:S.PLATFORMS_MAP.mobile,vendor:"Apple",model:E}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:S.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:S.PLATFORMS_MAP.mobile}}},{test:function(b){return"blackberry"===b.getBrowserName(!0)},describe:function(){return{type:S.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(b){return"bada"===b.getBrowserName(!0)},describe:function(){return{type:S.PLATFORMS_MAP.mobile}}},{test:function(b){return"windows phone"===b.getBrowserName()},describe:function(){return{type:S.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(b){var E=Number(String(b.getOSVersion()).split(".")[0]);return"android"===b.getOSName(!0)&&E>=3},describe:function(){return{type:S.PLATFORMS_MAP.tablet}}},{test:function(b){return"android"===b.getOSName(!0)},describe:function(){return{type:S.PLATFORMS_MAP.mobile}}},{test:function(b){return"macos"===b.getOSName(!0)},describe:function(){return{type:S.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(b){return"windows"===b.getOSName(!0)},describe:function(){return{type:S.PLATFORMS_MAP.desktop}}},{test:function(b){return"linux"===b.getOSName(!0)},describe:function(){return{type:S.PLATFORMS_MAP.desktop}}},{test:function(b){return"playstation 4"===b.getOSName(!0)},describe:function(){return{type:S.PLATFORMS_MAP.tv}}},{test:function(b){return"roku"===b.getOSName(!0)},describe:function(){return{type:S.PLATFORMS_MAP.tv}}}],n.exports=a.default},95:function(n,a,c){a.__esModule=!0,a.default=void 0;var u,p=(u=c(17))&&u.__esModule?u:{default:u},S=c(18);a.default=[{test:function(b){return"microsoft edge"===b.getBrowserName(!0)},describe:function(b){if(/\sedg\//i.test(b))return{name:S.ENGINE_MAP.Blink};var E=p.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,b);return{name:S.ENGINE_MAP.EdgeHTML,version:E}}},{test:[/trident/i],describe:function(b){var E={name:S.ENGINE_MAP.Trident},k=p.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:function(b){return b.test(/presto/i)},describe:function(b){var E={name:S.ENGINE_MAP.Presto},k=p.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:function(b){var E=b.test(/gecko/i),k=b.test(/like gecko/i);return E&&!k},describe:function(b){var E={name:S.ENGINE_MAP.Gecko},k=p.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:S.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(b){var E={name:S.ENGINE_MAP.WebKit},k=p.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,b);return k&&(E.version=k),E}}],n.exports=a.default}})},"object"==typeof t&&"object"==typeof i?i.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof t?t.bowser=a():n.bowser=a()}}),Ps=oe({"../../node_modules/sdp-transform/lib/grammar.js"(t,i){U();var n=i.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(a){return a.encoding?"rtpmap:%d %s/%s/%s":a.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(a){return null!=a.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(a){return null!=a.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(a){return"extmap:%d"+(a.direction?"/%s":"%v")+(a["encrypt-uri"]?" %s":"%v")+" %s"+(a.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(a){return null!=a.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(a){var c="candidate:%s %d %s %d %s %d typ %s";return c+=null!=a.raddr?" raddr %s rport %d":"%v%v",c+=null!=a.tcptype?" tcptype %s":"%v",null!=a.generation&&(c+=" generation %d"),(c+=null!=a["network-id"]?" network-id %d":"%v")+(null!=a["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(a){var c="ssrc:%d";return null!=a.attribute&&(c+=" %s",null!=a.value&&(c+=":%s")),c}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(a){return null!=a.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(a){return a.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(a){return"imageattr:%s %s %s"+(a.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(a){return"simulcast:%s %s"+(a.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(a){return"ts-refclk:%s"+(null!=a.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(a){var c="mediaclk:";return c+=null!=a.id?"id=%s %s":"%v%s",c+=null!=a.mediaClockValue?"=%s":"",(c+=null!=a.rateNumerator?" rate=%s":"")+(null!=a.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(a){n[a].forEach(function(u){u.reg||(u.reg=/(.*)/),u.format||(u.format="%s")})})}}),oc=oe({"../../node_modules/sdp-transform/lib/parser.js"(t){U();var i=function(S){return String(Number(S))===S?Number(S):S},a=function(S,C,b){var E=S.name&&S.names;S.push&&!C[S.push]?C[S.push]=[]:E&&!C[S.name]&&(C[S.name]={});var k=S.push?{}:E?C[S.name]:C;(function(S,C,b,E){if(E&&!b)C[E]=i(S[1]);else for(var k=0;k<b.length;k+=1)null!=S[k+1]&&(C[b[k]]=i(S[k+1]))})(b.match(S.reg),k,S.names,S.name),S.push&&C[S.push].push(k)},c=Ps(),u=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(S){var C={},b=[],E=C;return S.split(/(\r\n|\r|\n)/).filter(u).forEach(function(k){var q=k[0],V=k.slice(2);"m"===q&&(b.push({rtp:[],fmtp:[]}),E=b[b.length-1]);for(var F=0;F<(c[q]||[]).length;F+=1){var O=c[q][F];if(O.reg.test(V))return a(O,E,V)}}),C.media=b,C};var p=function(S,C){var b=C.split(/=(.+)/,2);return 2===b.length?S[b[0]]=i(b[1]):1===b.length&&C.length>1&&(S[b[0]]=void 0),S};t.parseParams=function(S){return S.split(/;\s?/).reduce(p,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(S){return S.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(S){for(var C=[],b=S.split(" ").map(i),E=0;E<b.length;E+=3)C.push({component:b[E],ip:b[E+1],port:b[E+2]});return C},t.parseImageAttributes=function(S){return S.split(" ").map(function(C){return C.substring(1,C.length-1).split(",").reduce(p,{})})},t.parseSimulcastStreamList=function(S){return S.split(";").map(function(C){return C.split(",").map(function(b){var E,k=!1;return"~"!==b[0]?E=i(b):(E=i(b.substring(1,b.length)),k=!0),{scid:E,paused:k}})})}}}),cc=oe({"../../node_modules/sdp-transform/lib/writer.js"(t,i){U();var n=Ps(),a=/%[sdv%]/g,c=function(C){var b=1,E=arguments,k=E.length;return C.replace(a,function(q){if(b>=k)return q;var V=E[b];switch(b+=1,q){case"%%":return"%";case"%s":return String(V);case"%d":return Number(V);case"%v":return""}})},u=function(C,b,E){var q=[C+"="+(b.format instanceof Function?b.format(b.push?E:E[b.name]):b.format)];if(b.names)for(var V=0;V<b.names.length;V+=1)q.push(b.name?E[b.name][b.names[V]]:E[b.names[V]]);else q.push(E[b.name]);return c.apply(null,q)},p=["v","o","s","i","u","e","p","c","b","t","r","z","a"],S=["i","c","b","a"];i.exports=function(C,b){b=b||{},null==C.version&&(C.version=0),null==C.name&&(C.name=" "),C.media.forEach(function(V){null==V.payloads&&(V.payloads="")});var k=b.innerOrder||S,q=[];return(b.outerOrder||p).forEach(function(V){n[V].forEach(function(F){F.name in C&&null!=C[F.name]?q.push(u(V,F,C)):F.push in C&&null!=C[F.push]&&C[F.push].forEach(function(O){q.push(u(V,F,O))})})}),C.media.forEach(function(V){q.push(u("m",n.m[0],V)),k.forEach(function(F){n[F].forEach(function(O){O.name in V&&null!=V[O.name]?q.push(u(F,O,V)):O.push in V&&null!=V[O.push]&&V[O.push].forEach(function(G){q.push(u(F,O,G))})})})}),q.join("\r\n")+"\r\n"}}}),pr=oe({"../../node_modules/sdp-transform/lib/index.js"(t){U();var i=oc(),n=cc();t.write=n,t.parse=i.parse,t.parseParams=i.parseParams,t.parseFmtpConfig=i.parseFmtpConfig,t.parsePayloads=i.parsePayloads,t.parseRemoteCandidates=i.parseRemoteCandidates,t.parseImageAttributes=i.parseImageAttributes,t.parseSimulcastStreamList=i.parseSimulcastStreamList}}),uc=oe({"../../node_modules/ua-parser-js/src/ua-parser.js"(t,i){U(),function(n,a){var S="function",C="undefined",b="object",E="string",q="model",V="name",F="type",O="vendor",G="version",se="architecture",ce="console",Z="mobile",ie="tablet",he="smarttv",fe="wearable",pe="embedded",Ce="Amazon",Qe="Apple",Ge="BlackBerry",Pe="Browser",mt="Chrome",Zt="Firefox",Jt="Google",nn="Microsoft",Kn="Motorola",ji="Opera",rn="Samsung",Li="Sony",sn="Xiaomi",an="Zebra",zn="Facebook",qt=function(ke){for(var He={},Ne=0;Ne<ke.length;Ne++)He[ke[Ne].toUpperCase()]=ke[Ne];return He},$n=function(ke,He){return typeof ke===E&&-1!==Ai(He).indexOf(Ai(ke))},Ai=function(ke){return ke.toLowerCase()},on=function(ke,He){if(typeof ke===E)return ke=ke.replace(/^\s\s*/,""),typeof He===C?ke:ke.substring(0,350)},Pi=function(ke,He){for(var it,De,qi,Je,Fi,Vt,Ne=0;Ne<He.length&&!Fi;){var Xn=He[Ne],Qn=He[Ne+1];for(it=De=0;it<Xn.length&&!Fi;)if(Fi=Xn[it++].exec(ke))for(qi=0;qi<Qn.length;qi++)Vt=Fi[++De],typeof(Je=Qn[qi])===b&&Je.length>0?2===Je.length?this[Je[0]]=typeof Je[1]==S?Je[1].call(this,Vt):Je[1]:3===Je.length?this[Je[0]]=typeof Je[1]!==S||Je[1].exec&&Je[1].test?Vt?Vt.replace(Je[1],Je[2]):a:Vt?Je[1].call(this,Vt,Je[2]):a:4===Je.length&&(this[Je[0]]=Vt?Je[3].call(this,Vt.replace(Je[1],Je[2])):a):this[Je]=Vt||a;Ne+=2}},cn=function(ke,He){for(var Ne in He)if(typeof He[Ne]===b&&He[Ne].length>0){for(var it=0;it<He[Ne].length;it++)if($n(He[Ne][it],ke))return"?"===Ne?a:Ne}else if($n(He[Ne],ke))return"?"===Ne?a:Ne;return ke},Gn={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Jn={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[G,[V,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[G,[V,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[V,G],[/opios[\/ ]+([\w\.]+)/i],[G,[V,ji+" Mini"]],[/\bopr\/([\w\.]+)/i],[G,[V,ji]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[V,G],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[G,[V,"UC"+Pe]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[G,[V,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[G,[V,"WeChat"]],[/konqueror\/([\w\.]+)/i],[G,[V,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[G,[V,"IE"]],[/yabrowser\/([\w\.]+)/i],[G,[V,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[V,/(.+)/,"$1 Secure "+Pe],G],[/\bfocus\/([\w\.]+)/i],[G,[V,Zt+" Focus"]],[/\bopt\/([\w\.]+)/i],[G,[V,ji+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[G,[V,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[G,[V,"Dolphin"]],[/coast\/([\w\.]+)/i],[G,[V,ji+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[G,[V,"MIUI "+Pe]],[/fxios\/([-\w\.]+)/i],[G,[V,Zt]],[/\bqihu|(qi?ho?o?|360)browser/i],[[V,"360 "+Pe]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[V,/(.+)/,"$1 "+Pe],G],[/(comodo_dragon)\/([\w\.]+)/i],[[V,/_/g," "],G],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[V,G],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[V],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[V,zn],G],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[V,G],[/\bgsa\/([\w\.]+) .*safari\//i],[G,[V,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[G,[V,mt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[V,mt+" WebView"],G],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[G,[V,"Android "+Pe]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[V,G],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[G,[V,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[G,V],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[V,[G,cn,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[V,G],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[V,"Netscape"],G],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[G,[V,Zt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[V,G],[/(cobalt)\/([\w\.]+)/i],[V,[G,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[se,"amd64"]],[/(ia32(?=;))/i],[[se,Ai]],[/((?:i[346]|x)86)[;\)]/i],[[se,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[se,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[se,"armhf"]],[/windows (ce|mobile); ppc;/i],[[se,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[se,/ower/,"",Ai]],[/(sun4\w)[;\)]/i],[[se,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[se,Ai]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[q,[O,rn],[F,ie]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[q,[O,rn],[F,Z]],[/\((ip(?:hone|od)[\w ]*);/i],[q,[O,Qe],[F,Z]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[q,[O,Qe],[F,ie]],[/(macintosh);/i],[q,[O,Qe]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[q,[O,"Huawei"],[F,ie]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[q,[O,"Huawei"],[F,Z]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[q,/_/g," "],[O,sn],[F,Z]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[q,/_/g," "],[O,sn],[F,ie]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[q,[O,"OPPO"],[F,Z]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[q,[O,"Vivo"],[F,Z]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[q,[O,"Realme"],[F,Z]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[q,[O,Kn],[F,Z]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[q,[O,Kn],[F,ie]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[q,[O,"LG"],[F,ie]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[q,[O,"LG"],[F,Z]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[q,[O,"Lenovo"],[F,ie]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[q,/_/g," "],[O,"Nokia"],[F,Z]],[/(pixel c)\b/i],[q,[O,Jt],[F,ie]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[q,[O,Jt],[F,Z]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[q,[O,Li],[F,Z]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[q,"Xperia Tablet"],[O,Li],[F,ie]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[q,[O,"OnePlus"],[F,Z]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[q,[O,Ce],[F,ie]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[q,/(.+)/g,"Fire Phone $1"],[O,Ce],[F,Z]],[/(playbook);[-\w\),; ]+(rim)/i],[q,O,[F,ie]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[q,[O,Ge],[F,Z]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[q,[O,"ASUS"],[F,ie]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[q,[O,"ASUS"],[F,Z]],[/(nexus 9)/i],[q,[O,"HTC"],[F,ie]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony(?!-bra))[-_ ]?([-\w]*)/i],[O,[q,/_/g," "],[F,Z]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[q,[O,"Acer"],[F,ie]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[q,[O,"Meizu"],[F,Z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[q,[O,"Sharp"],[F,Z]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[O,q,[F,Z]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[O,q,[F,ie]],[/(surface duo)/i],[q,[O,nn],[F,ie]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[q,[O,"Fairphone"],[F,Z]],[/(u304aa)/i],[q,[O,"AT&T"],[F,Z]],[/\bsie-(\w*)/i],[q,[O,"Siemens"],[F,Z]],[/\b(rct\w+) b/i],[q,[O,"RCA"],[F,ie]],[/\b(venue[\d ]{2,7}) b/i],[q,[O,"Dell"],[F,ie]],[/\b(q(?:mv|ta)\w+) b/i],[q,[O,"Verizon"],[F,ie]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[q,[O,"Barnes & Noble"],[F,ie]],[/\b(tm\d{3}\w+) b/i],[q,[O,"NuVision"],[F,ie]],[/\b(k88) b/i],[q,[O,"ZTE"],[F,ie]],[/\b(nx\d{3}j) b/i],[q,[O,"ZTE"],[F,Z]],[/\b(gen\d{3}) b.+49h/i],[q,[O,"Swiss"],[F,Z]],[/\b(zur\d{3}) b/i],[q,[O,"Swiss"],[F,ie]],[/\b((zeki)?tb.*\b) b/i],[q,[O,"Zeki"],[F,ie]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[O,"Dragon Touch"],q,[F,ie]],[/\b(ns-?\w{0,9}) b/i],[q,[O,"Insignia"],[F,ie]],[/\b((nxa|next)-?\w{0,9}) b/i],[q,[O,"NextBook"],[F,ie]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[O,"Voice"],q,[F,Z]],[/\b(lvtel\-)?(v1[12]) b/i],[[O,"LvTel"],q,[F,Z]],[/\b(ph-1) /i],[q,[O,"Essential"],[F,Z]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[q,[O,"Envizen"],[F,ie]],[/\b(trio[-\w\. ]+) b/i],[q,[O,"MachSpeed"],[F,ie]],[/\btu_(1491) b/i],[q,[O,"Rotor"],[F,ie]],[/(shield[\w ]+) b/i],[q,[O,"Nvidia"],[F,ie]],[/(sprint) (\w+)/i],[O,q,[F,Z]],[/(kin\.[onetw]{3})/i],[[q,/\./g," "],[O,nn],[F,Z]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[q,[O,an],[F,ie]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[q,[O,an],[F,Z]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[O,q,[F,ce]],[/droid.+; (shield) bui/i],[q,[O,"Nvidia"],[F,ce]],[/(playstation [345portablevi]+)/i],[q,[O,Li],[F,ce]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[q,[O,nn],[F,ce]],[/smart-tv.+(samsung)/i],[O,[F,he]],[/hbbtv.+maple;(\d+)/i],[[q,/^/,"SmartTV"],[O,rn],[F,he]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[O,"LG"],[F,he]],[/(apple) ?tv/i],[O,[q,Qe+" TV"],[F,he]],[/crkey/i],[[q,mt+"cast"],[O,Jt],[F,he]],[/droid.+aft(\w)( bui|\))/i],[q,[O,Ce],[F,he]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[q,[O,"Sharp"],[F,he]],[/(bravia[\w ]+)( bui|\))/i],[q,[O,Li],[F,he]],[/(mitv-\w{5}) bui/i],[q,[O,sn],[F,he]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[O,on],[q,on],[F,he]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[F,he]],[/((pebble))app/i],[O,q,[F,fe]],[/droid.+; (glass) \d/i],[q,[O,Jt],[F,fe]],[/droid.+; (wt63?0{2,3})\)/i],[q,[O,an],[F,fe]],[/(quest( 2)?)/i],[q,[O,zn],[F,fe]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[O,[F,pe]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[q,[F,Z]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[q,[F,ie]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[F,ie]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[F,Z]],[/(android[-\w\. ]{0,9});.+buil/i],[q,[O,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[G,[V,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[G,[V,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[V,G],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[G,V]],os:[[/microsoft (windows) (vista|xp)/i],[V,G],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[V,[G,cn,Gn]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[V,"Windows"],[G,cn,Gn]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[G,/_/g,"."],[V,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[V,"Mac OS"],[G,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[G,V],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[V,G],[/\(bb(10);/i],[G,[V,Ge]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[G,[V,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[G,[V,Zt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[G,[V,"webOS"]],[/crkey\/([\d\.]+)/i],[G,[V,mt+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[V,"Chromium OS"],G],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[V,G],[/(sunos) ?([\w\.\d]*)/i],[[V,"Solaris"],G],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[V,G]]},_t=function(ke,He){if(typeof ke===b&&(He=ke,ke=a),!(this instanceof _t))return new _t(ke,He).getResult();var Ne=ke||(typeof n!==C&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:""),it=He?function(ke,He){var Ne={};for(var it in ke)Ne[it]=He[it]&&He[it].length%2==0?He[it].concat(ke[it]):ke[it];return Ne}(Jn,He):Jn;return this.getBrowser=function(){var De={};return De[V]=a,De[G]=a,Pi.call(De,Ne,it.browser),De.major=function(ke){return typeof ke===E?ke.replace(/[^\d\.]/g,"").split(".")[0]:a}(De.version),De},this.getCPU=function(){var De={};return De[se]=a,Pi.call(De,Ne,it.cpu),De},this.getDevice=function(){var De={};return De[O]=a,De[q]=a,De[F]=a,Pi.call(De,Ne,it.device),De},this.getEngine=function(){var De={};return De[V]=a,De[G]=a,Pi.call(De,Ne,it.engine),De},this.getOS=function(){var De={};return De[V]=a,De[G]=a,Pi.call(De,Ne,it.os),De},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ne},this.setUA=function(De){return Ne=typeof De===E&&De.length>350?on(De,350):De,this},this.setUA(Ne),this};_t.VERSION="0.7.33",_t.BROWSER=qt([V,G,"major"]),_t.CPU=qt([se]),_t.DEVICE=qt([q,O,F,ce,Z,he,ie,fe,pe]),_t.ENGINE=_t.OS=qt([V,G]),typeof t!==C?(typeof i!==C&&i.exports&&(t=i.exports=_t),t.UAParser=_t):typeof define===S&&define.amd?define(function(){return _t}):typeof n!==C&&(n.UAParser=_t);var gi=typeof n!==C&&(n.jQuery||n.Zepto);if(gi&&!gi.ua){var Hi=new _t;gi.ua=Hi.getResult(),gi.ua.get=function(){return Hi.getUA()},gi.ua.set=function(ke){Hi.setUA(ke);var He=Hi.getResult();for(var Ne in He)gi.ua[Ne]=He[Ne]}}}("object"==typeof window?window:t)}}),lc=oe({"../../node_modules/jsrsasign/lib/jsrsasign.js"(t){U();var e,s,o,h,d,f,v,w,_,I,m,r,i={userAgent:!1},n={},u=u||(e=Math,o=(s={}).lib={},h=o.Base=function(){function g(){}return{extend:function(A){g.prototype=this;var y=new g;return A&&y.mixIn(A),y.hasOwnProperty("init")||(y.init=function(){y.$super.init.apply(this,arguments)}),y.init.prototype=y,y.$super=this,y},create:function(){var A=this.extend();return A.init.apply(A,arguments),A},init:function(){},mixIn:function(A){for(var y in A)A.hasOwnProperty(y)&&(this[y]=A[y]);A.hasOwnProperty("toString")&&(this.toString=A.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=o.WordArray=h.extend({init:function(g,A){g=this.words=g||[],this.sigBytes=null!=A?A:4*g.length},toString:function(g){return(g||v).stringify(this)},concat:function(g){var A=this.words,y=g.words,P=this.sigBytes,x=g.sigBytes;if(this.clamp(),P%4)for(var N=0;N<x;N++)A[P+N>>>2]|=(y[N>>>2]>>>24-N%4*8&255)<<24-(P+N)%4*8;else for(N=0;N<x;N+=4)A[P+N>>>2]=y[N>>>2];return this.sigBytes+=x,this},clamp:function(){var g=this.words,A=this.sigBytes;g[A>>>2]&=4294967295<<32-A%4*8,g.length=e.ceil(A/4)},clone:function(){var g=h.clone.call(this);return g.words=this.words.slice(0),g},random:function(g){for(var A=[],y=0;y<g;y+=4)A.push(4294967296*e.random()|0);return new d.init(A,g)}}),f=s.enc={},v=f.Hex={stringify:function(g){for(var A=g.words,y=g.sigBytes,P=[],x=0;x<y;x++){var N=A[x>>>2]>>>24-x%4*8&255;P.push((N>>>4).toString(16)),P.push((15&N).toString(16))}return P.join("")},parse:function(g){for(var A=g.length,y=[],P=0;P<A;P+=2)y[P>>>3]|=parseInt(g.substr(P,2),16)<<24-P%8*4;return new d.init(y,A/2)}},w=f.Latin1={stringify:function(g){for(var A=g.words,y=g.sigBytes,P=[],x=0;x<y;x++)P.push(String.fromCharCode(A[x>>>2]>>>24-x%4*8&255));return P.join("")},parse:function(g){for(var A=g.length,y=[],P=0;P<A;P++)y[P>>>2]|=(255&g.charCodeAt(P))<<24-P%4*8;return new d.init(y,A)}},_=f.Utf8={stringify:function(g){try{return decodeURIComponent(escape(w.stringify(g)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(g){return w.parse(unescape(encodeURIComponent(g)))}},I=o.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(g){"string"==typeof g&&(g=_.parse(g)),this._data.concat(g),this._nDataBytes+=g.sigBytes},_process:function(g){var A=this._data,y=A.words,P=A.sigBytes,x=this.blockSize,B=P/(4*x),M=(B=g?e.ceil(B):e.max((0|B)-this._minBufferSize,0))*x,j=e.min(4*M,P);if(M){for(var Q=0;Q<M;Q+=x)this._doProcessBlock(y,Q);var Y=y.splice(0,M);A.sigBytes-=j}return new d.init(Y,j)},clone:function(){var g=h.clone.call(this);return g._data=this._data.clone(),g},_minBufferSize:0}),o.Hasher=I.extend({cfg:h.extend(),init:function(g){this.cfg=this.cfg.extend(g),this.reset()},reset:function(){I.reset.call(this),this._doReset()},update:function(g){return this._append(g),this._process(),this},finalize:function(g){return g&&this._append(g),this._doFinalize()},blockSize:16,_createHelper:function(g){return function(A,y){return new g.init(y).finalize(A)}},_createHmacHelper:function(g){return function(A,y){return new m.HMAC.init(g,y).finalize(A)}}}),m=s.algo={},s);(function(e){var h,r=(h=u).lib,s=r.Base,o=r.WordArray;(h=h.x64={}).Word=s.extend({init:function(d,f){this.high=d,this.low=f}}),h.WordArray=s.extend({init:function(d,f){d=this.words=d||[],this.sigBytes=null!=f?f:8*d.length},toX32:function(){for(var d=this.words,f=d.length,v=[],w=0;w<f;w++){var _=d[w];v.push(_.high),v.push(_.low)}return o.create(v,this.sigBytes)},clone:function(){for(var d=s.clone.call(this),f=d.words=this.words.slice(0),v=f.length,w=0;w<v;w++)f[w]=f[w].clone();return d}})})(),u.lib.Cipher||function(e){var r=(g=u).lib,s=r.Base,o=r.WordArray,h=r.BufferedBlockAlgorithm,d=g.enc.Base64,f=g.algo.EvpKDF,v=r.Cipher=h.extend({cfg:s.extend(),createEncryptor:function(y,P){return this.create(this._ENC_XFORM_MODE,y,P)},createDecryptor:function(y,P){return this.create(this._DEC_XFORM_MODE,y,P)},init:function(y,P,x){this.cfg=this.cfg.extend(x),this._xformMode=y,this._key=P,this.reset()},reset:function(){h.reset.call(this),this._doReset()},process:function(y){return this._append(y),this._process()},finalize:function(y){return y&&this._append(y),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(y){return{encrypt:function(P,x,N){return("string"==typeof x?A:m).encrypt(y,P,x,N)},decrypt:function(P,x,N){return("string"==typeof x?A:m).decrypt(y,P,x,N)}}}});r.StreamCipher=v.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var T=g.mode={},w=function(y,P,x){var N=this._iv;N?this._iv=void 0:N=this._prevBlock;for(var B=0;B<x;B++)y[P+B]^=N[B]},_=(r.BlockCipherMode=s.extend({createEncryptor:function(y,P){return this.Encryptor.create(y,P)},createDecryptor:function(y,P){return this.Decryptor.create(y,P)},init:function(y,P){this._cipher=y,this._iv=P}})).extend();_.Encryptor=_.extend({processBlock:function(y,P){var x=this._cipher,N=x.blockSize;w.call(this,y,P,N),x.encryptBlock(y,P),this._prevBlock=y.slice(P,P+N)}}),_.Decryptor=_.extend({processBlock:function(y,P){var x=this._cipher,N=x.blockSize,B=y.slice(P,P+N);x.decryptBlock(y,P),w.call(this,y,P,N),this._prevBlock=B}}),T=T.CBC=_,_=(g.pad={}).Pkcs7={pad:function(y,P){for(var x,N=(x=(x=4*P)-y.sigBytes%x)<<24|x<<16|x<<8|x,B=[],M=0;M<x;M+=4)B.push(N);x=o.create(B,x),y.concat(x)},unpad:function(y){y.sigBytes-=255&y.words[y.sigBytes-1>>>2]}},r.BlockCipher=v.extend({cfg:v.cfg.extend({mode:T,padding:_}),reset:function(){v.reset.call(this);var y=(P=this.cfg).iv,P=P.mode;if(this._xformMode==this._ENC_XFORM_MODE)var x=P.createEncryptor;else x=P.createDecryptor,this._minBufferSize=1;this._mode=x.call(P,this,y&&y.words)},_doProcessBlock:function(y,P){this._mode.processBlock(y,P)},_doFinalize:function(){var y=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){y.pad(this._data,this.blockSize);var P=this._process(!0)}else P=this._process(!0),y.unpad(P);return P},blockSize:4});var I=r.CipherParams=s.extend({init:function(y){this.mixIn(y)},toString:function(y){return(y||this.formatter).stringify(this)}}),m=(T=(g.format={}).OpenSSL={stringify:function(y){var P=y.ciphertext;return((y=y.salt)?o.create([1398893684,1701076831]).concat(y).concat(P):P).toString(d)},parse:function(y){var P=(y=d.parse(y)).words;if(1398893684==P[0]&&1701076831==P[1]){var x=o.create(P.slice(2,4));P.splice(0,4),y.sigBytes-=16}return I.create({ciphertext:y,salt:x})}},r.SerializableCipher=s.extend({cfg:s.extend({format:T}),encrypt:function(y,P,x,N){N=this.cfg.extend(N);var B=y.createEncryptor(x,N);return P=B.finalize(P),I.create({ciphertext:P,key:x,iv:(B=B.cfg).iv,algorithm:y,mode:B.mode,padding:B.padding,blockSize:y.blockSize,formatter:N.format})},decrypt:function(y,P,x,N){return N=this.cfg.extend(N),P=this._parse(P,N.format),y.createDecryptor(x,N).finalize(P.ciphertext)},_parse:function(y,P){return"string"==typeof y?P.parse(y,this):y}})),g=(g.kdf={}).OpenSSL={execute:function(y,P,x,N){return N||(N=o.random(8)),y=f.create({keySize:P+x}).compute(y,N),x=o.create(y.words.slice(P),4*x),y.sigBytes=4*P,I.create({key:y,iv:x,salt:N})}},A=r.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:g}),encrypt:function(y,P,x,N){return x=(N=this.cfg.extend(N)).kdf.execute(x,y.keySize,y.ivSize),N.iv=x.iv,(y=m.encrypt.call(this,y,P,x.key,N)).mixIn(x),y},decrypt:function(y,P,x,N){return N=this.cfg.extend(N),P=this._parse(P,N.format),x=N.kdf.execute(x,y.keySize,y.ivSize,P.salt),N.iv=x.iv,m.decrypt.call(this,y,P,x.key,N)}})}(),function(){for(var e=u,r=e.lib.BlockCipher,Q=e.algo,s=[],o=[],h=[],d=[],f=[],v=[],w=[],_=[],I=[],T=[],m=[],g=0;256>g;g++)m[g]=128>g?g<<1:g<<1^283;var A=0,y=0;for(g=0;256>g;g++){var P;s[A]=P=(P=y^y<<1^y<<2^y<<3^y<<4)>>>8^255&P^99,o[P]=A;var x=m[A],N=m[x],B=m[N],M=257*m[P]^16843008*P;h[A]=M<<24|M>>>8,d[A]=M<<16|M>>>16,f[A]=M<<8|M>>>24,v[A]=M,w[P]=(M=16843009*B^65537*N^257*x^16843008*A)<<24|M>>>8,_[P]=M<<16|M>>>16,I[P]=M<<8|M>>>24,T[P]=M,A?(A=x^m[m[m[B^x]]],y^=m[m[y]]):A=y=1}var j=[0,1,2,4,8,16,32,64,128,27,54];Q=Q.AES=r.extend({_doReset:function(){for(var Y=(D=this._key).words,R=D.sigBytes/4,D=4*((this._nRounds=R+6)+1),L=this._keySchedule=[],H=0;H<D;H++)if(H<R)L[H]=Y[H];else{var z=L[H-1];H%R?6<R&&H%R==4&&(z=s[z>>>24]<<24|s[z>>>16&255]<<16|s[z>>>8&255]<<8|s[255&z]):(z=s[(z=z<<8|z>>>24)>>>24]<<24|s[z>>>16&255]<<16|s[z>>>8&255]<<8|s[255&z],z^=j[H/R|0]<<24),L[H]=L[H-R]^z}for(Y=this._invKeySchedule=[],R=0;R<D;R++)H=D-R,z=R%4?L[H]:L[H-4],Y[R]=4>R||4>=H?z:w[s[z>>>24]]^_[s[z>>>16&255]]^I[s[z>>>8&255]]^T[s[255&z]]},encryptBlock:function(Y,R){this._doCryptBlock(Y,R,this._keySchedule,h,d,f,v,s)},decryptBlock:function(Y,R){var D=Y[R+1];Y[R+1]=Y[R+3],Y[R+3]=D,this._doCryptBlock(Y,R,this._invKeySchedule,w,_,I,T,o),D=Y[R+1],Y[R+1]=Y[R+3],Y[R+3]=D},_doCryptBlock:function(Y,R,D,L,H,z,X,W){for(var $=this._nRounds,Te=Y[R]^D[0],Xe=Y[R+1]^D[1],ze=Y[R+2]^D[2],Oe=Y[R+3]^D[3],J=4,ee=1;ee<$;ee++){var be=L[Te>>>24]^H[Xe>>>16&255]^z[ze>>>8&255]^X[255&Oe]^D[J++],we=L[Xe>>>24]^H[ze>>>16&255]^z[Oe>>>8&255]^X[255&Te]^D[J++],ye=L[ze>>>24]^H[Oe>>>16&255]^z[Te>>>8&255]^X[255&Xe]^D[J++];Oe=L[Oe>>>24]^H[Te>>>16&255]^z[Xe>>>8&255]^X[255&ze]^D[J++],Te=be,Xe=we,ze=ye}be=(W[Te>>>24]<<24|W[Xe>>>16&255]<<16|W[ze>>>8&255]<<8|W[255&Oe])^D[J++],we=(W[Xe>>>24]<<24|W[ze>>>16&255]<<16|W[Oe>>>8&255]<<8|W[255&Te])^D[J++],ye=(W[ze>>>24]<<24|W[Oe>>>16&255]<<16|W[Te>>>8&255]<<8|W[255&Xe])^D[J++],Oe=(W[Oe>>>24]<<24|W[Te>>>16&255]<<16|W[Xe>>>8&255]<<8|W[255&ze])^D[J++],Y[R]=be,Y[R+1]=we,Y[R+2]=ye,Y[R+3]=Oe},keySize:8}),e.AES=r._createHelper(Q)}(),function(){function e(m,g){var A=(this._lBlock>>>m^this._rBlock)&g;this._rBlock^=A,this._lBlock^=A<<m}function r(m,g){var A=(this._rBlock>>>m^this._lBlock)&g;this._lBlock^=A,this._rBlock^=A<<m}var h,s=u,o=(h=s.lib).WordArray,d=s.algo,f=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],v=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],w=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],_=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],I=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],T=d.DES=(h=h.BlockCipher).extend({_doReset:function(){for(var m=this._key.words,g=[],A=0;56>A;A++){var y=f[A]-1;g[A]=m[y>>>5]>>>31-y%32&1}for(m=this._subKeys=[],y=0;16>y;y++){var P=m[y]=[],x=w[y];for(A=0;24>A;A++)P[A/6|0]|=g[(v[A]-1+x)%28]<<31-A%6,P[4+(A/6|0)]|=g[28+(v[A+24]-1+x)%28]<<31-A%6;for(P[0]=P[0]<<1|P[0]>>>31,A=1;7>A;A++)P[A]>>>=4*(A-1)+3;P[7]=P[7]<<5|P[7]>>>27}for(g=this._invSubKeys=[],A=0;16>A;A++)g[A]=m[15-A]},encryptBlock:function(m,g){this._doCryptBlock(m,g,this._subKeys)},decryptBlock:function(m,g){this._doCryptBlock(m,g,this._invSubKeys)},_doCryptBlock:function(m,g,A){this._lBlock=m[g],this._rBlock=m[g+1],e.call(this,4,252645135),e.call(this,16,65535),r.call(this,2,858993459),r.call(this,8,16711935),e.call(this,1,1431655765);for(var y=0;16>y;y++){for(var P=A[y],x=this._lBlock,N=this._rBlock,B=0,M=0;8>M;M++)B|=_[M][((N^P[M])&I[M])>>>0];this._lBlock=N,this._rBlock=x^B}A=this._lBlock,this._lBlock=this._rBlock,this._rBlock=A,e.call(this,1,1431655765),r.call(this,8,16711935),r.call(this,2,858993459),e.call(this,16,65535),e.call(this,4,252645135),m[g]=this._lBlock,m[g+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});s.DES=h._createHelper(T),d=d.TripleDES=h.extend({_doReset:function(){var m=this._key.words;this._des1=T.createEncryptor(o.create(m.slice(0,2))),this._des2=T.createEncryptor(o.create(m.slice(2,4))),this._des3=T.createEncryptor(o.create(m.slice(4,6)))},encryptBlock:function(m,g){this._des1.encryptBlock(m,g),this._des2.decryptBlock(m,g),this._des3.encryptBlock(m,g)},decryptBlock:function(m,g){this._des3.decryptBlock(m,g),this._des2.encryptBlock(m,g),this._des1.decryptBlock(m,g)},keySize:6,ivSize:2,blockSize:2}),s.TripleDES=h._createHelper(d)}(),r=u.lib.WordArray,u.enc.Base64={stringify:function(s){var o=s.words,h=s.sigBytes,d=this._map;s.clamp(),s=[];for(var f=0;f<h;f+=3)for(var v=(o[f>>>2]>>>24-f%4*8&255)<<16|(o[f+1>>>2]>>>24-(f+1)%4*8&255)<<8|o[f+2>>>2]>>>24-(f+2)%4*8&255,w=0;4>w&&f+.75*w<h;w++)s.push(d.charAt(v>>>6*(3-w)&63));if(o=d.charAt(64))for(;s.length%4;)s.push(o);return s.join("")},parse:function(s){var o=s.length,h=this._map;(d=h.charAt(64))&&-1!=(d=s.indexOf(d))&&(o=d);for(var d=[],f=0,v=0;v<o;v++)if(v%4){var w=h.indexOf(s.charAt(v-1))<<v%4*2,_=h.indexOf(s.charAt(v))>>>6-v%4*2;d[f>>>2]|=(w|_)<<24-f%4*8,f++}return r.create(d,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function r(T,m,g,A,y,P,x){return((T=T+(m&g|~m&A)+y+x)<<P|T>>>32-P)+m}function s(T,m,g,A,y,P,x){return((T=T+(m&A|g&~A)+y+x)<<P|T>>>32-P)+m}function o(T,m,g,A,y,P,x){return((T=T+(m^g^A)+y+x)<<P|T>>>32-P)+m}function h(T,m,g,A,y,P,x){return((T=T+(g^(m|~A))+y+x)<<P|T>>>32-P)+m}for(var d=u,f=(w=d.lib).WordArray,v=w.Hasher,w=d.algo,_=[],I=0;64>I;I++)_[I]=4294967296*e.abs(e.sin(I+1))|0;w=w.MD5=v.extend({_doReset:function(){this._hash=new f.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(T,m){for(var g=0;16>g;g++)T[A=m+g]=16711935&((y=T[A])<<8|y>>>24)|4278255360&(y<<24|y>>>8);var A,y=T[m+1],P=T[m+2],x=T[m+3],N=T[m+4],B=T[m+5],M=T[m+6],j=T[m+7],Q=T[m+8],Y=T[m+9],R=T[m+10],D=T[m+11],L=T[m+12],H=T[m+13],z=T[m+14],X=T[m+15],W=r(W=(g=this._hash.words)[0],ee=g[1],J=g[2],$=g[3],A=T[m+0],7,_[0]),$=r($,W,ee,J,y,12,_[1]),J=r(J,$,W,ee,P,17,_[2]),ee=r(ee,J,$,W,x,22,_[3]);W=r(W,ee,J,$,N,7,_[4]),$=r($,W,ee,J,B,12,_[5]),J=r(J,$,W,ee,M,17,_[6]),ee=r(ee,J,$,W,j,22,_[7]),W=r(W,ee,J,$,Q,7,_[8]),$=r($,W,ee,J,Y,12,_[9]),J=r(J,$,W,ee,R,17,_[10]),ee=r(ee,J,$,W,D,22,_[11]),W=r(W,ee,J,$,L,7,_[12]),$=r($,W,ee,J,H,12,_[13]),J=r(J,$,W,ee,z,17,_[14]),W=s(W,ee=r(ee,J,$,W,X,22,_[15]),J,$,y,5,_[16]),$=s($,W,ee,J,M,9,_[17]),J=s(J,$,W,ee,D,14,_[18]),ee=s(ee,J,$,W,A,20,_[19]),W=s(W,ee,J,$,B,5,_[20]),$=s($,W,ee,J,R,9,_[21]),J=s(J,$,W,ee,X,14,_[22]),ee=s(ee,J,$,W,N,20,_[23]),W=s(W,ee,J,$,Y,5,_[24]),$=s($,W,ee,J,z,9,_[25]),J=s(J,$,W,ee,x,14,_[26]),ee=s(ee,J,$,W,Q,20,_[27]),W=s(W,ee,J,$,H,5,_[28]),$=s($,W,ee,J,P,9,_[29]),J=s(J,$,W,ee,j,14,_[30]),W=o(W,ee=s(ee,J,$,W,L,20,_[31]),J,$,B,4,_[32]),$=o($,W,ee,J,Q,11,_[33]),J=o(J,$,W,ee,D,16,_[34]),ee=o(ee,J,$,W,z,23,_[35]),W=o(W,ee,J,$,y,4,_[36]),$=o($,W,ee,J,N,11,_[37]),J=o(J,$,W,ee,j,16,_[38]),ee=o(ee,J,$,W,R,23,_[39]),W=o(W,ee,J,$,H,4,_[40]),$=o($,W,ee,J,A,11,_[41]),J=o(J,$,W,ee,x,16,_[42]),ee=o(ee,J,$,W,M,23,_[43]),W=o(W,ee,J,$,Y,4,_[44]),$=o($,W,ee,J,L,11,_[45]),J=o(J,$,W,ee,X,16,_[46]),W=h(W,ee=o(ee,J,$,W,P,23,_[47]),J,$,A,6,_[48]),$=h($,W,ee,J,j,10,_[49]),J=h(J,$,W,ee,z,15,_[50]),ee=h(ee,J,$,W,B,21,_[51]),W=h(W,ee,J,$,L,6,_[52]),$=h($,W,ee,J,x,10,_[53]),J=h(J,$,W,ee,R,15,_[54]),ee=h(ee,J,$,W,y,21,_[55]),W=h(W,ee,J,$,Q,6,_[56]),$=h($,W,ee,J,X,10,_[57]),J=h(J,$,W,ee,M,15,_[58]),ee=h(ee,J,$,W,H,21,_[59]),W=h(W,ee,J,$,N,6,_[60]),$=h($,W,ee,J,D,10,_[61]),J=h(J,$,W,ee,P,15,_[62]),ee=h(ee,J,$,W,Y,21,_[63]),g[0]=g[0]+W|0,g[1]=g[1]+ee|0,g[2]=g[2]+J|0,g[3]=g[3]+$|0},_doFinalize:function(){var T=this._data,m=T.words,g=8*this._nDataBytes,A=8*T.sigBytes;m[A>>>5]|=128<<24-A%32;var y=e.floor(g/4294967296);for(m[15+(A+64>>>9<<4)]=16711935&(y<<8|y>>>24)|4278255360&(y<<24|y>>>8),m[14+(A+64>>>9<<4)]=16711935&(g<<8|g>>>24)|4278255360&(g<<24|g>>>8),T.sigBytes=4*(m.length+1),this._process(),m=(T=this._hash).words,g=0;4>g;g++)m[g]=16711935&((A=m[g])<<8|A>>>24)|4278255360&(A<<24|A>>>8);return T},clone:function(){var T=v.clone.call(this);return T._hash=this._hash.clone(),T}}),d.MD5=v._createHelper(w),d.HmacMD5=v._createHmacHelper(w)}(Math),function(){var e=u,r=(h=e.lib).WordArray,s=h.Hasher,o=[],h=e.algo.SHA1=s.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(d,f){for(var v=this._hash.words,w=v[0],_=v[1],I=v[2],T=v[3],m=v[4],g=0;80>g;g++){if(16>g)o[g]=0|d[f+g];else{var A=o[g-3]^o[g-8]^o[g-14]^o[g-16];o[g]=A<<1|A>>>31}A=(w<<5|w>>>27)+m+o[g],A=20>g?A+(1518500249+(_&I|~_&T)):40>g?A+(1859775393+(_^I^T)):60>g?A+((_&I|_&T|I&T)-1894007588):A+((_^I^T)-899497514),m=T,T=I,I=_<<30|_>>>2,_=w,w=A}v[0]=v[0]+w|0,v[1]=v[1]+_|0,v[2]=v[2]+I|0,v[3]=v[3]+T|0,v[4]=v[4]+m|0},_doFinalize:function(){var d=this._data,f=d.words,v=8*this._nDataBytes,w=8*d.sigBytes;return f[w>>>5]|=128<<24-w%32,f[14+(w+64>>>9<<4)]=Math.floor(v/4294967296),f[15+(w+64>>>9<<4)]=v,d.sigBytes=4*f.length,this._process(),this._hash},clone:function(){var d=s.clone.call(this);return d._hash=this._hash.clone(),d}});e.SHA1=s._createHelper(h),e.HmacSHA1=s._createHmacHelper(h)}(),function(e){for(var r=u,s=(g=r.lib).WordArray,o=g.Hasher,g=r.algo,h=[],d=[],f=function(y){return 4294967296*(y-(0|y))|0},v=2,w=0;64>w;){var _;e:{for(var I=e.sqrt(_=v),T=2;T<=I;T++)if(!(_%T)){_=!1;break e}_=!0}_&&(8>w&&(h[w]=f(e.pow(v,.5))),d[w]=f(e.pow(v,1/3)),w++),v++}var m=[];g=g.SHA256=o.extend({_doReset:function(){this._hash=new s.init(h.slice(0))},_doProcessBlock:function(A,y){for(var P=this._hash.words,x=P[0],N=P[1],B=P[2],M=P[3],j=P[4],Q=P[5],Y=P[6],R=P[7],D=0;64>D;D++){if(16>D)m[D]=0|A[y+D];else{var L=m[D-15],H=m[D-2];m[D]=((L<<25|L>>>7)^(L<<14|L>>>18)^L>>>3)+m[D-7]+((H<<15|H>>>17)^(H<<13|H>>>19)^H>>>10)+m[D-16]}L=R+((j<<26|j>>>6)^(j<<21|j>>>11)^(j<<7|j>>>25))+(j&Q^~j&Y)+d[D]+m[D],H=((x<<30|x>>>2)^(x<<19|x>>>13)^(x<<10|x>>>22))+(x&N^x&B^N&B),R=Y,Y=Q,Q=j,j=M+L|0,M=B,B=N,N=x,x=L+H|0}P[0]=P[0]+x|0,P[1]=P[1]+N|0,P[2]=P[2]+B|0,P[3]=P[3]+M|0,P[4]=P[4]+j|0,P[5]=P[5]+Q|0,P[6]=P[6]+Y|0,P[7]=P[7]+R|0},_doFinalize:function(){var A=this._data,y=A.words,P=8*this._nDataBytes,x=8*A.sigBytes;return y[x>>>5]|=128<<24-x%32,y[14+(x+64>>>9<<4)]=e.floor(P/4294967296),y[15+(x+64>>>9<<4)]=P,A.sigBytes=4*y.length,this._process(),this._hash},clone:function(){var A=o.clone.call(this);return A._hash=this._hash.clone(),A}}),r.SHA256=o._createHelper(g),r.HmacSHA256=o._createHmacHelper(g)}(Math),function(){var e=u,r=e.lib.WordArray,s=(o=e.algo).SHA256,o=o.SHA224=s.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var h=s._doFinalize.call(this);return h.sigBytes-=4,h}});e.SHA224=s._createHelper(o),e.HmacSHA224=s._createHmacHelper(o)}(),function(){function e(){return o.create.apply(o,arguments)}for(var r=u,s=r.lib.Hasher,o=(d=r.x64).Word,h=d.WordArray,d=r.algo,f=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],v=[],w=0;80>w;w++)v[w]=e();d=d.SHA512=s.extend({_doReset:function(){this._hash=new h.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(_,I){for(var N,T=(N=this._hash.words)[0],m=N[1],g=N[2],A=N[3],y=N[4],P=N[5],x=N[6],B=T.high,M=T.low,j=m.high,Q=m.low,Y=g.high,R=g.low,D=A.high,L=A.low,H=y.high,z=y.low,X=P.high,W=P.low,$=x.high,J=x.low,ee=(N=N[7]).high,be=N.low,we=B,ye=M,Oe=j,Te=Q,Xe=Y,ze=R,ci=D,Bt=L,yt=H,Et=z,Rt=X,Ue=W,lt=$,et=J,at=ee,Ct=be,$e=0;80>$e;$e++){var bi=v[$e];if(16>$e)var kt=bi.high=0|_[I+2*$e],qe=bi.low=0|_[I+2*$e+1];else{kt=((qe=(kt=v[$e-15]).high)>>>1|(ti=kt.low)<<31)^(qe>>>8|ti<<24)^qe>>>7;var ti=(ti>>>1|qe<<31)^(ti>>>8|qe<<24)^(ti>>>7|qe<<25),Ii=((qe=(Ii=v[$e-2]).high)>>>19|(Ze=Ii.low)<<13)^(qe<<3|Ze>>>29)^qe>>>6,Ze=(Ze>>>19|qe<<13)^(Ze<<3|qe>>>29)^(Ze>>>6|qe<<26);bi.high=kt=(kt=(kt=kt+(fn=(qe=v[$e-7]).high)+((qe=ti+qe.low)>>>0<ti>>>0?1:0))+Ii+((qe+=Ze)>>>0<Ze>>>0?1:0))+(ii=(mi=v[$e-16]).high)+((qe+=mi=mi.low)>>>0<mi>>>0?1:0),bi.low=qe}var fn=yt&Rt^~yt&lt,mi=Et&Ue^~Et&et,c0=(bi=we&Oe^we&Xe^Oe&Xe,ye&Te^ye&ze^Te&ze),u0=(Ze=f[$e]).high,jo=Ze.low,ii=at+((yt>>>14|Et<<18)^(yt>>>18|Et<<14)^(yt<<23|Et>>>9))+((Ze=Ct+((Et>>>14|yt<<18)^(Et>>>18|yt<<14)^(Et<<23|yt>>>9)))>>>0<Ct>>>0?1:0);at=lt,Ct=et,lt=Rt,et=Ue,Rt=yt,Ue=Et,yt=ci+(ii=(ii=(ii=ii+fn+((Ze+=mi)>>>0<mi>>>0?1:0))+u0+((Ze+=jo)>>>0<jo>>>0?1:0))+kt+((Ze+=qe)>>>0<qe>>>0?1:0))+((Et=Bt+Ze|0)>>>0<Bt>>>0?1:0)|0,ci=Xe,Bt=ze,Xe=Oe,ze=Te,Oe=we,Te=ye,we=ii+(bi=(ti=(we>>>28|ye<<4)^(we<<30|ye>>>2)^(we<<25|ye>>>7))+bi+((qe=(Ii=(ye>>>28|we<<4)^(ye<<30|we>>>2)^(ye<<25|we>>>7))+c0)>>>0<Ii>>>0?1:0))+((ye=Ze+qe|0)>>>0<Ze>>>0?1:0)|0}M=T.low=M+ye,T.high=B+we+(M>>>0<ye>>>0?1:0),Q=m.low=Q+Te,m.high=j+Oe+(Q>>>0<Te>>>0?1:0),R=g.low=R+ze,g.high=Y+Xe+(R>>>0<ze>>>0?1:0),L=A.low=L+Bt,A.high=D+ci+(L>>>0<Bt>>>0?1:0),z=y.low=z+Et,y.high=H+yt+(z>>>0<Et>>>0?1:0),W=P.low=W+Ue,P.high=X+Rt+(W>>>0<Ue>>>0?1:0),J=x.low=J+et,x.high=$+lt+(J>>>0<et>>>0?1:0),be=N.low=be+Ct,N.high=ee+at+(be>>>0<Ct>>>0?1:0)},_doFinalize:function(){var _=this._data,I=_.words,T=8*this._nDataBytes,m=8*_.sigBytes;return I[m>>>5]|=128<<24-m%32,I[30+(m+128>>>10<<5)]=Math.floor(T/4294967296),I[31+(m+128>>>10<<5)]=T,_.sigBytes=4*I.length,this._process(),this._hash.toX32()},clone:function(){var _=s.clone.call(this);return _._hash=this._hash.clone(),_},blockSize:32}),r.SHA512=s._createHelper(d),r.HmacSHA512=s._createHmacHelper(d)}(),function(){var e=u,r=(h=e.x64).Word,s=h.WordArray,o=(h=e.algo).SHA512,h=h.SHA384=o.extend({_doReset:function(){this._hash=new s.init([new r.init(3418070365,3238371032),new r.init(1654270250,914150663),new r.init(2438529370,812702999),new r.init(355462360,4144912697),new r.init(1731405415,4290775857),new r.init(2394180231,1750603025),new r.init(3675008525,1694076839),new r.init(1203062813,3204075428)])},_doFinalize:function(){var d=o._doFinalize.call(this);return d.sigBytes-=16,d}});e.SHA384=o._createHelper(h),e.HmacSHA384=o._createHmacHelper(h)}(),function(){var e=u,r=(_=e.lib).WordArray,s=_.Hasher,_=e.algo,o=r.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),h=r.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),d=r.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),f=r.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),v=r.create([0,1518500249,1859775393,2400959708,2840853838]),w=r.create([1352829926,1548603684,1836072691,2053994217,0]);_=_.RIPEMD160=s.extend({_doReset:function(){this._hash=r.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(I,T){for(var m=0;16>m;m++)I[g=T+m]=16711935&((A=I[g])<<8|A>>>24)|4278255360&(A<<24|A>>>8);var g,M,j,Q,Y,R,D,L,H,z,X,W,A=v.words,y=w.words,P=o.words,x=h.words,N=d.words,B=f.words;for(D=M=(g=this._hash.words)[0],L=j=g[1],H=Q=g[2],z=Y=g[3],X=R=g[4],m=0;80>m;m+=1)W=M+I[T+P[m]]|0,W=16>m?W+((j^Q^Y)+A[0]):32>m?W+((j&Q|~j&Y)+A[1]):48>m?W+(((j|~Q)^Y)+A[2]):64>m?W+((j&Y|Q&~Y)+A[3]):W+((j^(Q|~Y))+A[4]),W=(W=(W|=0)<<N[m]|W>>>32-N[m])+R|0,M=R,R=Y,Y=Q<<10|Q>>>22,Q=j,j=W,W=D+I[T+x[m]]|0,W=16>m?W+((L^(H|~z))+y[0]):32>m?W+((L&z|H&~z)+y[1]):48>m?W+(((L|~H)^z)+y[2]):64>m?W+((L&H|~L&z)+y[3]):W+((L^H^z)+y[4]),W=(W=(W|=0)<<B[m]|W>>>32-B[m])+X|0,D=X,X=z,z=H<<10|H>>>22,H=L,L=W;W=g[1]+Q+z|0,g[1]=g[2]+Y+X|0,g[2]=g[3]+R+D|0,g[3]=g[4]+M+L|0,g[4]=g[0]+j+H|0,g[0]=W},_doFinalize:function(){var I=this._data,T=I.words,m=8*this._nDataBytes,g=8*I.sigBytes;for(T[g>>>5]|=128<<24-g%32,T[14+(g+64>>>9<<4)]=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8),I.sigBytes=4*(T.length+1),this._process(),T=(I=this._hash).words,m=0;5>m;m++)T[m]=16711935&((g=T[m])<<8|g>>>24)|4278255360&(g<<24|g>>>8);return I},clone:function(){var I=s.clone.call(this);return I._hash=this._hash.clone(),I}}),e.RIPEMD160=s._createHelper(_),e.HmacRIPEMD160=s._createHmacHelper(_)}(Math),function(){var r=u.enc.Utf8;u.algo.HMAC=u.lib.Base.extend({init:function(s,o){s=this._hasher=new s.init,"string"==typeof o&&(o=r.parse(o));var h=s.blockSize,d=4*h;o.sigBytes>d&&(o=s.finalize(o)),o.clamp();for(var f=this._oKey=o.clone(),v=this._iKey=o.clone(),w=f.words,_=v.words,I=0;I<h;I++)w[I]^=1549556828,_[I]^=909522486;f.sigBytes=v.sigBytes=d,this.reset()},reset:function(){var s=this._hasher;s.reset(),s.update(this._iKey)},update:function(s){return this._hasher.update(s),this},finalize:function(s){var o=this._hasher;return s=o.finalize(s),o.reset(),o.finalize(this._oKey.clone().concat(s))}})}(),function(){var o,e=u,r=(o=e.lib).Base,s=o.WordArray,h=(o=e.algo).HMAC,d=o.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:o.SHA1,iterations:1}),init:function(f){this.cfg=this.cfg.extend(f)},compute:function(f,v){for(var w=h.create((A=this.cfg).hasher,f),_=s.create(),I=s.create([1]),T=_.words,m=I.words,g=A.keySize,A=A.iterations;T.length<g;){var y=w.update(v).finalize(I);w.reset();for(var P=y.words,x=P.length,N=y,B=1;B<A;B++){N=w.finalize(N),w.reset();for(var M=N.words,j=0;j<x;j++)P[j]^=M[j]}_.concat(y),m[0]++}return _.sigBytes=4*g,_}});e.PBKDF2=function(f,v,w){return d.create(w).compute(f,v)}}();var k,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function C(e){var r,s,o="";for(r=0;r+3<=e.length;r+=3)s=parseInt(e.substring(r,r+3),16),o+=p.charAt(s>>6)+p.charAt(63&s);for(r+1==e.length?(s=parseInt(e.substring(r,r+1),16),o+=p.charAt(s<<2)):r+2==e.length&&(s=parseInt(e.substring(r,r+2),16),o+=p.charAt(s>>2)+p.charAt((3&s)<<4));(3&o.length)>0;)o+="=";return o}function b(e){var s,h,d,r="",o=0;for(s=0;s<e.length&&"="!=e.charAt(s);++s)!((d=p.indexOf(e.charAt(s)))<0)&&(0==o?(r+=me(d>>2),h=3&d,o=1):1==o?(r+=me(h<<2|d>>4),h=15&d,o=2):2==o?(r+=me(h),r+=me(d>>2),h=3&d,o=3):(r+=me(h<<2|d>>4),r+=me(15&d),o=0));return 1==o&&(r+=me(h<<2)),r}function E(e){var s,r=b(e),o=new Array;for(s=0;2*s<r.length;++s)o[s]=parseInt(r.substring(2*s,2*s+2),16);return o}function F(e,r,s){null!=e&&("number"==typeof e?this.fromNumber(e,r,s):this.fromString(e,null==r&&"string"!=typeof e?256:r))}function O(){return new F(null)}"Microsoft Internet Explorer"==i.appName?(F.prototype.am=function se(e,r,s,o,h,d){for(var f=32767&r,v=r>>15;--d>=0;){var w=32767&this[e],_=this[e++]>>15,I=v*w+_*f;h=((w=f*w+((32767&I)<<15)+s[o]+(1073741823&h))>>>30)+(I>>>15)+v*_+(h>>>30),s[o++]=1073741823&w}return h},k=30):"Netscape"!=i.appName?(F.prototype.am=function G(e,r,s,o,h,d){for(;--d>=0;){var f=r*this[e++]+s[o]+h;h=Math.floor(f/67108864),s[o++]=67108863&f}return h},k=26):(F.prototype.am=function ce(e,r,s,o,h,d){for(var f=16383&r,v=r>>14;--d>=0;){var w=16383&this[e],_=this[e++]>>14,I=v*w+_*f;h=((w=f*w+((16383&I)<<14)+s[o]+h)>>28)+(I>>14)+v*_,s[o++]=268435455&w}return h},k=28),F.prototype.DB=k,F.prototype.DM=(1<<k)-1,F.prototype.DV=1<<k,F.prototype.FV=Math.pow(2,52),F.prototype.F1=52-k,F.prototype.F2=2*k-52;var fe,pe,he=new Array;for(fe=48,pe=0;pe<=9;++pe)he[fe++]=pe;for(fe=97,pe=10;pe<36;++pe)he[fe++]=pe;for(fe=65,pe=10;pe<36;++pe)he[fe++]=pe;function me(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function Ce(e,r){return he[e.charCodeAt(r)]??-1}function Ge(e){var r=O();return r.fromInt(e),r}function vi(e){var s,r=1;return 0!=(s=e>>>16)&&(e=s,r+=16),0!=(s=e>>8)&&(e=s,r+=8),0!=(s=e>>4)&&(e=s,r+=4),0!=(s=e>>2)&&(e=s,r+=2),0!=(s=e>>1)&&(e=s,r+=1),r}function qt(e){this.m=e}function ai(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function vf(e,r){return e&r}function ss(e,r){return e|r}function bo(e,r){return e^r}function yo(e,r){return e&~r}function xf(e){if(0==e)return-1;var r=0;return 65535&e||(e>>=16,r+=16),255&e||(e>>=8,r+=8),15&e||(e>>=4,r+=4),3&e||(e>>=2,r+=2),1&e||++r,r}function Cf(e){for(var r=0;0!=e;)e&=e-1,++r;return r}function un(){}function So(e){return e}function Vi(e){this.r2=O(),this.q3=O(),F.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}qt.prototype.convert=function $n(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},qt.prototype.revert=function Ai(e){return e},qt.prototype.reduce=function rs(e){e.divRemTo(this.m,null,e)},qt.prototype.mulTo=function on(e,r,s){e.multiplyTo(r,s),this.reduce(s)},qt.prototype.sqrTo=function Pi(e,r){e.squareTo(r),this.reduce(r)},ai.prototype.convert=function Gn(e){var r=O();return e.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),e.s<0&&r.compareTo(F.ZERO)>0&&this.m.subTo(r,r),r},ai.prototype.revert=function Jn(e){var r=O();return e.copyTo(r),this.reduce(r),r},ai.prototype.reduce=function _t(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var r=0;r<this.m.t;++r){var s=32767&e[r],o=s*this.mpl+((s*this.mph+(e[r]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[s=r+this.m.t]+=this.m.am(0,o,e,r,0,this.m.t);e[s]>=e.DV;)e[s]-=e.DV,e[++s]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},ai.prototype.mulTo=function Hi(e,r,s){e.multiplyTo(r,s),this.reduce(s)},ai.prototype.sqrTo=function gi(e,r){e.squareTo(r),this.reduce(r)},F.prototype.copyTo=function Qe(e){for(var r=this.t-1;r>=0;--r)e[r]=this[r];e.t=this.t,e.s=this.s},F.prototype.fromInt=function Ke(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},F.prototype.fromString=function Pe(e,r){var s;if(16==r)s=4;else if(8==r)s=3;else if(256==r)s=8;else if(2==r)s=1;else if(32==r)s=5;else{if(4!=r)return void this.fromRadix(e,r);s=2}this.t=0,this.s=0;for(var o=e.length,h=!1,d=0;--o>=0;){var f=8==s?255&e[o]:Ce(e,o);f<0?"-"==e.charAt(o)&&(h=!0):(h=!1,0==d?this[this.t++]=f:d+s>this.DB?(this[this.t-1]|=(f&(1<<this.DB-d)-1)<<d,this[this.t++]=f>>this.DB-d):this[this.t-1]|=f<<d,(d+=s)>=this.DB&&(d-=this.DB))}8==s&&128&e[0]&&(this.s=-1,d>0&&(this[this.t-1]|=(1<<this.DB-d)-1<<d)),this.clamp(),h&&F.ZERO.subTo(this,this)},F.prototype.clamp=function mt(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},F.prototype.dlShiftTo=function Kn(e,r){var s;for(s=this.t-1;s>=0;--s)r[s+e]=this[s];for(s=e-1;s>=0;--s)r[s]=0;r.t=this.t+e,r.s=this.s},F.prototype.drShiftTo=function ji(e,r){for(var s=e;s<this.t;++s)r[s-e]=this[s];r.t=Math.max(this.t-e,0),r.s=this.s},F.prototype.lShiftTo=function rn(e,r){var v,s=e%this.DB,o=this.DB-s,h=(1<<o)-1,d=Math.floor(e/this.DB),f=this.s<<s&this.DM;for(v=this.t-1;v>=0;--v)r[v+d+1]=this[v]>>o|f,f=(this[v]&h)<<s;for(v=d-1;v>=0;--v)r[v]=0;r[d]=f,r.t=this.t+d+1,r.s=this.s,r.clamp()},F.prototype.rShiftTo=function Wn(e,r){r.s=this.s;var s=Math.floor(e/this.DB);if(s>=this.t)r.t=0;else{var o=e%this.DB,h=this.DB-o,d=(1<<o)-1;r[0]=this[s]>>o;for(var f=s+1;f<this.t;++f)r[f-s-1]|=(this[f]&d)<<h,r[f-s]=this[f]>>o;o>0&&(r[this.t-s-1]|=(this.s&d)<<h),r.t=this.t-s,r.clamp()}},F.prototype.subTo=function Li(e,r){for(var s=0,o=0,h=Math.min(e.t,this.t);s<h;)o+=this[s]-e[s],r[s++]=o&this.DM,o>>=this.DB;if(e.t<this.t){for(o-=e.s;s<this.t;)o+=this[s],r[s++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;s<e.t;)o-=e[s],r[s++]=o&this.DM,o>>=this.DB;o-=e.s}r.s=o<0?-1:0,o<-1?r[s++]=this.DV+o:o>0&&(r[s++]=o),r.t=s,r.clamp()},F.prototype.multiplyTo=function sn(e,r){var s=this.abs(),o=e.abs(),h=s.t;for(r.t=h+o.t;--h>=0;)r[h]=0;for(h=0;h<o.t;++h)r[h+s.t]=s.am(0,o[h],r,h,0,s.t);r.s=0,r.clamp(),this.s!=e.s&&F.ZERO.subTo(r,r)},F.prototype.squareTo=function an(e){for(var r=this.abs(),s=e.t=2*r.t;--s>=0;)e[s]=0;for(s=0;s<r.t-1;++s){var o=r.am(s,r[s],e,2*s,0,1);(e[s+r.t]+=r.am(s+1,2*r[s],e,2*s+1,o,r.t-s-1))>=r.DV&&(e[s+r.t]-=r.DV,e[s+r.t+1]=1)}e.t>0&&(e[e.t-1]+=r.am(s,r[s],e,2*s,0,1)),e.s=0,e.clamp()},F.prototype.divRemTo=function zn(e,r,s){var o=e.abs();if(!(o.t<=0)){var h=this.abs();if(h.t<o.t)return r?.fromInt(0),void(null!=s&&this.copyTo(s));null==s&&(s=O());var d=O(),f=this.s,v=e.s,w=this.DB-vi(o[o.t-1]);w>0?(o.lShiftTo(w,d),h.lShiftTo(w,s)):(o.copyTo(d),h.copyTo(s));var _=d.t,I=d[_-1];if(0!=I){var T=I*(1<<this.F1)+(_>1?d[_-2]>>this.F2:0),m=this.FV/T,g=(1<<this.F1)/T,A=1<<this.F2,y=s.t,P=y-_,x=r??O();for(d.dlShiftTo(P,x),s.compareTo(x)>=0&&(s[s.t++]=1,s.subTo(x,s)),F.ONE.dlShiftTo(_,x),x.subTo(d,d);d.t<_;)d[d.t++]=0;for(;--P>=0;){var N=s[--y]==I?this.DM:Math.floor(s[y]*m+(s[y-1]+A)*g);if((s[y]+=d.am(0,N,s,P,0,_))<N)for(d.dlShiftTo(P,x),s.subTo(x,s);s[y]<--N;)s.subTo(x,s)}null!=r&&(s.drShiftTo(_,r),f!=v&&F.ZERO.subTo(r,r)),s.t=_,s.clamp(),w>0&&s.rShiftTo(w,s),f<0&&F.ZERO.subTo(s,s)}}},F.prototype.invDigit=function cn(){if(this.t<1)return 0;var e=this[0];if(!(1&e))return 0;var r=3&e;return(r=(r=(r=(r=r*(2-(15&e)*r)&15)*(2-(255&e)*r)&255)*(2-((65535&e)*r&65535))&65535)*(2-e*r%this.DV)%this.DV)>0?this.DV-r:-r},F.prototype.isEven=function ke(){return 0==(this.t>0?1&this[0]:this.s)},F.prototype.exp=function He(e,r){if(e>4294967295||e<1)return F.ONE;var s=O(),o=O(),h=r.convert(this),d=vi(e)-1;for(h.copyTo(s);--d>=0;)if(r.sqrTo(s,o),(e&1<<d)>0)r.mulTo(o,h,s);else{var f=s;s=o,o=f}return r.revert(s)},F.prototype.toString=function wt(e){if(this.s<0)return"-"+this.negate().toString(e);var r;if(16==e)r=4;else if(8==e)r=3;else if(2==e)r=1;else if(32==e)r=5;else{if(4!=e)return this.toRadix(e);r=2}var o,s=(1<<r)-1,h=!1,d="",f=this.t,v=this.DB-f*this.DB%r;if(f-- >0)for(v<this.DB&&(o=this[f]>>v)>0&&(h=!0,d=me(o));f>=0;)v<r?(o=(this[f]&(1<<v)-1)<<r-v,o|=this[--f]>>(v+=this.DB-r)):(o=this[f]>>(v-=r)&s,v<=0&&(v+=this.DB,--f)),o>0&&(h=!0),h&&(d+=me(o));return h?d:"0"},F.prototype.negate=function Zt(){var e=O();return F.ZERO.subTo(this,e),e},F.prototype.abs=function Jt(){return this.s<0?this.negate():this},F.prototype.compareTo=function Mi(e){var r=this.s-e.s;if(0!=r)return r;var s=this.t;if(0!=(r=s-e.t))return this.s<0?-r:r;for(;--s>=0;)if(0!=(r=this[s]-e[s]))return r;return 0},F.prototype.bitLength=function nn(){return this.t<=0?0:this.DB*(this.t-1)+vi(this[this.t-1]^this.s&this.DM)},F.prototype.mod=function ns(e){var r=O();return this.abs().divRemTo(e,null,r),this.s<0&&r.compareTo(F.ZERO)>0&&e.subTo(r,r),r},F.prototype.modPowInt=function Ne(e,r){var s;return s=e<256||r.isEven()?new qt(r):new ai(r),this.exp(e,s)},F.ZERO=Ge(0),F.ONE=Ge(1),un.prototype.convert=So,un.prototype.revert=So,un.prototype.mulTo=function Vf(e,r,s){e.multiplyTo(r,s)},un.prototype.sqrTo=function Uf(e,r){e.squareTo(r)},Vi.prototype.convert=function $f(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var r=O();return e.copyTo(r),this.reduce(r),r},Vi.prototype.revert=function Gf(e){return e},Vi.prototype.reduce=function Jf(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},Vi.prototype.mulTo=function Qf(e,r,s){e.multiplyTo(r,s),this.reduce(s)},Vi.prototype.sqrTo=function Xf(e,r){e.squareTo(r),this.reduce(r)};var Yn,Ot,ft,Xt,us,ls,hs,xt=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ip=(1<<26)/xt[xt.length-1];function as(){this.i=0,this.j=0,this.S=new Array}function cs(){!function cp(e){Ot[ft++]^=255&e,Ot[ft++]^=e>>8&255,Ot[ft++]^=e>>16&255,Ot[ft++]^=e>>24&255,ft>=256&&(ft-=256)}((new Date).getTime())}if(F.prototype.chunkSize=function Fi(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},F.prototype.toRadix=function Xn(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var r=this.chunkSize(e),s=Math.pow(e,r),o=Ge(s),h=O(),d=O(),f="";for(this.divRemTo(o,h,d);h.signum()>0;)f=(s+d.intValue()).toString(e).substr(1)+f,h.divRemTo(o,h,d);return d.intValue().toString(e)+f},F.prototype.fromRadix=function Qn(e,r){this.fromInt(0),null==r&&(r=10);for(var s=this.chunkSize(r),o=Math.pow(r,s),h=!1,d=0,f=0,v=0;v<e.length;++v){var w=Ce(e,v);w<0?"-"==e.charAt(v)&&0==this.signum()&&(h=!0):(f=r*f+w,++d>=s&&(this.dMultiply(o),this.dAddOffset(f,0),d=0,f=0))}d>0&&(this.dMultiply(Math.pow(r,d)),this.dAddOffset(f,0)),h&&F.ZERO.subTo(this,this)},F.prototype.fromNumber=function uf(e,r,s){if("number"==typeof r)if(e<2)this.fromInt(1);else for(this.fromNumber(e,s),this.testBit(e-1)||this.bitwiseTo(F.ONE.shiftLeft(e-1),ss,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(r);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(F.ONE.shiftLeft(e-1),this);else{var o=new Array,h=7&e;o.length=1+(e>>3),r.nextBytes(o),h>0?o[0]&=(1<<h)-1:o[0]=0,this.fromString(o,256)}},F.prototype.bitwiseTo=function pf(e,r,s){var o,h,d=Math.min(e.t,this.t);for(o=0;o<d;++o)s[o]=r(this[o],e[o]);if(e.t<this.t){for(h=e.s&this.DM,o=d;o<this.t;++o)s[o]=r(this[o],h);s.t=this.t}else{for(h=this.s&this.DM,o=d;o<e.t;++o)s[o]=r(h,e[o]);s.t=e.t}s.s=r(this.s,e.s),s.clamp()},F.prototype.changeBit=function Ff(e,r){var s=F.ONE.shiftLeft(e);return this.bitwiseTo(s,r,s),s},F.prototype.addTo=function kf(e,r){for(var s=0,o=0,h=Math.min(e.t,this.t);s<h;)o+=this[s]+e[s],r[s++]=o&this.DM,o>>=this.DB;if(e.t<this.t){for(o+=e.s;s<this.t;)o+=this[s],r[s++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;s<e.t;)o+=e[s],r[s++]=o&this.DM,o>>=this.DB;o+=e.s}r.s=o<0?-1:0,o>0?r[s++]=o:o<-1&&(r[s++]=this.DV+o),r.t=s,r.clamp()},F.prototype.dMultiply=function Hf(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},F.prototype.dAddOffset=function qf(e,r){if(0!=e){for(;this.t<=r;)this[this.t++]=0;for(this[r]+=e;this[r]>=this.DV;)this[r]-=this.DV,++r>=this.t&&(this[this.t++]=0),++this[r]}},F.prototype.multiplyLowerTo=function Wf(e,r,s){var h,o=Math.min(this.t+e.t,r);for(s.s=0,s.t=o;o>0;)s[--o]=0;for(h=s.t-this.t;o<h;++o)s[o+this.t]=this.am(0,e[o],s,o,0,this.t);for(h=Math.min(e.t,r);o<h;++o)this.am(0,e[o],s,o,0,r-o);s.clamp()},F.prototype.multiplyUpperTo=function zf(e,r,s){--r;var o=s.t=this.t+e.t-r;for(s.s=0;--o>=0;)s[o]=0;for(o=Math.max(r-this.t,0);o<e.t;++o)s[this.t+o-r]=this.am(r-o,e[o],s,0,0,this.t+o-r);s.clamp(),s.drShiftTo(1,s)},F.prototype.modInt=function ep(e){if(e<=0)return 0;var r=this.DV%e,s=this.s<0?e-1:0;if(this.t>0)if(0==r)s=this[0]%e;else for(var o=this.t-1;o>=0;--o)s=(r*s+this[o])%e;return s},F.prototype.millerRabin=function rp(e){var r=this.subtract(F.ONE),s=r.getLowestSetBit();if(s<=0)return!1;var o=r.shiftRight(s);(e=e+1>>1)>xt.length&&(e=xt.length);for(var h=O(),d=0;d<e;++d){h.fromInt(xt[Math.floor(Math.random()*xt.length)]);var f=h.modPow(o,this);if(0!=f.compareTo(F.ONE)&&0!=f.compareTo(r)){for(var v=1;v++<s&&0!=f.compareTo(r);)if(0==(f=f.modPowInt(2,this)).compareTo(F.ONE))return!1;if(0!=f.compareTo(r))return!1}}return!0},F.prototype.clone=function it(){var e=O();return this.copyTo(e),e},F.prototype.intValue=function De(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},F.prototype.byteValue=function qi(){return 0==this.t?this.s:this[0]<<24>>24},F.prototype.shortValue=function Je(){return 0==this.t?this.s:this[0]<<16>>16},F.prototype.signum=function Vt(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},F.prototype.toByteArray=function lf(){var e=this.t,r=new Array;r[0]=this.s;var o,s=this.DB-e*this.DB%8,h=0;if(e-- >0)for(s<this.DB&&(o=this[e]>>s)!=(this.s&this.DM)>>s&&(r[h++]=o|this.s<<this.DB-s);e>=0;)s<8?(o=(this[e]&(1<<s)-1)<<8-s,o|=this[--e]>>(s+=this.DB-8)):(o=this[e]>>(s-=8)&255,s<=0&&(s+=this.DB,--e)),128&o&&(o|=-256),0==h&&(128&this.s)!=(128&o)&&++h,(h>0||o!=this.s)&&(r[h++]=o);return r},F.prototype.equals=function hf(e){return 0==this.compareTo(e)},F.prototype.min=function df(e){return this.compareTo(e)<0?this:e},F.prototype.max=function ff(e){return this.compareTo(e)>0?this:e},F.prototype.and=function gf(e){var r=O();return this.bitwiseTo(e,vf,r),r},F.prototype.or=function mf(e){var r=O();return this.bitwiseTo(e,ss,r),r},F.prototype.xor=function bf(e){var r=O();return this.bitwiseTo(e,bo,r),r},F.prototype.andNot=function yf(e){var r=O();return this.bitwiseTo(e,yo,r),r},F.prototype.not=function Sf(){for(var e=O(),r=0;r<this.t;++r)e[r]=this.DM&~this[r];return e.t=this.t,e.s=~this.s,e},F.prototype.shiftLeft=function wf(e){var r=O();return e<0?this.rShiftTo(-e,r):this.lShiftTo(e,r),r},F.prototype.shiftRight=function _f(e){var r=O();return e<0?this.lShiftTo(-e,r):this.rShiftTo(e,r),r},F.prototype.getLowestSetBit=function Ef(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+xf(this[e]);return this.s<0?this.t*this.DB:-1},F.prototype.bitCount=function Af(){for(var e=0,r=this.s&this.DM,s=0;s<this.t;++s)e+=Cf(this[s]^r);return e},F.prototype.testBit=function Pf(e){var r=Math.floor(e/this.DB);return r>=this.t?0!=this.s:!!(this[r]&1<<e%this.DB)},F.prototype.setBit=function If(e){return this.changeBit(e,ss)},F.prototype.clearBit=function Tf(e){return this.changeBit(e,yo)},F.prototype.flipBit=function Rf(e){return this.changeBit(e,bo)},F.prototype.add=function Nf(e){var r=O();return this.addTo(e,r),r},F.prototype.subtract=function Df(e){var r=O();return this.subTo(e,r),r},F.prototype.multiply=function Of(e){var r=O();return this.multiplyTo(e,r),r},F.prototype.divide=function Mf(e){var r=O();return this.divRemTo(e,r,null),r},F.prototype.remainder=function jf(e){var r=O();return this.divRemTo(e,null,r),r},F.prototype.divideAndRemainder=function Lf(e){var r=O(),s=O();return this.divRemTo(e,r,s),new Array(r,s)},F.prototype.modPow=function Yf(e,r){var o,d,s=e.bitLength(),h=Ge(1);if(s<=0)return h;o=s<18?1:s<48?3:s<144?4:s<768?5:6,d=s<8?new qt(r):r.isEven()?new Vi(r):new ai(r);var f=new Array,v=3,w=o-1,_=(1<<o)-1;if(f[1]=d.convert(this),o>1){var I=O();for(d.sqrTo(f[1],I);v<=_;)f[v]=O(),d.mulTo(I,f[v-2],f[v]),v+=2}var m,y,T=e.t-1,g=!0,A=O();for(s=vi(e[T])-1;T>=0;){for(s>=w?m=e[T]>>s-w&_:(m=(e[T]&(1<<s+1)-1)<<w-s,T>0&&(m|=e[T-1]>>this.DB+s-w)),v=o;!(1&m);)m>>=1,--v;if((s-=v)<0&&(s+=this.DB,--T),g)f[m].copyTo(h),g=!1;else{for(;v>1;)d.sqrTo(h,A),d.sqrTo(A,h),v-=2;v>0?d.sqrTo(h,A):(y=h,h=A,A=y),d.mulTo(A,f[m],h)}for(;T>=0&&!(e[T]&1<<s);)d.sqrTo(h,A),y=h,h=A,A=y,--s<0&&(s=this.DB-1,--T)}return d.revert(h)},F.prototype.modInverse=function tp(e){var r=e.isEven();if(this.isEven()&&r||0==e.signum())return F.ZERO;for(var s=e.clone(),o=this.clone(),h=Ge(1),d=Ge(0),f=Ge(0),v=Ge(1);0!=s.signum();){for(;s.isEven();)s.rShiftTo(1,s),r?((!h.isEven()||!d.isEven())&&(h.addTo(this,h),d.subTo(e,d)),h.rShiftTo(1,h)):d.isEven()||d.subTo(e,d),d.rShiftTo(1,d);for(;o.isEven();)o.rShiftTo(1,o),r?((!f.isEven()||!v.isEven())&&(f.addTo(this,f),v.subTo(e,v)),f.rShiftTo(1,f)):v.isEven()||v.subTo(e,v),v.rShiftTo(1,v);s.compareTo(o)>=0?(s.subTo(o,s),r&&h.subTo(f,h),d.subTo(v,d)):(o.subTo(s,o),r&&f.subTo(h,f),v.subTo(d,v))}return 0!=o.compareTo(F.ONE)?F.ZERO:v.compareTo(e)>=0?v.subtract(e):v.signum()<0?(v.addTo(e,v),v.signum()<0?v.add(e):v):v},F.prototype.pow=function Kf(e){return this.exp(e,new un)},F.prototype.gcd=function Zf(e){var r=this.s<0?this.negate():this.clone(),s=e.s<0?e.negate():e.clone();if(r.compareTo(s)<0){var o=r;r=s,s=o}var h=r.getLowestSetBit(),d=s.getLowestSetBit();if(d<0)return r;for(h<d&&(d=h),d>0&&(r.rShiftTo(d,r),s.rShiftTo(d,s));r.signum()>0;)(h=r.getLowestSetBit())>0&&r.rShiftTo(h,r),(h=s.getLowestSetBit())>0&&s.rShiftTo(h,s),r.compareTo(s)>=0?(r.subTo(s,r),r.rShiftTo(1,r)):(s.subTo(r,s),s.rShiftTo(1,s));return d>0&&s.lShiftTo(d,s),s},F.prototype.isProbablePrime=function np(e){var r,s=this.abs();if(1==s.t&&s[0]<=xt[xt.length-1]){for(r=0;r<xt.length;++r)if(s[0]==xt[r])return!0;return!1}if(s.isEven())return!1;for(r=1;r<xt.length;){for(var o=xt[r],h=r+1;h<xt.length&&o<ip;)o*=xt[h++];for(o=s.modInt(o);r<h;)if(o%xt[r++]==0)return!1}return s.millerRabin(e)},F.prototype.square=function Bf(){var e=O();return this.squareTo(e),e},as.prototype.init=function sp(e){var r,s,o;for(r=0;r<256;++r)this.S[r]=r;for(s=0,r=0;r<256;++r)o=this.S[r],this.S[r]=this.S[s=s+this.S[r]+e[r%e.length]&255],this.S[s]=o;this.i=0,this.j=0},as.prototype.next=function ap(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]},null==Ot){if(Ot=new Array,ft=0,void 0!==n&&(void 0!==n.crypto||void 0!==n.msCrypto))if((us=n.crypto||n.msCrypto).getRandomValues)for(ls=new Uint8Array(32),us.getRandomValues(ls),Xt=0;Xt<32;++Xt)Ot[ft++]=ls[Xt];else if("Netscape"==i.appName&&i.appVersion<"5")for(hs=n.crypto.random(32),Xt=0;Xt<hs.length;++Xt)Ot[ft++]=255&hs.charCodeAt(Xt);for(;ft<256;)Xt=Math.floor(65536*Math.random()),Ot[ft++]=Xt>>>8,Ot[ft++]=255&Xt;ft=0,cs()}function up(){if(null==Yn){for(cs(),(Yn=function op(){return new as}()).init(Ot),ft=0;ft<Ot.length;++ft)Ot[ft]=0;ft=0}return Yn.next()}function Ui(){}function Ft(e,r){return new F(e,r)}function Ee(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function ht(e,r){this.x=r,this.q=e}function Me(e,r,s,o){this.curve=e,this.x=r,this.y=s,this.z=null==o?F.ONE:o,this.zinv=null}function oi(e,r,s){this.q=e,this.a=this.fromBigInteger(r),this.b=this.fromBigInteger(s),this.infinity=new Me(this,null,null)}Ui.prototype.nextBytes=function lp(e){var r;for(r=0;r<e.length;++r)e[r]=up()},Ee.prototype.doPublic=function dp(e){return e.modPowInt(this.e,this.n)},Ee.prototype.setPublic=function hp(e,r){if(this.isPublic=!0,this.isPrivate=!1,"string"!=typeof e)this.n=e,this.e=r;else{if(!(null!=e&&null!=r&&e.length>0&&r.length>0))throw"Invalid RSA public key";this.n=Ft(e,16),this.e=parseInt(r,16)}},Ee.prototype.type="RSA",Ee.prototype.doPrivate=function gp(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var r=e.mod(this.p).modPow(this.dmp1,this.p),s=e.mod(this.q).modPow(this.dmq1,this.q);r.compareTo(s)<0;)r=r.add(this.p);return r.subtract(s).multiply(this.coeff).mod(this.p).multiply(this.q).add(s)},Ee.prototype.setPrivate=function fp(e,r,s){if(this.isPrivate=!0,"string"!=typeof e)this.n=e,this.e=r,this.d=s;else{if(!(null!=e&&null!=r&&e.length>0&&r.length>0))throw"Invalid RSA private key";this.n=Ft(e,16),this.e=parseInt(r,16),this.d=Ft(s,16)}},Ee.prototype.setPrivateEx=function pp(e,r,s,o,h,d,f,v){if(this.isPrivate=!0,this.isPublic=!1,null==e)throw"RSASetPrivateEx N == null";if(null==r)throw"RSASetPrivateEx E == null";if(0==e.length)throw"RSASetPrivateEx N.length == 0";if(0==r.length)throw"RSASetPrivateEx E.length == 0";if(!(null!=e&&null!=r&&e.length>0&&r.length>0))throw"Invalid RSA private key in RSASetPrivateEx";this.n=Ft(e,16),this.e=parseInt(r,16),this.d=Ft(s,16),this.p=Ft(o,16),this.q=Ft(h,16),this.dmp1=Ft(d,16),this.dmq1=Ft(f,16),this.coeff=Ft(v,16)},Ee.prototype.generate=function vp(e,r){var s=new Ui,o=e>>1;this.e=parseInt(r,16);for(var h=new F(r,16),d=e/2-100,f=F.ONE.shiftLeft(d);;){for(;this.p=new F(e-o,1,s),0!=this.p.subtract(F.ONE).gcd(h).compareTo(F.ONE)||!this.p.isProbablePrime(10););for(;this.q=new F(o,1,s),0!=this.q.subtract(F.ONE).gcd(h).compareTo(F.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var v=this.p;this.p=this.q,this.q=v}var w=this.q.subtract(this.p).abs();if(!(w.bitLength()<d||w.compareTo(f)<=0)){var _=this.p.subtract(F.ONE),I=this.q.subtract(F.ONE),T=_.multiply(I);if(0==T.gcd(h).compareTo(F.ONE)&&(this.n=this.p.multiply(this.q),this.n.bitLength()==e)){this.d=h.modInverse(T),this.dmp1=this.d.mod(_),this.dmq1=this.d.mod(I),this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0},ht.prototype.equals=function mp(e){return e==this||this.q.equals(e.q)&&this.x.equals(e.x)},ht.prototype.toBigInteger=function bp(){return this.x},ht.prototype.negate=function yp(){return new ht(this.q,this.x.negate().mod(this.q))},ht.prototype.add=function Sp(e){return new ht(this.q,this.x.add(e.toBigInteger()).mod(this.q))},ht.prototype.subtract=function wp(e){return new ht(this.q,this.x.subtract(e.toBigInteger()).mod(this.q))},ht.prototype.multiply=function _p(e){return new ht(this.q,this.x.multiply(e.toBigInteger()).mod(this.q))},ht.prototype.square=function xp(){return new ht(this.q,this.x.square().mod(this.q))},ht.prototype.divide=function Ep(e){return new ht(this.q,this.x.multiply(e.toBigInteger().modInverse(this.q)).mod(this.q))},ht.prototype.sqrt=function(){return new ht(this.q,this.x.sqrt().mod(this.q))},Me.prototype.getX=function Cp(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Me.prototype.getY=function Ap(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Me.prototype.equals=function Pp(e){return e==this||(this.isInfinity()?e.isInfinity():e.isInfinity()?this.isInfinity():!!e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(F.ZERO)&&e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(F.ZERO))},Me.prototype.isInfinity=function Fp(){return null==this.x&&null==this.y||this.z.equals(F.ZERO)&&!this.y.toBigInteger().equals(F.ZERO)},Me.prototype.negate=function Ip(){return new Me(this.curve,this.x,this.y.negate(),this.z)},Me.prototype.add=function Tp(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var r=e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q),s=e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q);if(F.ZERO.equals(s))return F.ZERO.equals(r)?this.twice():this.curve.getInfinity();var o=new F("3"),h=this.x.toBigInteger(),d=this.y.toBigInteger(),w=(e.x.toBigInteger(),e.y.toBigInteger(),s.square()),_=w.multiply(s),I=h.multiply(w),T=r.square().multiply(this.z),m=T.subtract(I.shiftLeft(1)).multiply(e.z).subtract(_).multiply(s).mod(this.curve.q),g=I.multiply(o).multiply(r).subtract(d.multiply(_)).subtract(T.multiply(r)).multiply(e.z).add(r.multiply(_)).mod(this.curve.q),A=_.multiply(this.z).multiply(e.z).mod(this.curve.q);return new Me(this.curve,this.curve.fromBigInteger(m),this.curve.fromBigInteger(g),A)},Me.prototype.twice=function Rp(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=new F("3"),r=this.x.toBigInteger(),s=this.y.toBigInteger(),o=s.multiply(this.z),h=o.multiply(s).mod(this.curve.q),d=this.curve.a.toBigInteger(),f=r.square().multiply(e);F.ZERO.equals(d)||(f=f.add(this.z.square().multiply(d)));var v=(f=f.mod(this.curve.q)).square().subtract(r.shiftLeft(3).multiply(h)).shiftLeft(1).multiply(o).mod(this.curve.q),w=f.multiply(e).multiply(r).subtract(h.shiftLeft(1)).shiftLeft(2).multiply(h).subtract(f.square().multiply(f)).mod(this.curve.q),_=o.square().multiply(o).shiftLeft(3).mod(this.curve.q);return new Me(this.curve,this.curve.fromBigInteger(v),this.curve.fromBigInteger(w),_)},Me.prototype.multiply=function kp(e){if(this.isInfinity())return this;if(0==e.signum())return this.curve.getInfinity();var _,r=e,s=r.multiply(new F("3")),o=this.negate(),h=this,d=this.curve.q.subtract(e),f=d.multiply(new F("3")),v=new Me(this.curve,this.x,this.y),w=v.negate();for(_=s.bitLength()-2;_>0;--_){h=h.twice();var I=s.testBit(_);I!=r.testBit(_)&&(h=h.add(I?this:o))}for(_=f.bitLength()-2;_>0;--_){v=v.twice();var m=f.testBit(_);m!=d.testBit(_)&&(v=v.add(m?v:w))}return h},Me.prototype.multiplyTwo=function Np(e,r,s){var o;o=e.bitLength()>s.bitLength()?e.bitLength()-1:s.bitLength()-1;for(var h=this.curve.getInfinity(),d=this.add(r);o>=0;)h=h.twice(),e.testBit(o)?h=s.testBit(o)?h.add(d):h.add(this):s.testBit(o)&&(h=h.add(r)),--o;return h},oi.prototype.getQ=function Dp(){return this.q},oi.prototype.getA=function Op(){return this.a},oi.prototype.getB=function Bp(){return this.b},oi.prototype.equals=function Mp(e){return e==this||this.q.equals(e.q)&&this.a.equals(e.a)&&this.b.equals(e.b)},oi.prototype.getInfinity=function jp(){return this.infinity},oi.prototype.fromBigInteger=function Lp(e){return new ht(this.q,e)},oi.prototype.decodePointHex=function Hp(e){switch(parseInt(e.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var r=e.substr(0,2),o=(e.substr(2),this.fromBigInteger(new F(_,16))),h=this.getA(),d=this.getB(),v=o.square().add(h).multiply(o).add(d).sqrt();return"03"==r&&(v=v.negate()),new Me(this,o,v);case 4:case 6:case 7:var w=(e.length-2)/2,_=e.substr(2,w),I=e.substr(w+2,w);return new Me(this,this.fromBigInteger(new F(_,16)),this.fromBigInteger(new F(I,16)));default:return null}},ht.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},Me.prototype.getEncoded=function(e){var r=function(d,f){var v=d.toByteArrayUnsigned();if(f<v.length)v=v.slice(v.length-f);else for(;f>v.length;)v.unshift(0);return v},s=this.getX().toBigInteger(),o=this.getY().toBigInteger(),h=r(s,32);return e?o.isEven()?h.unshift(2):h.unshift(3):(h.unshift(4),h=h.concat(r(o,32))),h},Me.decodeFrom=function(e,r){var o=r.length-1,h=r.slice(1,1+o/2),d=r.slice(1+o/2,1+o);h.unshift(0),d.unshift(0);var f=new F(h),v=new F(d);return new Me(e,e.fromBigInteger(f),e.fromBigInteger(v))},Me.decodeFromHex=function(e,r){r.substr(0,2);var o=r.length-2,h=r.substr(2,o/2),d=r.substr(2+o/2,o/2),f=new F(h,16),v=new F(d,16);return new Me(e,e.fromBigInteger(f),e.fromBigInteger(v))},Me.prototype.add2D=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;if(this.x.equals(e.x))return this.y.equals(e.y)?this.twice():this.curve.getInfinity();var r=e.x.subtract(this.x),o=e.y.subtract(this.y).divide(r),h=o.square().subtract(this.x).subtract(e.x),d=o.multiply(this.x.subtract(h)).subtract(this.y);return new Me(this.curve,h,d)},Me.prototype.twice2D=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=this.curve.fromBigInteger(F.valueOf(2)),r=this.curve.fromBigInteger(F.valueOf(3)),s=this.x.square().multiply(r).add(this.curve.a).divide(this.y.multiply(e)),o=s.square().subtract(this.x.multiply(e)),h=s.multiply(this.x.subtract(o)).subtract(this.y);return new Me(this.curve,o,h)},Me.prototype.multiply2D=function(e){if(this.isInfinity())return this;if(0==e.signum())return this.curve.getInfinity();var d,r=e,s=r.multiply(new F("3")),o=this.negate(),h=this;for(d=s.bitLength()-2;d>0;--d){h=h.twice();var f=s.testBit(d);f!=r.testBit(d)&&(h=h.add2D(f?this:o))}return h},Me.prototype.isOnCurve=function(){var e=this.getX().toBigInteger(),r=this.getY().toBigInteger(),s=this.curve.getA().toBigInteger(),o=this.curve.getB().toBigInteger(),h=this.curve.getQ(),d=r.multiply(r).mod(h),f=e.multiply(e).multiply(e).add(s.multiply(e)).add(o).mod(h);return d.equals(f)},Me.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},Me.prototype.validate=function(){var e=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var r=this.getX().toBigInteger(),s=this.getY().toBigInteger();if(r.compareTo(F.ONE)<0||r.compareTo(e.subtract(F.ONE))>0)throw new Error("x coordinate out of bounds");if(s.compareTo(F.ONE)<0||s.compareTo(e.subtract(F.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(e).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};var wo=function(){var o=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),h=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),d={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function f(T,m,g){return m?d[m]:String.fromCharCode(parseInt(g,16))}var v=new String(""),I=Object.hasOwnProperty;return function(T,m){var A,g=T.match(o),y=g[0],P=!1;"{"===y?A={}:"["===y?A=[]:(A=[],P=!0);for(var x,N=[A],B=1-P,M=g.length;B<M;++B){var j;switch((y=g[B]).charCodeAt(0)){default:(j=N[0])[x||j.length]=+y,x=void 0;break;case 34:if(-1!==(y=y.substring(1,y.length-1)).indexOf("\\")&&(y=y.replace(h,f)),j=N[0],!x){if(!(j instanceof Array)){x=y||v;break}x=j.length}j[x]=y,x=void 0;break;case 91:N.unshift((j=N[0])[x||j.length]=[]),x=void 0;break;case 93:case 125:N.shift();break;case 102:(j=N[0])[x||j.length]=!1,x=void 0;break;case 110:(j=N[0])[x||j.length]=null,x=void 0;break;case 116:(j=N[0])[x||j.length]=!0,x=void 0;break;case 123:N.unshift((j=N[0])[x||j.length]={}),x=void 0}}if(P){if(1!==N.length)throw new Error;A=A[0]}else if(N.length)throw new Error;if(m){var Q=function(Y,R){var D=Y[R];if(D&&"object"==typeof D){var L=null;for(var H in D)if(I.call(D,H)&&D!==Y){var z=Q(D,H);void 0!==z?D[H]=z:(L||(L=[]),L.push(H))}if(L)for(var X=L.length;--X>=0;)delete D[L[X]]}return m.call(Y,R,D)};A=Q({"":A},"")}return A}}();(typeof l>"u"||!l)&&(l={}),(typeof l.asn1>"u"||!l.asn1)&&(l.asn1={}),l.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var r=e.toString(16);return r.length%2==1&&(r="0"+r),r},this.bigIntToMinTwosComplementsHex=function(e){return dn(e)},this.getPEMStringFromHex=function(e,r){return bt(e,r)},this.newObject=function(e){var s=l.asn1,o=s.ASN1Object,h=s.DERBoolean,d=s.DERInteger,f=s.DERBitString,v=s.DEROctetString,w=s.DERNull,_=s.DERObjectIdentifier,I=s.DEREnumerated,T=s.DERUTF8String,m=s.DERNumericString,g=s.DERPrintableString,A=s.DERTeletexString,y=s.DERIA5String,P=s.DERUTCTime,x=s.DERGeneralizedTime,N=s.DERVisibleString,B=s.DERBMPString,M=s.DERSequence,j=s.DERSet,Q=s.DERTaggedObject,Y=s.ASN1Util.newObject;if(e instanceof s.ASN1Object)return e;var R=Object.keys(e);if(1!=R.length)throw new Error("key of param shall be only one.");var D=R[0];if(-1==":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+D+":"))throw new Error("undefined key: "+D);if("bool"==D)return new h(e[D]);if("int"==D)return new d(e[D]);if("bitstr"==D)return new f(e[D]);if("octstr"==D)return new v(e[D]);if("null"==D)return new w(e[D]);if("oid"==D)return new _(e[D]);if("enum"==D)return new I(e[D]);if("utf8str"==D)return new T(e[D]);if("numstr"==D)return new m(e[D]);if("prnstr"==D)return new g(e[D]);if("telstr"==D)return new A(e[D]);if("ia5str"==D)return new y(e[D]);if("utctime"==D)return new P(e[D]);if("gentime"==D)return new x(e[D]);if("visstr"==D)return new N(e[D]);if("bmpstr"==D)return new B(e[D]);if("asn1"==D)return new o(e[D]);if("seq"==D){for(var L=e[D],H=[],z=0;z<L.length;z++){var X=Y(L[z]);H.push(X)}return new M({array:H})}if("set"==D){for(L=e[D],H=[],z=0;z<L.length;z++)X=Y(L[z]),H.push(X);return new j({array:H})}if("tag"==D){var W=e[D];if("[object Array]"===Object.prototype.toString.call(W)&&3==W.length){var $=Y(W[2]);return new Q({tag:W[0],explicit:W[1],obj:$})}return new Q(W)}},this.jsonToASN1HEX=function(e){return this.newObject(e).tohex()}},l.asn1.ASN1Util.oidHexToInt=function(e){for(var h="",r=parseInt(e.substr(0,2),16),d=(h=Math.floor(r/40)+"."+r%40,""),f=2;f<e.length;f+=2){var w=("00000000"+parseInt(e.substr(f,2),16).toString(2)).slice(-8);d+=w.substr(1,7),"0"==w.substr(0,1)&&(h=h+"."+new F(d,2).toString(10),d="")}return h},l.asn1.ASN1Util.oidIntToHex=function(e){var r=function(v){var w=v.toString(16);return 1==w.length&&(w="0"+w),w},s=function(v){var w="",I=new F(v,10).toString(2),T=7-I.length%7;7==T&&(T=0);for(var m="",g=0;g<T;g++)m+="0";for(I=m+I,g=0;g<I.length-1;g+=7){var A=I.substr(g,7);g!=I.length-7&&(A="1"+A),w+=r(parseInt(A,2))}return w};if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var o="",h=e.split("."),d=40*parseInt(h[0])+parseInt(h[1]);o+=r(d),h.splice(0,2);for(var f=0;f<h.length;f++)o+=s(h[f]);return o},l.asn1.ASN1Object=function(e){this.params=null,this.getLengthHexFromValue=function(){if(typeof this.hV>"u"||null==this.hV)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n=0,v="+this.hV);var f=this.hV.length/2,v=f.toString(16);if(v.length%2==1&&(v="0"+v),f<128)return v;var w=v.length/2;if(w>15)throw new Error("ASN.1 length too long to represent by 8x: n = "+f.toString(16));return(128+w).toString(16)+v},this.tohex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.getValueHex=function(){return this.tohex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(f){this.params=f},null!=e&&null!=e.tlv&&(this.hTLV=e.tlv,this.isModified=!1)},l.asn1.DERAbstractString=function(e){l.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(o){this.hTLV=null,this.isModified=!0,this.s=o,this.hV=er(this.s).toLowerCase()},this.setStringHex=function(o){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=o},this.getFreshValueHex=function(){return this.hV},typeof e<"u"&&("string"==typeof e?this.setString(e):typeof e.str<"u"?this.setString(e.str):typeof e.hex<"u"&&this.setStringHex(e.hex))},ne(l.asn1.DERAbstractString,l.asn1.ASN1Object),l.asn1.DERAbstractTime=function(e){l.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(o){var h=o.getTime()+6e4*o.getTimezoneOffset();return new Date(h)},this.formatDate=function(o,h,d){var f=this.zeroPadding,v=this.localDateToUTC(o),w=String(v.getFullYear());"utc"==h&&(w=w.substr(2,2));var A=w+f(String(v.getMonth()+1),2)+f(String(v.getDate()),2)+f(String(v.getHours()),2)+f(String(v.getMinutes()),2)+f(String(v.getSeconds()),2);if(!0===d){var y=v.getMilliseconds();if(0!=y){var P=f(String(y),3);A=A+"."+(P=P.replace(/[0]+$/,""))}}return A+"Z"},this.zeroPadding=function(o,h){return o.length>=h?o:new Array(h-o.length+1).join("0")+o},this.setByParam=function(o){this.hV=null,this.hTLV=null,this.params=o},this.getString=function(){},this.setString=function(o){this.hTLV=null,this.isModified=!0,null==this.params&&(this.params={}),this.params.str=o},this.setByDate=function(o){this.hTLV=null,this.isModified=!0,null==this.params&&(this.params={}),this.params.date=o},this.setByDateValue=function(o,h,d,f,v,w){var _=new Date(Date.UTC(o,h-1,d,f,v,w,0));this.setByDate(_)},this.getFreshValueHex=function(){return this.hV}},ne(l.asn1.DERAbstractTime,l.asn1.ASN1Object),l.asn1.DERAbstractStructured=function(e){l.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(s){this.hTLV=null,this.isModified=!0,this.asn1Array=s},this.appendASN1Object=function(s){this.hTLV=null,this.isModified=!0,this.asn1Array.push(s)},this.asn1Array=new Array,typeof e<"u"&&typeof e.array<"u"&&(this.asn1Array=e.array)},ne(l.asn1.DERAbstractStructured,l.asn1.ASN1Object),l.asn1.DERBoolean=function(e){l.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=0==e?"010100":"0101ff"},ne(l.asn1.DERBoolean,l.asn1.ASN1Object),l.asn1.DERInteger=function(e){l.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.params=null;var r=dn;this.setByBigInteger=function(s){this.isModified=!0,this.params={bigint:s}},this.setByInteger=function(s){this.isModified=!0,this.params=s},this.setValueHex=function(s){this.isModified=!0,this.params={hex:s}},this.getFreshValueHex=function(){var s=this.params,o=null;if(null==s)throw new Error("value not set");if("object"==typeof s&&null!=s.hex)return this.hV=s.hex,this.hV;if("number"==typeof s)o=new F(String(s),10);else if(null!=s.int)o=new F(String(s.int),10);else{if(null==s.bigint)throw new Error("wrong parameter");o=s.bigint}return this.hV=r(o),this.hV},null!=e&&(this.params=e)},ne(l.asn1.DERInteger,l.asn1.ASN1Object),l.asn1.DERBitString=function(e){if(void 0!==e&&typeof e.obj<"u"){var r=l.asn1.ASN1Util.newObject(e.obj);e.hex="00"+r.tohex()}l.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(s){this.hTLV=null,this.isModified=!0,this.hV=s},this.setUnusedBitsAndHexValue=function(s,o){if(s<0||7<s)throw"unused bits shall be from 0 to 7: u = "+s;var h="0"+s;this.hTLV=null,this.isModified=!0,this.hV=h+o},this.setByBinaryString=function(s){var o=8-(s=s.replace(/0+$/,"")).length%8;8==o&&(o=0),s+="0000000".substr(0,o);for(var h="",d=0;d<s.length-1;d+=8){var f=s.substr(d,8),v=parseInt(f,2).toString(16);1==v.length&&(v="0"+v),h+=v}this.hTLV=null,this.isModified=!0,this.hV="0"+o+h},this.setByBooleanArray=function(s){for(var o="",h=0;h<s.length;h++)o+=1==s[h]?"1":"0";this.setByBinaryString(o)},this.newFalseArray=function(s){for(var o=new Array(s),h=0;h<s;h++)o[h]=!1;return o},this.getFreshValueHex=function(){return this.hV},typeof e<"u"&&("string"==typeof e&&e.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(e):typeof e.hex<"u"?this.setHexValueIncludingUnusedBits(e.hex):typeof e.bin<"u"?this.setByBinaryString(e.bin):typeof e.array<"u"&&this.setByBooleanArray(e.array))},ne(l.asn1.DERBitString,l.asn1.ASN1Object),l.asn1.DEROctetString=function(e){if(void 0!==e&&typeof e.obj<"u"){var r=l.asn1.ASN1Util.newObject(e.obj);e.hex=r.tohex()}l.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},ne(l.asn1.DEROctetString,l.asn1.DERAbstractString),l.asn1.DERNull=function(){l.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},ne(l.asn1.DERNull,l.asn1.ASN1Object),l.asn1.DERObjectIdentifier=function(e){l.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(r){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=r},this.setValueOidString=function(r){var s=To(r);if(null==s)throw new Error("malformed oid string: "+r);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=s},this.setValueName=function(r){var s=l.asn1.x509.OID.name2oid(r);if(""===s)throw new Error("DERObjectIdentifier oidName undefined: "+r);this.setValueOidString(s)},this.setValueNameOrOid=function(r){r.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(r):this.setValueName(r)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(r){"string"==typeof r?this.setValueNameOrOid(r):void 0!==r.oid?this.setValueNameOrOid(r.oid):void 0!==r.name?this.setValueNameOrOid(r.name):void 0!==r.hex&&this.setValueHex(r.hex)},void 0!==e&&this.setByParam(e)},ne(l.asn1.DERObjectIdentifier,l.asn1.ASN1Object),l.asn1.DEREnumerated=function(e){l.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(r){this.hTLV=null,this.isModified=!0,this.hV=dn(r)},this.setByInteger=function(r){var s=new F(String(r),10);this.setByBigInteger(s)},this.setValueHex=function(r){this.hV=r},this.getFreshValueHex=function(){return this.hV},typeof e<"u"&&(typeof e.int<"u"?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):typeof e.hex<"u"&&this.setValueHex(e.hex))},ne(l.asn1.DEREnumerated,l.asn1.ASN1Object),l.asn1.DERUTF8String=function(e){l.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},ne(l.asn1.DERUTF8String,l.asn1.DERAbstractString),l.asn1.DERNumericString=function(e){l.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},ne(l.asn1.DERNumericString,l.asn1.DERAbstractString),l.asn1.DERPrintableString=function(e){l.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},ne(l.asn1.DERPrintableString,l.asn1.DERAbstractString),l.asn1.DERTeletexString=function(e){l.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},ne(l.asn1.DERTeletexString,l.asn1.DERAbstractString),l.asn1.DERIA5String=function(e){l.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},ne(l.asn1.DERIA5String,l.asn1.DERAbstractString),l.asn1.DERVisibleString=function(e){l.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="1a"},ne(l.asn1.DERVisibleString,l.asn1.DERAbstractString),l.asn1.DERBMPString=function(e){l.asn1.DERBMPString.superclass.constructor.call(this,e),this.hT="1e"},ne(l.asn1.DERBMPString,l.asn1.DERAbstractString),l.asn1.DERUTCTime=function(e){l.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.params=void 0,this.getFreshValueHex=function(){var r=this.params;if(null==this.params&&(r={date:new Date}),"string"==typeof r){if(!r.match(/^[0-9]{12}Z$/)&&!r.match(/^[0-9]{12}\.[0-9]+Z$/))throw new Error("malformed string for UTCTime: "+r);this.hV=It(r)}else null!=r.str?this.hV=It(r.str):null==r.date&&1==r.millis?this.hV=It(this.formatDate(new Date,"utc",!0)):null!=r.date&&r.date instanceof Date?this.hV=It(this.formatDate(r.date,"utc",!0===r.millis)):r instanceof Date&&(this.hV=It(this.formatDate(r,"utc")));if(null==this.hV)throw new Error("parameter not specified properly for UTCTime");return this.hV},null!=e&&this.setByParam(e)},ne(l.asn1.DERUTCTime,l.asn1.DERAbstractTime),l.asn1.DERGeneralizedTime=function(e){l.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.params=e,this.getFreshValueHex=function(){var r=this.params;if(null==this.params&&(r={date:new Date}),"string"==typeof r){if(!r.match(/^[0-9]{14}Z$/)&&!r.match(/^[0-9]{14}\.[0-9]+Z$/))throw new Error("malformed string for GeneralizedTime: "+r);this.hV=It(r)}else null!=r.str?this.hV=It(r.str):null==r.date&&1==r.millis?this.hV=It(this.formatDate(new Date,"gen",!0)):null!=r.date&&r.date instanceof Date?this.hV=It(this.formatDate(r.date,"gen",!0===r.millis)):r instanceof Date&&(this.hV=It(this.formatDate(r,"gen")));if(null==this.hV)throw new Error("parameter not specified properly for GeneralizedTime");return this.hV},null!=e&&this.setByParam(e)},ne(l.asn1.DERGeneralizedTime,l.asn1.DERAbstractTime),l.asn1.DERSequence=function(e){l.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){for(var r="",s=0;s<this.asn1Array.length;s++)r+=this.asn1Array[s].tohex();return this.hV=r,this.hV}},ne(l.asn1.DERSequence,l.asn1.DERAbstractStructured),l.asn1.DERSet=function(e){l.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var r=new Array,s=0;s<this.asn1Array.length;s++)r.push(this.asn1Array[s].tohex());return 1==this.sortFlag&&r.sort(),this.hV=r.join(""),this.hV},typeof e<"u"&&typeof e.sortflag<"u"&&0==e.sortflag&&(this.sortFlag=!1)},ne(l.asn1.DERSet,l.asn1.DERAbstractStructured),l.asn1.DERTaggedObject=function(e){l.asn1.DERTaggedObject.superclass.constructor.call(this);var r=l.asn1,o=ue.getV,d=r.ASN1Util.newObject;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.params={tag:"a0",explicit:!0},this.setASN1Object=function(f,v,w){this.params={tag:v,explicit:f,obj:w}},this.getFreshValueHex=function(){var f=this.params;if(null==f.explicit&&(f.explicit=!0),null!=f.tage&&(f.tag=f.tage,f.explicit=!0),null!=f.tagi&&(f.tag=f.tagi,f.explicit=!1),null!=f.str)this.hV=er(f.str);else if(null!=f.hex)this.hV=f.hex;else{if(null==f.obj)throw new Error("str, hex nor obj not specified");var v;f.obj instanceof r.ASN1Object?v=f.obj.tohex():"object"==typeof f.obj&&(v=d(f.obj).tohex()),this.hV=f.explicit?v:o(v,0)}return null==f.tag&&(f.tag="a0"),this.hT=f.tag,this.hTLV=null,this.isModified=!0,this.hV},this.setByParam=function(f){this.params=f},void 0!==e&&this.setByParam(e)},ne(l.asn1.DERTaggedObject,l.asn1.ASN1Object);var l,hn,Qt,ue=new function(){};function _o(e){for(var r=new Array,s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r}function xo(e){for(var r="",s=0;s<e.length;s++)r+=String.fromCharCode(e[s]);return r}function Zn(e){for(var r="",s=0;s<e.length;s++){var o=e[s].toString(16);1==o.length&&(o="0"+o),r+=o}return r}function It(e){return Zn(_o(e))}function Ki(e){return(e=(e=e.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function ln(e){return e.length%4==2?e+="==":e.length%4==3&&(e+="="),(e=e.replace(/-/g,"+")).replace(/_/g,"/")}function dt(e){return e.length%2==1&&(e="0"+e),Ki(C(e))}function Ye(e){return b(ln(e))}function er(e){return ir(sr(e)).toLowerCase()}function Ve(e){try{return decodeURIComponent(nr(e))}catch{return null}}function zp(e){return Ve(function $p(e){for(var r=e.match(/.{1,2}/g),s=[],o=0;o<r.length;o++){var h=parseInt(r[o],16);161<=h&&h<=191?(s.push("c2"),s.push(r[o])):192<=h&&h<=255?(s.push("c3"),s.push((h-64).toString(16))):s.push(r[o])}return s.join("")}(e))}function Tt(e){for(var r="",s=0;s<e.length-1;s+=2)r+=String.fromCharCode(parseInt(e.substr(s,2),16));return r}function ei(e){for(var r="",s=0;s<e.length;s++)r+=("0"+e.charCodeAt(s).toString(16)).slice(-2);return r}function ds(e){return C(e)}function tr(e,r){return(e=e.replace(new RegExp("(.{"+r+"})","g"),"$1\r\n")).replace(/\s+$/,"")}function Eo(e){return b(e.replace(/[^0-9A-Za-z\/+=]*/g,""))}function bt(e,r){return"-----BEGIN "+r+"-----\r\n"+tr(ds(e),64)+"\r\n-----END "+r+"-----\r\n"}function nt(e,r){if(-1==e.indexOf("-----BEGIN "))throw new Error("can't find PEM header");return Eo(e=void 0!==r?(e=e.replace(new RegExp("^[^]*-----BEGIN "+r+"-----"),"")).replace(new RegExp("-----END "+r+"-----[^]*$"),""):(e=e.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function fs(e){var r,s,o,h,d,f,v,I,T,m;if(m=(e=Ao(e)).match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return r=parseInt(m[1]),s=parseInt(m[2])-1,o=parseInt(m[3]),h=parseInt(m[4]),d=parseInt(m[5]),f=parseInt(m[6]),v=0,""!==(I=m[7])&&(T=(I.substr(1)+"00").substr(0,3),v=parseInt(T)),Date.UTC(r,s,o,h,d,f,v);throw new Error("unsupported zulu format: "+e)}function Co(e){return Math.round(fs(e)/1e3)}function Ao(e){return e.match(/^[0-9]{12}Z$/)||e.match(/^[0-9]{12}[.][0-9]*Z$/)?e.match(/^[0-4]/)?"20"+e:"19"+e:e}function ir(e){return e.replace(/%/g,"")}function nr(e){return e.replace(/(..)/g,"%$1")}function ps(e){var r="malformed IPv6 address";if(!e.match(/^[0-9A-Fa-f:]+$/))throw r;var s=(e=e.toLowerCase()).split(":").length-1;if(s<2)throw r;var o=":".repeat(7-s+2),h=(e=e.replace("::",o)).split(":");if(8!=h.length)throw r;for(var d=0;d<8;d++)h[d]=("0000"+h[d]).slice(-4);return h.join("")}function vs(e){if(!e.match(/^[0-9A-Fa-f]{32}$/))throw new Error("malformed IPv6 address: "+e);var r=(e=e.toLowerCase()).match(/.{1,4}/g);r=r.map(function(h){return h.replace(/^0+/,"")}),r=r.map(function(h){return""==h?"0":h});var s=(e=":"+r.join(":")+":").match(/:(0:){2,}/g);if(null==s)return e.slice(1,-1);var o=s.sort().slice(-1)[0];return"::"!=(e=e.replace(o.substr(0,o.length-1),":")).substr(0,2)&&(e=e.substr(1)),"::"!=e.substr(-2,2)&&(e=e.substr(0,e.length-1)),e}function rr(e){var r=new Error("malformed hex value");if(!e.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw r;if(8==e.length)try{return parseInt(e.substr(0,2),16)+"."+parseInt(e.substr(2,2),16)+"."+parseInt(e.substr(4,2),16)+"."+parseInt(e.substr(6,2),16)}catch{throw r}else{if(16!=e.length){if(32==e.length)return vs(e);if(64==e.length){try{return vs(e.substr(0,32))+"/"+Po(e.substr(32))}catch{throw r}return}return e}try{return rr(e.substr(0,8))+"/"+Po(e.substr(8))}catch{throw r}}}function Po(e){var s,r=new Error("malformed mask");try{s=new F(e,16).toString(2)}catch{throw r}if(!s.match(/^1*0*$/))throw r;return s.replace(/0+$/,"").length}function gs(e){var r=new Error("malformed IP address");if(!(e=e.toLowerCase(e)).match(/^[0-9a-f.:/]+$/))throw r;if(!e.match(/^[0-9.]+$/)){var f;if(e.match(/^[0-9.]+\/[0-9]+$/))return gs((f=e.split("/"))[0])+Fo(parseInt(f[1]),32);if(e.match(/^[0-9a-f:]+$/)&&-1!==e.indexOf(":"))return ps(e);if(e.match(/^[0-9a-f:]+\/[0-9]+$/)&&-1!==e.indexOf(":"))return ps((f=e.split("/"))[0])+Fo(parseInt(f[1]),128);throw r}var s=e.split(".");if(4!==s.length)throw r;var o="";try{for(var h=0;h<4;h++)o+=("0"+parseInt(s[h]).toString(16)).slice(-2);return o}catch{throw r}}function Fo(e,r){return 32==r&&0==e?"00000000":128==r&&0==e?"00000000000000000000000000000000":new F(Array(e+1).join("1")+Array(r-e+1).join("0"),2).toString(16)}function ms(e){var o=e.match(/.{4}/g).map(function r(h){var d=parseInt(h.substr(0,2),16),f=parseInt(h.substr(2),16);if(0==d&f<128)return String.fromCharCode(f);if(d<8){var w=128|63&f;return Ve((192|(7&d)<<3|(192&f)>>6).toString(16)+w.toString(16))}w=128|(15&d)<<2|(192&f)>>6;var _=128|63&f;return Ve((224|(240&d)>>4).toString(16)+w.toString(16)+_.toString(16))});return o.join("")}function sr(e){for(var r=encodeURIComponent(e),s="",o=0;o<r.length;o++)"%"==r[o]?(s+=r.substr(o,3),o+=2):s=s+"%"+It(r[o]);return s}function Io(e){return!(e.length%2!=0||!e.match(/^[0-9a-f]+$/)&&!e.match(/^[0-9A-F]+$/))}function bs(e){return!!e.match(/^[0-9A-Za-z-_.]+$/)}function ys(e){return e.length%2==1?"0"+e:e.substr(0,1)>"7"?"00"+e:e}function To(e){var r=function(v){var w=v.toString(16);return 1==w.length&&(w="0"+w),w},s=function(v){var w="",I=parseInt(v,10).toString(2),T=7-I.length%7;7==T&&(T=0);for(var m="",g=0;g<T;g++)m+="0";for(I=m+I,g=0;g<I.length-1;g+=7){var A=I.substr(g,7);g!=I.length-7&&(A="1"+A),w+=r(parseInt(A,2))}return w};try{if(!e.match(/^[0-9.]+$/))return null;var o="",h=e.split("."),d=40*parseInt(h[0],10)+parseInt(h[1],10);o+=r(d),h.splice(0,2);for(var f=0;f<h.length;f++)o+=s(h[f]);return o}catch{return null}}function ar(e){if(!Io(e))return null;try{var r=[],s=e.substr(0,2),o=parseInt(s,16);r[0]=new String(Math.floor(o/40)),r[1]=new String(o%40);for(var h=e.substr(2),d=[],f=0;f<h.length/2;f++)d.push(parseInt(h.substr(2*f,2),16));var v=[],w="";for(f=0;f<d.length;f++)128&d[f]?w+=or((127&d[f]).toString(2),7):(w+=or((127&d[f]).toString(2),7),v.push(new String(parseInt(w,2))),w="");var _=r.join(".");return v.length>0&&(_=_+"."+v.join(".")),_}catch{return null}}function Ro(e){return dn(new F(String(e),10))}function dn(e){var r=e.toString(16);if("-"!=r.substr(0,1))return r.length%2==1?r="0"+r:r.match(/^[0-7]/)||(r="00"+r),r;var o=r.substr(1).length;o%2==1?o+=1:r.match(/^[0-7]/)||(o+=2);for(var h="",d=0;d<o;d++)h+="f";return new F(h,16).xor(e).add(F.ONE).toString(16).replace(/^-/,"")}ue.getLblen=function(e,r){if("8"!=e.substr(r+2,1))return 1;var s=parseInt(e.substr(r+3,1));return 0==s?-1:0<s&&s<10?s+1:-2},ue.getL=function(e,r){var s=ue.getLblen(e,r);return s<1?"":e.substr(r+2,2*s)},ue.getVblen=function(e,r){var s;return""==(s=ue.getL(e,r))?-1:("8"===s.substr(0,1)?new F(s.substr(2),16):new F(s,16)).intValue()},ue.getVidx=function(e,r){var s=ue.getLblen(e,r);return s<0?s:r+2*(s+1)},ue.getV=function(e,r){var s=ue.getVidx(e,r),o=ue.getVblen(e,r);return e.substr(s,2*o)},ue.getTLV=function(e,r){return e.substr(r,2)+ue.getL(e,r)+ue.getV(e,r)},ue.getTLVblen=function(e,r){return 2+2*ue.getLblen(e,r)+2*ue.getVblen(e,r)},ue.getNextSiblingIdx=function(e,r){return ue.getVidx(e,r)+2*ue.getVblen(e,r)},ue.getChildIdx=function(e,r){var h,d,f,s=ue,o=[];h=s.getVidx(e,r),d=2*s.getVblen(e,r),"03"==e.substr(r,2)&&(h+=2,d-=2),f=0;for(var v=h;f<=d;){var w=s.getTLVblen(e,v);if((f+=w)<=d&&o.push(v),v+=w,f>=d)break}return o},ue.getNthChildIdx=function(e,r,s){return ue.getChildIdx(e,r)[s]},ue.getIdxbyList=function(e,r,s,o){var d,f,h=ue;return 0==s.length?void 0!==o&&e.substr(r,2)!==o?-1:r:(d=s.shift())>=(f=h.getChildIdx(e,r)).length?-1:h.getIdxbyList(e,f[d],s,o)},ue.getIdxbyListEx=function(e,r,s,o){var d,f,h=ue;if(0==s.length)return void 0!==o&&e.substr(r,2)!==o?-1:r;d=s.shift(),f=h.getChildIdx(e,r);for(var v=0,w=0;w<f.length;w++){var _=e.substr(f[w],2);if("number"==typeof d&&!h.isContextTag(_)&&v==d||"string"==typeof d&&h.isContextTag(_,d))return h.getIdxbyListEx(e,f[w],s,o);h.isContextTag(_)||v++}return-1},ue.getTLVbyList=function(e,r,s,o){var h=ue,d=h.getIdxbyList(e,r,s,o);return-1==d||d>=e.length?null:h.getTLV(e,d)},ue.getTLVbyListEx=function(e,r,s,o){var h=ue,d=h.getIdxbyListEx(e,r,s,o);return-1==d?null:h.getTLV(e,d)},ue.getVbyList=function(e,r,s,o,h){var f,v,d=ue;return-1==(f=d.getIdxbyList(e,r,s,o))||f>=e.length?null:(v=d.getV(e,f),!0===h&&(v=v.substr(2)),v)},ue.getVbyListEx=function(e,r,s,o,h){var f,w,d=ue;return-1==(f=d.getIdxbyListEx(e,r,s,o))?null:(w=d.getV(e,f),"03"==e.substr(f,2)&&!1!==h&&(w=w.substr(2)),w)},ue.getInt=function(e,r,s){null==s&&(s=-1);try{var o=e.substr(r,2);if("02"!=o&&"03"!=o)return s;var h=ue.getV(e,r);return"02"==o?parseInt(h,16):ko(h)}catch{return s}},ue.getOID=function(e,r,s){null==s&&(s=null);try{return"06"!=e.substr(r,2)?s:ar(ue.getV(e,r))}catch{return s}},ue.getOIDName=function(e,r,s){null==s&&(s=null);try{var o=ue.getOID(e,r,s);if(o==s)return s;var h=l.asn1.x509.OID.oid2name(o);return""==h?o:h}catch{return s}},ue.getString=function(e,r,s){null==s&&(s=null);try{return Tt(ue.getV(e,r))}catch{return s}},ue.hextooidstr=function(e){var r=function(T,m){return T.length>=m?T:new Array(m-T.length+1).join("0")+T},s=[],o=e.substr(0,2),h=parseInt(o,16);s[0]=new String(Math.floor(h/40)),s[1]=new String(h%40);for(var d=e.substr(2),f=[],v=0;v<d.length/2;v++)f.push(parseInt(d.substr(2*v,2),16));var w=[],_="";for(v=0;v<f.length;v++)128&f[v]?_+=r((127&f[v]).toString(2),7):(_+=r((127&f[v]).toString(2),7),w.push(new String(parseInt(_,2))),_="");var I=s.join(".");return w.length>0&&(I=I+"."+w.join(".")),I},ue.dump=function(e,r,s,o){var h=ue,d=h.getV,f=h.dump,v=h.getChildIdx,w=e;e instanceof l.asn1.ASN1Object&&(w=e.tohex());var _=function(Y,R){return Y.length<=2*R?Y:Y.substr(0,R)+"..(total "+Y.length/2+"bytes).."+Y.substr(Y.length-R,R)};void 0===r&&(r={ommit_long_octet:32}),void 0===s&&(s=0),void 0===o&&(o="");var j,I=r.ommit_long_octet;if("01"==(j=w.substr(s,2)))return"00"==(T=d(w,s))?o+"BOOLEAN FALSE\n":o+"BOOLEAN TRUE\n";if("02"==j)return o+"INTEGER "+_(T=d(w,s),I)+"\n";if("03"==j){var T=d(w,s);return h.isASN1HEX(T.substr(2))?(m=o+"BITSTRING, encapsulates\n")+f(T.substr(2),r,0,o+"  "):o+"BITSTRING "+_(T,I)+"\n"}if("04"==j)return T=d(w,s),h.isASN1HEX(T)?(m=o+"OCTETSTRING, encapsulates\n")+f(T,r,0,o+"  "):o+"OCTETSTRING "+_(T,I)+"\n";if("05"==j)return o+"NULL\n";if("06"==j){var g=d(w,s),A=l.asn1.ASN1Util.oidHexToInt(g),y=l.asn1.x509.OID.oid2name(A),P=A.replace(/\./g," ");return""!=y?o+"ObjectIdentifier "+y+" ("+P+")\n":o+"ObjectIdentifier ("+P+")\n"}if("0a"==j)return o+"ENUMERATED "+parseInt(d(w,s))+"\n";if("0c"==j)return o+"UTF8String '"+Ve(d(w,s))+"'\n";if("13"==j)return o+"PrintableString '"+Ve(d(w,s))+"'\n";if("14"==j)return o+"TeletexString '"+Ve(d(w,s))+"'\n";if("16"==j)return o+"IA5String '"+Ve(d(w,s))+"'\n";if("17"==j)return o+"UTCTime "+Ve(d(w,s))+"\n";if("18"==j)return o+"GeneralizedTime "+Ve(d(w,s))+"\n";if("1a"==j)return o+"VisualString '"+Ve(d(w,s))+"'\n";if("1e"==j)return o+"BMPString '"+ms(d(w,s))+"'\n";if("30"==j){if("3000"==w.substr(s,4))return o+"SEQUENCE {}\n";m=o+"SEQUENCE\n";var N=r;if((2==(x=v(w,s)).length||3==x.length)&&"06"==w.substr(x[0],2)&&"04"==w.substr(x[x.length-1],2)){y=h.oidname(d(w,x[0]));var B=JSON.parse(JSON.stringify(r));B.x509ExtName=y,N=B}for(var M=0;M<x.length;M++)m+=f(w,N,x[M],o+"  ");return m}if("31"==j){m=o+"SET\n";var x=v(w,s);for(M=0;M<x.length;M++)m+=f(w,r,x[M],o+"  ");return m}if(128&(j=parseInt(j,16))){var m,Q=31&j;if(32&j){for(m=o+"["+Q+"]\n",x=v(w,s),M=0;M<x.length;M++)m+=f(w,r,x[M],o+"  ");return m}return T=d(w,s),ue.isASN1HEX(T)?(m=o+"["+Q+"]\n")+f(T,r,0,o+"  "):(("68747470"==T.substr(0,8)||"subjectAltName"===r.x509ExtName&&2==Q)&&(T=Ve(T)),o+"["+Q+"] "+T+"\n")}return o+"UNKNOWN("+j+") "+d(w,s)+"\n"},ue.parse=function(e){var s=ue.parse,o=ue.isASN1HEX,h=ue.getV,d=ue.getTLV,f=ue.getChildIdx,v=l.asn1,w=v.ASN1Util.oidHexToInt,_=v.x509.OID.oid2name,I=Ve,T=ms,m=zp,g={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},y=e.substr(0,2),P={},x=h(e,0);if("01"==y)return"0101ff"==e?{bool:!0}:{bool:!1};if("02"==y)return{int:{hex:x}};if("03"==y)try{if("00"!=x.substr(0,2))throw"not encap";var N=x.substr(2);if(!o(N))throw"not encap";return{bitstr:{obj:s(N)}}}catch{var B=null;return x.length<=10&&(B=Do(x)),null==B?{bitstr:{hex:x}}:{bitstr:{bin:B}}}else if("04"==y)try{if(!o(x))throw"not encap";return{octstr:{obj:s(x)}}}catch{return{octstr:{hex:x}}}else{if("05"==y)return{null:""};if("06"==y){var M=w(x),j=_(M);return""==j?{oid:M}:{oid:j}}if("0a"==y)return x.length>4?{enum:{hex:x}}:{enum:parseInt(x,16)};if("30"==y||"31"==y)return P[g[y]]=function(D){for(var L=[],H=f(D,0),z=0;z<H.length;z++){var W=d(D,H[z]),$=s(W);L.push($)}return L}(e),P;if("14"==y){var Q=m(x);return P[g[y]]={str:Q},P}if("1e"==y)return Q=T(x),P[g[y]]={str:Q},P;if(-1!=":0c:12:13:16:17:18:1a:".indexOf(y))return Q=I(x),P[g[y]]={str:Q},P;if(y.match(/^8[0-9]$/))return null==(Q=I(x))|""==Q||null!=Q.match(/[\x00-\x1F\x7F-\x9F]/)||null!=Q.match(/[\u0000-\u001F\u0080\u2013\u009F]/)?{tag:{tag:y,explicit:!1,hex:x}}:{tag:{tag:y,explicit:!1,str:Q}};if(!y.match(/^a[0-9]$/)){var Y=new l.asn1.ASN1Object;return Y.hV=x,{asn1:{tlv:y+Y.getLengthHexFromValue()+x}}}try{if(!o(x))throw new Error("not encap");return{tag:{tag:y,explicit:!0,obj:s(x)}}}catch{return{tag:{tag:y,explicit:!0,hex:x}}}}},ue.isContextTag=function(e,r){var s,o;e=e.toLowerCase();try{s=parseInt(e,16)}catch{return-1}if(void 0===r)return 128==(192&s);try{return!(null==r.match(/^\[[0-9]+\]$/)||(o=parseInt(r.substr(1,r.length-1),10),o>31))&&128==(192&s)&&(31&s)==o}catch{return!1}},ue.isASN1HEX=function(e){var r=ue;if(e.length%2==1)return!1;var s=r.getVblen(e,0),o=e.substr(0,2),h=r.getL(e,0);return e.length-o.length-h.length==2*s},ue.checkStrictDER=function(e,r,s,o,h){var d=ue;if(void 0===s){if("string"!=typeof e)throw new Error("not hex string");if(e=e.toLowerCase(),!l.lang.String.isHex(e))throw new Error("not hex string");s=e.length,h=(o=e.length/2)<128?1:Math.ceil(o.toString(16))+1}if(d.getL(e,r).length>2*h)throw new Error("L of TLV too long: idx="+r);var v=d.getVblen(e,r);if(v>o)throw new Error("value of L too long than hex: idx="+r);var w=d.getTLV(e,r),_=w.length-2-d.getL(e,r).length;if(_!==2*v)throw new Error("V string length and L's value not the same:"+_+"/"+2*v);if(0===r&&e.length!=w.length)throw new Error("total length and TLV length unmatch:"+e.length+"!="+w.length);var I=e.substr(r,2);if("02"===I){var T=d.getVidx(e,r);if("00"==e.substr(T,2)&&e.charCodeAt(T+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(I,16)){for(var m=d.getVblen(e,r),g=0,A=d.getChildIdx(e,r),y=0;y<A.length;y++)g+=d.getTLV(e,A[y]).length,d.checkStrictDER(e,A[y],s,o,h);if(2*m!=g)throw new Error("sum of children's TLV length and L unmatch: "+2*m+"!="+g)}},ue.oidname=function(e){var r=l.asn1;l.lang.String.isHex(e)&&(e=r.ASN1Util.oidHexToInt(e));var s=r.x509.OID.oid2name(e);return""===s&&(s=e),s},(typeof l>"u"||!l)&&(l={}),(typeof l.asn1>"u"||!l.asn1)&&(l.asn1={}),(typeof l.asn1.x509>"u"||!l.asn1.x509)&&(l.asn1.x509={}),l.asn1.x509.Certificate=function(e){l.asn1.x509.Certificate.superclass.constructor.call(this);var s=l.asn1,o=s.DERBitString,h=s.DERSequence,d=s.x509,f=d.TBSCertificate,v=d.AlgorithmIdentifier;this.params=void 0,this.setByParam=function(w){this.params=w},this.sign=function(){var w=this.params,_=w.sigalg;null!=w.sigalg.name&&(_=w.sigalg.name);var I=w.tbsobj.tohex(),T=new l.crypto.Signature({alg:_});T.init(w.cakey),T.updateHex(I),w.sighex=T.sign()},this.getPEM=function(){return bt(this.tohex(),"CERTIFICATE")},this.tohex=function(){var w=this.params;if((null==w.tbsobj||null==w.tbsobj)&&(w.tbsobj=new f(w)),null==w.sighex&&null!=w.cakey&&this.sign(),null==w.sighex)throw new Error("sighex or cakey parameter not defined");var _=[];return _.push(w.tbsobj),_.push(new v({name:w.sigalg})),_.push(new o({hex:"00"+w.sighex})),new h({array:_}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&(this.params=e)},ne(l.asn1.x509.Certificate,l.asn1.ASN1Object),l.asn1.x509.TBSCertificate=function(e){l.asn1.x509.TBSCertificate.superclass.constructor.call(this);var s=l.asn1,o=s.x509,h=s.DERTaggedObject,d=s.DERInteger,f=s.DERSequence,v=o.AlgorithmIdentifier,w=o.Time,_=o.X500Name,I=o.Extensions,T=o.SubjectPublicKeyInfo;this.params=null,this.setByParam=function(m){this.params=m},this.tohex=function(){var m=[],g=this.params;if(null!=g.version||1!=g.version){var A=2;null!=g.version&&(A=g.version-1);var y=new h({obj:new d({int:A})});m.push(y)}return m.push(new d(g.serial)),m.push(new v({name:g.sigalg})),m.push(new _(g.issuer)),m.push(new f({array:[new w(g.notbefore),new w(g.notafter)]})),m.push(new _(g.subject)),m.push(new T(Ie.getKey(g.sbjpubkey))),void 0!==g.ext&&g.ext.length>0&&m.push(new h({tag:"a3",obj:new I(g.ext)})),new l.asn1.DERSequence({array:m}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.x509.TBSCertificate,l.asn1.ASN1Object),l.asn1.x509.Extensions=function(e){l.asn1.x509.Extensions.superclass.constructor.call(this);var s=l.asn1,o=s.DERSequence,h=s.x509;this.aParam=[],this.setByParam=function(d){this.aParam=d},this.tohex=function(){for(var d=[],f=0;f<this.aParam.length;f++){var v=this.aParam[f],w=v.extname,_=null;if(null!=v.extn)_=new h.PrivateExtension(v);else if("subjectKeyIdentifier"==w)_=new h.SubjectKeyIdentifier(v);else if("keyUsage"==w)_=new h.KeyUsage(v);else if("subjectAltName"==w)_=new h.SubjectAltName(v);else if("issuerAltName"==w)_=new h.IssuerAltName(v);else if("basicConstraints"==w)_=new h.BasicConstraints(v);else if("nameConstraints"==w)_=new h.NameConstraints(v);else if("cRLDistributionPoints"==w)_=new h.CRLDistributionPoints(v);else if("certificatePolicies"==w)_=new h.CertificatePolicies(v);else if("policyMappings"==w)_=new h.PolicyMappings(v);else if("policyConstraints"==w)_=new h.PolicyConstraints(v);else if("inhibitAnyPolicy"==w)_=new h.InhibitAnyPolicy(v);else if("authorityKeyIdentifier"==w)_=new h.AuthorityKeyIdentifier(v);else if("extKeyUsage"==w)_=new h.ExtKeyUsage(v);else if("authorityInfoAccess"==w)_=new h.AuthorityInfoAccess(v);else if("cRLNumber"==w)_=new h.CRLNumber(v);else if("cRLReason"==w)_=new h.CRLReason(v);else if("ocspNonce"==w)_=new h.OCSPNonce(v);else if("ocspNoCheck"==w)_=new h.OCSPNoCheck(v);else if("adobeTimeStamp"==w)_=new h.AdobeTimeStamp(v);else{if("subjectDirectoryAttributes"!=w)throw new Error("extension not supported:"+JSON.stringify(v));_=new h.SubjectDirectoryAttributes(v)}null!=_&&d.push(_)}return new o({array:d}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.x509.Extensions,l.asn1.ASN1Object),l.asn1.x509.Extension=function(e){l.asn1.x509.Extension.superclass.constructor.call(this);var o=l.asn1,h=o.DERObjectIdentifier,d=o.DEROctetString,v=o.DERBoolean,w=o.DERSequence;this.tohex=function(){var _=new h({oid:this.oid}),I=new d({hex:this.getExtnValueHex()}),T=new Array;return T.push(_),this.critical&&T.push(new v),T.push(I),new w({array:T}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.critical=!1,void 0!==e&&void 0!==e.critical&&(this.critical=e.critical)},ne(l.asn1.x509.Extension,l.asn1.ASN1Object),l.asn1.x509.KeyUsage=function(e){l.asn1.x509.KeyUsage.superclass.constructor.call(this,e);var r=Error,s={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var o=this.getBinValue();return this.asn1ExtnValue=new l.asn1.DERBitString({bin:o}),this.asn1ExtnValue.tohex()},this.getBinValue=function(){var o=this.params;if("object"!=typeof o||"object"!=typeof o.names&&"string"!=typeof o.bin)throw new r("parameter not yet set");if(null!=o.names)return cr(o.names,s);if(null!=o.bin)return o.bin;throw new r("parameter not set properly")},this.oid="2.5.29.15",void 0!==e&&(this.params=e)},ne(l.asn1.x509.KeyUsage,l.asn1.x509.Extension),l.asn1.x509.BasicConstraints=function(e){l.asn1.x509.BasicConstraints.superclass.constructor.call(this,e);var r=l.asn1,s=r.DERBoolean,o=r.DERInteger,h=r.DERSequence;this.getExtnValueHex=function(){var v=new Array;this.cA&&v.push(new s),this.pathLen>-1&&v.push(new o({int:this.pathLen}));var w=new h({array:v});return this.asn1ExtnValue=w,this.asn1ExtnValue.tohex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,void 0!==e&&(void 0!==e.cA&&(this.cA=e.cA),void 0!==e.pathLen&&(this.pathLen=e.pathLen))},ne(l.asn1.x509.BasicConstraints,l.asn1.x509.Extension),l.asn1.x509.CRLDistributionPoints=function(e){l.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,e);var s=l.asn1,o=s.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.setByDPArray=function(h){for(var d=[],f=0;f<h.length;f++)if(h[f]instanceof l.asn1.ASN1Object)d.push(h[f]);else{var v=new o.DistributionPoint(h[f]);d.push(v)}this.asn1ExtnValue=new s.DERSequence({array:d})},this.setByOneURI=function(h){var d=new o.DistributionPoint({fulluri:h});this.setByDPArray([d])},this.oid="2.5.29.31",void 0!==e&&(void 0!==e.array?this.setByDPArray(e.array):void 0!==e.uri&&this.setByOneURI(e.uri))},ne(l.asn1.x509.CRLDistributionPoints,l.asn1.x509.Extension),l.asn1.x509.DistributionPoint=function(e){l.asn1.x509.DistributionPoint.superclass.constructor.call(this);var o=l.asn1,h=o.x509.DistributionPointName;this.tohex=function(){var d=new o.DERSequence;if(null!=this.asn1DP){var f=new o.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});d.appendASN1Object(f)}return this.hTLV=d.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.dpobj?this.asn1DP=e.dpobj:void 0!==e.dpname?this.asn1DP=new h(e.dpname):void 0!==e.fulluri&&(this.asn1DP=new h({full:[{uri:e.fulluri}]})))},ne(l.asn1.x509.DistributionPoint,l.asn1.ASN1Object),l.asn1.x509.DistributionPointName=function(e){l.asn1.x509.DistributionPointName.superclass.constructor.call(this);var f=l.asn1,v=f.DERTaggedObject;if(this.tohex=function(){if("full"!=this.type)throw new Error("currently type shall be 'full': "+this.type);return this.asn1Obj=new v({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e)if(f.x509.GeneralNames.prototype.isPrototypeOf(e))this.type="full",this.tag="a0",this.asn1V=e;else{if(void 0===e.full)throw new Error("This class supports GeneralNames only as argument");this.type="full",this.tag="a0",this.asn1V=new f.x509.GeneralNames(e.full)}},ne(l.asn1.x509.DistributionPointName,l.asn1.ASN1Object),l.asn1.x509.CertificatePolicies=function(e){l.asn1.x509.CertificatePolicies.superclass.constructor.call(this,e);var s=l.asn1,h=s.DERSequence,d=s.x509.PolicyInformation;this.params=null,this.getExtnValueHex=function(){for(var f=[],v=0;v<this.params.array.length;v++)f.push(new d(this.params.array[v]));var w=new h({array:f});return this.asn1ExtnValue=w,this.asn1ExtnValue.tohex()},this.oid="2.5.29.32",void 0!==e&&(this.params=e)},ne(l.asn1.x509.CertificatePolicies,l.asn1.x509.Extension),l.asn1.x509.PolicyInformation=function(e){l.asn1.x509.PolicyInformation.superclass.constructor.call(this,e);var r=l.asn1,s=r.DERSequence,o=r.DERObjectIdentifier,h=r.x509.PolicyQualifierInfo;this.params=null,this.tohex=function(){if(void 0===this.params.policyoid&&void 0===this.params.array)throw new Error("parameter oid and array missing");var d=[new o(this.params.policyoid)];if(void 0!==this.params.array){for(var f=[],v=0;v<this.params.array.length;v++)f.push(new h(this.params.array[v]));f.length>0&&d.push(new s({array:f}))}return new s({array:d}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},ne(l.asn1.x509.PolicyInformation,l.asn1.ASN1Object),l.asn1.x509.PolicyQualifierInfo=function(e){l.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,e);var r=l.asn1,s=r.DERSequence,o=r.DERIA5String,h=r.DERObjectIdentifier,d=r.x509.UserNotice;this.params=null,this.tohex=function(){return void 0!==this.params.cps?new s({array:[new h({oid:"1.3.6.1.5.5.7.2.1"}),new o({str:this.params.cps})]}).tohex():null!=this.params.unotice?new s({array:[new h({oid:"1.3.6.1.5.5.7.2.2"}),new d(this.params.unotice)]}).tohex():void 0},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},ne(l.asn1.x509.PolicyQualifierInfo,l.asn1.ASN1Object),l.asn1.x509.UserNotice=function(e){l.asn1.x509.UserNotice.superclass.constructor.call(this,e);var r=l.asn1.DERSequence,o=l.asn1.x509.DisplayText,h=l.asn1.x509.NoticeReference;this.params=null,this.tohex=function(){var d=[];return void 0!==this.params.noticeref&&d.push(new h(this.params.noticeref)),void 0!==this.params.exptext&&d.push(new o(this.params.exptext)),new r({array:d}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},ne(l.asn1.x509.UserNotice,l.asn1.ASN1Object),l.asn1.x509.NoticeReference=function(e){l.asn1.x509.NoticeReference.superclass.constructor.call(this,e);var r=l.asn1.DERSequence,s=l.asn1.DERInteger,o=l.asn1.x509.DisplayText;this.params=null,this.tohex=function(){var h=[];if(void 0!==this.params.org&&h.push(new o(this.params.org)),void 0!==this.params.noticenum){for(var d=[],f=this.params.noticenum,v=0;v<f.length;v++)d.push(new s(f[v]));h.push(new r({array:d}))}if(0==h.length)throw new Error("parameter is empty");return new r({array:h}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},ne(l.asn1.x509.NoticeReference,l.asn1.ASN1Object),l.asn1.x509.DisplayText=function(e){l.asn1.x509.DisplayText.superclass.constructor.call(this,e),this.hT="0c",void 0!==e&&("ia5"===e.type?this.hT="16":"vis"===e.type?this.hT="1a":"bmp"===e.type&&(this.hT="1e"))},ne(l.asn1.x509.DisplayText,l.asn1.DERAbstractString),l.asn1.x509.PolicyMappings=function(e){l.asn1.x509.PolicyMappings.superclass.constructor.call(this,e);var h=l.asn1.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){for(var d=this.params,f=[],v=0;v<d.array.length;v++){var w=d.array[v];f.push({seq:[{oid:w[0]},{oid:w[1]}]})}return this.asn1ExtnValue=h({seq:f}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.33",void 0!==e&&(this.params=e)},ne(l.asn1.x509.PolicyMappings,l.asn1.x509.Extension),l.asn1.x509.PolicyConstraints=function(e){l.asn1.x509.PolicyConstraints.superclass.constructor.call(this,e);var h=l.asn1.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){var d=this.params,f=[];return null!=d.reqexp&&f.push({tag:{tagi:"80",obj:{int:d.reqexp}}}),null!=d.inhibit&&f.push({tag:{tagi:"81",obj:{int:d.inhibit}}}),this.asn1ExtnValue=h({seq:f}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.36",void 0!==e&&(this.params=e)},ne(l.asn1.x509.PolicyConstraints,l.asn1.x509.Extension),l.asn1.x509.InhibitAnyPolicy=function(e){l.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,e);var h=l.asn1.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=h({int:this.params.skip}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.54",void 0!==e&&(this.params=e)},ne(l.asn1.x509.InhibitAnyPolicy,l.asn1.x509.Extension),l.asn1.x509.NameConstraints=function(e){l.asn1.x509.NameConstraints.superclass.constructor.call(this,e);var s=l.asn1,h=s.ASN1Util.newObject,d=s.x509.GeneralSubtree;this.params=null,this.getExtnValueHex=function(){var f=this.params,v=[];if(null!=f.permit&&null!=f.permit.length){for(var w=[],_=0;_<f.permit.length;_++)w.push(new d(f.permit[_]));v.push({tag:{tagi:"a0",obj:{seq:w}}})}if(null!=f.exclude&&null!=f.exclude.length){var I=[];for(_=0;_<f.exclude.length;_++)I.push(new d(f.exclude[_]));v.push({tag:{tagi:"a1",obj:{seq:I}}})}return this.asn1ExtnValue=h({seq:v}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.30",void 0!==e&&(this.params=e)},ne(l.asn1.x509.NameConstraints,l.asn1.x509.Extension),l.asn1.x509.GeneralSubtree=function(e){l.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var r=l.asn1,o=r.x509.GeneralName,h=r.ASN1Util.newObject;this.params=null,this.setByParam=function(d){this.params=d},this.tohex=function(){var d=this.params,f=[new o(d)];return null!=d.min&&f.push({tag:{tagi:"80",obj:{int:d.min}}}),null!=d.max&&f.push({tag:{tagi:"81",obj:{int:d.max}}}),h({seq:f}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.x509.GeneralSubtree,l.asn1.ASN1Object),l.asn1.x509.ExtKeyUsage=function(e){l.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,e);var s=l.asn1;this.setPurposeArray=function(o){this.asn1ExtnValue=new s.DERSequence;for(var h=0;h<o.length;h++){var d=new s.DERObjectIdentifier(o[h]);this.asn1ExtnValue.appendASN1Object(d)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.37",void 0!==e&&void 0!==e.array&&this.setPurposeArray(e.array)},ne(l.asn1.x509.ExtKeyUsage,l.asn1.x509.Extension),l.asn1.x509.AuthorityKeyIdentifier=function(e){l.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,e);var s=l.asn1,o=s.DERTaggedObject,h=s.x509.GeneralNames;this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var f=new Array;this.asn1KID&&f.push(new o({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&f.push(new o({explicit:!1,tag:"a1",obj:new h([{dn:this.asn1CertIssuer}])})),this.asn1CertSN&&f.push(new o({explicit:!1,tag:"82",obj:this.asn1CertSN}));var v=new s.DERSequence({array:f});return this.asn1ExtnValue=v,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(f){if(void 0!==f.str||void 0!==f.hex)this.asn1KID=new l.asn1.DEROctetString(f);else if("object"==typeof f&&l.crypto.Util.isKey(f)||"string"==typeof f&&-1!=f.indexOf("BEGIN ")){var v=f;"string"==typeof f&&(v=Ie.getKey(f));var w=Ie.getKeyID(v);this.asn1KID=new l.asn1.DEROctetString({hex:w})}},this.setCertIssuerByParam=function(f){void 0!==f.str||void 0!==f.ldapstr||void 0!==f.hex||void 0!==f.certsubject||void 0!==f.certissuer?this.asn1CertIssuer=new l.asn1.x509.X500Name(f):"string"==typeof f&&-1!=f.indexOf("BEGIN ")&&-1!=f.indexOf("CERTIFICATE")&&(this.asn1CertIssuer=new l.asn1.x509.X500Name({certissuer:f}))},this.setCertSNByParam=function(f){if(void 0!==f.str||void 0!==f.bigint||void 0!==f.hex)this.asn1CertSN=new l.asn1.DERInteger(f);else if("string"==typeof f&&-1!=f.indexOf("BEGIN ")&&f.indexOf("CERTIFICATE")){var v=new Se;v.readCertPEM(f);var w=v.getSerialNumberHex();this.asn1CertSN=new l.asn1.DERInteger({hex:w})}},this.oid="2.5.29.35",void 0!==e&&(void 0!==e.kid&&this.setKIDByParam(e.kid),void 0!==e.issuer&&this.setCertIssuerByParam(e.issuer),void 0!==e.sn&&this.setCertSNByParam(e.sn),void 0!==e.issuersn&&"string"==typeof e.issuersn&&-1!=e.issuersn.indexOf("BEGIN ")&&e.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(e.issuersn),this.setCertIssuerByParam(e.issuersn)))},ne(l.asn1.x509.AuthorityKeyIdentifier,l.asn1.x509.Extension),l.asn1.x509.SubjectKeyIdentifier=function(e){l.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,e);var o=l.asn1.DEROctetString;this.asn1KID=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=this.asn1KID,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(h){if(void 0!==h.str||void 0!==h.hex)this.asn1KID=new o(h);else if("object"==typeof h&&l.crypto.Util.isKey(h)||"string"==typeof h&&-1!=h.indexOf("BEGIN")){var d=h;"string"==typeof h&&(d=Ie.getKey(h));var f=Ie.getKeyID(d);this.asn1KID=new l.asn1.DEROctetString({hex:f})}},this.oid="2.5.29.14",void 0!==e&&void 0!==e.kid&&this.setKIDByParam(e.kid)},ne(l.asn1.x509.SubjectKeyIdentifier,l.asn1.x509.Extension),l.asn1.x509.AuthorityInfoAccess=function(e){l.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,e),this.setAccessDescriptionArray=function(r){for(var s=new Array,h=l.asn1,d=h.DERSequence,f=h.DERObjectIdentifier,v=h.x509.GeneralName,w=0;w<r.length;w++){var _,I=r[w];if(void 0!==I.ocsp)_=new d({array:[new f({oid:"1.3.6.1.5.5.7.48.1"}),new v({uri:I.ocsp})]});else{if(void 0===I.caissuer)throw new Error("unknown AccessMethod parameter: "+JSON.stringify(I));_=new d({array:[new f({oid:"1.3.6.1.5.5.7.48.2"}),new v({uri:I.caissuer})]})}s.push(_)}this.asn1ExtnValue=new d({array:s})},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.1.1",void 0!==e&&void 0!==e.array&&this.setAccessDescriptionArray(e.array)},ne(l.asn1.x509.AuthorityInfoAccess,l.asn1.x509.Extension),l.asn1.x509.SubjectAltName=function(e){l.asn1.x509.SubjectAltName.superclass.constructor.call(this,e),this.setNameArray=function(r){this.asn1ExtnValue=new l.asn1.x509.GeneralNames(r)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.17",void 0!==e&&void 0!==e.array&&this.setNameArray(e.array)},ne(l.asn1.x509.SubjectAltName,l.asn1.x509.Extension),l.asn1.x509.IssuerAltName=function(e){l.asn1.x509.IssuerAltName.superclass.constructor.call(this,e),this.setNameArray=function(r){this.asn1ExtnValue=new l.asn1.x509.GeneralNames(r)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.18",void 0!==e&&void 0!==e.array&&this.setNameArray(e.array)},ne(l.asn1.x509.IssuerAltName,l.asn1.x509.Extension),l.asn1.x509.SubjectDirectoryAttributes=function(e){l.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,e);var r=l.asn1,s=r.DERSequence,o=r.ASN1Util.newObject,h=r.x509.OID.name2oid;this.params=null,this.getExtnValueHex=function(){for(var d=[],f=0;f<this.params.array.length;f++){var v=this.params.array[f];if(null==v.attr||null==v.array){var _={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if("dateOfBirth"==v.attr)_.seq[0].oid=h(v.attr),_.seq[1].set[0]={gentime:v.str};else if("placeOfBirth"==v.attr)_.seq[0].oid=h(v.attr),_.seq[1].set[0]={utf8str:v.str};else if("gender"==v.attr)_.seq[0].oid=h(v.attr),_.seq[1].set[0]={prnstr:v.str};else if("countryOfCitizenship"==v.attr)_.seq[0].oid=h(v.attr),_.seq[1].set[0]={prnstr:v.str};else{if("countryOfResidence"!=v.attr)throw new Error("unsupported attribute: "+v.attr);_.seq[0].oid=h(v.attr),_.seq[1].set[0]={prnstr:v.str}}d.push(new o(_))}else d.push(o({seq:[{oid:v.attr},{set:v.array}]}))}var I=new s({array:d});return this.asn1ExtnValue=I,this.asn1ExtnValue.tohex()},this.oid="2.5.29.9",void 0!==e&&(this.params=e)},ne(l.asn1.x509.SubjectDirectoryAttributes,l.asn1.x509.Extension),l.asn1.x509.PrivateExtension=function(e){l.asn1.x509.PrivateExtension.superclass.constructor.call(this,e);var s=l.lang.String.isHex,o=l.asn1,h=o.x509.OID.name2oid,d=o.ASN1Util.newObject;this.params=null,this.setByParam=function(f){this.oid=h(f.extname),this.params=f},this.getExtnValueHex=function(){if(null==this.params.extname||null==this.params.extn)throw new Error("extname or extnhex not specified");var f=this.params.extn;if("string"==typeof f&&s(f))return f;if("object"==typeof f)try{return d(f).tohex()}catch{}throw new Error("unsupported extn value")},null!=e&&this.setByParam(e)},ne(l.asn1.x509.PrivateExtension,l.asn1.x509.Extension),l.asn1.x509.CRL=function(e){l.asn1.x509.CRL.superclass.constructor.call(this);var s=l.asn1,o=s.DERSequence,h=s.DERBitString,d=s.x509,f=d.AlgorithmIdentifier,v=d.TBSCertList;this.params=void 0,this.setByParam=function(w){this.params=w},this.sign=function(){var w=new v(this.params).tohex(),_=new l.crypto.Signature({alg:this.params.sigalg});_.init(this.params.cakey),_.updateHex(w);var I=_.sign();this.params.sighex=I},this.getPEM=function(){return bt(this.tohex(),"X509 CRL")},this.tohex=function(){var w=this.params;if(null==w.tbsobj&&(w.tbsobj=new v(w)),null==w.sighex&&null!=w.cakey&&this.sign(),null==w.sighex)throw new Error("sighex or cakey parameter not defined");var _=[];return _.push(w.tbsobj),_.push(new f({name:w.sigalg})),_.push(new h({hex:"00"+w.sighex})),new o({array:_}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&(this.params=e)},ne(l.asn1.x509.CRL,l.asn1.ASN1Object),l.asn1.x509.TBSCertList=function(e){l.asn1.x509.TBSCertList.superclass.constructor.call(this);var s=l.asn1,o=s.DERInteger,h=s.DERSequence,d=s.DERTaggedObject,v=s.x509,w=v.AlgorithmIdentifier,_=v.Time,I=v.Extensions,T=v.X500Name;this.params=null,this.setByParam=function(m){this.params=m},this.getRevCertSequence=function(){for(var m=[],g=this.params.revcert,A=0;A<g.length;A++){var y=[new o(g[A].sn),new _(g[A].date)];null!=g[A].ext&&y.push(new I(g[A].ext)),m.push(new h({array:y}))}return new h({array:m})},this.tohex=function(){var m=[],g=this.params;if(null!=g.version){var y=new o({int:g.version-1});m.push(y)}if(m.push(new w({name:g.sigalg})),m.push(new T(g.issuer)),m.push(new _(g.thisupdate)),null!=g.nextupdate&&m.push(new _(g.nextupdate)),null!=g.revcert&&m.push(this.getRevCertSequence()),null!=g.ext){var P=new I(g.ext);m.push(new d({tag:"a0",explicit:!0,obj:P}))}return new h({array:m}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.x509.TBSCertList,l.asn1.ASN1Object),l.asn1.x509.CRLEntry=function(e){l.asn1.x509.CRLEntry.superclass.constructor.call(this);var h=l.asn1;this.setCertSerial=function(d){this.sn=new h.DERInteger(d)},this.setRevocationDate=function(d){this.time=new h.x509.Time(d)},this.tohex=function(){var d=new h.DERSequence({array:[this.sn,this.time]});return this.TLV=d.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.time&&this.setRevocationDate(e.time),void 0!==e.sn&&this.setCertSerial(e.sn))},ne(l.asn1.x509.CRLEntry,l.asn1.ASN1Object),l.asn1.x509.CRLNumber=function(e){l.asn1.x509.CRLNumber.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new l.asn1.DERInteger(this.params.num),this.asn1ExtnValue.tohex()},this.oid="2.5.29.20",null!=e&&(this.params=e)},ne(l.asn1.x509.CRLNumber,l.asn1.x509.Extension),l.asn1.x509.CRLReason=function(e){l.asn1.x509.CRLReason.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new l.asn1.DEREnumerated(this.params.code),this.asn1ExtnValue.tohex()},this.oid="2.5.29.21",null!=e&&(this.params=e)},ne(l.asn1.x509.CRLReason,l.asn1.x509.Extension),l.asn1.x509.OCSPNonce=function(e){l.asn1.x509.OCSPNonce.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new l.asn1.DEROctetString(this.params),this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.2",null!=e&&(this.params=e)},ne(l.asn1.x509.OCSPNonce,l.asn1.x509.Extension),l.asn1.x509.OCSPNoCheck=function(e){l.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new l.asn1.DERNull,this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.5",null!=e&&(this.params=e)},ne(l.asn1.x509.OCSPNoCheck,l.asn1.x509.Extension),l.asn1.x509.AdobeTimeStamp=function(e){l.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,e);var s=l.asn1,o=s.DERInteger,h=s.DERBoolean,d=s.DERSequence,f=s.x509.GeneralName;this.params=null,this.getExtnValueHex=function(){var v=this.params,w=[new o(1)];return w.push(new f({uri:v.uri})),null!=v.reqauth&&w.push(new h(v.reqauth)),this.asn1ExtnValue=new d({array:w}),this.asn1ExtnValue.tohex()},this.oid="1.2.840.113583.1.1.9.1",void 0!==e&&this.setByParam(e)},ne(l.asn1.x509.AdobeTimeStamp,l.asn1.x509.Extension),l.asn1.x509.X500Name=function(e){l.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var s=l.asn1,o=s.x509,h=o.RDN;this.setByString=function(f,v){void 0!==v&&(this.sRule=v);var w=f.split("/");w.shift();for(var _=[],I=0;I<w.length;I++)if(w[I].match(/^[^=]+=.+$/))_.push(w[I]);else{var T=_.length-1;_[T]=_[T]+"/"+w[I]}for(I=0;I<_.length;I++)this.asn1Array.push(new h({str:_[I],rule:this.sRule}))},this.setByLdapString=function(f,v){void 0!==v&&(this.sRule=v);var w=o.X500Name.ldapToCompat(f);this.setByString(w,v)},this.setByObject=function(f,v){for(var w in void 0!==v&&(this.sRule=v),f)if(f.hasOwnProperty(w)){var _=new h({str:w+"="+f[w],rule:this.sRule});this.asn1Array?this.asn1Array.push(_):this.asn1Array=[_]}},this.setByParam=function(f){if(void 0!==f.rule&&(this.sRule=f.rule),void 0!==f.array)this.paramArray=f.array;else if(void 0!==f.str)this.setByString(f.str);else if(void 0!==f.ldapstr)this.setByLdapString(f.ldapstr);else if(void 0!==f.hex)this.hTLV=f.hex;else if(void 0!==f.certissuer)(v=new Se).readCertPEM(f.certissuer),this.hTLV=v.getIssuerHex();else if(void 0!==f.certsubject){var v;(v=new Se).readCertPEM(f.certsubject),this.hTLV=v.getSubjectHex()}else"object"==typeof f&&void 0===f.certsubject&&void 0===f.certissuer&&this.setByObject(f)},this.tohex=function(){if("string"==typeof this.hTLV)return this.hTLV;if(0==this.asn1Array.length&&this.paramArray.length>0)for(var f=0;f<this.paramArray.length;f++){var v={array:this.paramArray[f]};"utf8"!=this.sRule&&(v.rule=this.sRule);var w=new h(v);this.asn1Array.push(w)}var _=new s.DERSequence({array:this.asn1Array});return this.hTLV=_.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.x509.X500Name,l.asn1.ASN1Object),l.asn1.x509.X500Name.compatToLDAP=function(e){if("/"!==e.substr(0,1))throw"malformed input";var s=(e=e.substr(1)).split("/");return s.reverse(),s=s.map(function(o){return o.replace(/,/,"\\,")}),s.join(",")},l.asn1.x509.X500Name.onelineToLDAP=function(e){return l.asn1.x509.X500Name.compatToLDAP(e)},l.asn1.x509.X500Name.ldapToCompat=function(e){for(var r=e.split(","),s=!1,o=[],h=0;r.length>0;h++){var d=r.shift();if(!0===s){var v=(o.pop()+","+d).replace(/\\,/g,",");o.push(v),s=!1}else o.push(d);"\\"===d.substr(-1,1)&&(s=!0)}return o=o.map(function(w){return w.replace("/","\\/")}),o.reverse(),"/"+o.join("/")},l.asn1.x509.X500Name.ldapToOneline=function(e){return l.asn1.x509.X500Name.ldapToCompat(e)},l.asn1.x509.RDN=function(e){l.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var r=l.asn1.x509.AttributeTypeAndValue;this.setByParam=function(s){void 0!==s.rule&&(this.sRule=s.rule),void 0!==s.str&&this.addByMultiValuedString(s.str),void 0!==s.array&&(this.paramArray=s.array)},this.addByString=function(s){this.asn1Array.push(new l.asn1.x509.AttributeTypeAndValue({str:s,rule:this.sRule}))},this.addByMultiValuedString=function(s){for(var o=l.asn1.x509.RDN.parseString(s),h=0;h<o.length;h++)this.addByString(o[h])},this.tohex=function(){if(0==this.asn1Array.length&&this.paramArray.length>0)for(var s=0;s<this.paramArray.length;s++){var o=this.paramArray[s];void 0!==o.rule&&"utf8"!=this.sRule&&(o.rule=this.sRule);var h=new r(o);this.asn1Array.push(h)}var d=new l.asn1.DERSet({array:this.asn1Array});return this.TLV=d.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.x509.RDN,l.asn1.ASN1Object),l.asn1.x509.RDN.parseString=function(e){for(var r=e.split(/\+/),s=!1,o=[],h=0;r.length>0;h++){var d=r.shift();if(!0===s){var v=(o.pop()+"+"+d).replace(/\\\+/g,"+");o.push(v),s=!1}else o.push(d);"\\"===d.substr(-1,1)&&(s=!0)}var w=!1,_=[];for(h=0;o.length>0;h++){if(d=o.shift(),!0===w){var I=_.pop();d.match(/"$/)?(v=(I+"+"+d).replace(/^([^=]+)="(.*)"$/,"$1=$2"),_.push(v),w=!1):_.push(I+"+"+d)}else _.push(d);d.match(/^[^=]+="/)&&(w=!0)}return _},l.asn1.x509.AttributeTypeAndValue=function(e){l.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this),this.sRule="utf8",this.sType=null,this.sValue=null,this.dsType=null;var s=l.asn1,o=s.DERSequence,h=s.DERUTF8String,d=s.DERPrintableString,f=s.DERTeletexString,v=s.DERIA5String,w=s.DERVisibleString,_=s.DERBMPString,I=l.lang.String.isMail,T=l.lang.String.isPrintable;this.setByParam=function(m){if(void 0!==m.rule&&(this.sRule=m.rule),void 0!==m.ds&&(this.dsType=m.ds),void 0===m.value&&void 0!==m.str){var A=m.str.match(/^([^=]+)=(.+)$/);if(!A)throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);this.sType=A[1],this.sValue=A[2]}else this.sType=m.type,this.sValue=m.value},this.setByString=function(m,g){void 0!==g&&(this.sRule=g);var A=m.match(/^([^=]+)=(.+)$/);if(!A)throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);this.setByAttrTypeAndValueStr(A[1],A[2])},this._getDsType=function(){var m=this.sType,g=this.sValue,A=this.sRule;return"prn"===A?"CN"==m&&I(g)?"ia5":T(g)?"prn":"utf8":"utf8"===A?"CN"==m&&I(g)?"ia5":"C"==m?"prn":"utf8":"utf8"},this.setByAttrTypeAndValueStr=function(m,g,A){void 0!==A&&(this.sRule=A),this.sType=m,this.sValue=g},this.getValueObj=function(m,g){if("utf8"==m)return new h({str:g});if("prn"==m)return new d({str:g});if("tel"==m)return new f({str:g});if("ia5"==m)return new v({str:g});if("vis"==m)return new w({str:g});if("bmp"==m)return new _({str:g});throw new Error("unsupported directory string type: type="+m+" value="+g)},this.tohex=function(){null==this.dsType&&(this.dsType=this._getDsType());var m=l.asn1.x509.OID.atype2obj(this.sType),g=this.getValueObj(this.dsType,this.sValue),A=new o({array:[m,g]});return this.TLV=A.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.x509.AttributeTypeAndValue,l.asn1.ASN1Object),l.asn1.x509.SubjectPublicKeyInfo=function(e){l.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var h=l.asn1,d=h.DERInteger,f=h.DERBitString,v=h.DERObjectIdentifier,w=h.DERSequence,_=h.ASN1Util.newObject,T=h.x509.AlgorithmIdentifier;this.getASN1Object=function(){if(null==this.asn1AlgId||null==this.asn1SubjPKey)throw"algId and/or subjPubKey not set";return new w({array:[this.asn1AlgId,this.asn1SubjPKey]})},this.tohex=function(){var y=this.getASN1Object();return this.hTLV=y.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.setPubKey=function(y){try{if(y instanceof Ee){var x=_({seq:[{int:{bigint:y.n}},{int:{int:y.e}}]}).tohex();this.asn1AlgId=new T({name:"rsaEncryption"}),this.asn1SubjPKey=new f({hex:"00"+x})}}catch{}try{if(y instanceof l.crypto.ECDSA){var N=new v({name:y.curveName});this.asn1AlgId=new T({name:"ecPublicKey",asn1params:N}),this.asn1SubjPKey=new f({hex:"00"+y.pubKeyHex})}}catch{}try{if(y instanceof l.crypto.DSA){N=new _({seq:[{int:{bigint:y.p}},{int:{bigint:y.q}},{int:{bigint:y.g}}]}),this.asn1AlgId=new T({name:"dsa",asn1params:N});var B=new d({bigint:y.y});this.asn1SubjPKey=new f({hex:"00"+B.tohex()})}}catch{}},void 0!==e&&this.setPubKey(e)},ne(l.asn1.x509.SubjectPublicKeyInfo,l.asn1.ASN1Object),l.asn1.x509.Time=function(e){l.asn1.x509.Time.superclass.constructor.call(this);var h=l.asn1,d=h.DERUTCTime,f=h.DERGeneralizedTime;this.params=null,this.type=null,this.setTimeParams=function(v){this.timeParams=v},this.setByParam=function(v){this.params=v},this.getType=function(v){return v.match(/^[0-9]{12}Z$/)?"utc":v.match(/^[0-9]{14}Z$/)?"gen":v.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":v.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null},this.tohex=function(){var v=this.params,w=null;if("string"==typeof v&&(v={str:v}),null!=v&&v.str&&(null==v.type||null==v.type)&&(v.type=this.getType(v.str)),null!=v&&v.str?("utc"==v.type&&(w=new d(v.str)),"gen"==v.type&&(w=new f(v.str))):w="gen"==this.type?new f:new d,null==w)throw new Error("wrong setting for Time");return this.TLV=w.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},l.asn1.x509.Time_bak=function(e){l.asn1.x509.Time_bak.superclass.constructor.call(this);var h=l.asn1,d=h.DERUTCTime,f=h.DERGeneralizedTime;this.setTimeParams=function(v){this.timeParams=v},this.tohex=function(){var v=null;return v=null!=this.timeParams?"utc"==this.type?new d(this.timeParams):new f(this.timeParams):"utc"==this.type?new d:new f,this.TLV=v.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},this.type="utc",void 0!==e&&(void 0!==e.type?this.type=e.type:void 0!==e.str&&(e.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),e.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=e)},ne(l.asn1.x509.Time,l.asn1.ASN1Object),l.asn1.x509.AlgorithmIdentifier=function(e){l.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var s=l.asn1,o=s.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;if(this.tohex=function(){if(null===this.nameAlg&&null===this.asn1Alg)throw new Error("algorithm not specified");if(null!==this.nameAlg){var d=null;for(var f in o)f===this.nameAlg&&(d=o[f]);if(null!==d)return this.hTLV=d,this.hTLV}null!==this.nameAlg&&null===this.asn1Alg&&(this.asn1Alg=s.x509.OID.name2obj(this.nameAlg));var v=[this.asn1Alg];null!==this.asn1Params&&v.push(this.asn1Params);var w=new s.DERSequence({array:v});return this.hTLV=w.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.name&&(this.nameAlg=e.name),void 0!==e.asn1params&&(this.asn1Params=e.asn1params),void 0!==e.paramempty&&(this.paramEmpty=e.paramempty)),null===this.asn1Params&&!1===this.paramEmpty&&null!==this.nameAlg){void 0!==this.nameAlg.name&&(this.nameAlg=this.nameAlg.name);var h=this.nameAlg.toLowerCase();"withdsa"!==h.substr(-7,7)&&"withecdsa"!==h.substr(-9,9)&&(this.asn1Params=new s.DERNull)}},ne(l.asn1.x509.AlgorithmIdentifier,l.asn1.ASN1Object),l.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"},l.asn1.x509.GeneralName=function(e){l.asn1.x509.GeneralName.superclass.constructor.call(this);var o=l.asn1,h=o.x509,d=h.X500Name,f=h.OtherName,v=o.DERIA5String,_=o.DEROctetString,I=o.DERTaggedObject,T=o.ASN1Object,m=Error;this.params=null,this.setByParam=function(g){this.params=g},this.tohex=function(){var A,y,g=this.params,P=!1;if(void 0!==g.other)A="a0",y=new f(g.other);else if(void 0!==g.rfc822)A="81",y=new v({str:g.rfc822});else if(void 0!==g.dns)A="82",y=new v({str:g.dns});else if(void 0!==g.dn)A="a4",P=!0,y="string"==typeof g.dn?new d({str:g.dn}):g.dn instanceof l.asn1.x509.X500Name?g.dn:new d(g.dn);else if(void 0!==g.ldapdn)A="a4",P=!0,y=new d({ldapstr:g.ldapdn});else if(void 0!==g.certissuer||void 0!==g.certsubj){A="a4",P=!0;var x,N,B=null;if(void 0!==g.certsubj?(x=!1,N=g.certsubj):(x=!0,N=g.certissuer),N.match(/^[0-9A-Fa-f]+$/),-1!=N.indexOf("-----BEGIN ")&&(B=nt(N)),null==B)throw new Error("certsubj/certissuer not cert");var j,M=new Se;M.hex=B,j=x?M.getIssuerHex():M.getSubjectHex(),(y=new T).hTLV=j}else if(void 0!==g.uri)A="86",y=new v({str:g.uri});else{if(void 0===g.ip)throw new m("improper params");A="87";var Q,Y=g.ip;try{if(Y.match(/^[0-9a-f]+$/)){var R=Y.length;if(8!=R&&16!=R&&32!=R&&64!=R)throw"err";Q=Y}else Q=gs(Y)}catch(L){throw new m("malformed IP address: "+g.ip+":"+L.message)}y=new _({hex:Q})}return new I({tag:A,explicit:P,obj:y}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.x509.GeneralName,l.asn1.ASN1Object),l.asn1.x509.GeneralNames=function(e){l.asn1.x509.GeneralNames.superclass.constructor.call(this);var o=l.asn1;this.setByParamArray=function(h){for(var d=0;d<h.length;d++){var f=new o.x509.GeneralName(h[d]);this.asn1Array.push(f)}},this.tohex=function(){return new o.DERSequence({array:this.asn1Array}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.asn1Array=new Array,typeof e<"u"&&this.setByParamArray(e)},ne(l.asn1.x509.GeneralNames,l.asn1.ASN1Object),l.asn1.x509.OtherName=function(e){l.asn1.x509.OtherName.superclass.constructor.call(this);var h=l.asn1,d=h.DERObjectIdentifier,f=h.DERSequence,v=h.ASN1Util.newObject;this.params=null,this.setByParam=function(w){this.params=w},this.tohex=function(){var w=this.params;if(null==w.oid||null==w.value)throw new Error("oid or value not specified");var _=new d({oid:w.oid}),I=v({tag:{tag:"a0",explicit:!0,obj:w.value}});return new f({array:[_,I]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.x509.OtherName,l.asn1.ASN1Object),l.asn1.x509.OID=new function(){var e=l.asn1.DERObjectIdentifier;this.name2oidList={"aes128-CBC":"2.16.840.1.101.3.4.1.2","aes256-CBC":"2.16.840.1.101.3.4.1.42",sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",hmacWithSHA1:"1.2.840.113549.2.7",hmacWithSHA224:"1.2.840.113549.2.8",hmacWithSHA256:"1.2.840.113549.2.9",hmacWithSHA384:"1.2.840.113549.2.10",hmacWithSHA512:"1.2.840.113549.2.11",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1",smimeMailboxLegacy:"2.23.140.1.5.1.1",smimeMailboxMulti:"2.23.140.1.5.1.2",smimeMailboxStrict:"2.23.140.1.5.1.3",smimeOrganizationLegacy:"2.23.140.1.5.2.1",smimeOrganizationMulti:"2.23.140.1.5.2.2",smimeOrganizationStrict:"2.23.140.1.5.2.3",smimeSponsorLegacy:"2.23.140.1.5.3.1",smimeSponsorMulti:"2.23.140.1.5.3.2",smimeSponsorStrict:"2.23.140.1.5.3.3",smimeIndividualLegacy:"2.23.140.1.5.4.1",smimeIndividualMulti:"2.23.140.1.5.4.2",smimeIndividualStrict:"2.23.140.1.5.4.3"},this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",GN:"2.5.4.42",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.objCache={},this.name2obj=function(r){if(typeof this.objCache[r]<"u")return this.objCache[r];if(typeof this.name2oidList[r]>"u")throw"Name of ObjectIdentifier not defined: "+r;var o=new e({oid:this.name2oidList[r]});return this.objCache[r]=o,o},this.atype2obj=function(r){if(void 0!==this.objCache[r])return this.objCache[r];var s;if(r.match(/^\d+\.\d+\.[0-9.]+$/))s=r;else if(void 0!==this.atype2oidList[r])s=this.atype2oidList[r];else{if(void 0===this.name2oidList[r])throw new Error("AttributeType name undefined: "+r);s=this.name2oidList[r]}var o=new e({oid:s});return this.objCache[r]=o,o},this.registerOIDs=function(r){if(this.checkOIDs(r))for(var s in r)this.name2oidList[s]=r[s]},this.checkOIDs=function(r){try{var s=Object.keys(r);return 0!=s.length&&(s.map(function(o,h,d){if(!this[o].match(/^[0-2]\.[0-9.]+$/))throw new Error("value is not OID")},r),!0)}catch{return!1}}},l.asn1.x509.OID.oid2name=function(e){var r=l.asn1.x509.OID.name2oidList;for(var s in r)if(r[s]==e)return s;return""},l.asn1.x509.OID.oid2atype=function(e){var r=l.asn1.x509.OID.atype2oidList;for(var s in r)if(r[s]==e)return s;return e},l.asn1.x509.OID.name2oid=function(e){if(e.match(/^[0-9.]+$/))return e;var r=l.asn1.x509.OID.name2oidList;return void 0===r[e]?"":r[e]},l.asn1.x509.X509Util={},l.asn1.x509.X509Util.newCertPEM=function(e){return new(0,l.asn1.x509.Certificate)(e).getPEM()},(typeof l>"u"||!l)&&(l={}),(typeof l.asn1>"u"||!l.asn1)&&(l.asn1={}),(typeof l.asn1.cms>"u"||!l.asn1.cms)&&(l.asn1.cms={}),l.asn1.cms.Attribute=function(e){var r=Error,o=l.asn1,h=o.DERSequence,d=o.DERSet,f=o.DERObjectIdentifier;this.params=null,this.typeOid=null,this.setByParam=function(v){this.params=v},this.getValueArray=function(){throw new r("not yet implemented abstract")},this.tohex=function(){var v=new f({oid:this.typeOid}),w=new d({array:this.getValueArray()});return new h({array:[v,w]}).tohex()},this.getEncodedHex=function(){return this.tohex()}},ne(l.asn1.cms.Attribute,l.asn1.ASN1Object),l.asn1.cms.ContentType=function(e){var s=l.asn1;s.cms.ContentType.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.3",this.getValueArray=function(){return[new s.DERObjectIdentifier(this.params.type)]},null!=e&&this.setByParam(e)},ne(l.asn1.cms.ContentType,l.asn1.cms.Attribute),l.asn1.cms.MessageDigest=function(e){var s=l.asn1,o=s.DEROctetString;s.cms.MessageDigest.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.4",this.getValueArray=function(){return[new o(this.params)]},null!=e&&this.setByParam(e)},ne(l.asn1.cms.MessageDigest,l.asn1.cms.Attribute),l.asn1.cms.SigningTime=function(e){var s=l.asn1;s.cms.SigningTime.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.5",this.getValueArray=function(){return[new s.x509.Time(this.params)]},null!=e&&this.setByParam(e)},ne(l.asn1.cms.SigningTime,l.asn1.cms.Attribute),l.asn1.cms.SigningCertificate=function(e){var r=Error,o=l.asn1,h=o.DERSequence,d=o.cms,f=d.ESSCertID;d.SigningCertificate.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.12",this.getValueArray=function(){if(null==this.params||null==this.params||null==this.params.array)throw new r("parameter 'array' not specified");for(var w=this.params.array,_=[],I=0;I<w.length;I++){var T=w[I];0==e.hasis&&"string"==typeof T&&(-1!=T.indexOf("-----BEGIN")||ue.isASN1HEX(T))&&(T={cert:T}),0!=T.hasis&&0==e.hasis&&(T.hasis=!1),_.push(new f(T))}var m=new h({array:_});return[new h({array:[m]})]},null!=e&&this.setByParam(e)},ne(l.asn1.cms.SigningCertificate,l.asn1.cms.Attribute),l.asn1.cms.ESSCertID=function(e){l.asn1.cms.ESSCertID.superclass.constructor.call(this);var r=Error,s=l,o=s.asn1,h=o.DEROctetString,d=o.DERSequence,f=o.cms.IssuerSerial;this.params=null,this.getCertHash=function(v,w){if(null!=v.hash)return v.hash;if("string"==typeof v&&-1==v.indexOf("-----BEGIN")&&!ue.isASN1HEX(v))return v;var _,I,T;if("string"==typeof v)_=v;else{if(null==v.cert)throw new r("hash nor cert unspecified");_=v.cert}if(I=-1!=_.indexOf("-----BEGIN")?nt(_):_,"string"==typeof v&&(-1!=v.indexOf("-----BEGIN")?I=nt(v):ue.isASN1HEX(v)&&(I=v)),null!=v.alg)T=v.alg;else{if(null==w)throw new r("hash alg unspecified");T=w}return s.crypto.Util.hashHex(I,T)},this.tohex=function(){var v=this.params,w=this.getCertHash(v,"sha1"),_=[];return _.push(new h({hex:w})),("string"==typeof v&&-1!=v.indexOf("-----BEGIN")||null!=v.cert&&0!=v.hasis||null!=v.issuer&&null!=v.serial)&&_.push(new f(v)),new d({array:_}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cms.ESSCertID,l.asn1.ASN1Object),l.asn1.cms.SigningCertificateV2=function(e){var r=Error,o=l.asn1,h=o.DERSequence,f=o.cms,v=f.ESSCertIDv2;f.SigningCertificateV2.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.47",this.getValueArray=function(){if(null==this.params||null==this.params||null==this.params.array)throw new r("parameter 'array' not specified");for(var _=this.params.array,I=[],T=0;T<_.length;T++){var m=_[T];(null!=e.alg||0==e.hasis)&&"string"==typeof m&&(-1!=m.indexOf("-----BEGIN")||ue.isASN1HEX(m))&&(m={cert:m}),null==m.alg&&null!=e.alg&&(m.alg=e.alg),0!=m.hasis&&0==e.hasis&&(m.hasis=!1),I.push(new v(m))}var g=new h({array:I});return[new h({array:[g]})]},null!=e&&this.setByParam(e)},ne(l.asn1.cms.SigningCertificateV2,l.asn1.cms.Attribute),l.asn1.cms.ESSCertIDv2=function(e){l.asn1.cms.ESSCertIDv2.superclass.constructor.call(this),Error;var o=l.asn1,h=o.DEROctetString,d=o.DERSequence,f=o.cms.IssuerSerial,v=o.x509.AlgorithmIdentifier;this.params=null,this.tohex=function(){var w=this.params,_=this.getCertHash(w,"sha256"),I=[];return null!=w.alg&&"sha256"!=w.alg&&I.push(new v({name:w.alg})),I.push(new h({hex:_})),("string"==typeof w&&-1!=w.indexOf("-----BEGIN")||null!=w.cert&&0!=w.hasis||null!=w.issuer&&null!=w.serial)&&I.push(new f(w)),new d({array:I}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cms.ESSCertIDv2,l.asn1.cms.ESSCertID),l.asn1.cms.IssuerSerial=function(e){var r=Error,o=l.asn1,h=o.DERInteger,d=o.DERSequence,w=o.x509.GeneralNames,_=Se;o.cms.IssuerSerial.superclass.constructor.call(this),this.setByParam=function(I){this.params=I},this.tohex=function(){var T,m,I=this.params;if("string"==typeof I&&-1!=I.indexOf("-----BEGIN")||null!=I.cert){var g;g=null!=I.cert?I.cert:I;var A=new _;A.readCertPEM(g),T=A.getIssuer(),m={hex:A.getSerialNumberHex()}}else{if(null==I.issuer||!I.serial)throw new r("cert or issuer and serial parameter not specified");T=I.issuer,m=I.serial}var y=new w([{dn:T}]),P=new h(m);return new d({array:[y,P]}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cms.IssuerSerial,l.asn1.ASN1Object),l.asn1.cms.SignerIdentifier=function(e){var d=l.asn1.cms,f=d.IssuerAndSerialNumber,v=d.SubjectKeyIdentifier;Error,d.SignerIdentifier.superclass.constructor.call(this),this.params=null,this.tohex=function(){var m=this.params;if("isssn"==m.type)return new f(m).tohex();if("skid"==m.type)return new v(m).tohex();throw new Error("wrong property for isssn or skid")},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cms.SignerIdentifier,l.asn1.ASN1Object),l.asn1.cms.IssuerAndSerialNumber=function(e){var s=l.asn1,o=s.DERInteger,h=s.DERSequence,v=s.x509.X500Name,w=Se,_=Error;s.cms.IssuerAndSerialNumber.superclass.constructor.call(this),this.params=null,this.tohex=function(){var T,m,I=this.params;if("string"==typeof I&&-1!=I.indexOf("-----BEGIN")||null!=I.cert){var g;g=null!=I.cert?I.cert:I;var A=new w;A.readCertPEM(g),T=A.getIssuer(),m={hex:A.getSerialNumberHex()}}else{if(null==I.issuer||!I.serial)throw new _("cert or issuer and serial parameter not specified");T=I.issuer,m=I.serial}var y=new v(T),P=new o(m);return new h({array:[y,P]}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(I){this.params=I},null!=e&&this.setByParam(e)},ne(l.asn1.cms.IssuerAndSerialNumber,l.asn1.ASN1Object),l.asn1.cms.SubjectKeyIdentifier=function(e){var s=l.asn1,d=s.ASN1Util.newObject,T=Se,m=Error;s.cms.SubjectKeyIdentifier.superclass.constructor.call(this),this.tohex=function(){var A,g=this.params;if(null==g.cert&&null==g.skid)throw new m("property cert nor skid undefined");return null!=g.cert?A=new T(g.cert).getExtSubjectKeyIdentifier().kid.hex:null!=g.skid&&(A=g.skid),d({tag:{tage:"a0",obj:{octstr:{hex:A}}}}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cms.SubjectKeyIdentifier,l.asn1.ASN1Object),l.asn1.cms.AttributeList=function(e){var r=Error,o=l.asn1,h=o.DERSet,d=o.cms;d.AttributeList.superclass.constructor.call(this),this.params=null,this.hTLV=null,this.setByParam=function(f){this.params=f},this.tohex=function(){var f=this.params;if(null!=this.hTLV)return this.hTLV;var v=!0;null!=f.sortflag&&(v=f.sortflag);for(var w=f.array,_=[],I=0;I<w.length;I++){var T=w[I],m=T.attr;if("contentType"==m)_.push(new d.ContentType(T));else if("messageDigest"==m)_.push(new d.MessageDigest(T));else if("signingTime"==m)_.push(new d.SigningTime(T));else if("signingCertificate"==m)_.push(new d.SigningCertificate(T));else if("signingCertificateV2"==m)_.push(new d.SigningCertificateV2(T));else if("signaturePolicyIdentifier"==m)_.push(new l.asn1.cades.SignaturePolicyIdentifier(T));else{if("signatureTimeStamp"!=m&&"timeStampToken"!=m)throw new r("unknown attr: "+m);_.push(new l.asn1.cades.SignatureTimeStamp(T))}}var g=new h({array:_,sortflag:v});return this.hTLV=g.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cms.AttributeList,l.asn1.ASN1Object),l.asn1.cms.SignerInfo=function(e){var r=Error,o=l.asn1,h=o.DERInteger,d=o.DEROctetString,f=o.DERSequence,v=o.DERTaggedObject,w=o.cms,_=w.SignerIdentifier,I=w.AttributeList,P=o.x509.AlgorithmIdentifier,x=l.crypto,N=Ie;w.SignerInfo.superclass.constructor.call(this),this.params=null,this.sign=function(){var B=this.params,M=B.sigalg,j=new I(B.sattrs).tohex(),Q=N.getKey(B.signkey),Y=new x.Signature({alg:M});Y.init(Q),Y.updateHex(j);var R=Y.sign();B.sighex=R},this.tohex=function(){var B=this.params,M=[];if(M.push(new h({int:B.version})),M.push(new _(B.id)),M.push(new P({name:B.hashalg})),null!=B.sattrs){var j=new I(B.sattrs);try{M.push(new v({tag:"a0",explicit:!1,obj:j}))}catch(Y){throw new r("si sattr error: "+Y)}}if(M.push(new P(null!=B.sigalgfield?{name:B.sigalgfield}:{name:B.sigalg})),null==B.sighex&&null!=B.signkey&&this.sign(),M.push(new d({hex:B.sighex})),null!=B.uattrs){j=new I(B.uattrs);try{M.push(new v({tag:"a1",explicit:!1,obj:j}))}catch(R){throw new r("si uattr error: "+R)}}return new f({array:M}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cms.SignerInfo,l.asn1.ASN1Object),l.asn1.cms.EncapsulatedContentInfo=function(e){var s=l.asn1,o=s.DERTaggedObject,h=s.DERSequence,d=s.DERObjectIdentifier,f=s.DEROctetString;s.cms.EncapsulatedContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var w=this.params,_=[];if(_.push(new d(w.type)),null!=w.content&&(null!=w.content.hex||null!=w.content.str)&&1!=w.isDetached){var I=new f(w.content),T=new o({tag:"a0",explicit:!0,obj:I});_.push(T)}return new h({array:_}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(w){this.params=w},null!=e&&this.setByParam(e)},ne(l.asn1.cms.EncapsulatedContentInfo,l.asn1.ASN1Object),l.asn1.cms.ContentInfo=function(e){var s=l.asn1,o=s.DERTaggedObject,h=s.DERSequence,d=s.DERObjectIdentifier;l.asn1.cms.ContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var w=this.params,_=[];_.push(new d(w.type));var I=new o({tag:"a0",explicit:!0,obj:w.obj});return _.push(I),new h({array:_}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(w){this.params=w},null!=e&&this.setByParam(e)},ne(l.asn1.cms.ContentInfo,l.asn1.ASN1Object),l.asn1.cms.SignedData=function(e){Error;var o=l.asn1,d=o.DERInteger,f=o.DERSet,v=o.DERSequence,_=o.cms,I=_.EncapsulatedContentInfo,T=_.SignerInfo,m=_.ContentInfo,g=_.CertificateSet,A=_.RevocationInfoChoices,P=o.x509.AlgorithmIdentifier;l.asn1.cms.SignedData.superclass.constructor.call(this),this.params=null,this.checkAndFixParam=function(){var x=this.params;this._setDigestAlgs(x),this._setContentTypeByEContent(x),this._setMessageDigestByEContent(x),this._setSignerInfoVersion(x),this._setSignedDataVersion(x)},this._setDigestAlgs=function(x){for(var N={},B=x.sinfos,M=0;M<B.length;M++)N[B[M].hashalg]=1;x.hashalgs=Object.keys(N).sort()},this._setContentTypeByEContent=function(x){for(var N=x.econtent.type,B=x.sinfos,M=0;M<B.length;M++)this._getAttrParamByName(B[M],"contentType").type=N},this._setMessageDigestByEContent=function(x){var N=x.econtent,M=N.content.hex;null==M&&"data"==N.type&&null!=N.content.str&&(M=ei(N.content.str));for(var j=x.sinfos,Q=0;Q<j.length;Q++){var Y=j[Q],R=Y.hashalg,D=this._getAttrParamByName(Y,"messageDigest"),L=l.crypto.Util.hashHex(M,R);D.hex=L}},this._getAttrParamByName=function(x,N){for(var B=x.sattrs.array,M=0;M<B.length;M++)if(B[M].attr==N)return B[M]},this._setSignerInfoVersion=function(x){for(var N=x.sinfos,B=0;B<N.length;B++){var M=N[B],j=1;"skid"==M.id.type&&(j=3),M.version=j}},this._setSignedDataVersion=function(x){var N=this._getSignedDataVersion(x);x.version=N},this._getSignedDataVersion=function(x){if(null!=x.revinfos)for(var N=x.revinfos,B=0;B<N.length;B++)if(null!=N[B].ocsp)return 5;var j=x.sinfos;for(B=0;B<j.length;B++)if(3==x.sinfos[B].version)return 3;return"data"!=x.econtent.type?3:1},this.tohex=function(){var x=this.params;null!=this.getEncodedHexPrepare&&this.getEncodedHexPrepare(),1!=x.fixed&&this.checkAndFixParam();var N=[];N.push(new d({int:x.version}));for(var B=[],M=0;M<x.hashalgs.length;M++)B.push(new P({name:x.hashalgs[M]}));N.push(new f({array:B})),N.push(new I(x.econtent)),null!=x.certs&&N.push(new g(x.certs)),null!=x.revinfos&&N.push(new A(x.revinfos));var Q=[];for(M=0;M<x.sinfos.length;M++)Q.push(new T(x.sinfos[M]));return N.push(new f({array:Q})),new v({array:N}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.getContentInfo=function(){return new m({type:"signed-data",obj:this})},this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cms.SignedData,l.asn1.ASN1Object),l.asn1.cms.CertificateSet=function(e){l.asn1.cms.CertificateSet.superclass.constructor.call(this);var r=Error,s=l.asn1,o=s.DERTaggedObject,h=s.DERSet,d=s.ASN1Object;this.params=null,this.tohex=function(){var w,f=this.params,v=[];if(f instanceof Array)w=f;else{if(null==f.array)throw new r("cert array not specified");w=f.array}for(var _=0;_<w.length;_++){var T=nt(w[_]),m=new d;m.hTLV=T,v.push(m)}var g={array:v};0==f.sortflag&&(g.sortflag=!1);var A=new h(g);return new o({tag:"a0",explicit:!1,obj:A}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cms.CertificateSet,l.asn1.ASN1Object),l.asn1.cms.RevocationInfoChoices=function(e){l.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this),this.params=null,this.tohex=function(){var r=this.params;if(!r instanceof Array)throw new Error("params is not array");for(var s=[],o=0;o<r.length;o++)s.push(new l.asn1.cms.RevocationInfoChoice(r[o]));return l.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:s}}}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cms.RevocationInfoChoices,l.asn1.ASN1Object),l.asn1.cms.RevocationInfoChoice=function(e){l.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this),this.params=null,this.tohex=function(){var r=this.params;if(null!=r.crl&&"string"==typeof r.crl){var s=r.crl;return-1!=r.crl.indexOf("-----BEGIN")&&(s=nt(r.crl)),s}if(null!=r.ocsp)return l.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new l.asn1.cms.OtherRevocationFormat(r)}}).tohex();throw new Error("property crl or ocsp undefined")},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cms.RevocationInfoChoice,l.asn1.ASN1Object),l.asn1.cms.OtherRevocationFormat=function(e){l.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var r=Error,h=l.asn1.ASN1Util.newObject,d=l.lang.String.isHex;this.params=null,this.tohex=function(){var f=this.params;if(null==f.ocsp)throw new r("property ocsp not specified");if(!d(f.ocsp)||!ue.isASN1HEX(f.ocsp))throw new r("ocsp value not ASN.1 hex string");return h({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:f.ocsp}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cms.OtherRevocationFormat,l.asn1.ASN1Object),l.asn1.cms.CMSUtil=new function(){},l.asn1.cms.CMSUtil.newSignedData=function(e){return new l.asn1.cms.SignedData(e)},l.asn1.cms.CMSUtil.verifySignedData=function(e){var g=ue.getVbyList,A=ue.getTLVbyList,y=ue.getIdxbyList,P=ue.getChildIdx,x=ue.getTLV,N=ue.oidname,B=l.crypto.Util.hashHex;void 0===e.cms&&(0,l.lang.String.isHex)(e.cms);var M=e.cms,Y=function($,J){var ee=J.idx;J.signerid_issuer1=A($,ee,[1,0],"30"),J.signerid_serial1=g($,ee,[1,1],"02"),J.hashalg=N(g($,ee,[2,0],"06"));var be=y($,ee,[3],"a0");J.idxSignedAttrs=be,R($,J,be);var ye=P($,ee).length;if(ye<6)throw"malformed SignerInfo";J.sigalg=N(g($,ee,[ye-2,0],"06")),J.sigval=g($,ee,[ye-1],"04")},R=function($,J,ee){var be=P($,ee);J.signedAttrIdxList=be;for(var we=0;we<be.length;we++){var Te,ye=be[we],Oe=g($,ye,[0],"06");"2a864886f70d010905"===Oe?(Te=Ve(g($,ye,[1,0])),J.saSigningTime=Te):"2a864886f70d010904"===Oe&&(Te=g($,ye,[1,0],"04"),J.saMessageDigest=Te)}},z=function($,J,ee,be){ee.verifyDetail={};var we=ee.verifyDetail,ye=J.parse.econtent,Oe=ee.hashalg,Te=ee.saMessageDigest;we.validMessageDigest=!1,B(ye,Oe)===Te&&(we.validMessageDigest=!0),function($,J,ee,be){var ye,we=J.parse.certsIdx;if(void 0===J.certs){ye=[],J.certkeys=[];for(var Oe=P($,we),Te=0;Te<Oe.length;Te++){var Xe=x($,Oe[Te]),ze=new Se;ze.readCertHex(Xe),ye[Te]=ze,J.certkeys[Te]=ze.getPublicKey()}J.certs=ye}else ye=J.certs;for(J.cccc=ye.length,J.cccci=Oe.length,Te=0;Te<ye.length;Te++){var ci=ze.getIssuerHex(),Bt=ze.getSerialNumberHex();ee.signerid_issuer1===ci&&ee.signerid_serial1===Bt&&(ee.certkey_idx=Te)}}($,J,ee),we.validSignatureValue=!1;var Xe=ee.sigalg,ze="31"+x($,ee.idxSignedAttrs).substr(2);ee.signedattrshex=ze;var ci=J.certs[ee.certkey_idx].getPublicKey(),Bt=new l.crypto.Signature({alg:Xe});Bt.init(ci),Bt.updateHex(ze);var yt=Bt.verify(ee.sigval);we.validSignatureValue_isValid=yt,!0===yt&&(we.validSignatureValue=!0),ee.isValid=!1,we.validMessageDigest&&we.validSignatureValue&&(ee.isValid=!0)},W={isValid:!1,parse:{}};return function($,J){if("2a864886f70d010702"!==g($,0,[0],"06"))return J;J.cmsType="signedData",J.econtent=g($,0,[1,0,2,1,0]),function($,J){for(var ee,be=3;be<6;be++)if(void 0!==(ee=y($,0,[1,0,be]))){var we=$.substr(ee,2);"a0"===we&&(J.certsIdx=ee),"a1"===we&&(J.revinfosIdx=ee),"31"===we&&(J.signerinfosIdx=ee)}}($,J),J.signerInfos=[],function($,J){var ee=J.signerinfosIdx;if(void 0!==ee){var be=P($,ee);J.signerInfoIdxList=be;for(var we=0;we<be.length;we++){var Oe={idx:be[we]};Y($,Oe),J.signerInfos.push(Oe)}}}($,J)}(M,W.parse),function($,J){for(var ee=J.parse.signerInfos,be=ee.length,we=!0,ye=0;ye<be;ye++){var Oe=ee[ye];z($,J,Oe),Oe.isValid||(we=!1)}J.isValid=we}(M,W),W},l.asn1.cms.CMSParser=function(){var e=Error,r=Se,s=new r,o=ue,h=o.getV,d=o.getTLV,v=o.getTLVbyList,w=o.getTLVbyListEx,_=o.getVbyList,I=o.getVbyListEx,T=o.getChildIdx;this.getCMSSignedData=function(m){var g=v(m,0,[1,0]);return this.getSignedData(g)},this.getSignedData=function(m){var g=T(m,0),A={},y=h(m,g[0]),P=parseInt(y,16);A.version=P;var x=d(m,g[1]);A.hashalgs=this.getHashAlgArray(x);var N=d(m,g[2]);A.econtent=this.getEContent(N);var B=w(m,0,["[0]"]);null!=B&&(A.certs=this.getCertificateSet(B)),w(m,0,["[1]"]);var j=w(m,0,[3]);return A.sinfos=this.getSignerInfos(j),A},this.getHashAlgArray=function(m){for(var g=T(m,0),A=new r,y=[],P=0;P<g.length;P++){var x=d(m,g[P]),N=A.getAlgorithmIdentifierName(x);y.push(N)}return y},this.getEContent=function(m){var g={},A=_(m,0,[0]),y=_(m,0,[1,0]);return g.type=l.asn1.x509.OID.oid2name(ue.hextooidstr(A)),g.content={hex:y},g},this.getSignerInfos=function(m){for(var g=[],A=T(m,0),y=0;y<A.length;y++){var P=d(m,A[y]),x=this.getSignerInfo(P);g.push(x)}return g},this.getSignerInfo=function(m){var g={},A=T(m,0),y=o.getInt(m,A[0],-1);-1!=y&&(g.version=y);var P=d(m,A[1]),x=this.getIssuerAndSerialNumber(P);g.id=x;var N=d(m,A[2]),B=s.getAlgorithmIdentifierName(N);g.hashalg=B;var M=w(m,0,["[0]"]);if(null!=M){var j=this.getAttributeList(M);g.sattrs=j}var Q=w(m,0,[3]),Y=s.getAlgorithmIdentifierName(Q);g.sigalg=Y;var R=I(m,0,[4]);g.sighex=R;var D=w(m,0,["[1]"]);if(null!=D){var L=this.getAttributeList(D);g.uattrs=L}return g},this.getSignerIdentifier=function(m){if("30"==m.substr(0,2))return this.getIssuerAndSerialNumber(m);throw new Error("SKID of signerIdentifier not supported")},this.getIssuerAndSerialNumber=function(m){var g={type:"isssn"},A=T(m,0),y=d(m,A[0]);g.issuer=s.getX500Name(y);var P=h(m,A[1]);return g.serial={hex:P},g},this.getAttributeList=function(m){for(var g=[],A=T(m,0),y=0;y<A.length;y++){var P=d(m,A[y]),x=this.getAttribute(P);g.push(x)}return{array:g}},this.getAttribute=function(m){var g={},A=T(m,0),y=o.getOID(m,A[0]),P=l.asn1.x509.OID.oid2name(y);g.attr=P;var x=d(m,A[1]),N=T(x,0);if(1==N.length)g.valhex=d(x,N[0]);else{for(var B=[],M=0;M<N.length;M++)B.push(d(x,N[M]));g.valhex=B}return"contentType"==P?this.setContentType(g):"messageDigest"==P?this.setMessageDigest(g):"signingTime"==P?this.setSigningTime(g):"signingCertificate"==P?this.setSigningCertificate(g):"signingCertificateV2"==P?this.setSigningCertificateV2(g):"signaturePolicyIdentifier"==P&&this.setSignaturePolicyIdentifier(g),g},this.setContentType=function(m){var g=o.getOIDName(m.valhex,0,null);null!=g&&(m.type=g,delete m.valhex)},this.setSigningTime=function(m){var A=Ve(h(m.valhex,0));m.str=A,delete m.valhex},this.setMessageDigest=function(m){var g=h(m.valhex,0);m.hex=g,delete m.valhex},this.setSigningCertificate=function(m){var g=T(m.valhex,0);if(g.length>0){for(var A=d(m.valhex,g[0]),y=T(A,0),P=[],x=0;x<y.length;x++){var N=d(A,y[x]),B=this.getESSCertID(N);P.push(B)}m.array=P}if(g.length>1){var M=d(m.valhex,g[1]);m.polhex=M}delete m.valhex},this.setSignaturePolicyIdentifier=function(m){var g=T(m.valhex,0);if(g.length>0){var A=o.getOID(m.valhex,g[0]);m.oid=A}if(g.length>1){var y=new r,P=T(m.valhex,g[1]),x=d(m.valhex,P[0]),N=y.getAlgorithmIdentifierName(x);m.alg=N;var B=h(m.valhex,P[1]);m.hash=B}delete m.valhex},this.setSigningCertificateV2=function(m){var g=T(m.valhex,0);if(g.length>0){for(var A=d(m.valhex,g[0]),y=T(A,0),P=[],x=0;x<y.length;x++){var N=d(A,y[x]),B=this.getESSCertIDv2(N);P.push(B)}m.array=P}if(g.length>1){var M=d(m.valhex,g[1]);m.polhex=M}delete m.valhex},this.getESSCertID=function(m){var g={},A=T(m,0);if(A.length>0){var y=h(m,A[0]);g.hash=y}if(A.length>1){var P=d(m,A[1]),x=this.getIssuerSerial(P);null!=x.serial&&(g.serial=x.serial),null!=x.issuer&&(g.issuer=x.issuer)}return g},this.getESSCertIDv2=function(m){var g={},A=T(m,0);if(A.length<1||3<A.length)throw new e("wrong number of elements");var y=0;if("30"==m.substr(A[0],2)){var P=d(m,A[0]);g.alg=s.getAlgorithmIdentifierName(P),y++}else g.alg="sha256";var x=h(m,A[y]);if(g.hash=x,A.length>y+1){var N=d(m,A[y+1]),B=this.getIssuerSerial(N);g.issuer=B.issuer,g.serial=B.serial}return g},this.getIssuerSerial=function(m){var g={},A=T(m,0),y=d(m,A[0]),P=s.getGeneralNames(y);g.issuer=P[0].dn;var N=h(m,A[1]);return g.serial={hex:N},g},this.getCertificateSet=function(m){for(var g=T(m,0),A=[],y=0;y<g.length;y++){var P=d(m,g[y]);if("30"==P.substr(0,2)){var x=bt(P,"CERTIFICATE");A.push(x)}}return{array:A,sortflag:!1}}},(typeof l>"u"||!l)&&(l={}),(typeof l.asn1>"u"||!l.asn1)&&(l.asn1={}),(typeof l.asn1.tsp>"u"||!l.asn1.tsp)&&(l.asn1.tsp={}),l.asn1.tsp.TimeStampToken=function(e){var o=l.asn1.tsp;o.TimeStampToken.superclass.constructor.call(this),this.params=null,this.getEncodedHexPrepare=function(){var h=new o.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=h.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.tsp.TimeStampToken,l.asn1.cms.SignedData),l.asn1.tsp.TSTInfo=function(e){Error;var o=l.asn1,h=o.DERSequence,d=o.DERInteger,f=o.DERBoolean,v=o.DERGeneralizedTime,w=o.DERObjectIdentifier,_=o.DERTaggedObject,I=o.tsp,T=I.MessageImprint,m=I.Accuracy,A=o.x509.GeneralName;if(I.TSTInfo.superclass.constructor.call(this),this.dVersion=new d({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerial=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.tohex=function(){var y=[this.dVersion];if(null==this.dPolicy)throw new Error("policy shall be specified.");if(y.push(this.dPolicy),null==this.dMessageImprint)throw new Error("messageImprint shall be specified.");if(y.push(this.dMessageImprint),null==this.dSerial)throw new Error("serialNumber shall be specified.");if(y.push(this.dSerial),null==this.dGenTime)throw new Error("genTime shall be specified.");y.push(this.dGenTime),null!=this.dAccuracy&&y.push(this.dAccuracy),null!=this.dOrdering&&y.push(this.dOrdering),null!=this.dNonce&&y.push(this.dNonce),null!=this.dTsa&&y.push(this.dTsa);var P=new h({array:y});return this.hTLV=P.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e){if("string"==typeof e.policy){if(!e.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new w({oid:e.policy})}void 0!==e.messageImprint&&(this.dMessageImprint=new T(e.messageImprint)),void 0!==e.serial&&(this.dSerial=new d(e.serial)),void 0!==e.genTime&&(this.dGenTime=new v(e.genTime)),void 0!==e.accuracy&&(this.dAccuracy=new m(e.accuracy)),void 0!==e.ordering&&1==e.ordering&&(this.dOrdering=new f),void 0!==e.nonce&&(this.dNonce=new d(e.nonce)),void 0!==e.tsa&&(this.dTsa=new _({tag:"a0",explicit:!0,obj:new A({dn:e.tsa})}))}},ne(l.asn1.tsp.TSTInfo,l.asn1.ASN1Object),l.asn1.tsp.Accuracy=function(e){var s=l.asn1,o=s.ASN1Util.newObject;s.tsp.Accuracy.superclass.constructor.call(this),this.params=null,this.tohex=function(){var h=this.params,d=[];return null!=h.seconds&&"number"==typeof h.seconds&&d.push({int:h.seconds}),null!=h.millis&&"number"==typeof h.millis&&d.push({tag:{tagi:"80",obj:{int:h.millis}}}),null!=h.micros&&"number"==typeof h.micros&&d.push({tag:{tagi:"81",obj:{int:h.micros}}}),o({seq:d}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.tsp.Accuracy,l.asn1.ASN1Object),l.asn1.tsp.MessageImprint=function(e){var s=l.asn1,o=s.DERSequence,h=s.DEROctetString,f=s.x509.AlgorithmIdentifier;s.tsp.MessageImprint.superclass.constructor.call(this),this.params=null,this.tohex=function(){var v=this.params,w=new f({name:v.alg}),_=new h({hex:v.hash});return new o({array:[w,_]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.tsp.MessageImprint,l.asn1.ASN1Object),l.asn1.tsp.TimeStampReq=function(e){var s=l.asn1,o=s.DERSequence,h=s.DERInteger,d=s.DERBoolean,v=s.DERObjectIdentifier,w=s.tsp,_=w.MessageImprint;w.TimeStampReq.superclass.constructor.call(this),this.params=null,this.tohex=function(){var I=this.params,T=[];return T.push(new h({int:1})),T.push(I.messageImprint instanceof l.asn1.ASN1Object?I.messageImprint:new _(I.messageImprint)),null!=I.policy&&T.push(new v(I.policy)),null!=I.nonce&&T.push(new h(I.nonce)),1==I.certreq&&T.push(new d),new o({array:T}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.tsp.TimeStampReq,l.asn1.ASN1Object),l.asn1.tsp.TimeStampResp=function(e){var s=l.asn1,o=s.DERSequence,d=s.tsp,f=d.PKIStatusInfo;d.TimeStampResp.superclass.constructor.call(this),this.params=null,this.tohex=function(){var v=this.params,w=[];if(null!=v.econtent||null!=v.tst)if(w.push(new f(null!=v.statusinfo?v.statusinfo:"granted")),null!=v.econtent)w.push(new d.TimeStampToken(v).getContentInfo());else{if(!(v.tst instanceof s.ASN1Object))throw new Error("improper member tst value");w.push(v.tst)}else{if(null==v.statusinfo)throw new Error("parameter for token nor statusinfo not specified");w.push(new f(v.statusinfo))}return new o({array:w}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.tsp.TimeStampResp,l.asn1.ASN1Object),l.asn1.tsp.PKIStatusInfo=function(e){var r=Error,o=l.asn1,h=o.DERSequence,d=o.tsp,f=d.PKIStatus,v=d.PKIFreeText,w=d.PKIFailureInfo;d.PKIStatusInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var _=this.params,I=[];if("string"==typeof _)I.push(new f(_));else{if(null==_.status)throw new r("property 'status' unspecified");I.push(new f(_.status)),null!=_.statusstr&&I.push(new v(_.statusstr)),null!=_.failinfo&&I.push(new w(_.failinfo))}return new h({array:I}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.tsp.PKIStatusInfo,l.asn1.ASN1Object),l.asn1.tsp.PKIStatus=function(e){var r=Error,o=l.asn1,h=o.DERInteger;o.tsp.PKIStatus.superclass.constructor.call(this);var f={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null,this.tohex=function(){var _,v=this.params;if("string"==typeof v)try{_=f[v]}catch{throw new r("undefined name: "+v)}else{if("number"!=typeof v)throw new r("unsupported params");_=v}return new h({int:_}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.tsp.PKIStatus,l.asn1.ASN1Object),l.asn1.tsp.PKIFreeText=function(e){var r=Error,o=l.asn1,h=o.DERSequence,d=o.DERUTF8String;o.tsp.PKIFreeText.superclass.constructor.call(this),this.params=null,this.tohex=function(){var v=this.params;if(!v instanceof Array)throw new r("wrong params: not array");for(var w=[],_=0;_<v.length;_++)w.push(new d({str:v[_]}));return new h({array:w}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.tsp.PKIFreeText,l.asn1.ASN1Object),l.asn1.tsp.PKIFailureInfo=function(e){var r=Error,o=l.asn1,h=o.DERBitString,v={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};o.tsp.PKIFailureInfo.superclass.constructor.call(this),this.params=null,this.getBinValue=function(){var w=this.params,_=0;if("number"==typeof w&&0<=w&&w<=25){for(var I=(_|=1<<w).toString(2),T="",m=I.length-1;m>=0;m--)T+=I[m];return T}if("string"==typeof w&&null!=v[w])return cr([w],v);if("object"==typeof w&&null!=w.length)return cr(w,v);throw new r("wrong params")},this.tohex=function(){var _=this.getBinValue();return new h({bin:_}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.tsp.PKIFailureInfo,l.asn1.ASN1Object),l.asn1.tsp.AbstractTSAAdapter=function(e){this.getTSTHex=function(r,s){throw"not implemented yet"}},l.asn1.tsp.SimpleTSAAdapter=function(e){var o=l.asn1.tsp,h=l.crypto.Util.hashHex;o.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(d,f){var v=h(d,f);this.params.econtent.content.messageImprint={alg:f,hash:v},this.params.econtent.content.serial={int:this.serial++};var w=Math.floor(1e9*Math.random());return this.params.econtent.content.nonce={int:w},new o.TimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==e&&(this.params=e)},ne(l.asn1.tsp.SimpleTSAAdapter,l.asn1.tsp.AbstractTSAAdapter),l.asn1.tsp.FixedTSAAdapter=function(e){var o=l.asn1.tsp,h=l.crypto.Util.hashHex;o.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(d,f){var v=h(d,f);return this.params.econtent.content.messageImprint={alg:f,hash:v},new o.TimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==e&&(this.params=e)},ne(l.asn1.tsp.FixedTSAAdapter,l.asn1.tsp.AbstractTSAAdapter),l.asn1.tsp.TSPUtil=new function(){},l.asn1.tsp.TSPUtil.newTimeStampToken=function(e){return new l.asn1.tsp.TimeStampToken(e)},l.asn1.tsp.TSPUtil.parseTimeStampReq=function(e){return(new l.asn1.tsp.TSPParser).getTimeStampReq(e)},l.asn1.tsp.TSPUtil.parseMessageImprint=function(e){return(new l.asn1.tsp.TSPParser).getMessageImprint(e)},l.asn1.tsp.TSPParser=function(){Error;var s=new Se,o=ue,h=o.getV,d=o.getTLV,f=o.getIdxbyList,w=o.getChildIdx,_=["granted","grantedWithMods","rejection","waiting","revocationWarning","revocationNotification"],I={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(T){var m=w(T,0);if(1==m.length)return this.getPKIStatusInfo(d(T,m[0]));if(m.length>1){var g=this.getPKIStatusInfo(d(T,m[0])),A=d(T,m[1]),y=this.getToken(A);return y.statusinfo=g,y}},this.getToken=function(T){var g=(new l.asn1.cms.CMSParser).getCMSSignedData(T);return this.setTSTInfo(g),g},this.setTSTInfo=function(T){var m=T.econtent;if("tstinfo"==m.type){var A=this.getTSTInfo(m.content.hex);m.content=A}},this.getTSTInfo=function(T){var m={},g=w(T,0),A=h(T,g[1]);m.policy=ar(A);var y=d(T,g[2]);m.messageImprint=this.getMessageImprint(y);var P=h(T,g[3]);m.serial={hex:P};var x=h(T,g[4]);m.genTime={str:Ve(x)};var N=0;if(g.length>5&&"30"==T.substr(g[5],2)){var B=d(T,g[5]);m.accuracy=this.getAccuracy(B),N++}if(g.length>5+N&&"01"==T.substr(g[5+N],2)&&("ff"==h(T,g[5+N])&&(m.ordering=!0),N++),g.length>5+N&&"02"==T.substr(g[5+N],2)){var j=h(T,g[5+N]);m.nonce={hex:j},N++}if(g.length>5+N&&"a0"==T.substr(g[5+N],2)){var Q=d(T,g[5+N]);Q="30"+Q.substr(2),pGeneralNames=s.getGeneralNames(Q);var Y=pGeneralNames[0].dn;m.tsa=Y,N++}if(g.length>5+N&&"a1"==T.substr(g[5+N],2)){var R=d(T,g[5+N]);R="30"+R.substr(2);var D=s.getExtParamArray(R);m.ext=D,N++}return m},this.getAccuracy=function(T){for(var m={},g=w(T,0),A=0;A<g.length;A++){var y=T.substr(g[A],2),P=h(T,g[A]),x=parseInt(P,16);"02"==y?m.seconds=x:"80"==y?m.millis=x:"81"==y&&(m.micros=x)}return m},this.getMessageImprint=function(T){if("30"!=T.substr(0,2))throw new Error("head of messageImprint hex shall be x30");var m={},A=(w(T,0),f(T,0,[0,0])),y=h(T,A),P=o.hextooidstr(y),x=l.asn1.x509.OID.oid2name(P);if(""==x)throw new Error("hashAlg name undefined: "+P);var N=x,B=f(T,0,[1]);return m.alg=N,m.hash=h(T,B),m},this.getPKIStatusInfo=function(T){var m={},g=w(T,0),A=0;try{var y=h(T,g[0]),P=parseInt(y,16);m.status=_[P]}catch{}if(g.length>1&&"30"==T.substr(g[1],2)){var x=d(T,g[1]);m.statusstr=this.getPKIFreeText(x),A++}if(g.length>A&&"03"==T.substr(g[1+A],2)){var N=d(T,g[1+A]);m.failinfo=this.getPKIFailureInfo(N)}return m},this.getPKIFreeText=function(T){for(var m=[],g=w(T,0),A=0;A<g.length;A++)m.push(o.getString(T,g[A]));return m},this.getPKIFailureInfo=function(T){var m=o.getInt(T,0);return null!=I[m]?I[m]:m},this.getTimeStampReq=function(T){var m={certreq:!1},g=w(T,0);if(g.length<2)throw new Error("TimeStampReq must have at least 2 items");var A=d(T,g[1]);m.messageImprint=l.asn1.tsp.TSPUtil.parseMessageImprint(A);for(var y=2;y<g.length;y++){var P=g[y],x=T.substr(P,2);if("06"==x){var N=h(T,P);m.policy=o.hextooidstr(N)}"02"==x&&(m.nonce=h(T,P)),"01"==x&&(m.certreq=!0)}return m}},(typeof l>"u"||!l)&&(l={}),(typeof l.asn1>"u"||!l.asn1)&&(l.asn1={}),(typeof l.asn1.cades>"u"||!l.asn1.cades)&&(l.asn1.cades={}),l.asn1.cades.SignaturePolicyIdentifier=function(e){var o=l.asn1.cades,h=o.SignaturePolicyId;o.SignaturePolicyIdentifier.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.15",this.params=null,this.getValueArray=function(){return[new h(this.params)]},this.setByParam=function(d){this.params=d},null!=e&&this.setByParam(e)},ne(l.asn1.cades.SignaturePolicyIdentifier,l.asn1.cms.Attribute),l.asn1.cades.SignaturePolicyId=function(e){var s=l.asn1,o=s.DERSequence,h=s.DERObjectIdentifier,v=s.cades,_=v.OtherHashAlgAndValue;v.SignaturePolicyId.superclass.constructor.call(this),this.params=null,this.tohex=function(){var I=this.params,T=[];return T.push(new h(I.oid)),T.push(new _(I)),new o({array:T}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(I){this.params=I},null!=e&&this.setByParam(e)},ne(l.asn1.cades.SignaturePolicyId,l.asn1.ASN1Object),l.asn1.cades.OtherHashAlgAndValue=function(e){var r=Error,o=l.asn1,h=o.DERSequence,d=o.DEROctetString,v=o.x509.AlgorithmIdentifier;o.cades.OtherHashAlgAndValue.superclass.constructor.call(this),this.params=null,this.tohex=function(){var I=this.params;if(null==I.alg)throw new r("property 'alg' not specified");if(null==I.hash&&null==I.cert)throw new r("property 'hash' nor 'cert' not specified");var T=null;if(null!=I.hash)T=I.hash;else if(null!=I.cert){if("string"!=typeof I.cert)throw new r("cert not string");var m=I.cert;-1!=I.cert.indexOf("-----BEGIN")&&(m=nt(I.cert)),T=l.crypto.Util.hashHex(m,I.alg)}var g=[];return g.push(new v({name:I.alg})),g.push(new d({hex:T})),new h({array:g}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cades.OtherHashAlgAndValue,l.asn1.ASN1Object),l.asn1.cades.OtherHashValue=function(e){l.asn1.cades.OtherHashValue.superclass.constructor.call(this);var r=Error,d=l.asn1.DEROctetString;this.params=null,this.tohex=function(){var v=this.params;if(null==v.hash&&null==v.cert)throw new r("hash or cert not specified");var w=null;if(null!=v.hash)w=v.hash;else if(null!=v.cert){if("string"!=typeof v.cert)throw new r("cert not string");var _=v.cert;-1!=v.cert.indexOf("-----BEGIN")&&(_=nt(v.cert)),w=l.crypto.Util.hashHex(_,"sha1")}return new d({hex:w}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cades.OtherHashValue,l.asn1.ASN1Object),l.asn1.cades.SignatureTimeStamp=function(e){var r=Error,o=l.lang.String.isHex,h=l.asn1,d=h.ASN1Object;h.cades.SignatureTimeStamp.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.14",this.params=null,this.getValueArray=function(){var w=this.params;if(null!=w.tst){if(o(w.tst))return(_=new d).hTLV=w.tst,[_];if(w.tst instanceof d)return[w.tst];throw new r("params.tst has wrong value")}if(null!=w.res){var _,I=w.res;if(I instanceof d&&(I=I.tohex()),"string"!=typeof I||!o(I))throw new r("params.res has wrong value");return ue.getTLVbyList(I,0,[1]),(_=new d).hTLV=w.tst,[_]}},null!=e&&this.setByParam(e)},ne(l.asn1.cades.SignatureTimeStamp,l.asn1.cms.Attribute),l.asn1.cades.CompleteCertificateRefs=function(e){var r=Error,o=l.asn1,h=o.DERSequence,d=o.cades,f=d.OtherCertID,v=l.lang.String.isHex;d.CompleteCertificateRefs.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.21",this.params=null,this.getValueArray=function(){for(var w=this.params,_=[],I=0;I<w.array.length;I++){var T=w.array[I];if("string"==typeof T)if(-1!=T.indexOf("-----BEGIN"))T={cert:T};else{if(!v(T))throw new r("unsupported value: "+T);T={hash:T}}null!=w.alg&&null==T.alg&&(T.alg=w.alg),null!=w.hasis&&null==T.hasis&&(T.hasis=w.hasis);var m=new f(T);_.push(m)}return[new h({array:_})]},null!=e&&this.setByParam(e)},ne(l.asn1.cades.CompleteCertificateRefs,l.asn1.cms.Attribute),l.asn1.cades.OtherCertID=function(e){var s=l.asn1,o=s.DERSequence,d=s.cms.IssuerSerial,f=s.cades,v=f.OtherHashValue,w=f.OtherHashAlgAndValue;f.OtherCertID.superclass.constructor.call(this),this.params=e,this.tohex=function(){var _=this.params;"string"==typeof _&&(-1!=_.indexOf("-----BEGIN")?_={cert:_}:_isHex(_)&&(_={hash:_}));var T,I=[];if(T=null!=_.alg?new w(_):new v(_),I.push(T),null!=_.cert&&1==_.hasis||null!=_.issuer&&null!=_.serial){var m=new d(_);I.push(m)}return new o({array:I}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cades.OtherCertID,l.asn1.ASN1Object),l.asn1.cades.OtherHash=function(e){Error;var d=l.asn1.cades,f=d.OtherHashAlgAndValue,v=d.OtherHashValue,_=l.lang.String.isHex;d.OtherHash.superclass.constructor.call(this),this.params=null,this.tohex=function(){var I=this.params;return"string"==typeof I&&(-1!=I.indexOf("-----BEGIN")?I={cert:I}:_(I)&&(I={hash:I})),(null!=I.alg?new f(I):new v(I)).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.cades.OtherHash,l.asn1.ASN1Object),l.asn1.cades.CAdESUtil=new function(){},l.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(e){return(new l.asn1.cms.CMSParser).getCMSSignedData(e)},l.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(e,r,s){var d=ue.getTLV,f=ue.getV,w=l.asn1,_=w.ASN1Object,I=w.cms,T=I.AttributeList,m=I.SignerInfo,g={},A=(0,ue.getChildIdx)(e,r);if(6!=A.length)throw"not supported items for SignerInfo (!=6)";var y=A.shift();g.version=d(e,y);var P=A.shift();g.si=d(e,P);var x=A.shift();g.digalg=d(e,x);var N=A.shift();g.sattrs=d(e,N);var B=A.shift();g.sigalg=d(e,B);var M=A.shift();g.sig=d(e,M),g.sigval=f(e,M);var j=null;return g.obj=new m,(j=new _).hTLV=g.version,g.obj.dCMSVersion=j,(j=new _).hTLV=g.si,g.obj.dSignerIdentifier=j,(j=new _).hTLV=g.digalg,g.obj.dDigestAlgorithm=j,(j=new _).hTLV=g.sattrs,g.obj.dSignedAttrs=j,(j=new _).hTLV=g.sigalg,g.obj.dSigAlg=j,(j=new _).hTLV=g.sig,g.obj.dSig=j,g.obj.dUnsignedAttrs=new T,g},(typeof l.asn1.csr>"u"||!l.asn1.csr)&&(l.asn1.csr={}),l.asn1.csr.CertificationRequest=function(e){var s=l.asn1,o=s.DERBitString,h=s.DERSequence,d=s.csr,v=d.CertificationRequestInfo;d.CertificationRequest.superclass.constructor.call(this),this.setByParam=function(w){this.params=w},this.sign=function(){var w=new v(this.params).tohex(),_=new l.crypto.Signature({alg:this.params.sigalg});_.init(this.params.sbjprvkey),_.updateHex(w);var I=_.sign();this.params.sighex=I},this.getPEM=function(){return bt(this.tohex(),"CERTIFICATE REQUEST")},this.tohex=function(){var w=this.params,_=new l.asn1.csr.CertificationRequestInfo(this.params),I=new l.asn1.x509.AlgorithmIdentifier({name:w.sigalg});if(null==w.sighex&&null!=w.sbjprvkey&&this.sign(),null==w.sighex)throw new Error("sighex or sbjprvkey parameter not defined");var T=new o({hex:"00"+w.sighex});return new h({array:[_,I,T]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.csr.CertificationRequest,l.asn1.ASN1Object),l.asn1.csr.CertificationRequestInfo=function(e){var s=l.asn1,h=s.DERSequence,d=s.DERInteger,f=s.DERUTF8String,v=s.DERTaggedObject,w=s.ASN1Util.newObject,I=s.x509,T=I.X500Name,m=I.Extensions,g=I.SubjectPublicKeyInfo;s.csr.CertificationRequestInfo.superclass.constructor.call(this),this.params=null,this.setByParam=function(P){null!=P&&(this.params=P)},this.tohex=function(){var P=this.params,x=[];if(x.push(new d({int:0})),x.push(new T(P.subject)),x.push(new g(Ie.getKey(P.sbjpubkey))),null!=P.attrs){var N=function y(P){for(var x=Error,N=l.asn1.x509.Extensions,B=[],M=0;M<P.length;M++){var j=P[M],Q=j.attr;if("extensionRequest"==Q){var Y=new N(j.ext);B.push({seq:[{oid:"1.2.840.113549.1.9.14"},{set:[Y]}]})}else if("unstructuredName"==Q)B.push({seq:[{oid:"1.2.840.113549.1.9.2"},{set:j.names}]});else{if("challengePassword"!=Q)throw new x("unknown CSR attribute");B.push({seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:j.password}]}]})}}return{set:B}}(P.attrs),B=w({tag:{tage:"a0",obj:N}});x.push(B)}else if(null!=P.extreq){var M=new m(P.extreq);B=w({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[M]}]}}}),x.push(B)}else x.push(new v({tag:"a0",explicit:!1,obj:new f({str:""})}));return new h({array:x}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},ne(l.asn1.csr.CertificationRequestInfo,l.asn1.ASN1Object),l.asn1.csr.AttributeList=function(e){},ne(l.asn1.csr.AttributeList,l.asn1.ASN1Object),l.asn1.csr.CSRUtil=new function(){},l.asn1.csr.CSRUtil.newCSRPEM=function(e){return new l.asn1.csr.CertificationRequest(e).getPEM()},l.asn1.csr.CSRUtil.getParam=function(e,r){var o=ue.getV,h=ue.getIdxbyList,d=ue.getTLVbyList,f=ue.getTLVbyListEx,v=ue.getVbyListEx,_={};if(-1==e.indexOf("-----BEGIN CERTIFICATE REQUEST"))throw new Error("argument is not PEM file");var I=nt(e,"CERTIFICATE REQUEST");r&&(_.tbs=d(I,0,[0]));try{var T=f(I,0,[0,1]);if("3000"==T)_.subject={};else{var y=new Se;_.subject=y.getX500Name(T)}}catch{}var m=f(I,0,[0,2]),g=Ie.getKey(m,null,"pkcs8pub");_.sbjpubkey=Ie.getPEM(g,"PKCS8PUB");var N,B,A=(B=h(N=I,0,[0,3,0,0],"06"),"2a864886f70d01090e"!=o(N,B)?null:d(N,0,[0,3,0,1,0],"30"));y=new Se,null!=A&&(_.extreq=y.getExtParamArray(A));try{var P=f(I,0,[1],"30");y=new Se,_.sigalg=y.getAlgorithmIdentifierName(P)}catch{}try{var x=v(I,0,[2]);_.sighex=x}catch{}return _},l.asn1.csr.CSRUtil.verifySignature=function(e){try{var r=null;if("string"==typeof e&&-1!=e.indexOf("-----BEGIN CERTIFICATE REQUEST")?r=l.asn1.csr.CSRUtil.getParam(e,!0):"object"==typeof e&&null!=e.sbjpubkey&&null!=e.sigalg&&null!=e.sighex&&null!=e.tbs&&(r=e),null==r)return!1;var s=new l.crypto.Signature({alg:r.sigalg});return s.init(r.sbjpubkey),s.updateHex(r.tbs),s.verify(r.sighex)}catch(o){return alert(o),!1}},(typeof l>"u"||!l)&&(l={}),(typeof l.asn1>"u"||!l.asn1)&&(l.asn1={}),(typeof l.asn1.ocsp>"u"||!l.asn1.ocsp)&&(l.asn1.ocsp={}),l.asn1.ocsp.DEFAULT_HASH="sha1",l.asn1.ocsp.OCSPResponse=function(e){l.asn1.ocsp.OCSPResponse.superclass.constructor.call(this);var s=l.asn1.ASN1Util.newObject,o=l.asn1.ocsp.ResponseBytes,h=["successful","malformedRequest","internalError","tryLater","_not_used_","sigRequired","unauthorized"];this.params=null,this._getStatusCode=function(){var d=this.params.resstatus;return"number"==typeof d?d:"string"!=typeof d?-1:h.indexOf(d)},this.setByParam=function(d){this.params=d},this.tohex=function(){var d=this.params,f=this._getStatusCode();if(-1==f)throw new Error("responseStatus not supported: "+d.resstatus);if(0!=f)return s({seq:[{enum:{int:f}}]}).tohex();var v=new o(d);return s({seq:[{enum:{int:0}},{tag:{tag:"a0",explicit:!0,obj:v}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.ocsp.OCSPResponse,l.asn1.ASN1Object),l.asn1.ocsp.ResponseBytes=function(e){l.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var r=l.asn1,s=r.DERSequence,o=r.DERObjectIdentifier,h=r.DEROctetString,d=r.ocsp.BasicOCSPResponse;this.params=null,this.setByParam=function(f){this.params=f},this.tohex=function(){var f=this.params;if("ocspBasic"!=f.restype)throw new Error("not supported responseType: "+f.restype);var v=new d(f),w=[];return w.push(new o({name:"ocspBasic"})),w.push(new h({hex:v.tohex()})),new s({array:w}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.ocsp.ResponseBytes,l.asn1.ASN1Object),l.asn1.ocsp.BasicOCSPResponse=function(e){l.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var r=Error,s=l.asn1,o=s.ASN1Object,h=s.DERSequence,f=s.DERTaggedObject,v=s.DERBitString,_=s.x509.AlgorithmIdentifier,I=s.ocsp;_SingleResponseList=I.SingleResponseList,_ResponseData=I.ResponseData,this.params=null,this.setByParam=function(m){this.params=m},this.sign=function(){var m=this.params,g=m.tbsresp.tohex(),A=new l.crypto.Signature({alg:m.sigalg});A.init(m.reskey),A.updateHex(g),m.sighex=A.sign()},this.tohex=function(){var m=this.params;null==m.tbsresp&&(m.tbsresp=new _ResponseData(m)),null==m.sighex&&null!=m.reskey&&this.sign();var g=[];if(g.push(m.tbsresp),g.push(new _({name:m.sigalg})),g.push(new v({hex:"00"+m.sighex})),null!=m.certs&&null!=m.certs.length){for(var A=[],y=0;y<m.certs.length;y++){var P=m.certs[y],x=null;if(ue.isASN1HEX(P))x=P;else{if(!P.match(/-----BEGIN/))throw new r("certs["+y+"] not hex or PEM");x=nt(P)}A.push(new o({tlv:x}))}var N=new h({array:A});g.push(new f({tag:"a0",explicit:!0,obj:N}))}return new h({array:g}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.ocsp.BasicOCSPResponse,l.asn1.ASN1Object),l.asn1.ocsp.ResponseData=function(e){l.asn1.ocsp.ResponseData.superclass.constructor.call(this);var r=Error,s=l.asn1,o=s.DERSequence,h=s.DERGeneralizedTime,d=s.DERTaggedObject,f=s.x509.Extensions,v=s.ocsp,w=v.ResponderID;_SingleResponseList=v.SingleResponseList,this.params=null,this.tohex=function(){var _=this.params;null!=_.respid&&new r("respid not specified"),null!=_.prodat&&new r("prodat not specified"),null!=_.array&&new r("array not specified");var I=[];if(I.push(new w(_.respid)),I.push(new h(_.prodat)),I.push(new _SingleResponseList(_.array)),null!=_.ext){var T=new f(_.ext);I.push(new d({tag:"a1",explicit:!0,obj:T}))}return new o({array:I}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(_){this.params=_},void 0!==e&&this.setByParam(e)},ne(l.asn1.ocsp.ResponseData,l.asn1.ASN1Object),l.asn1.ocsp.ResponderID=function(e){l.asn1.ocsp.ResponderID.superclass.constructor.call(this);var s=l.asn1,o=s.ASN1Util.newObject,h=s.x509.X500Name,d=l.lang.String.isHex,f=Error;this.params=null,this.tohex=function(){var v=this.params;if(null!=v.key){var w=null;if("string"==typeof v.key)d(v.key)&&(w=v.key),v.key.match(/-----BEGIN CERTIFICATE/)&&null!=(I=new Se(v.key).getExtSubjectKeyIdentifier())&&(w=I.kid.hex);else if(v.key instanceof Se){var I;null!=(I=v.key.getExtSubjectKeyIdentifier())&&(w=I.kid.hex)}if(null==w)throw new f("wrong key member value");return o({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:w}}}}).tohex()}if(null!=v.name){var m=null;if("string"==typeof v.name&&v.name.match(/-----BEGIN CERTIFICATE/)?m=new Se(v.name).getSubject():v.name instanceof Se?m=v.name.getSubject():"object"==typeof v.name&&(null!=v.name.array||null!=v.name.str)&&(m=v.name),null==m)throw new f("wrong name member value");return o({tag:{tag:"a1",explicit:!0,obj:new h(m)}}).tohex()}throw new f("key or name not specified")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(v){this.params=v},void 0!==e&&this.setByParam(e)},ne(l.asn1.ocsp.ResponderID,l.asn1.ASN1Object),l.asn1.ocsp.SingleResponseList=function(e){l.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var r=l.asn1,s=r.DERSequence,o=r.ocsp.SingleResponse;this.params=null,this.tohex=function(){var h=this.params;if("object"!=typeof h||null==h.length)throw new Error("params not specified properly");for(var d=[],f=0;f<h.length;f++)d.push(new o(h[f]));return new s({array:d}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(h){this.params=h},void 0!==e&&this.setByParam(e)},ne(l.asn1.ocsp.SingleResponseList,l.asn1.ASN1Object),l.asn1.ocsp.SingleResponse=function(e){var r=Error,o=l.asn1,h=o.DERSequence,d=o.DERGeneralizedTime,f=o.DERTaggedObject,v=o.ocsp,w=v.CertID,_=v.CertStatus,T=o.x509.Extensions;v.SingleResponse.superclass.constructor.call(this),this.params=null,this.tohex=function(){var m=this.params,g=[];if(null==m.certid)throw new r("certid unspecified");if(null==m.status)throw new r("status unspecified");if(null==m.thisupdate)throw new r("thisupdate unspecified");if(g.push(new w(m.certid)),g.push(new _(m.status)),g.push(new d(m.thisupdate)),null!=m.nextupdate){var A=new d(m.nextupdate);g.push(new f({tag:"a0",explicit:!0,obj:A}))}if(null!=m.ext){var y=new T(m.ext);g.push(new f({tag:"a1",explicit:!0,obj:y}))}return new h({array:g}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(m){this.params=m},void 0!==e&&this.setByParam(e)},ne(l.asn1.ocsp.SingleResponse,l.asn1.ASN1Object),l.asn1.ocsp.CertID=function(e){var s=l.asn1,o=s.DEROctetString,h=s.DERInteger,d=s.DERSequence,v=s.x509.AlgorithmIdentifier,T=l.crypto.Util.hashHex,m=Se,A=ue.getVbyList;s.ocsp.CertID.superclass.constructor.call(this),this.DEFAULT_HASH="sha1",this.params=null,this.setByValue=function(y,P,x,N){null==N&&(N=this.DEFAULT_HASH),this.params={alg:N,issname:y,isskey:P,sbjsn:x}},this.setByCert=function(y,P,x){null==x&&(x=this.DEFAULT_HASH),this.params={alg:x,issuerCert:y,subjectCert:P}},this.getParamByCerts=function(y,P,x){null==x&&(x=this.DEFAULT_HASH);var N=new m(y),B=new m(P),M=T(N.getSubjectHex(),x),j=N.getPublicKeyHex();return{alg:x,issname:M,isskey:T(A(j,0,[1],"03",!0),x),sbjsn:B.getSerialNumberHex()}},this.tohex=function(){if("object"!=typeof this.params)throw new Error("params not set");var P,x,N,B,y=this.params;if(B=null==y.alg?this.DEFAULT_HASH:y.alg,null!=y.issuerCert&&null!=y.subjectCert){var M=this.getParamByCerts(y.issuerCert,y.subjectCert,B);P=M.issname,x=M.isskey,N=M.sbjsn}else{if(null==y.issname||null==y.isskey||null==y.sbjsn)throw new Error("required param members not defined");P=y.issname,x=y.isskey,N=y.sbjsn}var j=new v({name:B}),Q=new o({hex:P}),Y=new o({hex:x}),R=new h({hex:N}),D=new d({array:[j,Q,Y,R]});return this.hTLV=D.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},ne(l.asn1.ocsp.CertID,l.asn1.ASN1Object),l.asn1.ocsp.CertStatus=function(e){l.asn1.ocsp.CertStatus.superclass.constructor.call(this),this.params=null,this.tohex=function(){var r=this.params;if("good"==r.status)return"8000";if("unknown"==r.status)return"8200";if("revoked"==r.status){var s=[{gentime:{str:r.time}}];return null!=r.reason&&s.push({tag:{tag:"a0",explicit:!0,obj:{enum:{int:r.reason}}}}),l.asn1.ASN1Util.newObject({tag:{tag:"a1",explicit:!1,obj:{seq:s}}}).tohex()}throw new Error("bad status")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(r){this.params=r},void 0!==e&&this.setByParam(e)},ne(l.asn1.ocsp.CertStatus,l.asn1.ASN1Object),l.asn1.ocsp.Request=function(e){var s=l.asn1,o=s.DERSequence,h=s.ocsp;if(h.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.tohex=function(){var f=[];if(null===this.dReqCert)throw"reqCert not set";f.push(this.dReqCert);var v=new o({array:f});return this.hTLV=v.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},typeof e<"u"){var d=new h.CertID(e);this.dReqCert=d}},ne(l.asn1.ocsp.Request,l.asn1.ASN1Object),l.asn1.ocsp.TBSRequest=function(e){var s=l.asn1,o=s.DERSequence,h=s.ocsp;h.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(d){for(var f=[],v=0;v<d.length;v++){var w=new h.Request(d[0]);f.push(w)}this.dRequestList=f},this.tohex=function(){var d=[];if(0!==this.version)throw"not supported version: "+this.version;if(null!==this.dRequestorName)throw"requestorName not supported";var f=new o({array:this.dRequestList});if(d.push(f),null!==this.dRequestExt)throw"requestExtensions not supported";var v=new o({array:d});return this.hTLV=v.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&void 0!==e.reqList&&this.setRequestListByParam(e.reqList)},ne(l.asn1.ocsp.TBSRequest,l.asn1.ASN1Object),l.asn1.ocsp.OCSPRequest=function(e){var s=l.asn1,o=s.DERSequence,h=s.ocsp;if(h.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.tohex=function(){var f=[];if(null===this.dTbsRequest)throw"tbsRequest not set";if(f.push(this.dTbsRequest),null!==this.dOptionalSignature)throw"optionalSignature not supported";var v=new o({array:f});return this.hTLV=v.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&void 0!==e.reqList){var d=new h.TBSRequest(e);this.dTbsRequest=d}},ne(l.asn1.ocsp.OCSPRequest,l.asn1.ASN1Object),l.asn1.ocsp.OCSPUtil={},l.asn1.ocsp.OCSPUtil.getRequestHex=function(e,r,s){var d=l.asn1.ocsp;return void 0===s&&(s=d.DEFAULT_HASH),new d.OCSPRequest({reqList:[{alg:s,issuerCert:e,subjectCert:r}]}).tohex()},l.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(e){var s=ue.getVbyList,o=ue.getVbyListEx,h=ue.getIdxbyList,f=ue.getV,v={};try{var w=o(e,0,[0],"0a");v.responseStatus=parseInt(w,16)}catch{}if(0!==v.responseStatus)return v;try{var _=h(e,0,[1,0,1,0,0,2,0,1]);"80"===e.substr(_,2)?v.certStatus="good":"a1"===e.substr(_,2)?(v.certStatus="revoked",v.revocationTime=Ve(s(e,_,[0]))):"82"===e.substr(_,2)&&(v.certStatus="unknown")}catch{}try{var I=h(e,0,[1,0,1,0,0,2,0,2]);v.thisUpdate=Ve(f(e,I))}catch{}try{var T=h(e,0,[1,0,1,0,0,2,0,3]);"a0"===e.substr(T,2)&&(v.nextUpdate=Ve(s(e,T,[0])))}catch{}return v},l.asn1.ocsp.OCSPParser=function(){var e=Error,r=Se,s=new r,h=ue.getV,d=ue.getTLV,f=ue.getIdxbyList,v=ue.getVbyList,w=ue.getTLVbyList,_=ue.getVbyListEx,I=ue.getTLVbyListEx,T=ue.getChildIdx;this.getOCSPRequest=function(m){var g=T(m,0);if(1!=g.length&&2!=g.length)throw new e("wrong number elements: "+g.length);return this.getTBSRequest(d(m,g[0]))},this.getTBSRequest=function(m){var g={},A=I(m,0,[0],"30");g.array=this.getRequestList(A);var y=I(m,0,["[2]",0],"30");return null!=y&&(g.ext=s.getExtParamArray(y)),g},this.getRequestList=function(m){for(var g=[],A=T(m,0),y=0;y<A.length;y++)m=d(m,A[y]),g.push(this.getRequest(m));return g},this.getRequest=function(m){var g=T(m,0);if(1!=g.length&&2!=g.length)throw new e("wrong number elements: "+g.length);var A=this.getCertID(d(m,g[0]));if(2==g.length){var y=f(m,0,[1,0]);A.ext=s.getExtParamArray(d(m,y))}return A},this.getCertID=function(m){var g=T(m,0);if(4!=g.length)throw new e("wrong number elements: "+g.length);var A=new r,y={};return y.alg=A.getAlgorithmIdentifierName(d(m,g[0])),y.issname=h(m,g[1]),y.isskey=h(m,g[2]),y.sbjsn=h(m,g[3]),y},this.getOCSPResponse=function(m){var A,g=T(m,0),y=h(m,g[0]),P=parseInt(y);if(1==g.length)return{resstatus:P};var x=w(m,0,[1,0]);return(A=this.getResponseBytes(x)).resstatus=P,A},this.getResponseBytes=function(m){var A,g=T(m,0),y=w(m,0,[1,0]);A=this.getBasicOCSPResponse(y);var P=h(m,g[0]);return A.restype=l.asn1.x509.OID.oid2name(ar(P)),A},this.getBasicOCSPResponse=function(m){var A,g=T(m,0);A=this.getResponseData(d(m,g[0]));var y=new Se;A.alg=y.getAlgorithmIdentifierName(d(m,g[1]));var P=h(m,g[2]);A.sighex=P.substr(2);var x=_(m,0,["[0]"]);if(null!=x){for(var N=T(x,0),B=[],M=0;M<N.length;M++){var j=d(x,N[M]);B.push(j)}A.certs=B}return A},this.getResponseData=function(m){var g=T(m,0),A=g.length,y={},P=0;"a0"==m.substr(g[0],2)&&P++,y.respid=this.getResponderID(d(m,g[P++]));var x=h(m,g[P++]);if(y.prodat=Ve(x),y.array=this.getSingleResponseList(d(m,g[P++])),"a1"==m.substr(g[A-1],2)){var N=w(m,g[A-1],[0]),B=new Se;y.ext=B.getExtParamArray(N)}return y},this.getResponderID=function(m){var g={};if("a2"==m.substr(0,2)){var A=v(m,0,[0]);g.key=A}if("a1"==m.substr(0,2)){var y=w(m,0,[0]),P=new Se;g.name=P.getX500Name(y)}return g},this.getSingleResponseList=function(m){for(var g=T(m,0),A=[],y=0;y<g.length;y++){var P=this.getSingleResponse(d(m,g[y]));A.push(P)}return A},this.getSingleResponse=function(m){var g=T(m,0),A={},y=this.getCertID(d(m,g[0]));A.certid=y;var P=this.getCertStatus(d(m,g[1]));if(A.status=P,"18"==m.substr(g[2],2)){var x=h(m,g[2]);A.thisupdate=Ve(x)}for(var N=3;N<g.length;N++){if("a0"==m.substr(g[N],2)){var B=v(m,g[N],[0],"18");A.nextupdate=Ve(B)}if("a1"==m.substr(g[N],2)){var M=new Se,j=w(m,0,[N,0]);A.ext=M.getExtParamArray(j)}}return A},this.getCertStatus=function(m){var g={};if("8000"==m)return{status:"good"};if("8200"==m)return{status:"unknown"};if("a1"==m.substr(0,2)){g.status="revoked";var y=Ve(v(m,0,[0]));g.time=y}return g}},(typeof l>"u"||!l)&&(l={}),(typeof l.lang>"u"||!l.lang)&&(l.lang={}),l.lang.String=function(){},"function"==typeof Buffer?(hn=function(e){return Ki(Buffer.from(e,"utf8").toString("base64"))},Qt=function(e){return Buffer.from(ln(e),"base64").toString("utf8")}):(hn=function(e){return dt(ir(sr(e)))},Qt=function(e){return decodeURIComponent(nr(Ye(e)))}),l.lang.String.isInteger=function(e){return!!e.match(/^[0-9]+$/)||!!e.match(/^-[0-9]+$/)},l.lang.String.isHex=function(e){return Io(e)},l.lang.String.isBase64=function(e){return!(!(e=e.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||e.length%4!=0)},l.lang.String.isBase64URL=function(e){return!e.match(/[+/=]/)&&(e=ln(e),l.lang.String.isBase64(e))},l.lang.String.isIntegerArray=function(e){return!!(e=e.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},l.lang.String.isPrintable=function(e){return null!==e.match(/^[0-9A-Za-z '()+,-./:=?]*$/)},l.lang.String.isIA5=function(e){return null!==e.match(/^[\x20-\x21\x23-\x7f]*$/)},l.lang.String.isMail=function(e){return null!==e.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)};var or=function(e,r,s){return null==s&&(s="0"),e.length>=r?e:new Array(r-e.length+1).join(s)+e};function ko(e){if(e.length%2!=0||null==(e=e.toLowerCase()).match(/^[0-9a-f]+$/))return-1;try{var r=e.substr(0,2);if("00"==r)return parseInt(e.substr(2),16);var s=parseInt(r,16);if(s>7)return-1;var o=e.substr(2),h=parseInt(o,16).toString(2);"0"==h&&(h="00000000"),h=h.slice(0,0-s);var d=parseInt(h,2);return NaN==d?-1:d}catch{return-1}}function No(e){if("number"!=typeof e||e<0)return null;var r=Number(e).toString(2),s=8-r.length%8;8==s&&(s=0),r+=or("",s,"0");var o=parseInt(r,2).toString(16);return o.length%2==1&&(o="0"+o),"0"+s+o}function Do(e){if("string"!=typeof e||e.length%2!=0||!e.match(/^[0-9a-f]+$/))return null;try{var r=parseInt(e.substr(0,2),16);if(r<0||7<r)return null;for(var s=e.substr(2),o="",h=0;h<s.length;h+=2){var d=s.substr(h,2),f=parseInt(d,16).toString(2);o+=f=("0000000"+f).slice(-8)}return o.substr(0,o.length-r)}catch{return null}}function cr(e,r){for(var s=0,o=0;o<e.length;o++)s|=1<<r[e[o]];var h=s.toString(2),d="";for(o=h.length-1;o>=0;o--)d+=h[o];return d}function rt(e,o,s){if("object"==typeof e){o=String(o).split(".");for(var h=0;h<o.length&&e;h++){var d=o[h];d.match(/^[0-9]+$/)&&(d=parseInt(d)),e=e[d]}return e||!1===e?e:s}}function ne(e,r){var s=function(){};s.prototype=r.prototype,e.prototype=new s,e.prototype.constructor=e,e.superclass=r.prototype,r.prototype.constructor==Object.prototype.constructor&&(r.prototype.constructor=r)}(typeof l>"u"||!l)&&(l={}),(typeof l.crypto>"u"||!l.crypto)&&(l.crypto={}),l.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:u.algo.MD5,sha1:u.algo.SHA1,sha224:u.algo.SHA224,sha256:u.algo.SHA256,sha384:u.algo.SHA384,sha512:u.algo.SHA512,ripemd160:u.algo.RIPEMD160},this.getDigestInfoHex=function(e,r){if(typeof this.DIGESTINFOHEAD[r]>"u")throw"alg not supported in Util.DIGESTINFOHEAD: "+r;return this.DIGESTINFOHEAD[r]+e},this.getPaddedDigestInfoHex=function(e,r,s){var o=this.getDigestInfoHex(e,r),h=s/4;if(o.length+22>h)throw"key is too short for SigAlg: keylen="+s+","+r;for(var f="00"+o,v="",w=h-4-f.length,_=0;_<w;_+=2)v+="ff";return"0001"+v+f},this.hashString=function(e,r){return new l.crypto.MessageDigest({alg:r}).digestString(e)},this.hashHex=function(e,r){return new l.crypto.MessageDigest({alg:r}).digestHex(e)},this.sha1=function(e){return this.hashString(e,"sha1")},this.sha256=function(e){return this.hashString(e,"sha256")},this.sha256Hex=function(e){return this.hashHex(e,"sha256")},this.sha512=function(e){return this.hashString(e,"sha512")},this.sha512Hex=function(e){return this.hashHex(e,"sha512")},this.isKey=function(e){return e instanceof Ee||e instanceof l.crypto.DSA||e instanceof l.crypto.ECDSA}},l.crypto.Util.md5=function(e){return new l.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(e)},l.crypto.Util.ripemd160=function(e){return new l.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(e)},l.crypto.Util.SECURERANDOMGEN=new Ui,l.crypto.Util.getRandomHexOfNbytes=function(e){var r=new Array(e);return l.crypto.Util.SECURERANDOMGEN.nextBytes(r),Zn(r)},l.crypto.Util.getRandomBigIntegerOfNbytes=function(e){return new F(l.crypto.Util.getRandomHexOfNbytes(e),16)},l.crypto.Util.getRandomHexOfNbits=function(e){var r=e%8,o=new Array((e-r)/8+1);return l.crypto.Util.SECURERANDOMGEN.nextBytes(o),o[0]=(255<<r&255^255)&o[0],Zn(o)},l.crypto.Util.getRandomBigIntegerOfNbits=function(e){return new F(l.crypto.Util.getRandomHexOfNbits(e),16)},l.crypto.Util.getRandomBigIntegerZeroToMax=function(e){for(var r=e.bitLength();;){var s=l.crypto.Util.getRandomBigIntegerOfNbits(r);if(-1!=e.compareTo(s))return s}},l.crypto.Util.getRandomBigIntegerMinToMax=function(e,r){var s=e.compareTo(r);if(1==s)throw"biMin is greater than biMax";if(0==s)return e;var o=r.subtract(e);return l.crypto.Util.getRandomBigIntegerZeroToMax(o).add(e)},l.crypto.MessageDigest=function(e){this.setAlgAndProvider=function(h,d){if(null!==(h=l.crypto.MessageDigest.getCanonicalAlgName(h))&&void 0===d&&(d=l.crypto.Util.DEFAULTPROVIDER[h]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(h)&&"cryptojs"==d){try{this.md=l.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[h].create()}catch(f){throw"setAlgAndProvider hash alg set fail alg="+h+"/"+f}this.updateString=function(f){this.md.update(f)},this.updateHex=function(f){var v=u.enc.Hex.parse(f);this.md.update(v)},this.digest=function(){return this.md.finalize().toString(u.enc.Hex)},this.digestString=function(f){return this.updateString(f),this.digest()},this.digestHex=function(f){return this.updateHex(f),this.digest()}}if(-1!=":sha256:".indexOf(h)&&"sjcl"==d){try{this.md=new sjcl.hash.sha256}catch(f){throw"setAlgAndProvider hash alg set fail alg="+h+"/"+f}this.updateString=function(f){this.md.update(f)},this.updateHex=function(f){var v=sjcl.codec.hex.toBits(f);this.md.update(v)},this.digest=function(){var f=this.md.finalize();return sjcl.codec.hex.fromBits(f)},this.digestString=function(f){return this.updateString(f),this.digest()},this.digestHex=function(f){return this.updateHex(f),this.digest()}}},this.updateString=function(h){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(h){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(h){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(h){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==e&&void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov&&(this.provName=l.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},l.crypto.MessageDigest.getCanonicalAlgName=function(e){return"string"==typeof e&&(e=(e=e.toLowerCase()).replace(/-/,"")),e},l.crypto.MessageDigest.getHashLength=function(e){var r=l.crypto.MessageDigest,s=r.getCanonicalAlgName(e);if(void 0===r.HASHLENGTH[s])throw"not supported algorithm: "+e;return r.HASHLENGTH[s]},l.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},l.crypto.Mac=function(e){this.setAlgAndProvider=function(f,v){if(null==(f=f.toLowerCase())&&(f="hmacsha1"),"hmac"!=(f=f.toLowerCase()).substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+f;void 0===v&&(v=l.crypto.Util.DEFAULTPROVIDER[f]),this.algProv=f+"/"+v;var w=f.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(w)&&"cryptojs"==v){try{this.mac=u.algo.HMAC.create(l.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[w],this.pass)}catch(I){throw"setAlgAndProvider hash alg set fail hashAlg="+w+"/"+I}this.updateString=function(I){this.mac.update(I)},this.updateHex=function(I){var T=u.enc.Hex.parse(I);this.mac.update(T)},this.doFinal=function(){return this.mac.finalize().toString(u.enc.Hex)},this.doFinalString=function(I){return this.updateString(I),this.doFinal()},this.doFinalHex=function(I){return this.updateHex(I),this.doFinal()}}},this.updateString=function(f){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(f){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(f){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(f){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(f){if("string"==typeof f){var v=f;return(f.length%2==1||!f.match(/^[0-9A-Fa-f]+$/))&&(v=ei(f)),void(this.pass=u.enc.Hex.parse(v))}if("object"!=typeof f)throw"KJUR.crypto.Mac unsupported password type: "+f;if(v=null,void 0!==f.hex){if(f.hex.length%2!=0||!f.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+f.hex;v=f.hex}if(void 0!==f.utf8&&(v=er(f.utf8)),void 0!==f.rstr&&(v=ei(f.rstr)),void 0!==f.b64&&(v=b(f.b64)),void 0!==f.b64u&&(v=Ye(f.b64u)),null==v)throw"KJUR.crypto.Mac unsupported password type: "+f;this.pass=u.enc.Hex.parse(v)},void 0!==e&&(void 0!==e.pass&&this.setPassword(e.pass),void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov&&(this.provName=l.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},l.crypto.Signature=function(e){var r=null;if(this._setAlgNames=function(){var x=this.algName.match(/^(.+)with(.+)$/);x&&(this.mdAlgName=x[1].toLowerCase(),this.pubkeyAlgName=x[2].toLowerCase(),"rsaandmgf1"==this.pubkeyAlgName&&"sha"==this.mdAlgName&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(x,N){for(var B="",M=N/4-x.length,j=0;j<M;j++)B+="0";return B+x},this.setAlgAndProvider=function(x,N){if(this._setAlgNames(),"cryptojs/jsrsa"!=N)throw new Error("provider not supported: "+N);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new l.crypto.MessageDigest({alg:this.mdAlgName})}catch(B){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+B)}this.init=function(B,M){var j=null;try{j=void 0===M?Ie.getKey(B):Ie.getKey(B,M)}catch(Q){throw"init failed:"+Q}if(!0===j.isPrivate)this.prvKey=j,this.state="SIGN";else{if(!0!==j.isPublic)throw"init failed.:"+j;this.pubKey=j,this.state="VERIFY"}},this.updateString=function(B){this.md.updateString(B)},this.updateHex=function(B){this.md.updateHex(B)},this.sign=function(){if(this.sHashHex=this.md.digest(),void 0===this.prvKey&&void 0!==this.ecprvhex&&void 0!==this.eccurvename&&void 0!==l.crypto.ECDSA&&(this.prvKey=new l.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof Ee&&"rsaandmgf1"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof Ee&&"rsa"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof l.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof l.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(B){return this.updateString(B),this.sign()},this.signHex=function(B){return this.updateHex(B),this.sign()},this.verify=function(B){if(this.sHashHex=this.md.digest(),void 0===this.pubKey&&void 0!==this.ecpubhex&&void 0!==this.eccurvename&&void 0!==l.crypto.ECDSA&&(this.pubKey=new l.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof Ee&&"rsaandmgf1"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,B,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof Ee&&"rsa"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,B);if(void 0!==l.crypto.ECDSA&&this.pubKey instanceof l.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,B);if(void 0!==l.crypto.DSA&&this.pubKey instanceof l.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,B);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(x,N){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(x){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(x){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(x){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(x){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(x){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=e,void 0!==e&&(void 0!==e.alg&&(this.algName=e.alg,this.provName=void 0===e.prov?l.crypto.Util.DEFAULTPROVIDER[this.algName]:e.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==e.psssaltlen&&(this.pssSaltLen=e.psssaltlen),void 0!==e.prvkeypem)){if(void 0!==e.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{r=Ie.getKey(e.prvkeypem),this.init(r)}catch(x){throw"fatal error to load pem private key: "+x}}},l.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},(typeof l>"u"||!l)&&(l={}),(typeof l.crypto>"u"||!l.crypto)&&(l.crypto={}),l.crypto.ECDSA=function(e){var d=Error,f=F,v=Me,w=l.crypto.ECDSA,_=l.crypto.ECParameterDB,I=w.getName,m=ue.getVbyListEx,g=ue.isASN1HEX,A=new Ui;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(x){return new f(x.bitLength(),A).mod(x.subtract(f.ONE)).add(f.ONE)},this.setNamedCurve=function(x){this.ecparams=_.getByName(x),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=x},this.setPrivateKeyHex=function(x){this.isPrivate=!0,this.prvKeyHex=x},this.setPublicKeyHex=function(x){this.isPublic=!0,this.pubKeyHex=x},this.getPublicKeyXYHex=function(){var x=this.pubKeyHex;if("04"!==x.substr(0,2))throw"this method supports uncompressed format(04) only";var N=this.ecparams.keycharlen;if(x.length!==2+2*N)throw"malformed public key hex length";var B={};return B.x=x.substr(2,N),B.y=x.substr(2+N),B},this.getShortNISTPCurveName=function(){var x=this.curveName;return"secp256r1"===x||"NIST P-256"===x||"P-256"===x||"prime256v1"===x?"P-256":"secp384r1"===x||"NIST P-384"===x||"P-384"===x?"P-384":"secp521r1"===x||"NIST P-521"===x||"P-521"===x?"P-521":null},this.generateKeyPairHex=function(){var N=this.getBigRandom(this.ecparams.n),B=this.ecparams.keycharlen,M=("0000000000"+N.toString(16)).slice(-B);return this.setPrivateKeyHex(M),{ecprvhex:M,ecpubhex:this.generatePublicKeyHex()}},this.generatePublicKeyHex=function(){var x=new f(this.prvKeyHex,16),N=this.ecparams.G.multiply(x),B=N.getX().toBigInteger(),M=N.getY().toBigInteger(),j=this.ecparams.keycharlen,R="04"+("0000000000"+B.toString(16)).slice(-j)+("0000000000"+M.toString(16)).slice(-j);return this.setPublicKeyHex(R),R},this.signWithMessageHash=function(x){return this.signHex(x,this.prvKeyHex)},this.signHex=function(x,N){var B=new f(N,16),M=this.ecparams.n,j=new f(x.substring(0,this.ecparams.keycharlen),16);do{var Q=this.getBigRandom(M),D=this.ecparams.G.multiply(Q).getX().toBigInteger().mod(M)}while(D.compareTo(f.ZERO)<=0);var L=Q.modInverse(M).multiply(j.add(B.multiply(D))).mod(M);return w.biRSSigToASN1Sig(D,L)},this.sign=function(x,N){var B=N,M=this.ecparams.n,j=f.fromByteArrayUnsigned(x);do{var Q=this.getBigRandom(M),D=this.ecparams.G.multiply(Q).getX().toBigInteger().mod(M)}while(D.compareTo(F.ZERO)<=0);var L=Q.modInverse(M).multiply(j.add(B.multiply(D))).mod(M);return this.serializeSig(D,L)},this.verifyWithMessageHash=function(x,N){return this.verifyHex(x,N,this.pubKeyHex)},this.verifyHex=function(x,N,B){try{var M,j,Q=w.parseSigHex(N);M=Q.r,j=Q.s;var Y=v.decodeFromHex(this.ecparams.curve,B),R=new f(x.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(R,M,j,Y)}catch{return!1}},this.verify=function(x,N,B){var M,j,Y;if(Bitcoin.Util.isArray(N)){var Q=this.parseSig(N);M=Q.r,j=Q.s}else{if("object"!=typeof N||!N.r||!N.s)throw"Invalid value for signature";M=N.r,j=N.s}if(B instanceof Me)Y=B;else{if(!Bitcoin.Util.isArray(B))throw"Invalid format for pubkey value, must be byte array or ECPointFp";Y=v.decodeFrom(this.ecparams.curve,B)}var R=f.fromByteArrayUnsigned(x);return this.verifyRaw(R,M,j,Y)},this.verifyRaw=function(x,N,B,M){var j=this.ecparams.n,Q=this.ecparams.G;if(N.compareTo(f.ONE)<0||N.compareTo(j)>=0||B.compareTo(f.ONE)<0||B.compareTo(j)>=0)return!1;var Y=B.modInverse(j),R=x.multiply(Y).mod(j),D=N.multiply(Y).mod(j);return Q.multiply(R).add(M.multiply(D)).getX().toBigInteger().mod(j).equals(N)},this.serializeSig=function(x,N){var B=x.toByteArraySigned(),M=N.toByteArraySigned(),j=[];return j.push(2),j.push(B.length),(j=j.concat(B)).push(2),j.push(M.length),(j=j.concat(M)).unshift(j.length),j.unshift(48),j},this.parseSig=function(x){var N;if(48!=x[0])throw new Error("Signature not a valid DERSequence");if(2!=x[N=2])throw new Error("First element in signature must be a DERInteger");var B=x.slice(N+2,N+2+x[N+1]);if(2!=x[N+=2+x[N+1]])throw new Error("Second element in signature must be a DERInteger");var M=x.slice(N+2,N+2+x[N+1]);return N+=2+x[N+1],{r:f.fromByteArrayUnsigned(B),s:f.fromByteArrayUnsigned(M)}},this.parseSigCompact=function(x){if(65!==x.length)throw"Signature has the wrong length";var N=x[0]-27;if(N<0||N>7)throw"Invalid signature type";var B=this.ecparams.n;return{r:f.fromByteArrayUnsigned(x.slice(1,33)).mod(B),s:f.fromByteArrayUnsigned(x.slice(33,65)).mod(B),i:N}},this.readPKCS5PrvKeyHex=function(x){if(!1===g(x))throw new Error("not ASN.1 hex string");var N,B,M;try{N=m(x,0,["[0]",0],"06"),B=m(x,0,[1],"04");try{M=m(x,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=I(N),void 0===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(M),this.setPrivateKeyHex(B),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(x){if(!1===g(x))throw new d("not ASN.1 hex string");var B,M,j;try{m(x,0,[1,0],"06"),B=m(x,0,[1,1],"06"),M=m(x,0,[2,0,1],"04");try{j=m(x,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new d("malformed PKCS#8 plain ECC private key")}if(this.curveName=I(B),void 0===this.curveName)throw new d("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(j),this.setPrivateKeyHex(M),this.isPublic=!1},this.readPKCS8PubKeyHex=function(x){if(!1===g(x))throw new d("not ASN.1 hex string");var B,M;try{m(x,0,[0,0],"06"),B=m(x,0,[0,1],"06"),M=m(x,0,[1],"03")}catch{throw new d("malformed PKCS#8 ECC public key")}if(this.curveName=I(B),null===this.curveName)throw new d("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(M)},this.readCertPubKeyHex=function(x,N){if(!1===g(x))throw new d("not ASN.1 hex string");var B,M;try{B=m(x,0,[0,5,0,1],"06"),M=m(x,0,[0,5,1],"03")}catch{throw new d("malformed X.509 certificate ECC public key")}if(this.curveName=I(B),null===this.curveName)throw new d("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(M)},void 0!==e&&void 0!==e.curve&&(this.curveName=e.curve),void 0===this.curveName&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),void 0!==e&&(void 0!==e.prv&&this.setPrivateKeyHex(e.prv),void 0!==e.pub&&this.setPublicKeyHex(e.pub))},l.crypto.ECDSA.parseSigHex=function(e){var r=l.crypto.ECDSA.parseSigHexInHexRS(e);return{r:new F(r.r,16),s:new F(r.s,16)}},l.crypto.ECDSA.parseSigHexInHexRS=function(e){var s=ue.getChildIdx,o=ue.getV;if(ue.checkStrictDER(e,0),"30"!=e.substr(0,2))throw new Error("signature is not a ASN.1 sequence");var h=s(e,0);if(2!=h.length)throw new Error("signature shall have two elements");var d=h[0],f=h[1];if("02"!=e.substr(d,2))throw new Error("1st item not ASN.1 integer");if("02"!=e.substr(f,2))throw new Error("2nd item not ASN.1 integer");return{r:o(e,d),s:o(e,f)}},l.crypto.ECDSA.asn1SigToConcatSig=function(e){var r=l.crypto.ECDSA.parseSigHexInHexRS(e),s=r.r,o=r.s;if(s.length>=130&&s.length<=134){if(s.length%2!=0)throw Error("unknown ECDSA sig r length error");if(o.length%2!=0)throw Error("unknown ECDSA sig s length error");"00"==s.substr(0,2)&&(s=s.substr(2)),"00"==o.substr(0,2)&&(o=o.substr(2));var h=Math.max(s.length,o.length);return(s=("000000"+s).slice(-h))+("000000"+o).slice(-h)}if("00"==s.substr(0,2)&&s.length%32==2&&(s=s.substr(2)),"00"==o.substr(0,2)&&o.length%32==2&&(o=o.substr(2)),s.length%32==30&&(s="00"+s),o.length%32==30&&(o="00"+o),s.length%32!=0)throw Error("unknown ECDSA sig r length error");if(o.length%32!=0)throw Error("unknown ECDSA sig s length error");return s+o},l.crypto.ECDSA.concatSigToASN1Sig=function(e){if(e.length%4!=0)throw Error("unknown ECDSA concatinated r-s sig length error");var r=e.substr(0,e.length/2),s=e.substr(e.length/2);return l.crypto.ECDSA.hexRSSigToASN1Sig(r,s)},l.crypto.ECDSA.hexRSSigToASN1Sig=function(e,r){var s=new F(e,16),o=new F(r,16);return l.crypto.ECDSA.biRSSigToASN1Sig(s,o)},l.crypto.ECDSA.biRSSigToASN1Sig=function(e,r){var s=l.asn1,o=new s.DERInteger({bigint:e}),h=new s.DERInteger({bigint:r});return new s.DERSequence({array:[o,h]}).tohex()},l.crypto.ECDSA.getName=function(e){return"2b8104001f"===e?"secp192k1":"2a8648ce3d030107"===e?"secp256r1":"2b8104000a"===e?"secp256k1":"2b81040021"===e?"secp224r1":"2b81040022"===e?"secp384r1":"2b81040023"===e?"secp521r1":-1!=="|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(e)?"secp256r1":-1!=="|secp256k1|".indexOf(e)?"secp256k1":-1!=="|secp224r1|NIST P-224|P-224|".indexOf(e)?"secp224r1":-1!=="|secp384r1|NIST P-384|P-384|".indexOf(e)?"secp384r1":-1!=="|secp521r1|NIST P-521|P-521|".indexOf(e)?"secp521r1":null},(typeof l>"u"||!l)&&(l={}),(typeof l.crypto>"u"||!l.crypto)&&(l.crypto={}),l.crypto.ECParameterDB=new function(){var e={},r={};function s(o){return new F(o,16)}this.getByName=function(o){var h=o;if(typeof r[h]<"u"&&(h=r[o]),typeof e[h]<"u")return e[h];throw"unregistered EC curve name: "+h},this.regist=function(o,h,d,f,v,w,_,I,T,m,g,A){e[o]={};var y=s(d),P=s(f),x=s(v),N=s(w),B=s(_),M=new oi(y,P,x),j=M.decodePointHex("04"+I+T);e[o].name=o,e[o].keylen=h,e[o].keycharlen=2*Math.ceil(h/8),e[o].curve=M,e[o].G=j,e[o].n=N,e[o].h=B,e[o].oid=g,e[o].info=A;for(var Q=0;Q<m.length;Q++)r[m[Q]]=o}},l.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),l.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),l.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),l.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),l.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),l.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),l.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),l.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),l.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),l.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]),(typeof l>"u"||!l)&&(l={}),(typeof l.crypto>"u"||!l.crypto)&&(l.crypto={}),l.crypto.DSA=function(){var s=ue.getVbyListEx,o=ue.isASN1HEX,h=F;this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(d,f,v,w,_){this.isPrivate=!0,this.p=d,this.q=f,this.g=v,this.y=w,this.x=_},this.setPrivateHex=function(d,f,v,w,_){var I,T,m,g,A;I=new F(d,16),T=new F(f,16),m=new F(v,16),g="string"==typeof w&&w.length>1?new F(w,16):null,A=new F(_,16),this.setPrivate(I,T,m,g,A)},this.setPublic=function(d,f,v,w){this.isPublic=!0,this.p=d,this.q=f,this.g=v,this.y=w,this.x=null},this.setPublicHex=function(d,f,v,w){var _,I,T,m;_=new F(d,16),I=new F(f,16),T=new F(v,16),m=new F(w,16),this.setPublic(_,I,T,m)},this.signWithMessageHash=function(d){var f=this.p,v=this.q,w=this.g,I=this.x,T=l.crypto.Util.getRandomBigIntegerMinToMax(F.ONE.add(F.ONE),v.subtract(F.ONE)),g=new F(d.substr(0,v.bitLength()/4),16),A=w.modPow(T,f).mod(v),y=T.modInverse(v).multiply(g.add(I.multiply(A))).mod(v);return l.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:A}},{int:{bigint:y}}]})},this.verifyWithMessageHash=function(d,f){var v=this.p,w=this.q,_=this.g,I=this.y,T=this.parseASN1Signature(f),m=T[0],g=T[1],y=new F(d.substr(0,w.bitLength()/4),16);if(F.ZERO.compareTo(m)>0||m.compareTo(w)>0||F.ZERO.compareTo(g)>=0||g.compareTo(w)>0)throw"invalid DSA signature";var P=g.modInverse(w),x=y.multiply(P).mod(w),N=m.multiply(P).mod(w);return 0==_.modPow(x,v).multiply(I.modPow(N,v)).mod(v).mod(w).compareTo(m)},this.parseASN1Signature=function(d){try{return[new h(s(d,0,[0],"02"),16),new h(s(d,0,[1],"02"),16)]}catch{throw new Error("malformed ASN.1 DSA signature")}},this.readPKCS5PrvKeyHex=function(d){var f,v,w,_,I;if(!1===o(d))throw new Error("not ASN.1 hex string");try{f=s(d,0,[1],"02"),v=s(d,0,[2],"02"),w=s(d,0,[3],"02"),_=s(d,0,[4],"02"),I=s(d,0,[5],"02")}catch{throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(f,v,w,_,I)},this.readPKCS8PrvKeyHex=function(d){var f,v,w,_;if(!1===o(d))throw new Error("not ASN.1 hex string");try{f=s(d,0,[1,1,0],"02"),v=s(d,0,[1,1,1],"02"),w=s(d,0,[1,1,2],"02"),_=s(d,0,[2,0],"02")}catch{throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(f,v,w,null,_)},this.readPKCS8PubKeyHex=function(d){var f,v,w,_;if(!1===o(d))throw new Error("not ASN.1 hex string");try{f=s(d,0,[0,1,0],"02"),v=s(d,0,[0,1,1],"02"),w=s(d,0,[0,1,2],"02"),_=s(d,0,[1,0],"02")}catch{throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(f,v,w,_)},this.readCertPubKeyHex=function(d,f){var v,w,_,I;if(!1===o(d))throw new Error("not ASN.1 hex string");try{v=s(d,0,[0,5,0,1,0],"02"),w=s(d,0,[0,5,0,1,1],"02"),_=s(d,0,[0,5,0,1,2],"02"),I=s(d,0,[0,5,1,0],"02")}catch{throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(v,w,_,I)}};var Ie=function(){var e=function(y,P,x){return o(u.AES,y,P,x)},o=function(y,P,x,N){var B=u.enc.Hex.parse(P),M=u.enc.Hex.parse(x),j=u.enc.Hex.parse(N),Q={};Q.key=M,Q.iv=j,Q.ciphertext=B;var Y=y.decrypt(Q,M,{iv:j});return u.enc.Hex.stringify(Y)},h=function(y,P,x){return v(u.AES,y,P,x)},v=function(y,P,x,N){var B=u.enc.Hex.parse(P),M=u.enc.Hex.parse(x),j=u.enc.Hex.parse(N),Q=y.encrypt(B,M,{iv:j}),Y=u.enc.Hex.parse(Q.toString());return u.enc.Base64.stringify(Y)},w={"AES-256-CBC":{proc:e,eproc:h,keylen:32,ivlen:16},"AES-192-CBC":{proc:e,eproc:h,keylen:24,ivlen:16},"AES-128-CBC":{proc:e,eproc:h,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(y,P,x){return o(u.TripleDES,y,P,x)},eproc:function(y,P,x){return v(u.TripleDES,y,P,x)},keylen:24,ivlen:8},"DES-CBC":{proc:function(y,P,x){return o(u.DES,y,P,x)},eproc:function(y,P,x){return v(u.DES,y,P,x)},keylen:8,ivlen:8}},T=function(y){var P={},x=y.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));x&&(P.cipher=x[1],P.ivsalt=x[2]);var N=y.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));N&&(P.type=N[1]);var B=-1,M=0;-1!=y.indexOf("\r\n\r\n")&&(B=y.indexOf("\r\n\r\n"),M=2),-1!=y.indexOf("\n\n")&&(B=y.indexOf("\n\n"),M=1);var j=y.indexOf("-----END");if(-1!=B&&-1!=j){var Q=y.substring(B+2*M,j-M);Q=Q.replace(/\s+/g,""),P.data=Q}return P},m=function(y,P,x){for(var N=x.substring(0,16),B=u.enc.Hex.parse(N),M=u.enc.Utf8.parse(P),j=w[y].keylen+w[y].ivlen,Q="",Y=null;;){var R=u.algo.MD5.create();if(null!=Y&&R.update(Y),R.update(M),R.update(B),Y=R.finalize(),(Q+=u.enc.Hex.stringify(Y)).length>=2*j)break}var D={};return D.keyhex=Q.substr(0,2*w[y].keylen),D.ivhex=Q.substr(2*w[y].keylen,2*w[y].ivlen),D},g=function(y,P,x,N){var B=u.enc.Base64.parse(y),M=u.enc.Hex.stringify(B);return(0,w[P].proc)(M,x,N)};return{version:"1.0.0",parsePKCS5PEM:function(y){return T(y)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(y,P,x){return m(y,P,x)},decryptKeyB64:function(y,P,x,N){return g(y,P,x,N)},getDecryptedKeyHex:function(y,P){var x=T(y),B=x.cipher,M=x.ivsalt,j=x.data,Q=m(B,P,M);return g(j,B,Q.keyhex,M)},getEncryptedPKCS5PEMFromPrvKeyHex:function(y,P,x,N,B){var L="";if((typeof N>"u"||null==N)&&(N="AES-256-CBC"),typeof w[N]>"u")throw new Error("KEYUTIL unsupported algorithm: "+N);if(typeof B>"u"||null==B){var j=function(y){var P=u.lib.WordArray.random(y);return u.enc.Hex.stringify(P)}(w[N].ivlen);B=j.toUpperCase()}var R=function(y,P,x,N){return(0,w[P].eproc)(y,x,N)}(P,N,m(N,x,B).keyhex,B);return L="-----BEGIN "+y+" PRIVATE KEY-----\r\n",L+="Proc-Type: 4,ENCRYPTED\r\n",L+="DEK-Info: "+N+","+B+"\r\n",L+="\r\n",(L+=R.replace(/(.{64})/g,"$1\r\n"))+"\r\n-----END "+y+" PRIVATE KEY-----\r\n"},getEncryptedPKCS8PEM:function(y,P,x){return bt(this.getEncryptedPKCS8Hex(y,P,x),"ENCRYPTED PRIVATE KEY")},getEncryptedPKCS8Hex:function(y,P,x){var N;(N=null==x||null==x?{}:JSON.parse(JSON.stringify(x))).plain=y,this.initPBES2Param(N),this.encryptPBES2Param(N,P);var B=this.generatePBES2ASN1Param(N);return l.asn1.ASN1Util.newObject(B).tohex()},initPBES2Param:function(y){var P;null==rt(y,"encalg")&&(y.encalg="aes256-CBC"),null==rt(y,"iter")&&(y.iter=2048),null==rt(y,"prf")&&(y.prf="hmacWithSHA256"),null==rt(y,"salt")&&(y.salt=u.enc.Hex.stringify(u.lib.WordArray.random(8))),null==rt(y,"enciv")&&("des-EDE3-CBC"==y.encalg&&(P=8),"aes128-CBC"==y.encalg&&(P=16),"aes256-CBC"==y.encalg&&(P=16),y.enciv=u.enc.Hex.stringify(u.lib.WordArray.random(P)))},encryptPBES2Param:function(y,P){var x=Ie.getDKFromPBES2Param(y,P);try{var N=l.crypto.Cipher.encrypt(y.plain,x,y.encalg,{iv:y.enciv})}catch{throw new Error("encrypt error: "+y.plain+" "+x+" "+y.encalg+" "+y.enciv)}y.enc=N},generatePBES2ASN1Param:function(y){var P={seq:[{seq:[{oid:"pkcs5PBES2"},{seq:[{seq:[{oid:"pkcs5PBKDF2"},{seq:[{octstr:{hex:y.salt}},{int:{hex:Ro(y.iter)}}]}]},{seq:[{oid:y.encalg},{octstr:{hex:y.enciv}}]}]}]},{octstr:{hex:y.enc}}]};return"hmacWithSHA1"!=y.prf&&P.seq[0].seq[1].seq[0].seq[1].seq.push({seq:[{oid:y.prf},{null:""}]}),P},parseHexOfEncryptedPKCS8:function(y){var x=ue.getChildIdx,N=ue.getV,B={},M=x(y,0);if(2!=M.length)throw new Error("malformed format: SEQUENCE(0).items != 2: "+M.length);B.ciphertext=N(y,M[1]);var j=x(y,M[0]);if(2!=j.length)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+j.length);if("2a864886f70d01050d"!=N(y,j[0]))throw new Error("this only supports pkcs5PBES2");var Q=x(y,j[1]);if(2!=j.length)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+Q.length);var Y=x(y,Q[1]);if(2!=Y.length)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+Y.length);if("2a864886f70d0307"!=N(y,Y[0]))throw"this only supports TripleDES";B.encryptionSchemeAlg="TripleDES",B.encryptionSchemeIV=N(y,Y[1]);var R=x(y,Q[0]);if(2!=R.length)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+R.length);if("2a864886f70d01050c"!=N(y,R[0]))throw new Error("this only supports pkcs5PBKDF2");var D=x(y,R[1]);if(D.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+D.length);B.pbkdf2Salt=N(y,D[0]);var L=N(y,D[1]);try{B.pbkdf2Iter=parseInt(L,16)}catch{throw new Error("malformed format pbkdf2Iter: "+L)}return B},getPBKDF2KeyHexFromParam:function(y,P){var x=u.enc.Hex.parse(y.pbkdf2Salt),B=u.PBKDF2(P,x,{keySize:6,iterations:y.pbkdf2Iter});return u.enc.Hex.stringify(B)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(y,P){var x=nt(y,"ENCRYPTED PRIVATE KEY"),N=this.parseHexOfEncryptedPKCS8(x),B=Ie.getPBKDF2KeyHexFromParam(N,P),M={};M.ciphertext=u.enc.Hex.parse(N.ciphertext);var j=u.enc.Hex.parse(B),Q=u.enc.Hex.parse(N.encryptionSchemeIV),Y=u.TripleDES.decrypt(M,j,{iv:Q});return u.enc.Hex.stringify(Y)},parsePBES2:function(y){var P=ue.parse(y);if("pkcs5PBES2"!=rt(P,"seq.0.seq.0.oid")||"pkcs5PBKDF2"!=rt(P,"seq.0.seq.1.seq.0.seq.0.oid"))throw new Error("not pkcs5PBES2 and pkcs5PBKDF2 used");var x=rt(P,"seq.0.seq.1.seq.0.seq.1.seq");if(null==x)throw new Error("PBKDF2 parameter not found");var N=rt(x,"0.octstr.hex"),B=rt(x,"1.int.hex"),M=rt(x,"2.seq.0.oid","hmacWithSHA1"),j=-1;try{j=parseInt(B,16)}catch{throw new Error("iter not proper value")}var Q=rt(P,"seq.0.seq.1.seq.1.seq.0.oid"),Y=rt(P,"seq.0.seq.1.seq.1.seq.1.octstr.hex"),R=rt(P,"seq.1.octstr.hex");if(null==Q||null==Y||null==R)throw new Error("encalg, enciv or enc is undefined");return{salt:N,iter:j,prf:M,encalg:Q,enciv:Y,enc:R}},getDKFromPBES2Param:function(y,P){var B={hmacWithSHA1:u.algo.SHA1,hmacWithSHA224:u.algo.SHA224,hmacWithSHA256:u.algo.SHA256,hmacWithSHA384:u.algo.SHA384,hmacWithSHA512:u.algo.SHA512}[y.prf];if(null==B)throw new Error("unsupported prf");var M={"des-EDE3-CBC":6,"aes128-CBC":4,"aes256-CBC":8}[y.encalg];if(null==M)throw new Error("unsupported encalg");var j=u.enc.Hex.parse(y.salt),Q=y.iter;try{var Y=u.PBKDF2(P,j,{keySize:M,iterations:Q,hasher:B});return u.enc.Hex.stringify(Y)}catch(R){throw new Error("PBKDF2 error: "+R+" "+JSON.stringify(y)+" "+P)}},getPlainHexFromEncryptedPKCS8PEM:function(y,P){if(-1==y.indexOf("BEGIN ENCRYPTED PRIVATE KEY"))throw new Error("not Encrypted PKCS#8 PEM string");var N,x=nt(y);try{N=Ie.parsePBES2(x)}catch(M){throw new Error("malformed PBES2 format: "+M.message)}var B=Ie.getDKFromPBES2Param(N,P);return l.crypto.Cipher.decrypt(N.enc,B,N.encalg,{iv:N.enciv})},getKeyFromEncryptedPKCS8PEM:function(y,P){var x=this.getPlainHexFromEncryptedPKCS8PEM(y,P);return this.getKeyFromPlainPrivatePKCS8Hex(x)},parsePlainPrivatePKCS8Hex:function(y){var P=ue,x=P.getChildIdx,N=P.getV,B={algparam:null};if("30"!=y.substr(0,2))throw new Error("malformed plain PKCS8 private key(code:001)");var M=x(y,0);if(M.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if("30"!=y.substr(M[1],2))throw new Error("malformed PKCS8 private key(code:003)");var j=x(y,M[1]);if(2!=j.length)throw new Error("malformed PKCS8 private key(code:004)");if("06"!=y.substr(j[0],2))throw new Error("malformed PKCS8 private key(code:005)");if(B.algoid=N(y,j[0]),"06"==y.substr(j[1],2)&&(B.algparam=N(y,j[1])),"04"!=y.substr(M[2],2))throw new Error("malformed PKCS8 private key(code:006)");return B.keyidx=P.getVidx(y,M[2]),B},getKeyFromPlainPrivatePKCS8PEM:function(y){var P=nt(y,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(P)},getKeyFromPlainPrivatePKCS8Hex:function(y){var x,P=this.parsePlainPrivatePKCS8Hex(y);if("2a864886f70d010101"==P.algoid)x=new Ee;else if("2a8648ce380401"==P.algoid)x=new l.crypto.DSA;else{if("2a8648ce3d0201"!=P.algoid)throw new Error("unsupported private key algorithm");x=new l.crypto.ECDSA}return x.readPKCS8PrvKeyHex(y),x},_getKeyFromPublicPKCS8Hex:function(y){var P,x=ue.getVbyList(y,0,[0,0],"06");if("2a864886f70d010101"===x)P=new Ee;else if("2a8648ce380401"===x)P=new l.crypto.DSA;else{if("2a8648ce3d0201"!==x)throw new Error("unsupported PKCS#8 public key hex");P=new l.crypto.ECDSA}return P.readPKCS8PubKeyHex(y),P},parsePublicRawRSAKeyHex:function(y){var x=ue.getChildIdx,N=ue.getV,B={};if("30"!=y.substr(0,2))throw new Error("malformed RSA key(code:001)");var M=x(y,0);if(2!=M.length)throw new Error("malformed RSA key(code:002)");if("02"!=y.substr(M[0],2))throw new Error("malformed RSA key(code:003)");if(B.n=N(y,M[0]),"02"!=y.substr(M[1],2))throw new Error("malformed RSA key(code:004)");return B.e=N(y,M[1]),B},parsePublicPKCS8Hex:function(y){var P=ue,x=P.getChildIdx,N=P.getV,B={algparam:null},M=x(y,0);if(2!=M.length)throw new Error("outer DERSequence shall have 2 elements: "+M.length);var j=M[0];if("30"!=y.substr(j,2))throw new Error("malformed PKCS8 public key(code:001)");var Q=x(y,j);if(2!=Q.length)throw new Error("malformed PKCS8 public key(code:002)");if("06"!=y.substr(Q[0],2))throw new Error("malformed PKCS8 public key(code:003)");if(B.algoid=N(y,Q[0]),"06"==y.substr(Q[1],2)?B.algparam=N(y,Q[1]):"30"==y.substr(Q[1],2)&&(B.algparam={},B.algparam.p=P.getVbyList(y,Q[1],[0],"02"),B.algparam.q=P.getVbyList(y,Q[1],[1],"02"),B.algparam.g=P.getVbyList(y,Q[1],[2],"02")),"03"!=y.substr(M[1],2))throw new Error("malformed PKCS8 public key(code:004)");return B.key=N(y,M[1]).substr(2),B}}}();function Oo(e,r){for(var s="",o=r/4-e.length,h=0;h<o;h++)s+="0";return s+e}function Bo(e,r,s){for(var o="",h=0;o.length<r;)o+=Tt(s(ei(e+String.fromCharCode.apply(String,[(4278190080&h)>>24,(16711680&h)>>16,(65280&h)>>8,255&h])))),h+=1;return o}function Mo(e){for(var r in l.crypto.Util.DIGESTINFOHEAD){var s=l.crypto.Util.DIGESTINFOHEAD[r],o=s.length;if(e.substring(0,o)==s)return[r,e.substring(o)]}return[]}function Se(e){var B,r=ue,s=r.getChildIdx,o=r.getV,d=r.parse,f=r.getTLV,v=r.getVbyList,w=r.getVbyListEx,_=r.getTLVbyList,I=r.getTLVbyListEx,T=r.getIdxbyList,m=r.getIdxbyListEx,g=r.getVidx,A=r.getInt,y=r.oidname,P=r.hextooidstr,N=nt,M=Error;try{B=l.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(null===this.hex||0!==this.version)return this.version;var R=_(this.hex,0,[0,0]);if("a0"==R.substr(0,2)){var D=_(R,0,[0]),L=A(D,0);if(L<0||2<L)throw new Error("malformed version field");return this.version=L+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return w(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var R=I(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(R)},this.getAlgorithmIdentifierName=function(R){for(var D in B)if(R===B[D])return D;return y(w(R,0,[0],"06"))},this.getIssuer=function(R,D){return this.getX500Name(this.getIssuerHex(),R,D)},this.getIssuerHex=function(){return _(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(R,D){return this.getX500Name(this.getSubjectHex(),R,D)},this.getSubjectHex=function(){return _(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var R=v(this.hex,0,[0,4+this.foffset,0]);return R=R.replace(/(..)/g,"%$1"),decodeURIComponent(R)},this.getNotAfter=function(){var R=v(this.hex,0,[0,4+this.foffset,1]);return R=R.replace(/(..)/g,"%$1"),decodeURIComponent(R)},this.getPublicKeyHex=function(){return this.getSPKI()},this.getSPKI=function(){return _(this.hex,0,[0,6+this.foffset],"30")},this.getSPKIValue=function(){var R=this.getSPKI();return null==R?null:v(R,0,[1],"03",!0)},this.getPublicKeyIdx=function(){return T(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var R=this.getPublicKeyIdx();return T(this.hex,R,[1,0],"30")},this.getPublicKey=function(){return Ie.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var R=_(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(R)},this.getSignatureValueHex=function(){return v(this.hex,0,[2],"03",!0)},this.verifySignature=function(R){var D=this.getSignatureAlgorithmField(),L=this.getSignatureValueHex(),H=_(this.hex,0,[0],"30"),z=new l.crypto.Signature({alg:D});return z.init(R),z.updateHex(H),z.verify(L)},this.parseExt=function(R){var D,L,H;if(void 0===R){if(3!==this.version)return-1;D=T(H=this.hex,0,[0,7,0],"30"),L=s(H,D)}else{H=nt(R);var z=T(H,0,[0,3,0,0],"06");if("2a864886f70d01090e"!=o(H,z))return void(this.aExtInfo=new Array);D=T(H,0,[0,3,0,1,0],"30"),L=s(H,D),this.hex=H}this.aExtInfo=new Array;for(var X=0;X<L.length;X++){var W={critical:!1},J=0;3===s(H,L[X]).length&&(W.critical=!0,J=1),W.oid=r.hextooidstr(v(H,L[X],[0],"06"));var ee=T(H,L[X],[1+J]);W.vidx=g(H,ee),this.aExtInfo.push(W)}},this.getExtInfo=function(R){var D=this.aExtInfo,L=R;if(R.match(/^[0-9.]+$/)||(L=l.asn1.x509.OID.name2oid(R)),""!==L)for(var H=0;H<D.length;H++)if(D[H].oid===L)return D[H]},this.getCriticalExtV=function(R,D,L){if(null!=D)return[D,L];var H=this.getExtInfo(R);return null==H?[null,null]:[f(this.hex,H.vidx),H.critical]},this.getExtBasicConstraints=function(R,D){if(void 0===R&&void 0===D){var L=this.getExtInfo("basicConstraints");if(void 0===L)return;R=f(this.hex,L.vidx),D=L.critical}var H={extname:"basicConstraints"};if(D&&(H.critical=!0),"3000"===R)return H;if("30030101ff"===R)return H.cA=!0,H;if("30060101ff02"===R.substr(0,12)){var z=o(R,10),X=parseInt(z,16);return H.cA=!0,H.pathLen=X,H}throw new Error("hExtV parse error: "+R)},this.getExtNameConstraints=function(R,D){var L=this.getCriticalExtV("nameConstraints",R,D);if(D=L[1],null!=(R=L[0])){var H={extname:"nameConstraints"};D&&(H.critical=!0);for(var z=s(R,0),X=0;X<z.length;X++){for(var W=[],$=s(R,z[X]),J=0;J<$.length;J++){var ee=f(R,$[J]),be=this.getGeneralSubtree(ee);W.push(be)}var we=R.substr(z[X],2);"a0"==we?H.permit=W:"a1"==we&&(H.exclude=W)}return H}},this.getGeneralSubtree=function(R){var D=s(R,0),L=D.length;if(L<1||2<L)throw new Error("wrong num elements");for(var H=this.getGeneralName(f(R,D[0])),z=1;z<L;z++){var X=R.substr(D[z],2),W=o(R,D[z]),$=parseInt(W,16);"80"==X&&(H.min=$),"81"==X&&(H.max=$)}return H},this.getExtKeyUsage=function(R,D){var L=this.getCriticalExtV("keyUsage",R,D);if(D=L[1],null!=(R=L[0])){var H={extname:"keyUsage"};return D&&(H.critical=!0),H.names=this.getExtKeyUsageString(R).split(","),H}},this.getExtKeyUsageBin=function(R){if(void 0===R){var D=this.getExtInfo("keyUsage");if(void 0===D)return"";R=f(this.hex,D.vidx)}if(8!=R.length&&10!=R.length)throw new Error("malformed key usage value: "+R);var L="000000000000000"+parseInt(R.substr(6),16).toString(2);return 8==R.length&&(L=L.slice(-8)),10==R.length&&(L=L.slice(-16)),""==(L=L.replace(/0+$/,""))&&(L="0"),L},this.getExtKeyUsageString=function(R){for(var D=this.getExtKeyUsageBin(R),L=new Array,H=0;H<D.length;H++)"1"==D.substr(H,1)&&L.push(Se.KEYUSAGE_NAME[H]);return L.join(",")},this.getExtSubjectKeyIdentifier=function(R,D){if(void 0===R&&void 0===D){var L=this.getExtInfo("subjectKeyIdentifier");if(void 0===L)return;R=f(this.hex,L.vidx),D=L.critical}var H={extname:"subjectKeyIdentifier"};D&&(H.critical=!0);var z=o(R,0);return H.kid={hex:z},H},this.getExtAuthorityKeyIdentifier=function(R,D){if(void 0===R&&void 0===D){var L=this.getExtInfo("authorityKeyIdentifier");if(void 0===L)return;R=f(this.hex,L.vidx),D=L.critical}var H={extname:"authorityKeyIdentifier"};D&&(H.critical=!0);for(var z=s(R,0),X=0;X<z.length;X++){var W=R.substr(z[X],2);if("80"===W&&(H.kid={hex:o(R,z[X])}),"a1"===W){var $=f(R,z[X]),J=this.getGeneralNames($);H.issuer=J[0].dn}"82"===W&&(H.sn={hex:o(R,z[X])})}return H},this.getExtExtKeyUsage=function(R,D){if(void 0===R&&void 0===D){var L=this.getExtInfo("extKeyUsage");if(void 0===L)return;R=f(this.hex,L.vidx),D=L.critical}var H={extname:"extKeyUsage",array:[]};D&&(H.critical=!0);for(var z=s(R,0),X=0;X<z.length;X++)H.array.push(y(o(R,z[X])));return H},this.getExtExtKeyUsageName=function(){var R=this.getExtInfo("extKeyUsage");if(void 0===R)return R;var D=new Array,L=f(this.hex,R.vidx);if(""===L)return D;for(var H=s(L,0),z=0;z<H.length;z++)D.push(y(o(L,H[z])));return D},this.getExtSubjectAltName=function(R,D){if(void 0===R&&void 0===D){var L=this.getExtInfo("subjectAltName");if(void 0===L)return;R=f(this.hex,L.vidx),D=L.critical}var H={extname:"subjectAltName",array:[]};return D&&(H.critical=!0),H.array=this.getGeneralNames(R),H},this.getExtIssuerAltName=function(R,D){if(void 0===R&&void 0===D){var L=this.getExtInfo("issuerAltName");if(void 0===L)return;R=f(this.hex,L.vidx),D=L.critical}var H={extname:"issuerAltName",array:[]};return D&&(H.critical=!0),H.array=this.getGeneralNames(R),H},this.getGeneralNames=function(R){for(var D=s(R,0),L=[],H=0;H<D.length;H++){var z=this.getGeneralName(f(R,D[H]));void 0!==z&&L.push(z)}return L},this.getGeneralName=function(R){var D=R.substr(0,2),L=o(R,0),H=Tt(L);return"81"==D?{rfc822:H}:"82"==D?{dns:H}:"86"==D?{uri:H}:"87"==D?{ip:rr(L)}:"a4"==D?{dn:this.getX500Name(L)}:"a0"==D?{other:this.getOtherName(R)}:void 0},this.getExtSubjectAltName2=function(){var R,D,L,H=this.getExtInfo("subjectAltName");if(void 0===H)return H;for(var z=new Array,X=f(this.hex,H.vidx),W=s(X,0),$=0;$<W.length;$++)L=X.substr(W[$],2),R=o(X,W[$]),"81"===L&&(D=Ve(R),z.push(["MAIL",D])),"82"===L&&(D=Ve(R),z.push(["DNS",D])),"84"===L&&(D=Se.hex2dn(R,0),z.push(["DN",D])),"86"===L&&(D=Ve(R),z.push(["URI",D])),"87"===L&&(D=rr(R),z.push(["IP",D]));return z},this.getExtCRLDistributionPoints=function(R,D){if(void 0===R&&void 0===D){var L=this.getExtInfo("cRLDistributionPoints");if(void 0===L)return;R=f(this.hex,L.vidx),D=L.critical}var H={extname:"cRLDistributionPoints",array:[]};D&&(H.critical=!0);for(var z=s(R,0),X=0;X<z.length;X++){var W=f(R,z[X]);H.array.push(this.getDistributionPoint(W))}return H},this.getDistributionPoint=function(R){for(var D={},L=s(R,0),H=0;H<L.length;H++){var z=R.substr(L[H],2),X=f(R,L[H]);"a0"==z&&(D.dpname=this.getDistributionPointName(X))}return D},this.getDistributionPointName=function(R){for(var D={},L=s(R,0),H=0;H<L.length;H++){var z=R.substr(L[H],2),X=f(R,L[H]);"a0"==z&&(D.full=this.getGeneralNames(X))}return D},this.getExtCRLDistributionPointsURI=function(){var R=this.getExtCRLDistributionPoints();if(null==R)return R;for(var D=R.array,L=[],H=0;H<D.length;H++)try{null!=D[H].dpname.full[0].uri&&L.push(D[H].dpname.full[0].uri)}catch{}return L},this.getExtAIAInfo=function(){var R=this.getExtInfo("authorityInfoAccess");if(void 0===R)return R;for(var D={ocsp:[],caissuer:[]},L=s(this.hex,R.vidx),H=0;H<L.length;H++){var z=v(this.hex,L[H],[0],"06"),X=v(this.hex,L[H],[1],"86");"2b06010505073001"===z&&D.ocsp.push(Ve(X)),"2b06010505073002"===z&&D.caissuer.push(Ve(X))}return D},this.getExtAuthorityInfoAccess=function(R,D){if(void 0===R&&void 0===D){var L=this.getExtInfo("authorityInfoAccess");if(void 0===L)return;R=f(this.hex,L.vidx),D=L.critical}var H={extname:"authorityInfoAccess",array:[]};D&&(H.critical=!0);for(var z=s(R,0),X=0;X<z.length;X++){var W=w(R,z[X],[0],"06"),J=Ve(v(R,z[X],[1],"86"));if("2b06010505073001"==W)H.array.push({ocsp:J});else{if("2b06010505073002"!=W)throw new Error("unknown method: "+W);H.array.push({caissuer:J})}}return H},this.getExtCertificatePolicies=function(R,D){if(void 0===R&&void 0===D){var L=this.getExtInfo("certificatePolicies");if(void 0===L)return;R=f(this.hex,L.vidx),D=L.critical}var H={extname:"certificatePolicies",array:[]};D&&(H.critical=!0);for(var z=s(R,0),X=0;X<z.length;X++){var W=f(R,z[X]),$=this.getPolicyInformation(W);H.array.push($)}return H},this.getPolicyInformation=function(R){var D={},L=v(R,0,[0],"06");D.policyoid=y(L);var H=m(R,0,[1],"30");if(-1!=H){D.array=[];for(var z=s(R,H),X=0;X<z.length;X++){var W=f(R,z[X]),$=this.getPolicyQualifierInfo(W);D.array.push($)}}return D},this.getOtherName=function(R){var D={},L=s(R,0),H=v(R,L[0],[],"06"),z=v(R,L[1],[]);return D.oid=y(H),D.value=d(z),D},this.getPolicyQualifierInfo=function(R){var D={},L=v(R,0,[0],"06");if("2b06010505070201"===L){var H=w(R,0,[1],"16");D.cps=Tt(H)}else if("2b06010505070202"===L){var z=_(R,0,[1],"30");D.unotice=this.getUserNotice(z)}return D},this.getUserNotice=function(R){var D=null;try{return D=r.parse(R),this._asn1ToUnotice(D)}catch{return}},this._asn1ToUnotice=function(R){try{for(var D={},L=rt(R,"seq"),H=0;H<L.length;H++){var z=this._asn1ToNoticeRef(L[H]);null!=z&&(D.noticeref=z);var X=this.asn1ToDisplayText(L[H]);null!=X&&(D.exptext=X)}return Object.keys(D).length>0?D:void 0}catch{return}},this._asn1ToNoticeRef=function(R){try{for(var D={},L=rt(R,"seq"),H=0;H<L.length;H++){var z=this._asn1ToNoticeNum(L[H]);null!=z&&(D.noticenum=z);var X=this.asn1ToDisplayText(L[H]);null!=X&&(D.org=X)}return Object.keys(D).length>0?D:void 0}catch{return}},this._asn1ToNoticeNum=function(R){try{for(var D=rt(R,"seq"),L=[],H=0;H<D.length;H++)L.push(parseInt(rt(D[H],"int.hex"),16));return L}catch{return}},this.getDisplayText=function(R){var L={};return L.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[R.substr(0,2)],L.str=Tt(o(R,0)),L},this.asn1ToDisplayText=function(R){return null!=R.utf8str?{type:"utf8",str:R.utf8str.str}:null!=R.ia5str?{type:"ia5",str:R.ia5str.str}:null!=R.visstr?{type:"vis",str:R.visstr.str}:null!=R.bmpstr?{type:"bmp",str:R.bmpstr.str}:null!=R.prnstr?{type:"prn",str:R.prnstr.str}:void 0},this.getExtPolicyMappings=function(R,D){var L=this.getCriticalExtV("policyMappings",R,D);if(D=L[1],null!=(R=L[0])){var H={extname:"policyMappings"};D&&(H.critical=!0);try{for(var X=d(R).seq,W=[],$=0;$<X.length;$++){var J=X[$].seq;W.push([J[0].oid,J[1].oid])}H.array=W}catch{throw new M("malformed policyMappings")}return H}},this.getExtPolicyConstraints=function(R,D){var L=this.getCriticalExtV("policyConstraints",R,D);if(D=L[1],null!=(R=L[0])){var H={extname:"policyConstraints"};D&&(H.critical=!0);var z=d(R);try{for(var X=z.seq,W=0;W<X.length;W++){var $=X[W].tag;0==$.explicit&&("80"==$.tag&&(H.reqexp=parseInt($.hex,16)),"81"==$.tag&&(H.inhibit=parseInt($.hex,16)))}}catch{return new M("malformed policyConstraints value")}return H}},this.getExtInhibitAnyPolicy=function(R,D){var L=this.getCriticalExtV("inhibitAnyPolicy",R,D);if(D=L[1],null!=(R=L[0])){var H={extname:"inhibitAnyPolicy"};D&&(H.critical=!0);var z=A(R,0);return-1==z?new M("wrong value"):(H.skip=z,H)}},this.getExtCRLNumber=function(R,D){var L={extname:"cRLNumber"};if(D&&(L.critical=!0),"02"==R.substr(0,2))return L.num={hex:o(R,0)},L;throw new M("hExtV parse error: "+R)},this.getExtCRLReason=function(R,D){var L={extname:"cRLReason"};if(D&&(L.critical=!0),"0a"==R.substr(0,2))return L.code=parseInt(o(R,0),16),L;throw new Error("hExtV parse error: "+R)},this.getExtOcspNonce=function(R,D){var L={extname:"ocspNonce"};D&&(L.critical=!0);var H=o(R,0);return L.hex=H,L},this.getExtOcspNoCheck=function(R,D){var L={extname:"ocspNoCheck"};return D&&(L.critical=!0),L},this.getExtAdobeTimeStamp=function(R,D){if(void 0===R&&void 0===D){var L=this.getExtInfo("adobeTimeStamp");if(void 0===L)return;R=f(this.hex,L.vidx),D=L.critical}var H={extname:"adobeTimeStamp"};D&&(H.critical=!0);var z=s(R,0);if(z.length>1){var X=f(R,z[1]),W=this.getGeneralName(X);null!=W.uri&&(H.uri=W.uri)}if(z.length>2){var $=f(R,z[2]);"0101ff"==$&&(H.reqauth=!0),"010100"==$&&(H.reqauth=!1)}return H},this.getExtSubjectDirectoryAttributes=function(R,D){if(void 0===R&&void 0===D){var L=this.getExtInfo("subjectDirectoryAttributes");if(void 0===L)return;R=f(this.hex,L.vidx),D=L.critical}var H={extname:"subjectDirectoryAttributes"};D&&(H.critical=!0);try{for(var z=d(R),X=[],W=0;W<z.seq.length;W++){var $=z.seq[W],J=rt($,"seq.0.oid"),ee=rt($,"seq.1.set");if(null==J||null==ee)throw"error";X.push({attr:J,array:ee})}return H.array=X,H}catch{throw new Error("malformed subjectDirectoryAttributes extension value")}};var j=function(R){var D={};try{var H=l.asn1.x509.OID.name2oid(R.seq[0].oid);D.type=l.asn1.x509.OID.oid2atype(H);var z=R.seq[1];if(null!=z.utf8str)D.ds="utf8",D.value=z.utf8str.str;else if(null!=z.numstr)D.ds="num",D.value=z.numstr.str;else if(null!=z.telstr)D.ds="tel",D.value=z.telstr.str;else if(null!=z.prnstr)D.ds="prn",D.value=z.prnstr.str;else if(null!=z.ia5str)D.ds="ia5",D.value=z.ia5str.str;else if(null!=z.visstr)D.ds="vis",D.value=z.visstr.str;else{if(null==z.bmpstr)throw"error";D.ds="bmp",D.value=z.bmpstr.str}return D}catch{throw new Erorr("improper ASN.1 parsed AttrTypeAndValue")}},Q=function(R){try{return R.set.map(function(D){return j(D)})}catch(D){throw new Error("improper ASN.1 parsed RDN: "+D)}};this.getX500NameRule=function(R){for(var W=null,$=[],J=0;J<R.length;J++)for(var ee=R[J],be=0;be<ee.length;be++)$.push(ee[be]);for(J=0;J<$.length;J++){var we=$[J],ye=we.ds,Te=we.type;if("prn"!=ye&&"utf8"!=ye&&"ia5"!=ye)return"mixed";if("ia5"==ye){if("CN"!=Te)return"mixed";if(l.lang.String.isMail(we.value))continue;return"mixed"}if("C"==Te){if("prn"==ye)continue;return"mixed"}if(null==W)W=ye;else if(W!==ye)return"mixed"}return W??"prn"},this.getAttrTypeAndValue=function(R){var D=d(R);return j(D)},this.getRDN=function(R){var D=d(R);return Q(D)},this.getX500NameArray=function(R){return function(R){try{return R.seq.map(function(D){return Q(D)})}catch(D){throw new Error("improper ASN.1 parsed X500Name: "+D)}}(d(R))},this.getX500Name=function(R,D,L){var H=this.getX500NameArray(R),X={str:this.dnarraytostr(H)};return X.array=H,1==L&&(X.hex=R),1==D&&(X.canon=this.c14nRDNArray(H)),X},this.readCertPEM=function(R){this.readCertHex(N(R))},this.readCertHex=function(R){this.hex=R,this.getVersion();try{T(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(R){var D={};return null==R&&(R={}),D.version=this.getVersion(),D.serial={hex:this.getSerialNumberHex()},D.sigalg=this.getSignatureAlgorithmField(),D.issuer=this.getIssuer(R.dncanon,R.dnhex),D.notbefore=this.getNotBefore(),D.notafter=this.getNotAfter(),D.subject=this.getSubject(R.dncanon,R.dnhex),D.sbjpubkey=bt(this.getPublicKeyHex(),"PUBLIC KEY"),null!=this.aExtInfo&&this.aExtInfo.length>0&&(D.ext=this.getExtParamArray()),D.sighex=this.getSignatureValueHex(),1==R.tbshex&&(D.tbshex=_(this.hex,0,[0])),1==R.nodnarray&&(delete D.issuer.array,delete D.subject.array),D},this.getExtParamArray=function(R){null==R&&-1!=m(this.hex,0,[0,"[3]"])&&(R=I(this.hex,0,[0,"[3]",0],"30"));for(var L=[],H=s(R,0),z=0;z<H.length;z++){var X=f(R,H[z]),W=this.getExtParam(X);null!=W&&L.push(W)}return L},this.getExtParam=function(R){var H=s(R,0).length;if(2!=H&&3!=H)throw new Error("wrong number elements in Extension: "+H+" "+R);var z=P(v(R,0,[0],"06")),X=!1;3==H&&"0101ff"==_(R,0,[1])&&(X=!0);var W=_(R,0,[H-1,0]),$=void 0;if("2.5.29.14"==z?$=this.getExtSubjectKeyIdentifier(W,X):"2.5.29.15"==z?$=this.getExtKeyUsage(W,X):"2.5.29.17"==z?$=this.getExtSubjectAltName(W,X):"2.5.29.18"==z?$=this.getExtIssuerAltName(W,X):"2.5.29.19"==z?$=this.getExtBasicConstraints(W,X):"2.5.29.30"==z?$=this.getExtNameConstraints(W,X):"2.5.29.31"==z?$=this.getExtCRLDistributionPoints(W,X):"2.5.29.32"==z?$=this.getExtCertificatePolicies(W,X):"2.5.29.33"==z?$=this.getExtPolicyMappings(W,X):"2.5.29.35"==z?$=this.getExtAuthorityKeyIdentifier(W,X):"2.5.29.36"==z?$=this.getExtPolicyConstraints(W,X):"2.5.29.37"==z?$=this.getExtExtKeyUsage(W,X):"2.5.29.54"==z?$=this.getExtInhibitAnyPolicy(W,X):"1.3.6.1.5.5.7.1.1"==z?$=this.getExtAuthorityInfoAccess(W,X):"2.5.29.20"==z?$=this.getExtCRLNumber(W,X):"2.5.29.21"==z?$=this.getExtCRLReason(W,X):"2.5.29.9"==z?$=this.getExtSubjectDirectoryAttributes(W,X):"1.3.6.1.5.5.7.48.1.2"==z?$=this.getExtOcspNonce(W,X):"1.3.6.1.5.5.7.48.1.5"==z?$=this.getExtOcspNoCheck(W,X):"1.2.840.113583.1.1.9.1"==z?$=this.getExtAdobeTimeStamp(W,X):null!=Se.EXT_PARSER[z]&&($=Se.EXT_PARSER[z](z,X,W)),null!=$)return $;var J={extname:z,extn:W};try{J.extn=d(W)}catch{}return X&&(J.critical=!0),J},this.findExt=function(R,D){for(var L=0;L<R.length;L++)if(R[L].extname==D)return R[L];return null},this.updateExtCDPFullURI=function(R,D){var L=this.findExt(R,"cRLDistributionPoints");if(null!=L&&null!=L.array)for(var H=L.array,z=0;z<H.length;z++)if(null!=H[z].dpname&&null!=H[z].dpname.full)for(var X=H[z].dpname.full,W=0;W<X.length;W++){var $=X[z];null!=$.uri&&($.uri=D)}},this.updateExtAIAOCSP=function(R,D){var L=this.findExt(R,"authorityInfoAccess");if(null!=L&&null!=L.array)for(var H=L.array,z=0;z<H.length;z++)null!=H[z].ocsp&&(H[z].ocsp=D)},this.updateExtAIACAIssuer=function(R,D){var L=this.findExt(R,"authorityInfoAccess");if(null!=L&&null!=L.array)for(var H=L.array,z=0;z<H.length;z++)null!=H[z].caissuer&&(H[z].caissuer=D)},this.dnarraytostr=function(R){return"/"+R.map(function(H){return function D(H){return H.map(function(z){return function L(H){return H.type+"="+H.value}(z).replace(/\+/,"\\+")}).join("+")}(H).replace(/\//,"\\/")}).join("/")},this.setCanonicalizedDN=function(R){var D;if(null!=R.str&&null==R.array){var H=new l.asn1.x509.X500Name({str:R.str}).tohex();D=this.getX500NameArray(H)}else D=R.array;null==R.canon&&(R.canon=this.c14nRDNArray(D))},this.c14nRDNArray=function(R){for(var D=[],L=0;L<R.length;L++){for(var H=R[L],z=[],X=0;X<H.length;X++){var W=H[X],$=W.value;$=($=($=($=$.replace(/^\s*/,"")).replace(/\s*$/,"")).replace(/\s+/g," ")).toLowerCase(),z.push(W.type.toLowerCase()+"="+$)}D.push(z.join("+"))}return"/"+D.join("/")},this.getInfo=function(){var X,W,$,R=function(Rt){for(var Ue="",lt="    ",at=Rt.array,Ct=0;Ct<at.length;Ct++){var $e=at[Ct];null!=$e.dn&&(Ue+=lt+"dn: "+$e.dn.str+"\n"),null!=$e.ip&&(Ue+=lt+"ip: "+$e.ip+"\n"),null!=$e.rfc822&&(Ue+=lt+"rfc822: "+$e.rfc822+"\n"),null!=$e.dns&&(Ue+=lt+"dns: "+$e.dns+"\n"),null!=$e.uri&&(Ue+=lt+"uri: "+$e.uri+"\n"),null!=$e.other&&(Ue+=lt+"other: "+$e.other.oid+"="+JSON.stringify($e.other.value).replace(/\"/g,"")+"\n")}return Ue.replace(/\n$/,"")},D=function(Rt){for(var Ue="",lt=Rt.array,et=0;et<lt.length;et++){var at=lt[et];if(Ue+="    policy oid: "+at.policyoid+"\n",void 0!==at.array)for(var Ct=0;Ct<at.array.length;Ct++){var $e=at.array[Ct];void 0!==$e.cps&&(Ue+="    cps: "+$e.cps+"\n")}}return Ue},L=function(Rt){for(var Ue="",lt=Rt.array,et=0;et<lt.length;et++){var at=lt[et];try{void 0!==at.dpname.full[0].uri&&(Ue+="    "+at.dpname.full[0].uri+"\n")}catch{}try{void 0!==at.dname.full[0].dn.hex&&(Ue+="    "+Se.hex2dn(at.dpname.full[0].dn.hex)+"\n")}catch{}}return Ue},H=function(Rt){for(var Ue="",lt=Rt.array,et=0;et<lt.length;et++){var at=lt[et];void 0!==at.caissuer&&(Ue+="    caissuer: "+at.caissuer+"\n"),void 0!==at.ocsp&&(Ue+="    ocsp: "+at.ocsp+"\n")}return Ue};if(X="Basic Fields\n",X+="  serial number: "+this.getSerialNumberHex()+"\n",X+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n",X+="  issuer: "+this.getIssuerString()+"\n",X+="  notBefore: "+this.getNotBefore()+"\n",X+="  notAfter: "+this.getNotAfter()+"\n",X+="  subject: "+this.getSubjectString()+"\n",X+="  subject public key info: \n",X+="    key algorithm: "+(W=this.getPublicKey()).type+"\n","RSA"===W.type&&(X+="    n="+ys(W.n.toString(16)).substr(0,16)+"...\n",X+="    e="+ys(W.e.toString(16))+"\n"),null!=($=this.aExtInfo)){X+="X509v3 Extensions:\n";for(var J=0;J<$.length;J++){var ee=$[J],be=l.asn1.x509.OID.oid2name(ee.oid);""===be&&(be=ee.oid);var we="";if(!0===ee.critical&&(we="CRITICAL"),X+="  "+be+" "+we+":\n","basicConstraints"===be){var ye=this.getExtBasicConstraints();void 0===ye.cA?X+="    {}\n":(X+="    cA=true",void 0!==ye.pathLen&&(X+=", pathLen="+ye.pathLen),X+="\n")}else if("policyMappings"==be)X+="    "+this.getExtPolicyMappings().array.map(function(Rt){return Rt[0]+":"+Rt[1]}).join(", ")+"\n";else if("policyConstraints"==be)X+="    ",null!=(Xe=this.getExtPolicyConstraints()).reqexp&&(X+=" reqexp="+Xe.reqexp),null!=Xe.inhibit&&(X+=" inhibit="+Xe.inhibit),X+="\n";else if("inhibitAnyPolicy"==be){var Xe;X+="    skip="+(Xe=this.getExtInhibitAnyPolicy()).skip+"\n"}else if("keyUsage"==be)X+="    "+this.getExtKeyUsageString()+"\n";else if("subjectKeyIdentifier"==be)X+="    "+this.getExtSubjectKeyIdentifier().kid.hex+"\n";else if("authorityKeyIdentifier"==be){var ze=this.getExtAuthorityKeyIdentifier();void 0!==ze.kid&&(X+="    kid="+ze.kid.hex+"\n")}else"extKeyUsage"==be?X+="    "+this.getExtExtKeyUsage().array.join(", ")+"\n":"subjectAltName"==be?X+=R(this.getExtSubjectAltName())+"\n":"cRLDistributionPoints"==be?X+=L(this.getExtCRLDistributionPoints()):"authorityInfoAccess"==be?X+=H(this.getExtAuthorityInfoAccess()):"certificatePolicies"==be&&(X+=D(this.getExtCertificatePolicies()))}}return(X+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n")+"signature: "+this.getSignatureValueHex().substr(0,16)+"...\n"},"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?this.readCertPEM(e):l.lang.String.isHex(e)&&this.readCertHex(e))}Ie.getKey=function(e,r,s){var R,h=(o=ue).getChildIdx,f=o.getVbyList,v=l.crypto,w=v.ECDSA,_=v.DSA,I=Ee,T=nt,m=Ie;if(typeof I<"u"&&e instanceof I||typeof w<"u"&&e instanceof w||typeof _<"u"&&e instanceof _)return e;if(void 0!==e.curve&&void 0!==e.xy&&void 0===e.d)return new w({pub:e.xy,curve:e.curve});if(void 0!==e.curve&&void 0!==e.d)return new w({prv:e.d,curve:e.curve});if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0===e.d)return(g=new I).setPublic(e.n,e.e),g;if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0!==e.p&&void 0!==e.q&&void 0!==e.dp&&void 0!==e.dq&&void 0!==e.co&&void 0===e.qi)return(g=new I).setPrivateEx(e.n,e.e,e.d,e.p,e.q,e.dp,e.dq,e.co),g;if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0===e.p)return(g=new I).setPrivate(e.n,e.e,e.d),g;if(void 0!==e.p&&void 0!==e.q&&void 0!==e.g&&void 0!==e.y&&void 0===e.x)return(g=new _).setPublic(e.p,e.q,e.g,e.y),g;if(void 0!==e.p&&void 0!==e.q&&void 0!==e.g&&void 0!==e.y&&void 0!==e.x)return(g=new _).setPrivate(e.p,e.q,e.g,e.y,e.x),g;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0===e.d)return(g=new I).setPublic(Ye(e.n),Ye(e.e)),g;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0!==e.p&&void 0!==e.q&&void 0!==e.dp&&void 0!==e.dq&&void 0!==e.qi)return(g=new I).setPrivateEx(Ye(e.n),Ye(e.e),Ye(e.d),Ye(e.p),Ye(e.q),Ye(e.dp),Ye(e.dq),Ye(e.qi)),g;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d)return(g=new I).setPrivate(Ye(e.n),Ye(e.e),Ye(e.d)),g;if("EC"===e.kty&&void 0!==e.crv&&void 0!==e.x&&void 0!==e.y&&void 0===e.d){var y=(A=new w({curve:e.crv})).ecparams.keycharlen,P=("0000000000"+Ye(e.x)).slice(-y),x=("0000000000"+Ye(e.y)).slice(-y);return A.setPublicKeyHex(N="04"+P+x),A}if("EC"===e.kty&&void 0!==e.crv&&void 0!==e.x&&void 0!==e.y&&void 0!==e.d){y=(A=new w({curve:e.crv})).ecparams.keycharlen;var N="04"+(P=("0000000000"+Ye(e.x)).slice(-y))+(x=("0000000000"+Ye(e.y)).slice(-y)),B=("0000000000"+Ye(e.d)).slice(-y);return A.setPublicKeyHex(N),A.setPrivateKeyHex(B),A}if("pkcs5prv"===s){var j,M=e,o=ue;if(9===(j=h(M,0)).length)(g=new I).readPKCS5PrvKeyHex(M);else if(6===j.length)(g=new _).readPKCS5PrvKeyHex(M);else{if(!(j.length>2&&"04"===M.substr(j[1],2)))throw new Error("unsupported PKCS#1/5 hexadecimal key");(g=new w).readPKCS5PrvKeyHex(M)}return g}if("pkcs8prv"===s)return m.getKeyFromPlainPrivatePKCS8Hex(e);if("pkcs8pub"===s)return m._getKeyFromPublicPKCS8Hex(e);if("x509pub"===s)return Se.getPublicKeyFromCertHex(e);if(-1!=e.indexOf("-END CERTIFICATE-",0)||-1!=e.indexOf("-END X509 CERTIFICATE-",0)||-1!=e.indexOf("-END TRUSTED CERTIFICATE-",0))return Se.getPublicKeyFromCertPEM(e);if(-1!=e.indexOf("-END PUBLIC KEY-")){var Q=nt(e,"PUBLIC KEY");return m._getKeyFromPublicPKCS8Hex(Q)}if(-1!=e.indexOf("-END RSA PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){var Y=T(e,"RSA PRIVATE KEY");return m.getKey(Y,null,"pkcs5prv")}if(-1!=e.indexOf("-END DSA PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){var D=f(R=T(e,"DSA PRIVATE KEY"),0,[1],"02"),L=f(R,0,[2],"02"),H=f(R,0,[3],"02"),z=f(R,0,[4],"02"),X=f(R,0,[5],"02");return(g=new _).setPrivate(new F(D,16),new F(L,16),new F(H,16),new F(z,16),new F(X,16)),g}if(-1!=e.indexOf("-END EC PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED"))return Y=T(e,"EC PRIVATE KEY"),m.getKey(Y,null,"pkcs5prv");if(-1!=e.indexOf("-END PRIVATE KEY-"))return m.getKeyFromPlainPrivatePKCS8PEM(e);if(-1!=e.indexOf("-END RSA PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var W=m.getDecryptedKeyHex(e,r),$=new Ee;return $.readPKCS5PrvKeyHex(W),$}if(-1!=e.indexOf("-END EC PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var A,g=f(R=m.getDecryptedKeyHex(e,r),0,[1],"04"),J=f(R,0,[2,0],"06"),ee=f(R,0,[3,0],"03").substr(2);if(void 0===l.crypto.OID.oidhex2name[J])throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+J);return(A=new w({curve:l.crypto.OID.oidhex2name[J]})).setPublicKeyHex(ee),A.setPrivateKeyHex(g),A.isPublic=!1,A}if(-1!=e.indexOf("-END DSA PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED"))return D=f(R=m.getDecryptedKeyHex(e,r),0,[1],"02"),L=f(R,0,[2],"02"),H=f(R,0,[3],"02"),z=f(R,0,[4],"02"),X=f(R,0,[5],"02"),(g=new _).setPrivate(new F(D,16),new F(L,16),new F(H,16),new F(z,16),new F(X,16)),g;if(-1!=e.indexOf("-END ENCRYPTED PRIVATE KEY-"))return m.getKeyFromEncryptedPKCS8PEM(e,r);throw new Error("not supported argument")},Ie.generateKeypair=function(e,r){if("RSA"==e){var s=r;(o=new Ee).generate(s,"10001"),o.isPrivate=!0,o.isPublic=!0;var h=new Ee,d=o.n.toString(16),f=o.e.toString(16);return h.setPublic(d,f),h.isPrivate=!1,h.isPublic=!0,(v={}).prvKeyObj=o,v.pubKeyObj=h,v}if("EC"==e){var o,v,w=r,I=new l.crypto.ECDSA({curve:w}).generateKeyPairHex();return(o=new l.crypto.ECDSA({curve:w})).setPublicKeyHex(I.ecpubhex),o.setPrivateKeyHex(I.ecprvhex),o.isPrivate=!0,o.isPublic=!1,(h=new l.crypto.ECDSA({curve:w})).setPublicKeyHex(I.ecpubhex),h.isPrivate=!1,h.isPublic=!0,(v={}).prvKeyObj=o,v.pubKeyObj=h,v}throw new Error("unknown algorithm: "+e)},Ie.getPEM=function(e,r,s,o,h,d){var v=l.asn1,w=v.DERObjectIdentifier,_=v.DERInteger,I=v.ASN1Util.newObject,g=l.crypto,A=g.DSA,y=g.ECDSA,P=Ee;function x($){return I({seq:[{int:0},{int:{bigint:$.n}},{int:$.e},{int:{bigint:$.d}},{int:{bigint:$.p}},{int:{bigint:$.q}},{int:{bigint:$.dmp1}},{int:{bigint:$.dmq1}},{int:{bigint:$.coeff}}]})}function N($){return I({seq:[{int:1},{octstr:{hex:$.prvKeyHex}},{tag:["a0",!0,{oid:{name:$.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+$.pubKeyHex}}]}]})}function B($){return I({seq:[{int:0},{int:{bigint:$.p}},{int:{bigint:$.q}},{int:{bigint:$.g}},{int:{bigint:$.y}},{int:{bigint:$.x}}]})}if((void 0!==P&&e instanceof P||void 0!==A&&e instanceof A||void 0!==y&&e instanceof y)&&1==e.isPublic&&(void 0===r||"PKCS8PUB"==r))return bt(j=new(0,v.x509.SubjectPublicKeyInfo)(e).tohex(),"PUBLIC KEY");if("PKCS1PRV"==r&&void 0!==P&&e instanceof P&&(void 0===s||null==s)&&1==e.isPrivate)return bt(j=x(e).tohex(),"RSA PRIVATE KEY");if("PKCS1PRV"==r&&void 0!==y&&e instanceof y&&(void 0===s||null==s)&&1==e.isPrivate){var Y=new w({name:e.curveName}).tohex(),D=N(e).tohex(),L="";return(L+=bt(Y,"EC PARAMETERS"))+bt(D,"EC PRIVATE KEY")}if("PKCS1PRV"==r&&void 0!==A&&e instanceof A&&(void 0===s||null==s)&&1==e.isPrivate)return bt(j=B(e).tohex(),"DSA PRIVATE KEY");if("PKCS5PRV"==r&&void 0!==P&&e instanceof P&&void 0!==s&&null!=s&&1==e.isPrivate){var j=x(e).tohex();return void 0===o&&(o="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",j,s,o,d)}if("PKCS5PRV"==r&&void 0!==y&&e instanceof y&&void 0!==s&&null!=s&&1==e.isPrivate)return j=N(e).tohex(),void 0===o&&(o="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",j,s,o,d);if("PKCS5PRV"==r&&void 0!==A&&e instanceof A&&void 0!==s&&null!=s&&1==e.isPrivate)return j=B(e).tohex(),void 0===o&&(o="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",j,s,o,d);var H=function($,J){if("string"==typeof J)return Ie.getEncryptedPKCS8PEM($,J);if("object"==typeof J&&null!=rt(J,"passcode")){var ee=JSON.parse(JSON.stringify(J)),be=ee.passcode;return delete ee.passcode,Ie.getEncryptedPKCS8PEM($,be,ee)}};if("PKCS8PRV"==r&&null!=P&&e instanceof P&&1==e.isPrivate){var X=x(e).tohex();return j=I({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:X}}]}).tohex(),void 0===s||null==s?bt(j,"PRIVATE KEY"):H(j,s)}if("PKCS8PRV"==r&&void 0!==y&&e instanceof y&&1==e.isPrivate){var W={seq:[{int:1},{octstr:{hex:e.prvKeyHex}}]};return"string"==typeof e.pubKeyHex&&W.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]}),X=new I(W).tohex(),j=I({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:e.curveName}}]},{octstr:{hex:X}}]}).tohex(),void 0===s||null==s?bt(j,"PRIVATE KEY"):H(j,s)}if("PKCS8PRV"==r&&void 0!==A&&e instanceof A&&1==e.isPrivate)return X=new _({bigint:e.x}).tohex(),j=I({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}}]}]},{octstr:{hex:X}}]}).tohex(),void 0===s||null==s?bt(j,"PRIVATE KEY"):H(j,s);throw new Error("unsupported object nor format")},Ie.getKeyFromCSRPEM=function(e){var r=nt(e,"CERTIFICATE REQUEST");return Ie.getKeyFromCSRHex(r)},Ie.getKeyFromCSRHex=function(e){var r=Ie.parseCSRHex(e);return Ie.getKey(r.p8pubkeyhex,null,"pkcs8pub")},Ie.parseCSRHex=function(e){var s=ue.getChildIdx,o=ue.getTLV,h={},d=e;if("30"!=d.substr(0,2))throw new Error("malformed CSR(code:001)");var f=s(d,0);if(f.length<1)throw new Error("malformed CSR(code:002)");if("30"!=d.substr(f[0],2))throw new Error("malformed CSR(code:003)");var v=s(d,f[0]);if(v.length<3)throw new Error("malformed CSR(code:004)");return h.p8pubkeyhex=o(d,v[2]),h},Ie.getKeyID=function(e){var r=Ie,s=ue;"string"==typeof e&&-1!=e.indexOf("BEGIN ")&&(e=r.getKey(e));var o=nt(r.getPEM(e)),h=s.getIdxbyList(o,0,[1]),d=s.getV(o,h).substring(2);return l.crypto.Util.hashHex(d,"sha1")},Ie.getJWK=function(e,r,s,o,h){var d,v,f={},w=l.crypto.Util.hashHex;if("string"==typeof e)d=Ie.getKey(e),-1!=e.indexOf("CERTIFICATE")&&(v=nt(e));else{if("object"!=typeof e)throw new Error("unsupported keyinfo type");e instanceof Se?(d=e.getPublicKey(),v=e.hex):d=e}if(d instanceof Ee&&d.isPrivate)f.kty="RSA",f.n=dt(d.n.toString(16)),f.e=dt(d.e.toString(16)),f.d=dt(d.d.toString(16)),f.p=dt(d.p.toString(16)),f.q=dt(d.q.toString(16)),f.dp=dt(d.dmp1.toString(16)),f.dq=dt(d.dmq1.toString(16)),f.qi=dt(d.coeff.toString(16));else if(d instanceof Ee&&d.isPublic)f.kty="RSA",f.n=dt(d.n.toString(16)),f.e=dt(d.e.toString(16));else if(d instanceof l.crypto.ECDSA&&d.isPrivate){if("P-256"!==(_=d.getShortNISTPCurveName())&&"P-384"!==_&&"P-521"!==_)throw new Error("unsupported curve name for JWT: "+_);var I=d.getPublicKeyXYHex();f.kty="EC",f.crv=_,f.x=dt(I.x),f.y=dt(I.y),f.d=dt(d.prvKeyHex)}else if(d instanceof l.crypto.ECDSA&&d.isPublic){var _;if("P-256"!==(_=d.getShortNISTPCurveName())&&"P-384"!==_&&"P-521"!==_)throw new Error("unsupported curve name for JWT: "+_);I=d.getPublicKeyXYHex(),f.kty="EC",f.crv=_,f.x=dt(I.x),f.y=dt(I.y)}if(null==f.kty)throw new Error("unsupported keyinfo");return!d.isPrivate&&1!=r&&(f.kid=l.jws.JWS.getJWKthumbprint(f)),null!=v&&1!=s&&(f.x5c=[C(v)]),null!=v&&1!=o&&(f.x5t=Ki(C(w(v,"sha1")))),null!=v&&1!=h&&(f["x5t#S256"]=Ki(C(w(v,"sha256")))),f},Ie.getJWKFromKey=function(e){return Ie.getJWK(e,!0,!0,!0,!0)},Ee.getPosArrayOfChildrenFromHex=function(e){return ue.getChildIdx(e,0)},Ee.getHexValueArrayOfChildrenFromHex=function(e){var m,s=ue.getV,o=s(e,(m=Ee.getPosArrayOfChildrenFromHex(e))[0]),h=s(e,m[1]),d=s(e,m[2]),f=s(e,m[3]),v=s(e,m[4]),w=s(e,m[5]),_=s(e,m[6]),I=s(e,m[7]),T=s(e,m[8]);return(m=new Array).push(o,h,d,f,v,w,_,I,T),m},Ee.prototype.readPrivateKeyFromPEMString=function(e){var r=nt(e),s=Ee.getHexValueArrayOfChildrenFromHex(r);this.setPrivateEx(s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8])},Ee.prototype.readPKCS5PrvKeyHex=function(e){var r=Ee.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])},Ee.prototype.readPKCS8PrvKeyHex=function(e){var r,s,o,h,d,f,v,w,I=ue.getVbyListEx;if(!1===ue.isASN1HEX(e))throw new Error("not ASN.1 hex string");try{r=I(e,0,[2,0,1],"02"),s=I(e,0,[2,0,2],"02"),o=I(e,0,[2,0,3],"02"),h=I(e,0,[2,0,4],"02"),d=I(e,0,[2,0,5],"02"),f=I(e,0,[2,0,6],"02"),v=I(e,0,[2,0,7],"02"),w=I(e,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(r,s,o,h,d,f,v,w)},Ee.prototype.readPKCS5PubKeyHex=function(e){var r=ue,s=r.getV;if(!1===r.isASN1HEX(e))throw new Error("keyHex is not ASN.1 hex string");var o=r.getChildIdx(e,0);if(2!==o.length||"02"!==e.substr(o[0],2)||"02"!==e.substr(o[1],2))throw new Error("wrong hex for PKCS#5 public key");var h=s(e,o[0]),d=s(e,o[1]);this.setPublic(h,d)},Ee.prototype.readPKCS8PubKeyHex=function(e){var r=ue;if(!1===r.isASN1HEX(e))throw new Error("not ASN.1 hex string");if("06092a864886f70d010101"!==r.getTLVbyListEx(e,0,[0,0]))throw new Error("not PKCS8 RSA public key");var s=r.getTLVbyListEx(e,0,[1,0]);this.readPKCS5PubKeyHex(s)},Ee.prototype.readCertPubKeyHex=function(e,r){var s,o;(s=new Se).readCertHex(e),o=s.getPublicKeyHex(),this.readPKCS8PubKeyHex(o)},new RegExp("[^0-9a-f]","gi"),Ee.prototype.sign=function(e,r){var o=function(h){return l.crypto.Util.hashString(h,r)}(e);return this.signWithMessageHash(o,r)},Ee.prototype.signWithMessageHash=function(e,r){var o=Ft(l.crypto.Util.getPaddedDigestInfoHex(e,r,this.n.bitLength()),16);return Oo(this.doPrivate(o).toString(16),this.n.bitLength())},Ee.prototype.signPSS=function(e,r,s){var h=function(d){return l.crypto.Util.hashHex(d,r)}(ei(e));return void 0===s&&(s=-1),this.signWithMessageHashPSS(h,r,s)},Ee.prototype.signWithMessageHashPSS=function(e,r,s){var v,o=Tt(e),h=o.length,d=this.n.bitLength()-1,f=Math.ceil(d/8),w=function(P){return l.crypto.Util.hashHex(P,r)};if(-1===s||void 0===s)s=h;else if(-2===s)s=f-h-2;else if(s<-2)throw new Error("invalid salt length");if(f<h+s+2)throw new Error("data too long");var _="";s>0&&(_=new Array(s),(new Ui).nextBytes(_),_=String.fromCharCode.apply(String,_));var I=Tt(w(ei("\0\0\0\0\0\0\0\0"+o+_))),T=[];for(v=0;v<f-s-h-2;v+=1)T[v]=0;var m=String.fromCharCode.apply(String,T)+"\x01"+_,g=Bo(I,m.length,w),A=[];for(v=0;v<m.length;v+=1)A[v]=m.charCodeAt(v)^g.charCodeAt(v);for(A[0]&=~(65280>>8*f-d&255),v=0;v<h;v++)A.push(I.charCodeAt(v));return A.push(188),Oo(this.doPrivate(new F(A)).toString(16),this.n.bitLength())},Ee.prototype.verify=function(e,r){if(null==(r=r.toLowerCase()).match(/^[0-9a-f]+$/))return!1;var s=Ft(r,16),o=this.n.bitLength();if(s.bitLength()>o)return!1;var d=this.doPublic(s).toString(16);if(d.length+3!=o/4)return!1;var v=Mo(d.replace(/^1f+00/,""));if(0==v.length)return!1;var w=v[0],_=v[1],T=function(m){return l.crypto.Util.hashString(m,w)}(e);return _==T},Ee.prototype.verifyWithMessageHash=function(e,r){if(r.length!=Math.ceil(this.n.bitLength()/4))return!1;var s=Ft(r,16);if(s.bitLength()>this.n.bitLength())return 0;var d=Mo(this.doPublic(s).toString(16).replace(/^1f+00/,""));return 0!=d.length&&d[1]==e},Ee.prototype.verifyPSS=function(e,r,s,o){var d=function(f){return l.crypto.Util.hashHex(f,s)}(ei(e));return void 0===o&&(o=-1),this.verifyWithMessageHashPSS(d,r,s,o)},Ee.prototype.verifyWithMessageHashPSS=function(e,r,s,o){if(r.length!=Math.ceil(this.n.bitLength()/4))return!1;var I,h=new F(r,16),d=function(N){return l.crypto.Util.hashHex(N,s)},f=Tt(e),v=f.length,w=this.n.bitLength()-1,_=Math.ceil(w/8);if(-1===o||void 0===o)o=v;else if(-2===o)o=_-v-2;else if(o<-2)throw new Error("invalid salt length");if(_<v+o+2)throw new Error("data too long");var T=this.doPublic(h).toByteArray();for(I=0;I<T.length;I+=1)T[I]&=255;for(;T.length<_;)T.unshift(0);if(188!==T[_-1])throw new Error("encoded message does not end in 0xbc");var m=(T=String.fromCharCode.apply(String,T)).substr(0,_-v-1),g=T.substr(m.length,v),A=65280>>8*_-w&255;if(m.charCodeAt(0)&A)throw new Error("bits beyond keysize not zero");var y=Bo(g,m.length,d),P=[];for(I=0;I<m.length;I+=1)P[I]=m.charCodeAt(I)^y.charCodeAt(I);P[0]&=~A;var x=_-v-o-2;for(I=0;I<x;I+=1)if(0!==P[I])throw new Error("leftmost octets not zero");if(1!==P[x])throw new Error("0x01 marker not found");return g===Tt(d(ei("\0\0\0\0\0\0\0\0"+f+String.fromCharCode.apply(String,P.slice(-o)))))},Ee.SALT_LEN_HLEN=-1,Ee.SALT_LEN_MAX=-2,Ee.SALT_LEN_RECOVER=-2,Se.EXT_PARSER={},Se.registExtParser=function(e,r){Se.EXT_PARSER[e]=r},Se.hex2dn=function(e,r){void 0===r&&(r=0);var s=new Se;return ue.getTLV(e,r),s.getX500Name(e).str},Se.hex2rdn=function(e,r){if(void 0===r&&(r=0),"31"!==e.substr(r,2))throw new Error("malformed RDN");for(var s=new Array,o=ue.getChildIdx(e,r),h=0;h<o.length;h++)s.push(Se.hex2attrTypeValue(e,o[h]));return s=s.map(function(d){return d.replace("+","\\+")}),s.join("+")},Se.hex2attrTypeValue=function(e,r){var s=ue,o=s.getV;if(void 0===r&&(r=0),"30"!==e.substr(r,2))throw new Error("malformed attribute type and value");var h=s.getChildIdx(e,r);2!==h.length||e.substr(h[0],2);var d=o(e,h[0]),f=l.asn1.ASN1Util.oidHexToInt(d);return l.asn1.x509.OID.oid2atype(f)+"="+Tt(o(e,h[1]))},Se.getPublicKeyFromCertHex=function(e){var r=new Se;return r.readCertHex(e),r.getPublicKey()},Se.getPublicKeyFromCertPEM=function(e){var r=new Se;return r.readCertPEM(e),r.getPublicKey()},Se.getPublicKeyInfoPropOfCertPEM=function(e){var h,d,s=ue.getVbyList,o={algparam:null};return(h=new Se).readCertPEM(e),d=h.getPublicKeyHex(),o.keyhex=s(d,0,[1],"03").substr(2),o.algoid=s(d,0,[0,0],"06"),"2a8648ce3d0201"===o.algoid&&(o.algparam=s(d,0,[0,1],"06")),o},Se.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],(typeof l>"u"||!l)&&(l={}),(typeof l.jws>"u"||!l.jws)&&(l.jws={}),l.jws.JWS=function(){var s=l.jws.JWS.isSafeJSONString;this.parseJWS=function(o,h){if(void 0===this.parsedJWS||!h&&void 0===this.parsedJWS.sigvalH){var d=o.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(null==d)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var f=d[1],v=d[2],w=d[3],_=f+"."+v;if(this.parsedJWS={},this.parsedJWS.headB64U=f,this.parsedJWS.payloadB64U=v,this.parsedJWS.sigvalB64U=w,this.parsedJWS.si=_,!h){var I=Ye(w),T=Ft(I,16);this.parsedJWS.sigvalH=I,this.parsedJWS.sigvalBI=T}var m=Qt(f),g=Qt(v);if(this.parsedJWS.headS=m,this.parsedJWS.payloadS=g,!s(m,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+m}}},l.jws.JWS.sign=function(e,r,s,o,h){var y,P,x,v=l.jws.JWS,w=v.readSafeJSONString,_=v.isSafeJSONString,I=l.crypto,m=I.Mac,g=I.Signature,A=JSON;if("string"!=typeof r&&"object"!=typeof r)throw"spHeader must be JSON string or object: "+r;if("object"==typeof r&&(y=A.stringify(P=r)),"string"==typeof r){if(!_(y=r))throw"JWS Head is not safe JSON string: "+y;P=w(y)}if(x=s,"object"==typeof s&&(x=A.stringify(s)),(""==e||null==e)&&void 0!==P.alg&&(e=P.alg),""!=e&&null!=e&&void 0===P.alg&&(P.alg=e,y=A.stringify(P)),e!==P.alg)throw"alg and sHeader.alg doesn't match: "+e+"!="+P.alg;var N=null;if(void 0===v.jwsalg2sigalg[e])throw"unsupported alg name: "+e;N=v.jwsalg2sigalg[e];var j=hn(y)+"."+hn(x),Q="";if("Hmac"==N.substr(0,4)){if(void 0===o)throw"mac key shall be specified for HS* alg";var Y=new m({alg:N,prov:"cryptojs",pass:o});Y.updateString(j),Q=Y.doFinal()}else if(-1!=N.indexOf("withECDSA")){(R=new g({alg:N})).init(o,h),R.updateString(j);var D=R.sign();Q=l.crypto.ECDSA.asn1SigToConcatSig(D)}else if("none"!=N){var R;(R=new g({alg:N})).init(o,h),R.updateString(j),Q=R.sign()}return j+"."+dt(Q)},l.jws.JWS.verify=function(e,r,s){var T,d=l.jws.JWS,f=d.readSafeJSONString,v=l.crypto,w=v.ECDSA,_=v.Mac,I=v.Signature;if(T=Ee,!bs(e))return!1;var m=e.split(".");if(3!==m.length)return!1;var B,y=m[0]+"."+m[1],P=Ye(m[2]),x=f(Qt(m[0])),N=null;if(void 0===x.alg)throw"algorithm not specified in header";if(B=(N=x.alg).substr(0,2),null!=s&&"[object Array]"===Object.prototype.toString.call(s)&&s.length>0&&-1==(":"+s.join(":")+":").indexOf(":"+N+":"))throw"algorithm '"+N+"' not accepted in the list";if("none"!=N&&null===r)throw"key shall be specified to verify.";if("string"==typeof r&&-1!=r.indexOf("-----BEGIN ")&&(r=Ie.getKey(r)),!("RS"!=B&&"PS"!=B||r instanceof T))throw"key shall be a RSAKey obj for RS* and PS* algs";if("ES"==B&&!(r instanceof w))throw"key shall be a ECDSA obj for ES* algs";var j=null;if(void 0===d.jwsalg2sigalg[x.alg])throw"unsupported alg name: "+N;if("none"==(j=d.jwsalg2sigalg[N]))throw"not supported";if("Hmac"==j.substr(0,4)){if(void 0===r)throw"hexadecimal key shall be specified for HMAC";var Y=new _({alg:j,pass:r});return Y.updateString(y),P==Y.doFinal()}if(-1!=j.indexOf("withECDSA")){var D,R=null;try{R=w.concatSigToASN1Sig(P)}catch{return!1}return(D=new I({alg:j})).init(r),D.updateString(y),D.verify(R)}return(D=new I({alg:j})).init(r),D.updateString(y),D.verify(P)},l.jws.JWS.parse=function(e){var h,d,r=e.split("."),s={};if(2!=r.length&&3!=r.length)throw"malformed sJWS: wrong number of '.' splitted elements";return h=r[1],3==r.length&&(d=r[2]),s.headerObj=l.jws.JWS.readSafeJSONString(Qt(r[0])),s.payloadObj=l.jws.JWS.readSafeJSONString(Qt(h)),s.headerPP=JSON.stringify(s.headerObj,null,"  "),s.payloadPP=null==s.payloadObj?Qt(h):JSON.stringify(s.payloadObj,null,"  "),void 0!==d&&(s.sigHex=Ye(d)),s},l.jws.JWS.verifyJWT=function(e,r,s){var h=l.jws,d=h.JWS,f=d.readSafeJSONString,v=d.inArray,w=d.includedArray;if(!bs(e))return!1;var _=e.split(".");if(3!=_.length)return!1;var I=_[0],T=_[1],A=(Ye(_[2]),f(Qt(I))),y=f(Qt(T));if(void 0===A.alg)return!1;if(void 0===s.alg)throw"acceptField.alg shall be specified";if(!v(A.alg,s.alg)||void 0!==y.iss&&"object"==typeof s.iss&&!v(y.iss,s.iss)||void 0!==y.sub&&"object"==typeof s.sub&&!v(y.sub,s.sub))return!1;if(void 0!==y.aud&&"object"==typeof s.aud)if("string"==typeof y.aud){if(!v(y.aud,s.aud))return!1}else if("object"==typeof y.aud&&!w(y.aud,s.aud))return!1;var P=h.IntDate.getNow();return void 0!==s.verifyAt&&"number"==typeof s.verifyAt&&(P=s.verifyAt),(void 0===s.gracePeriod||"number"!=typeof s.gracePeriod)&&(s.gracePeriod=0),!(void 0!==y.exp&&"number"==typeof y.exp&&y.exp+s.gracePeriod<P||void 0!==y.nbf&&"number"==typeof y.nbf&&P<y.nbf-s.gracePeriod||void 0!==y.iat&&"number"==typeof y.iat&&P<y.iat-s.gracePeriod||void 0!==y.jti&&void 0!==s.jti&&y.jti!==s.jti||!d.verify(e,r,s.alg))},l.jws.JWS.includedArray=function(e,r){var s=l.jws.JWS.inArray;if(null===e||"object"!=typeof e||"number"!=typeof e.length)return!1;for(var o=0;o<e.length;o++)if(!s(e[o],r))return!1;return!0},l.jws.JWS.inArray=function(e,r){if(null===r||"object"!=typeof r||"number"!=typeof r.length)return!1;for(var s=0;s<r.length;s++)if(r[s]==e)return!0;return!1},l.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},l.jws.JWS.isSafeJSONString=function(e,r,s){var o=null;try{return"object"!=typeof(o=wo(e))||o.constructor===Array?0:(r&&(r[s]=o),1)}catch{return 0}},l.jws.JWS.readSafeJSONString=function(e){var r=null;try{return"object"!=typeof(r=wo(e))||r.constructor===Array?null:r}catch{return null}},l.jws.JWS.getEncodedSignatureValueFromJWS=function(e){var r=e.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(null==r)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return r[1]},l.jws.JWS.getJWKthumbprint=function(e){if("RSA"!==e.kty&&"EC"!==e.kty&&"oct"!==e.kty)throw"unsupported algorithm for JWK Thumprint";var r="{";if("RSA"===e.kty){if("string"!=typeof e.n||"string"!=typeof e.e)throw"wrong n and e value for RSA key";r+='"e":"'+e.e+'",',r+='"kty":"'+e.kty+'",',r+='"n":"'+e.n+'"}'}else if("EC"===e.kty){if("string"!=typeof e.crv||"string"!=typeof e.x||"string"!=typeof e.y)throw"wrong crv, x and y value for EC key";r+='"crv":"'+e.crv+'",',r+='"kty":"'+e.kty+'",',r+='"x":"'+e.x+'",',r+='"y":"'+e.y+'"}'}else if("oct"===e.kty){if("string"!=typeof e.k)throw"wrong k value for oct(symmetric) key";r+='"kty":"'+e.kty+'",',r+='"k":"'+e.k+'"}'}var s=ei(r);return dt(l.crypto.Util.hashHex(s,"sha256"))},l.jws.IntDate={},l.jws.IntDate.get=function(e){var r=l.jws.IntDate,s=r.getNow,o=r.getZulu;if("now"==e)return s();if("now + 1hour"==e)return s()+3600;if("now + 1day"==e)return s()+86400;if("now + 1month"==e)return s()+2592e3;if("now + 1year"==e)return s()+31536e3;if(e.match(/Z$/))return o(e);if(e.match(/^[0-9]+$/))return parseInt(e);throw"unsupported format: "+e},l.jws.IntDate.getZulu=function(e){return Co(e)},l.jws.IntDate.getNow=function(){return~~(new Date/1e3)},l.jws.IntDate.intDate2UTCString=function(e){return new Date(1e3*e).toUTCString()},l.jws.IntDate.intDate2Zulu=function(e){var r=new Date(1e3*e);return("0000"+r.getUTCFullYear()).slice(-4)+("00"+(r.getUTCMonth()+1)).slice(-2)+("00"+r.getUTCDate()).slice(-2)+("00"+r.getUTCHours()).slice(-2)+("00"+r.getUTCMinutes()).slice(-2)+("00"+r.getUTCSeconds()).slice(-2)+"Z"},(typeof l>"u"||!l)&&(l={}),(typeof l.jws>"u"||!l.jws)&&(l.jws={}),l.jws.JWSJS=function(){var s=l.jws.JWS,o=s.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(h){this.init();var d=h.split(".");if(3!=d.length)throw"malformed input JWS";this.aHeader.push(d[0]),this.sPayload=d[1],this.aSignature.push(d[2])},this.addSignature=function(h,d,f,v){if(null==this.sPayload)throw"there's no JSON-JS signature to add.";var w=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var I=l.jws.JWS.sign(h,d,this.sPayload,f,v).split(".");this.aHeader.push(I[0]),this.aSignature.push(I[2])}catch(g){throw this.aHeader.length>w&&this.aHeader.pop(),this.aSignature.length>w&&this.aSignature.pop(),"addSignature failed: "+g}},this.verifyAll=function(h){if(this.aHeader.length!==h.length||this.aSignature.length!==h.length)return!1;for(var d=0;d<h.length;d++){var f=h[d];if(2!==f.length)return!1;if(!1===this.verifyNth(d,f[0],f[1]))return!1}return!0},this.verifyNth=function(h,d,f){if(this.aHeader.length<=h||this.aSignature.length<=h)return!1;var _=this.aHeader[h]+"."+this.sPayload+"."+this.aSignature[h],I=!1;try{I=s.verify(_,d,f)}catch{return!1}return I},this.readJWSJS=function(h){if("string"==typeof h){var d=o(h);if(null==d)throw"argument is not safe JSON object string";this.aHeader=d.headers,this.sPayload=d.payload,this.aSignature=d.signatures}else try{if(!(h.headers.length>0))throw"malformed header";if(this.aHeader=h.headers,"string"!=typeof h.payload)throw"malformed signatures";if(this.sPayload=h.payload,!(h.signatures.length>0))throw"malformed signatures";this.aSignature=h.signatures}catch(f){throw"malformed JWS-JS JSON object: "+f}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return 0==this.aHeader.length?1:0}},t.SecureRandom=Ui,t.rng_seed_time=cs,t.BigInteger=F,t.RSAKey=Ee,t.ECDSA=l.crypto.ECDSA,t.DSA=l.crypto.DSA,t.Signature=l.crypto.Signature,t.MessageDigest=l.crypto.MessageDigest,t.Mac=l.crypto.Mac,t.KEYUTIL=Ie,t.ASN1HEX=ue,t.X509=Se,t.X509CRL=function(e){var s=l.lang.String.isHex,h=ue.getV,d=ue.getTLV,f=ue.getVbyList,v=ue.getTLVbyList,w=ue.getTLVbyListEx,_=ue.getIdxbyList,I=ue.getIdxbyListEx,T=ue.getChildIdx,m=new Se;this.hex=null,this.posSigAlg=null,this.posRevCert=null,this.parsed=null,this._setPos=function(){var g=_(this.hex,0,[0,0]),A=this.hex.substr(g,2);if("02"==A)this.posSigAlg=1;else{if("30"!=A)throw new Error("malformed 1st item of TBSCertList: "+A);this.posSigAlg=0}var x,y=_(this.hex,0,[0,this.posSigAlg+3]),P=this.hex.substr(y,2);if("17"==P||"18"==P)x=_(this.hex,0,[0,this.posSigAlg+4]),this.posRevCert=null,-1!=x&&"30"==this.hex.substr(x,2)&&(this.posRevCert=this.posSigAlg+4);else if("30"==P)this.posRevCert=this.posSigAlg+3;else{if("a0"!=P)throw new Error("malformed nextUpdate or revCert tag: "+P);this.posRevCert=null}},this.getVersion=function(){return 0==this.posSigAlg?null:parseInt(f(this.hex,0,[0,0],"02"),16)+1},this.getSignatureAlgorithmField=function(){var g=v(this.hex,0,[0,this.posSigAlg],"30");return m.getAlgorithmIdentifierName(g)},this.getIssuer=function(){return m.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return v(this.hex,0,[0,this.posSigAlg+1],"30")},this.getThisUpdate=function(){var g=f(this.hex,0,[0,this.posSigAlg+2]);return result=Tt(g)},this.getNextUpdate=function(){var g=_(this.hex,0,[0,this.posSigAlg+3]),A=this.hex.substr(g,2);return"17"!=A&&"18"!=A?null:Tt(h(this.hex,g))},this.getRevCertArray=function(){if(null==this.posRevCert)return null;for(var g=[],A=_(this.hex,0,[0,this.posRevCert]),y=T(this.hex,A),P=0;P<y.length;P++){var x=d(this.hex,y[P]);g.push(this.getRevCert(x))}return g},this.getRevCert=function(g){var A={},y=T(g,0);return A.sn={hex:f(g,0,[0],"02")},A.date=Tt(f(g,0,[1])),3==y.length&&(A.ext=m.getExtParamArray(v(g,0,[2]))),A},this.findRevCert=function(g){var y=new Se(g).getSerialNumberHex();return this.findRevCertBySN(y)},this.findRevCertBySN=function(g){if(null==this.parsed&&this.getParam(),null==this.parsed.revcert)return null;for(var A=this.parsed.revcert,y=0;y<A.length;y++)if(g==A[y].sn.hex)return A[y];return null},this.getSignatureValueHex=function(){return f(this.hex,0,[2],"03",!0)},this.verifySignature=function(g){var A=this.getSignatureAlgorithmField(),y=this.getSignatureValueHex(),P=v(this.hex,0,[0],"30"),x=new l.crypto.Signature({alg:A});return x.init(g),x.updateHex(P),x.verify(y)},this.getParam=function(g){var A={},y=this.getVersion();null!=y&&(A.version=y),A.sigalg=this.getSignatureAlgorithmField(),A.issuer=this.getIssuer(),A.thisupdate=this.getThisUpdate();var P=this.getNextUpdate();null!=P&&(A.nextupdate=P);var x=this.getRevCertArray();if(null!=x&&(A.revcert=x),-1!=I(this.hex,0,[0,"[0]"])){var B=w(this.hex,0,[0,"[0]",0]);A.ext=m.getExtParamArray(B)}return A.sighex=this.getSignatureValueHex(),this.parsed=A,"object"==typeof g&&(1==g.tbshex&&(A.tbshex=v(this.hex,0,[0])),1==g.nodnarray&&delete A.issuer.array),A},"string"==typeof e&&(s(e)?this.hex=e:e.match(/-----BEGIN X509 CRL/)&&(this.hex=nt(e)),this._setPos())},t.CryptoJS=u,t.b64tohex=b,t.b64toBA=E,t.ECFieldElementFp=ht,t.ECPointFp=Me,t.ECCurveFp=oi,t.stoBA=_o,t.BAtos=xo,t.BAtohex=Zn,t.stohex=It,t.stob64=function qp(e){return C(It(e))},t.stob64u=function Vp(e){return Ki(C(It(e)))},t.b64utos=function Up(e){return xo(E(ln(e)))},t.b64tob64u=Ki,t.b64utob64=ln,t.hex2b64=C,t.hextob64u=dt,t.b64utohex=Ye,t.utf8tob64u=hn,t.b64utoutf8=Qt,t.utf8tob64=function Kp(e){return C(ir(sr(e)))},t.b64toutf8=function Wp(e){return decodeURIComponent(nr(b(e)))},t.utf8tohex=er,t.hextoutf8=Ve,t.hextorstr=Tt,t.rstrtohex=ei,t.hextob64=ds,t.hextob64nl=function Gp(e){return tr(ds(e),64)},t.b64nltohex=Eo,t.hextopem=bt,t.pemtohex=nt,t.hextoArrayBuffer=function Qp(e){if(e.length%2!=0)throw"input is not even length";if(null==e.match(/^[0-9A-Fa-f]+$/))throw"input is not hexadecimal";for(var r=new ArrayBuffer(e.length/2),s=new DataView(r),o=0;o<e.length/2;o++)s.setUint8(o,parseInt(e.substr(2*o,2),16));return r},t.ArrayBuffertohex=function Yp(e){for(var r="",s=new DataView(e),o=0;o<e.byteLength;o++)r+=("00"+s.getUint8(o).toString(16)).slice(-2);return r},t.zulutomsec=fs,t.msectozulu=function Zp(e){var r=new Date(e),s=("0000"+r.getUTCFullYear()).slice(-4),o=("00"+(r.getUTCMonth()+1)).slice(-2),h=("00"+r.getUTCDate()).slice(-2),d=("00"+r.getUTCHours()).slice(-2),f=("00"+r.getUTCMinutes()).slice(-2),v=("00"+r.getUTCSeconds()).slice(-2),w=("000"+r.getUTCMilliseconds()).slice(-3);return s+o+h+d+f+v+(w=""!=(w=w.replace(/0+$/,""))?"."+w:w)+"Z"},t.zulutosec=Co,t.zulutodate=function e0(e){return new Date(fs(e))},t.datetozulu=function t0(e,r,s){var o,h=e.getUTCFullYear();if(r){if(h<1950||2049<h)throw"not proper year for UTCTime: "+h;o=(""+h).slice(-2)}else o=("000"+h).slice(-4);if(o+=("0"+(e.getUTCMonth()+1)).slice(-2),o+=("0"+e.getUTCDate()).slice(-2),o+=("0"+e.getUTCHours()).slice(-2),o+=("0"+e.getUTCMinutes()).slice(-2),o+=("0"+e.getUTCSeconds()).slice(-2),s){var d=e.getUTCMilliseconds();0!==d&&(o+="."+(d=(d=("00"+d).slice(-3)).replace(/0+$/g,"")))}return o+"Z"},t.uricmptohex=ir,t.hextouricmp=nr,t.ipv6tohex=ps,t.hextoipv6=vs,t.hextoip=rr,t.iptohex=gs,t.ucs2hextoutf8=ms,t.encodeURIComponentAll=sr,t.newline_toUnix=function i0(e){return e.replace(/\r\n/gm,"\n")},t.newline_toDos=function n0(e){return(e=e.replace(/\r\n/gm,"\n")).replace(/\n/gm,"\r\n")},t.hextoposhex=ys,t.intarystrtohex=function r0(e){e=(e=(e=e.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{var r=e.split(/,/).map(function(s,o,h){var d=parseInt(s);if(d<0||255<d)throw"integer not in range 0-255";return("00"+d.toString(16)).slice(-2)}).join("");return r}catch(s){throw"malformed integer array string: "+s}},t.strdiffidx=function(e,r){var s=e.length;e.length>r.length&&(s=r.length);for(var o=0;o<s;o++)if(e.charCodeAt(o)!=r.charCodeAt(o))return o;return e.length!=r.length?s:-1},t.oidtohex=To,t.hextooid=ar,t.strpad=or,t.bitstrtoint=ko,t.inttobitstr=No,t.bitstrtobinstr=Do,t.binstrtobitstr=function a0(e){if("string"!=typeof e||null==e.match(/^[01]+$/))return null;try{return No(parseInt(e,2))}catch{return null}},t.isBase64URLDot=bs,t.namearraytobinstr=cr,t.extendClass=ne,t.foldnl=tr,t.b64topem=function Jp(e,r){return"-----BEGIN "+r+"-----\r\n"+tr(e,64)+"\r\n-----END "+r+"-----\r\n"},t.pemtob64=function Xp(e){return-1==e.indexOf("-----BEGIN ")||-1==e.indexOf("-----END ")?null:(e=(e=(e=e.replace(/^[\s\S]*?-----BEGIN [^-]+-----/m,"")).replace(/-----END [\s\S]+$/m,"")).replace(/\s+/g,"")).match(/^[0-9a-zA-Z+/=]+$/)?e:null},t.timeogen=Ao,t.aryval=rt,t.inttohex=Ro,t.twoscompl=dn,t.KJUR=l,t.crypto=l.crypto,t.asn1=l.asn1,t.jws=l.jws,t.lang=l.lang,t.VERSION="11.0.0",t.VERSION_FULL="jsrsasign(all) 11.0.0 (2024-01-16) (c) 2010-2023 Kenji Urushima | kjur.github.io/jsrsasign/license"}}),vr=oe({"../../node_modules/isomorphic-ws/browser.js"(t,i){U();var n=null;typeof WebSocket<"u"?n=WebSocket:typeof MozWebSocket<"u"?n=MozWebSocket:typeof global<"u"?n=global.WebSocket||global.MozWebSocket:typeof window<"u"?n=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(n=self.WebSocket||self.MozWebSocket),i.exports=n}}),Fs=oe({"../../node_modules/deepmerge/dist/cjs.js"(t,i){U();var n=function(ie){return function a(Z){return!!Z&&"object"==typeof Z}(ie)&&!function c(Z){var ie=Object.prototype.toString.call(Z);return"[object RegExp]"===ie||"[object Date]"===ie||function S(Z){return Z.$$typeof===p}(Z)}(ie)},p="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function b(Z,ie){return!1!==ie.clone&&ie.isMergeableObject(Z)?se(function C(Z){return Array.isArray(Z)?[]:{}}(Z),Z,ie):Z}function E(Z,ie,he){return Z.concat(ie).map(function(fe){return b(fe,he)})}function V(Z){return Object.keys(Z).concat(function q(Z){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(Z).filter(function(ie){return Object.propertyIsEnumerable.call(Z,ie)}):[]}(Z))}function F(Z,ie){try{return ie in Z}catch{return!1}}function se(Z,ie,he){(he=he||{}).arrayMerge=he.arrayMerge||E,he.isMergeableObject=he.isMergeableObject||n,he.cloneUnlessOtherwiseSpecified=b;var fe=Array.isArray(ie);return fe===Array.isArray(Z)?fe?he.arrayMerge(Z,ie,he):function G(Z,ie,he){var fe={};return he.isMergeableObject(Z)&&V(Z).forEach(function(pe){fe[pe]=b(Z[pe],he)}),V(ie).forEach(function(pe){(function O(Z,ie){return F(Z,ie)&&!(Object.hasOwnProperty.call(Z,ie)&&Object.propertyIsEnumerable.call(Z,ie))})(Z,pe)||(fe[pe]=F(Z,pe)&&he.isMergeableObject(ie[pe])?function k(Z,ie){if(!ie.customMerge)return se;var he=ie.customMerge(Z);return"function"==typeof he?he:se}(pe,he)(Z[pe],ie[pe],he):b(ie[pe],he))}),fe}(Z,ie,he):b(ie,he)}se.all=function(ie,he){if(!Array.isArray(ie))throw new Error("first argument should be an array");return ie.reduce(function(fe,pe){return se(fe,pe,he)},{})},i.exports=se}}),hc=oe({"../../node_modules/lodash/_listCacheClear.js"(t,i){U(),i.exports=function n(){this.__data__=[],this.size=0}}}),Is=oe({"../../node_modules/lodash/eq.js"(t,i){U(),i.exports=function n(a,c){return a===c||a!=a&&c!=c}}}),bn=oe({"../../node_modules/lodash/_assocIndexOf.js"(t,i){U();var n=Is();i.exports=function a(c,u){for(var p=c.length;p--;)if(n(c[p][0],u))return p;return-1}}}),dc=oe({"../../node_modules/lodash/_listCacheDelete.js"(t,i){U();var n=bn(),c=Array.prototype.splice;i.exports=function u(p){var S=this.__data__,C=n(S,p);return!(C<0||(C==S.length-1?S.pop():c.call(S,C,1),--this.size,0))}}}),fc=oe({"../../node_modules/lodash/_listCacheGet.js"(t,i){U();var n=bn();i.exports=function a(c){var u=this.__data__,p=n(u,c);return p<0?void 0:u[p][1]}}}),pc=oe({"../../node_modules/lodash/_listCacheHas.js"(t,i){U();var n=bn();i.exports=function a(c){return n(this.__data__,c)>-1}}}),vc=oe({"../../node_modules/lodash/_listCacheSet.js"(t,i){U();var n=bn();i.exports=function a(c,u){var p=this.__data__,S=n(p,c);return S<0?(++this.size,p.push([c,u])):p[S][1]=u,this}}}),yn=oe({"../../node_modules/lodash/_ListCache.js"(t,i){U();var n=hc(),a=dc(),c=fc(),u=pc(),p=vc();function S(C){var b=-1,E=null==C?0:C.length;for(this.clear();++b<E;){var k=C[b];this.set(k[0],k[1])}}S.prototype.clear=n,S.prototype.delete=a,S.prototype.get=c,S.prototype.has=u,S.prototype.set=p,i.exports=S}}),gc=oe({"../../node_modules/lodash/_stackClear.js"(t,i){U();var n=yn();i.exports=function a(){this.__data__=new n,this.size=0}}}),mc=oe({"../../node_modules/lodash/_stackDelete.js"(t,i){U(),i.exports=function n(a){var c=this.__data__,u=c.delete(a);return this.size=c.size,u}}}),bc=oe({"../../node_modules/lodash/_stackGet.js"(t,i){U(),i.exports=function n(a){return this.__data__.get(a)}}}),yc=oe({"../../node_modules/lodash/_stackHas.js"(t,i){U(),i.exports=function n(a){return this.__data__.has(a)}}}),Ts=oe({"../../node_modules/lodash/_freeGlobal.js"(t,i){U();var n="object"==typeof global&&global&&global.Object===Object&&global;i.exports=n}}),ri=oe({"../../node_modules/lodash/_root.js"(t,i){U();var n=Ts(),a="object"==typeof self&&self&&self.Object===Object&&self,c=n||a||Function("return this")();i.exports=c}}),gr=oe({"../../node_modules/lodash/_Symbol.js"(t,i){U();var n=ri();i.exports=n.Symbol}}),Sc=oe({"../../node_modules/lodash/_getRawTag.js"(t,i){U();var n=gr(),a=Object.prototype,c=a.hasOwnProperty,u=a.toString,p=n?n.toStringTag:void 0;i.exports=function S(C){var b=c.call(C,p),E=C[p];try{C[p]=void 0;var k=!0}catch{}var q=u.call(C);return k&&(b?C[p]=E:delete C[p]),q}}}),wc=oe({"../../node_modules/lodash/_objectToString.js"(t,i){U();var a=Object.prototype.toString;i.exports=function c(u){return a.call(u)}}}),Sn=oe({"../../node_modules/lodash/_baseGetTag.js"(t,i){U();var n=gr(),a=Sc(),c=wc(),S=n?n.toStringTag:void 0;i.exports=function C(b){return null==b?void 0===b?"[object Undefined]":"[object Null]":S&&S in Object(b)?a(b):c(b)}}}),Rs=oe({"../../node_modules/lodash/isObject.js"(t,i){U(),i.exports=function n(a){var c=typeof a;return null!=a&&("object"==c||"function"==c)}}}),ks=oe({"../../node_modules/lodash/isFunction.js"(t,i){U();var n=Sn(),a=Rs();i.exports=function C(b){if(!a(b))return!1;var E=n(b);return"[object Function]"==E||"[object GeneratorFunction]"==E||"[object AsyncFunction]"==E||"[object Proxy]"==E}}}),_c=oe({"../../node_modules/lodash/_coreJsData.js"(t,i){U();var n=ri();i.exports=n["__core-js_shared__"]}}),xc=oe({"../../node_modules/lodash/_isMasked.js"(t,i){U();var u,n=_c(),a=(u=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||""))?"Symbol(src)_1."+u:"";i.exports=function c(u){return!!a&&a in u}}}),Ns=oe({"../../node_modules/lodash/_toSource.js"(t,i){U();var a=Function.prototype.toString;i.exports=function c(u){if(null!=u){try{return a.call(u)}catch{}try{return u+""}catch{}}return""}}}),Ec=oe({"../../node_modules/lodash/_baseIsNative.js"(t,i){U();var n=ks(),a=xc(),c=Rs(),u=Ns(),S=/^\[object .+?Constructor\]$/,q=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");i.exports=function V(F){return!(!c(F)||a(F))&&(n(F)?q:S).test(u(F))}}}),Cc=oe({"../../node_modules/lodash/_getValue.js"(t,i){U(),i.exports=function n(a,c){return a?.[c]}}}),ki=oe({"../../node_modules/lodash/_getNative.js"(t,i){U();var n=Ec(),a=Cc();i.exports=function c(u,p){var S=a(u,p);return n(S)?S:void 0}}}),mr=oe({"../../node_modules/lodash/_Map.js"(t,i){U();var c=ki()(ri(),"Map");i.exports=c}}),wn=oe({"../../node_modules/lodash/_nativeCreate.js"(t,i){U();var a=ki()(Object,"create");i.exports=a}}),Ac=oe({"../../node_modules/lodash/_hashClear.js"(t,i){U();var n=wn();i.exports=function a(){this.__data__=n?n(null):{},this.size=0}}}),Pc=oe({"../../node_modules/lodash/_hashDelete.js"(t,i){U(),i.exports=function n(a){var c=this.has(a)&&delete this.__data__[a];return this.size-=c?1:0,c}}}),Fc=oe({"../../node_modules/lodash/_hashGet.js"(t,i){U();var n=wn(),u=Object.prototype.hasOwnProperty;i.exports=function p(S){var C=this.__data__;if(n){var b=C[S];return"__lodash_hash_undefined__"===b?void 0:b}return u.call(C,S)?C[S]:void 0}}}),Ic=oe({"../../node_modules/lodash/_hashHas.js"(t,i){U();var n=wn(),c=Object.prototype.hasOwnProperty;i.exports=function u(p){var S=this.__data__;return n?void 0!==S[p]:c.call(S,p)}}}),Tc=oe({"../../node_modules/lodash/_hashSet.js"(t,i){U();var n=wn();i.exports=function c(u,p){var S=this.__data__;return this.size+=this.has(u)?0:1,S[u]=n&&void 0===p?"__lodash_hash_undefined__":p,this}}}),Rc=oe({"../../node_modules/lodash/_Hash.js"(t,i){U();var n=Ac(),a=Pc(),c=Fc(),u=Ic(),p=Tc();function S(C){var b=-1,E=null==C?0:C.length;for(this.clear();++b<E;){var k=C[b];this.set(k[0],k[1])}}S.prototype.clear=n,S.prototype.delete=a,S.prototype.get=c,S.prototype.has=u,S.prototype.set=p,i.exports=S}}),kc=oe({"../../node_modules/lodash/_mapCacheClear.js"(t,i){U();var n=Rc(),a=yn(),c=mr();i.exports=function u(){this.size=0,this.__data__={hash:new n,map:new(c||a),string:new n}}}}),Nc=oe({"../../node_modules/lodash/_isKeyable.js"(t,i){U(),i.exports=function n(a){var c=typeof a;return"string"==c||"number"==c||"symbol"==c||"boolean"==c?"__proto__"!==a:null===a}}}),_n=oe({"../../node_modules/lodash/_getMapData.js"(t,i){U();var n=Nc();i.exports=function a(c,u){var p=c.__data__;return n(u)?p["string"==typeof u?"string":"hash"]:p.map}}}),Dc=oe({"../../node_modules/lodash/_mapCacheDelete.js"(t,i){U();var n=_n();i.exports=function a(c){var u=n(this,c).delete(c);return this.size-=u?1:0,u}}}),Oc=oe({"../../node_modules/lodash/_mapCacheGet.js"(t,i){U();var n=_n();i.exports=function a(c){return n(this,c).get(c)}}}),Bc=oe({"../../node_modules/lodash/_mapCacheHas.js"(t,i){U();var n=_n();i.exports=function a(c){return n(this,c).has(c)}}}),Mc=oe({"../../node_modules/lodash/_mapCacheSet.js"(t,i){U();var n=_n();i.exports=function a(c,u){var p=n(this,c),S=p.size;return p.set(c,u),this.size+=p.size==S?0:1,this}}}),Ds=oe({"../../node_modules/lodash/_MapCache.js"(t,i){U();var n=kc(),a=Dc(),c=Oc(),u=Bc(),p=Mc();function S(C){var b=-1,E=null==C?0:C.length;for(this.clear();++b<E;){var k=C[b];this.set(k[0],k[1])}}S.prototype.clear=n,S.prototype.delete=a,S.prototype.get=c,S.prototype.has=u,S.prototype.set=p,i.exports=S}}),jc=oe({"../../node_modules/lodash/_stackSet.js"(t,i){U();var n=yn(),a=mr(),c=Ds();i.exports=function p(S,C){var b=this.__data__;if(b instanceof n){var E=b.__data__;if(!a||E.length<199)return E.push([S,C]),this.size=++b.size,this;b=this.__data__=new c(E)}return b.set(S,C),this.size=b.size,this}}}),Lc=oe({"../../node_modules/lodash/_Stack.js"(t,i){U();var n=yn(),a=gc(),c=mc(),u=bc(),p=yc(),S=jc();function C(b){var E=this.__data__=new n(b);this.size=E.size}C.prototype.clear=a,C.prototype.delete=c,C.prototype.get=u,C.prototype.has=p,C.prototype.set=S,i.exports=C}}),Hc=oe({"../../node_modules/lodash/_setCacheAdd.js"(t,i){U(),i.exports=function a(c){return this.__data__.set(c,"__lodash_hash_undefined__"),this}}}),qc=oe({"../../node_modules/lodash/_setCacheHas.js"(t,i){U(),i.exports=function n(a){return this.__data__.has(a)}}}),Vc=oe({"../../node_modules/lodash/_SetCache.js"(t,i){U();var n=Ds(),a=Hc(),c=qc();function u(p){var S=-1,C=null==p?0:p.length;for(this.__data__=new n;++S<C;)this.add(p[S])}u.prototype.add=u.prototype.push=a,u.prototype.has=c,i.exports=u}}),Uc=oe({"../../node_modules/lodash/_arraySome.js"(t,i){U(),i.exports=function n(a,c){for(var u=-1,p=null==a?0:a.length;++u<p;)if(c(a[u],u,a))return!0;return!1}}}),Kc=oe({"../../node_modules/lodash/_cacheHas.js"(t,i){U(),i.exports=function n(a,c){return a.has(c)}}}),Os=oe({"../../node_modules/lodash/_equalArrays.js"(t,i){U();var n=Vc(),a=Uc(),c=Kc();i.exports=function S(C,b,E,k,q,V){var F=1&E,O=C.length,G=b.length;if(O!=G&&!(F&&G>O))return!1;var se=V.get(C),ce=V.get(b);if(se&&ce)return se==b&&ce==C;var Z=-1,ie=!0,he=2&E?new n:void 0;for(V.set(C,b),V.set(b,C);++Z<O;){var fe=C[Z],pe=b[Z];if(k)var me=F?k(pe,fe,Z,b,C,V):k(fe,pe,Z,C,b,V);if(void 0!==me){if(me)continue;ie=!1;break}if(he){if(!a(b,function(Ce,Qe){if(!c(he,Qe)&&(fe===Ce||q(fe,Ce,E,k,V)))return he.push(Qe)})){ie=!1;break}}else if(fe!==pe&&!q(fe,pe,E,k,V)){ie=!1;break}}return V.delete(C),V.delete(b),ie}}}),Wc=oe({"../../node_modules/lodash/_Uint8Array.js"(t,i){U();var n=ri();i.exports=n.Uint8Array}}),zc=oe({"../../node_modules/lodash/_mapToArray.js"(t,i){U(),i.exports=function n(a){var c=-1,u=Array(a.size);return a.forEach(function(p,S){u[++c]=[S,p]}),u}}}),$c=oe({"../../node_modules/lodash/_setToArray.js"(t,i){U(),i.exports=function n(a){var c=-1,u=Array(a.size);return a.forEach(function(p){u[++c]=p}),u}}}),Gc=oe({"../../node_modules/lodash/_equalByTag.js"(t,i){U();var n=gr(),a=Wc(),c=Is(),u=Os(),p=zc(),S=$c(),he=n?n.prototype:void 0,fe=he?he.valueOf:void 0;i.exports=function pe(me,Ce,Qe,Ke,Ge,Pe,mt){switch(Qe){case"[object DataView]":if(me.byteLength!=Ce.byteLength||me.byteOffset!=Ce.byteOffset)return!1;me=me.buffer,Ce=Ce.buffer;case"[object ArrayBuffer]":return!(me.byteLength!=Ce.byteLength||!Pe(new a(me),new a(Ce)));case"[object Boolean]":case"[object Date]":case"[object Number]":return c(+me,+Ce);case"[object Error]":return me.name==Ce.name&&me.message==Ce.message;case"[object RegExp]":case"[object String]":return me==Ce+"";case"[object Map]":var wt=p;case"[object Set]":if(wt||(wt=S),me.size!=Ce.size&&!(1&Ke))return!1;var Jt=mt.get(me);if(Jt)return Jt==Ce;Ke|=2,mt.set(me,Ce);var Mi=u(wt(me),wt(Ce),Ke,Ge,Pe,mt);return mt.delete(me),Mi;case"[object Symbol]":if(fe)return fe.call(me)==fe.call(Ce)}return!1}}}),Jc=oe({"../../node_modules/lodash/_arrayPush.js"(t,i){U(),i.exports=function n(a,c){for(var u=-1,p=c.length,S=a.length;++u<p;)a[S+u]=c[u];return a}}}),br=oe({"../../node_modules/lodash/isArray.js"(t,i){U(),i.exports=Array.isArray}}),Xc=oe({"../../node_modules/lodash/_baseGetAllKeys.js"(t,i){U();var n=Jc(),a=br();i.exports=function c(u,p,S){var C=p(u);return a(u)?C:n(C,S(u))}}}),Qc=oe({"../../node_modules/lodash/_arrayFilter.js"(t,i){U(),i.exports=function n(a,c){for(var u=-1,p=null==a?0:a.length,S=0,C=[];++u<p;){var b=a[u];c(b,u,a)&&(C[S++]=b)}return C}}}),Yc=oe({"../../node_modules/lodash/stubArray.js"(t,i){U(),i.exports=function n(){return[]}}}),Zc=oe({"../../node_modules/lodash/_getSymbols.js"(t,i){U();var n=Qc(),a=Yc(),u=Object.prototype.propertyIsEnumerable,p=Object.getOwnPropertySymbols;i.exports=p?function(C){return null==C?[]:(C=Object(C),n(p(C),function(b){return u.call(C,b)}))}:a}}),eu=oe({"../../node_modules/lodash/_baseTimes.js"(t,i){U(),i.exports=function n(a,c){for(var u=-1,p=Array(a);++u<a;)p[u]=c(u);return p}}}),xn=oe({"../../node_modules/lodash/isObjectLike.js"(t,i){U(),i.exports=function n(a){return null!=a&&"object"==typeof a}}}),tu=oe({"../../node_modules/lodash/_baseIsArguments.js"(t,i){U();var n=Sn(),a=xn();i.exports=function u(p){return a(p)&&"[object Arguments]"==n(p)}}}),iu=oe({"../../node_modules/lodash/isArguments.js"(t,i){U();var n=tu(),a=xn(),c=Object.prototype,u=c.hasOwnProperty,p=c.propertyIsEnumerable,S=n(function(){return arguments}())?n:function(C){return a(C)&&u.call(C,"callee")&&!p.call(C,"callee")};i.exports=S}}),nu=oe({"../../node_modules/lodash/stubFalse.js"(t,i){U(),i.exports=function n(){return!1}}}),Bs=oe({"../../node_modules/lodash/isBuffer.js"(t,i){U();var n=ri(),a=nu(),c="object"==typeof t&&t&&!t.nodeType&&t,u=c&&"object"==typeof i&&i&&!i.nodeType&&i,S=u&&u.exports===c?n.Buffer:void 0;i.exports=(S?S.isBuffer:void 0)||a}}),ru=oe({"../../node_modules/lodash/_isIndex.js"(t,i){U();var a=/^(?:0|[1-9]\d*)$/;i.exports=function c(u,p){var S=typeof u;return!!(p=p??9007199254740991)&&("number"==S||"symbol"!=S&&a.test(u))&&u>-1&&u%1==0&&u<p}}}),Ms=oe({"../../node_modules/lodash/isLength.js"(t,i){U(),i.exports=function a(c){return"number"==typeof c&&c>-1&&c%1==0&&c<=9007199254740991}}}),su=oe({"../../node_modules/lodash/_baseIsTypedArray.js"(t,i){U();var n=Sn(),a=Ms(),c=xn(),Pe={};Pe["[object Float32Array]"]=Pe["[object Float64Array]"]=Pe["[object Int8Array]"]=Pe["[object Int16Array]"]=Pe["[object Int32Array]"]=Pe["[object Uint8Array]"]=Pe["[object Uint8ClampedArray]"]=Pe["[object Uint16Array]"]=Pe["[object Uint32Array]"]=!0,Pe["[object Arguments]"]=Pe["[object Array]"]=Pe["[object ArrayBuffer]"]=Pe["[object Boolean]"]=Pe["[object DataView]"]=Pe["[object Date]"]=Pe["[object Error]"]=Pe["[object Function]"]=Pe["[object Map]"]=Pe["[object Number]"]=Pe["[object Object]"]=Pe["[object RegExp]"]=Pe["[object Set]"]=Pe["[object String]"]=Pe["[object WeakMap]"]=!1,i.exports=function mt(wt){return c(wt)&&a(wt.length)&&!!Pe[n(wt)]}}}),au=oe({"../../node_modules/lodash/_baseUnary.js"(t,i){U(),i.exports=function n(a){return function(c){return a(c)}}}}),ou=oe({"../../node_modules/lodash/_nodeUtil.js"(t,i){U();var n=Ts(),a="object"==typeof t&&t&&!t.nodeType&&t,c=a&&"object"==typeof i&&i&&!i.nodeType&&i,p=c&&c.exports===a&&n.process,S=function(){try{return c&&c.require&&c.require("util").types||p&&p.binding&&p.binding("util")}catch{}}();i.exports=S}}),js=oe({"../../node_modules/lodash/isTypedArray.js"(t,i){U();var n=su(),a=au(),c=ou(),u=c&&c.isTypedArray,p=u?a(u):n;i.exports=p}}),cu=oe({"../../node_modules/lodash/_arrayLikeKeys.js"(t,i){U();var n=eu(),a=iu(),c=br(),u=Bs(),p=ru(),S=js(),b=Object.prototype.hasOwnProperty;i.exports=function E(k,q){var V=c(k),F=!V&&a(k),O=!V&&!F&&u(k),G=!V&&!F&&!O&&S(k),se=V||F||O||G,ce=se?n(k.length,String):[],Z=ce.length;for(var ie in k)(q||b.call(k,ie))&&(!se||!("length"==ie||O&&("offset"==ie||"parent"==ie)||G&&("buffer"==ie||"byteLength"==ie||"byteOffset"==ie)||p(ie,Z)))&&ce.push(ie);return ce}}}),uu=oe({"../../node_modules/lodash/_isPrototype.js"(t,i){U();var n=Object.prototype;i.exports=function a(c){var u=c&&c.constructor;return c===("function"==typeof u&&u.prototype||n)}}}),lu=oe({"../../node_modules/lodash/_overArg.js"(t,i){U(),i.exports=function n(a,c){return function(u){return a(c(u))}}}}),hu=oe({"../../node_modules/lodash/_nativeKeys.js"(t,i){U();var a=lu()(Object.keys,Object);i.exports=a}}),du=oe({"../../node_modules/lodash/_baseKeys.js"(t,i){U();var n=uu(),a=hu(),u=Object.prototype.hasOwnProperty;i.exports=function p(S){if(!n(S))return a(S);var C=[];for(var b in Object(S))u.call(S,b)&&"constructor"!=b&&C.push(b);return C}}}),fu=oe({"../../node_modules/lodash/isArrayLike.js"(t,i){U();var n=ks(),a=Ms();i.exports=function c(u){return null!=u&&a(u.length)&&!n(u)}}}),pu=oe({"../../node_modules/lodash/keys.js"(t,i){U();var n=cu(),a=du(),c=fu();i.exports=function u(p){return c(p)?n(p):a(p)}}}),vu=oe({"../../node_modules/lodash/_getAllKeys.js"(t,i){U();var n=Xc(),a=Zc(),c=pu();i.exports=function u(p){return n(p,c,a)}}}),gu=oe({"../../node_modules/lodash/_equalObjects.js"(t,i){U();var n=vu(),u=Object.prototype.hasOwnProperty;i.exports=function p(S,C,b,E,k,q){var V=1&b,F=n(S),O=F.length;if(O!=n(C).length&&!V)return!1;for(var ce=O;ce--;){var Z=F[ce];if(!(V?Z in C:u.call(C,Z)))return!1}var ie=q.get(S),he=q.get(C);if(ie&&he)return ie==C&&he==S;var fe=!0;q.set(S,C),q.set(C,S);for(var pe=V;++ce<O;){var me=S[Z=F[ce]],Ce=C[Z];if(E)var Qe=V?E(Ce,me,Z,C,S,q):E(me,Ce,Z,S,C,q);if(!(void 0===Qe?me===Ce||k(me,Ce,b,E,q):Qe)){fe=!1;break}pe||(pe="constructor"==Z)}if(fe&&!pe){var Ke=S.constructor,Ge=C.constructor;Ke!=Ge&&"constructor"in S&&"constructor"in C&&!("function"==typeof Ke&&Ke instanceof Ke&&"function"==typeof Ge&&Ge instanceof Ge)&&(fe=!1)}return q.delete(S),q.delete(C),fe}}}),mu=oe({"../../node_modules/lodash/_DataView.js"(t,i){U();var c=ki()(ri(),"DataView");i.exports=c}}),bu=oe({"../../node_modules/lodash/_Promise.js"(t,i){U();var c=ki()(ri(),"Promise");i.exports=c}}),yu=oe({"../../node_modules/lodash/_Set.js"(t,i){U();var c=ki()(ri(),"Set");i.exports=c}}),Su=oe({"../../node_modules/lodash/_WeakMap.js"(t,i){U();var c=ki()(ri(),"WeakMap");i.exports=c}}),wu=oe({"../../node_modules/lodash/_getTag.js"(t,i){U();var n=mu(),a=mr(),c=bu(),u=yu(),p=Su(),S=Sn(),C=Ns(),b="[object Map]",k="[object Promise]",q="[object Set]",V="[object WeakMap]",F="[object DataView]",O=C(n),G=C(a),se=C(c),ce=C(u),Z=C(p),ie=S;(n&&ie(new n(new ArrayBuffer(1)))!=F||a&&ie(new a)!=b||c&&ie(c.resolve())!=k||u&&ie(new u)!=q||p&&ie(new p)!=V)&&(ie=function(he){var fe=S(he),pe="[object Object]"==fe?he.constructor:void 0,me=pe?C(pe):"";if(me)switch(me){case O:return F;case G:return b;case se:return k;case ce:return q;case Z:return V}return fe}),i.exports=ie}}),_u=oe({"../../node_modules/lodash/_baseIsEqualDeep.js"(t,i){U();var n=Lc(),a=Os(),c=Gc(),u=gu(),p=wu(),S=br(),C=Bs(),b=js(),k="[object Arguments]",q="[object Array]",V="[object Object]",O=Object.prototype.hasOwnProperty;i.exports=function G(se,ce,Z,ie,he,fe){var pe=S(se),me=S(ce),Ce=pe?q:p(se),Qe=me?q:p(ce),Ke=(Ce=Ce==k?V:Ce)==V,Ge=(Qe=Qe==k?V:Qe)==V,Pe=Ce==Qe;if(Pe&&C(se)){if(!C(ce))return!1;pe=!0,Ke=!1}if(Pe&&!Ke)return fe||(fe=new n),pe||b(se)?a(se,ce,Z,ie,he,fe):c(se,ce,Ce,Z,ie,he,fe);if(!(1&Z)){var mt=Ke&&O.call(se,"__wrapped__"),wt=Ge&&O.call(ce,"__wrapped__");if(mt||wt){var Zt=mt?se.value():se,Jt=wt?ce.value():ce;return fe||(fe=new n),he(Zt,Jt,Z,ie,fe)}}return!!Pe&&(fe||(fe=new n),u(se,ce,Z,ie,he,fe))}}}),xu=oe({"../../node_modules/lodash/_baseIsEqual.js"(t,i){U();var n=_u(),a=xn();i.exports=function c(u,p,S,C,b){return u===p||(null==u||null==p||!a(u)&&!a(p)?u!=u&&p!=p:n(u,p,S,C,c,b))}}}),Eu=oe({"../../node_modules/lodash/isEqual.js"(t,i){U();var n=xu();i.exports=function a(c,u){return n(c,u)}}});U(),U(),U(),U(),U();var Ls=["disable","error","warn","info","debug"],$i=class pn{constructor(i){this.debug=(...n)=>(this._log("debug",...n),Date.now()),this.info=(...n)=>(this._log("info",...n),Date.now()),this.warn=(...n)=>{this._log("warn",...n)},this.error=(...n)=>{this._log("error",...n)},this.elapsed=(n,...a)=>{const c=Date.now()-n;this._log("info",`elapsed ms:${c}`,...a)},this.prefix=i}_log(i,...n){const a=Ls.indexOf(i);if(Ls.indexOf(pn.level)>=a){const u=new Date(Date.now()+324e5).toISOString()+"+JST";n=[this.prefix,...n].map(C=>{if(C instanceof Error)return C.toJSON?C.toJSON():{name:C.name,message:C.message,stack:C.stack};if("object"==typeof C)try{return JSON.parse(JSON.stringify(C))}catch{return"json error"}return C});let S=[u,i,...n];switch("string"===pn.format&&(S=[u+" "+i+" "+JSON.stringify(n)]),i){case"debug":console.debug(...S);break;case"info":console.info(...S);break;case"warn":console.warn(...S);break;case"error":console.error(...S)}pn.onLog({id:pn.id,timestamp:u,level:i,message:n})}}createBlock(i){return{warn:(...n)=>{this.warn(re({},i),...n)},debug:(...n)=>{this.debug(re({},i),...n)},info:(...n)=>{this.info(re({},i),...n)},error:(...n)=>{this.error(re({},i),...n)}}}};$i.level="error",$i.format="object",$i.onLog=()=>{},$i.id=Math.random().toString().slice(2,7);var _e=$i,Cu=new _e("packages/common/src/error.ts"),li=class extends Error{constructor(t,i=!0){if(super(t.info.detail),this.id=Math.random().toString().slice(2,10),Object.assign(this,t),this.name=this.info.name,i){const n=["SkyWayError",`name:${this.info.name}, detail:${this.info.detail}, solution:${this.info.solution}`];this.path&&n.push(this.path),this.error&&n.push(this.error),this.payload&&n.push(this.payload),n.push(this.id),Cu.warn(...n)}}toJSON(){return{id:this.id,info:this.info,path:this.path,payload:this.payload,error:this.error,stack:this.stack}}};U();var Au=new _e("packages/common/src/event.ts"),Fe=class{constructor(t=(()=>{})){this._onSetListener=t,this._stack=[],this._eventIndex=0,this.emit=i=>{for(const n of this._stack)try{n.execute(i)}catch(a){Au.error("task throws error",a)}},this.removeAllListeners=()=>{this._stack=[]},this.pipe=i=>this.add(n=>i.emit(n)),this.add=i=>{const n=this._eventIndex;this._stack.push({execute:i,id:n}),this._eventIndex++;const a=()=>{this._stack=this._stack.filter(u=>u.id!==n&&u)};return this._onSetListener(),{removeListener:a,disposer:u=>{u.push(a)}}},this.once=i=>{const n=this.add(a=>{n.removeListener(),i(a)});return n},this.asPromise=i=>new Promise((n,a)=>{const c=i&&setTimeout(()=>{a(new Hs("Event asPromise timeout : "+i))},i);this.once(u=>{c&&clearTimeout(c),n(u)})}),this.watch=(i,n)=>new Promise((a,c)=>{const u=n&&setTimeout(()=>{c(new Hs("Event watch timeout : "+n))},n),{removeListener:p}=this.add(S=>{i(S)&&(u&&clearTimeout(u),p(),a(S))})})}get length(){return this._stack.length}},hi=class{constructor(){this.events=[]}make(){const t=new Fe;return this.events.push(t),t}dispose(){this.events.forEach(t=>t.removeAllListeners()),this.events=[]}},si=class{constructor(){this._disposer=[]}push(t){this._disposer.push(t)}dispose(){this._disposer.forEach(t=>t()),this._disposer=[]}},Hs=class extends Error{toJSON(){return{name:this.name,message:this.message,stack:this.stack}}};function qs(t,i){return function(){return t.apply(i,arguments)}}U(),U(),U(),U(),U();var{toString:Pu}=Object.prototype,{getPrototypeOf:yr}=Object,En=(t=>i=>{const n=Pu.call(i);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Ut=t=>(t=t.toLowerCase(),i=>En(i)===t),Cn=t=>i=>typeof i===t,{isArray:Ni}=Array,Gi=Cn("undefined"),Vs=Ut("ArrayBuffer"),Tu=Cn("string"),Nt=Cn("function"),Us=Cn("number"),An=t=>null!==t&&"object"==typeof t,Pn=t=>{if("object"!==En(t))return!1;const i=yr(t);return!(null!==i&&i!==Object.prototype&&null!==Object.getPrototypeOf(i)||Symbol.toStringTag in t||Symbol.iterator in t)},ku=Ut("Date"),Nu=Ut("File"),Du=Ut("Blob"),Ou=Ut("FileList"),ju=Ut("URLSearchParams"),[Lu,Hu,qu,Vu]=["ReadableStream","Request","Response","Headers"].map(Ut);function Ji(t,i,{allOwnKeys:n=!1}={}){if(null===t||typeof t>"u")return;let a,c;if("object"!=typeof t&&(t=[t]),Ni(t))for(a=0,c=t.length;a<c;a++)i.call(null,t[a],a,t);else{const u=n?Object.getOwnPropertyNames(t):Object.keys(t),p=u.length;let S;for(a=0;a<p;a++)S=u[a],i.call(null,t[S],S,t)}}function Ks(t,i){i=i.toLowerCase();const n=Object.keys(t);let c,a=n.length;for(;a-- >0;)if(c=n[a],i===c.toLowerCase())return c;return null}var yi=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ws=t=>!Gi(t)&&t!==yi,Xu=(t=>i=>t&&i instanceof t)(typeof Uint8Array<"u"&&yr(Uint8Array)),Zu=Ut("HTMLFormElement"),zs=(({hasOwnProperty:t})=>(i,n)=>t.call(i,n))(Object.prototype),tl=Ut("RegExp"),$s=(t,i)=>{const n=Object.getOwnPropertyDescriptors(t),a={};Ji(n,(c,u)=>{let p;!1!==(p=i(c,u,t))&&(a[u]=p||c)}),Object.defineProperties(t,a)},wr="abcdefghijklmnopqrstuvwxyz",Gs="0123456789",Js={DIGIT:Gs,ALPHA:wr,ALPHA_DIGIT:wr+wr.toUpperCase()+Gs},ul=Ut("AsyncFunction"),Xs=((t,i)=>{return t?setImmediate:i?(n=`axios@${Math.random()}`,a=[],yi.addEventListener("message",({source:c,data:u})=>{c===yi&&u===n&&a.length&&a.shift()()},!1),c=>{a.push(c),yi.postMessage(n,"*")}):n=>setTimeout(n);var n,a})("function"==typeof setImmediate,Nt(yi.postMessage)),hl=typeof queueMicrotask<"u"?queueMicrotask.bind(yi):typeof fr<"u"&&fr.nextTick||Xs,te={isArray:Ni,isArrayBuffer:Vs,isBuffer:function Fu(t){return null!==t&&!Gi(t)&&null!==t.constructor&&!Gi(t.constructor)&&Nt(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let i;return t&&("function"==typeof FormData&&t instanceof FormData||Nt(t.append)&&("formdata"===(i=En(t))||"object"===i&&Nt(t.toString)&&"[object FormData]"===t.toString()))},isArrayBufferView:function Iu(t){let i;return i=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&Vs(t.buffer),i},isString:Tu,isNumber:Us,isBoolean:t=>!0===t||!1===t,isObject:An,isPlainObject:Pn,isReadableStream:Lu,isRequest:Hu,isResponse:qu,isHeaders:Vu,isUndefined:Gi,isDate:ku,isFile:Nu,isBlob:Du,isRegExp:tl,isFunction:Nt,isStream:t=>An(t)&&Nt(t.pipe),isURLSearchParams:ju,isTypedArray:Xu,isFileList:Ou,forEach:Ji,merge:function Sr(){const{caseless:t}=Ws(this)&&this||{},i={},n=(a,c)=>{const u=t&&Ks(i,c)||c;i[u]=Pn(i[u])&&Pn(a)?Sr(i[u],a):Pn(a)?Sr({},a):Ni(a)?a.slice():a};for(let a=0,c=arguments.length;a<c;a++)arguments[a]&&Ji(arguments[a],n);return i},extend:(t,i,n,{allOwnKeys:a}={})=>(Ji(i,(c,u)=>{t[u]=n&&Nt(c)?qs(c,n):c},{allOwnKeys:a}),t),trim:t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(65279===t.charCodeAt(0)&&(t=t.slice(1)),t),inherits:(t,i,n,a)=>{t.prototype=Object.create(i.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:i.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,i,n,a)=>{let c,u,p;const S={};if(i=i||{},null==t)return i;do{for(c=Object.getOwnPropertyNames(t),u=c.length;u-- >0;)p=c[u],(!a||a(p,t,i))&&!S[p]&&(i[p]=t[p],S[p]=!0);t=!1!==n&&yr(t)}while(t&&(!n||n(t,i))&&t!==Object.prototype);return i},kindOf:En,kindOfTest:Ut,endsWith:(t,i,n)=>{t=String(t),(void 0===n||n>t.length)&&(n=t.length);const a=t.indexOf(i,n-=i.length);return-1!==a&&a===n},toArray:t=>{if(!t)return null;if(Ni(t))return t;let i=t.length;if(!Us(i))return null;const n=new Array(i);for(;i-- >0;)n[i]=t[i];return n},forEachEntry:(t,i)=>{const a=(t&&t[Symbol.iterator]).call(t);let c;for(;(c=a.next())&&!c.done;){const u=c.value;i.call(t,u[0],u[1])}},matchAll:(t,i)=>{let n;const a=[];for(;null!==(n=t.exec(i));)a.push(n);return a},isHTMLForm:Zu,hasOwnProperty:zs,hasOwnProp:zs,reduceDescriptors:$s,freezeMethods:t=>{$s(t,(i,n)=>{if(Nt(t)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;if(Nt(t[n])){if(i.enumerable=!1,"writable"in i)return void(i.writable=!1);i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},toObjectSet:(t,i)=>{const n={},a=c=>{c.forEach(u=>{n[u]=!0})};return Ni(t)?a(t):a(String(t).split(i)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,a,c){return a.toUpperCase()+c}),noop:()=>{},toFiniteNumber:(t,i)=>null!=t&&Number.isFinite(t=+t)?t:i,findKey:Ks,global:yi,isContextDefined:Ws,ALPHABET:Js,generateString:(t=16,i=Js.ALPHA_DIGIT)=>{let n="";const{length:a}=i;for(;t--;)n+=i[Math.random()*a|0];return n},isSpecCompliantForm:function ol(t){return!!(t&&Nt(t.append)&&"FormData"===t[Symbol.toStringTag]&&t[Symbol.iterator])},toJSONObject:t=>{const i=new Array(10),n=(a,c)=>{if(An(a)){if(i.indexOf(a)>=0)return;if(!("toJSON"in a)){i[c]=a;const u=Ni(a)?[]:{};return Ji(a,(p,S)=>{const C=n(p,c+1);!Gi(C)&&(u[S]=C)}),i[c]=void 0,u}}return a};return n(t,0)},isAsyncFn:ul,isThenable:t=>t&&(An(t)||Nt(t))&&Nt(t.then)&&Nt(t.catch),setImmediate:Xs,asap:hl};function Di(t,i,n,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=t,this.name="AxiosError",i&&(this.code=i),n&&(this.config=n),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}U(),U(),U(),U(),U(),te.inherits(Di,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:te.toJSONObject(this.config),code:this.code,status:this.status}}});var Qs=Di.prototype,Ys={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Ys[t]={value:t}}),Object.defineProperties(Di,Ys),Object.defineProperty(Qs,"isAxiosError",{value:!0}),Di.from=(t,i,n,a,c,u)=>{const p=Object.create(Qs);return te.toFlatObject(t,p,function(C){return C!==Error.prototype},S=>"isAxiosError"!==S),Di.call(p,t.message,i,n,a,c),p.cause=t,p.name=t.name,u&&Object.assign(p,u),p};var Re=Di;function _r(t){return te.isPlainObject(t)||te.isArray(t)}function ea(t){return te.endsWith(t,"[]")?t.slice(0,-2):t}function ta(t,i,n){return t?t.concat(i).map(function(c,u){return c=ea(c),!n&&u?"["+c+"]":c}).join(n?".":""):i}U();var fl=te.toFlatObject(te,{},null,function(i){return/^is[A-Z]/.test(i)}),Fn=function pl(t,i,n){if(!te.isObject(t))throw new TypeError("target must be an object");i=i||new FormData;const a=(n=te.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(O,G){return!te.isUndefined(G[O])})).metaTokens,c=n.visitor||E,u=n.dots,p=n.indexes,C=(n.Blob||typeof Blob<"u"&&Blob)&&te.isSpecCompliantForm(i);if(!te.isFunction(c))throw new TypeError("visitor must be a function");function b(F){if(null===F)return"";if(te.isDate(F))return F.toISOString();if(!C&&te.isBlob(F))throw new Re("Blob is not supported. Use a Buffer instead.");return te.isArrayBuffer(F)||te.isTypedArray(F)?C&&"function"==typeof Blob?new Blob([F]):Buffer.from(F):F}function E(F,O,G){let se=F;if(F&&!G&&"object"==typeof F)if(te.endsWith(O,"{}"))O=a?O:O.slice(0,-2),F=JSON.stringify(F);else if(te.isArray(F)&&function dl(t){return te.isArray(t)&&!t.some(_r)}(F)||(te.isFileList(F)||te.endsWith(O,"[]"))&&(se=te.toArray(F)))return O=ea(O),se.forEach(function(Z,ie){!te.isUndefined(Z)&&null!==Z&&i.append(!0===p?ta([O],ie,u):null===p?O:O+"[]",b(Z))}),!1;return!!_r(F)||(i.append(ta(G,O,u),b(F)),!1)}const k=[],q=Object.assign(fl,{defaultVisitor:E,convertValue:b,isVisitable:_r});if(!te.isObject(t))throw new TypeError("data must be an object");return function V(F,O){if(!te.isUndefined(F)){if(-1!==k.indexOf(F))throw Error("Circular reference detected in "+O.join("."));k.push(F),te.forEach(F,function(se,ce){!0===(!(te.isUndefined(se)||null===se)&&c.call(i,se,te.isString(ce)?ce.trim():ce,O,q))&&V(se,O?O.concat(ce):[ce])}),k.pop()}}(t),i};function ia(t){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(a){return i[a]})}function na(t,i){this._pairs=[],t&&Fn(t,this,i)}var ra=na.prototype;ra.append=function(i,n){this._pairs.push([i,n])},ra.toString=function(i){const n=i?function(a){return i.call(this,a,ia)}:ia;return this._pairs.map(function(c){return n(c[0])+"="+n(c[1])},"").join("&")};var sa=na;function vl(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function aa(t,i,n){if(!i)return t;const a=n&&n.encode||vl,c=n&&n.serialize;let u;if(u=c?c(i,n):te.isURLSearchParams(i)?i.toString():new sa(i,n).toString(a),u){const p=t.indexOf("#");-1!==p&&(t=t.slice(0,p)),t+=(-1===t.indexOf("?")?"?":"&")+u}return t}U();var oa=class{constructor(){this.handlers=[]}use(t,i,n){return this.handlers.push({fulfilled:t,rejected:i,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){te.forEach(this.handlers,function(n){null!==n&&t(n)})}};U(),U(),U(),U();var ca={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};U(),U(),U(),U();var ml=typeof URLSearchParams<"u"?URLSearchParams:sa;U();var bl=typeof FormData<"u"?FormData:null;U();var Sl={isBrowser:!0,classes:{URLSearchParams:ml,FormData:bl,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},ua={};((t,i)=>{for(var n in i)gn(t,n,{get:i[n],enumerable:!0})})(ua,{hasBrowserEnv:()=>xr,hasStandardBrowserEnv:()=>wl,hasStandardBrowserWebWorkerEnv:()=>_l,navigator:()=>Er,origin:()=>xl}),U();var xr=typeof window<"u"&&typeof document<"u",Er="object"==typeof navigator&&navigator||void 0,wl=xr&&(!Er||["ReactNative","NativeScript","NS"].indexOf(Er.product)<0),_l=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,xl=xr&&window.location.href||"http://localhost",At=re(re({},ua),Sl);U();var la=function Pl(t){function i(n,a,c,u){let p=n[u++];if("__proto__"===p)return!0;const S=Number.isFinite(+p),C=u>=n.length;return p=!p&&te.isArray(c)?c.length:p,C?(c[p]=te.hasOwnProp(c,p)?[c[p],a]:a,!S):((!c[p]||!te.isObject(c[p]))&&(c[p]=[]),i(n,a,c[p],u)&&te.isArray(c[p])&&(c[p]=function Al(t){const i={},n=Object.keys(t);let a;const c=n.length;let u;for(a=0;a<c;a++)u=n[a],i[u]=t[u];return i}(c[p])),!S)}if(te.isFormData(t)&&te.isFunction(t.entries)){const n={};return te.forEachEntry(t,(a,c)=>{i(function Cl(t){return te.matchAll(/\w+|\[(\w*)]/g,t).map(i=>"[]"===i[0]?"":i[1]||i[0])}(a),c,n,0)}),n}return null},Cr={transitional:ca,adapter:["xhr","http","fetch"],transformRequest:[function(i,n){const a=n.getContentType()||"",c=a.indexOf("application/json")>-1,u=te.isObject(i);if(u&&te.isHTMLForm(i)&&(i=new FormData(i)),te.isFormData(i))return c?JSON.stringify(la(i)):i;if(te.isArrayBuffer(i)||te.isBuffer(i)||te.isStream(i)||te.isFile(i)||te.isBlob(i)||te.isReadableStream(i))return i;if(te.isArrayBufferView(i))return i.buffer;if(te.isURLSearchParams(i))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let S;if(u){if(a.indexOf("application/x-www-form-urlencoded")>-1)return function El(t,i){return Fn(t,new At.classes.URLSearchParams,Object.assign({visitor:function(n,a,c,u){return At.isNode&&te.isBuffer(n)?(this.append(a,n.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},i))}(i,this.formSerializer).toString();if((S=te.isFileList(i))||a.indexOf("multipart/form-data")>-1){const C=this.env&&this.env.FormData;return Fn(S?{"files[]":i}:i,C&&new C,this.formSerializer)}}return u||c?(n.setContentType("application/json",!1),function Fl(t,i,n){if(te.isString(t))try{return(i||JSON.parse)(t),te.trim(t)}catch(a){if("SyntaxError"!==a.name)throw a}return(n||JSON.stringify)(t)}(i)):i}],transformResponse:[function(i){const n=this.transitional||Cr.transitional,a=n&&n.forcedJSONParsing,c="json"===this.responseType;if(te.isResponse(i)||te.isReadableStream(i))return i;if(i&&te.isString(i)&&(a&&!this.responseType||c)){const p=!(n&&n.silentJSONParsing)&&c;try{return JSON.parse(i)}catch(S){if(p)throw"SyntaxError"===S.name?Re.from(S,Re.ERR_BAD_RESPONSE,this,null,this.response):S}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:At.classes.FormData,Blob:At.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};te.forEach(["delete","get","head","post","put","patch"],t=>{Cr.headers[t]={}});var Ar=Cr;U(),U();var Il=te.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ha=Symbol("internals");function Xi(t){return t&&String(t).trim().toLowerCase()}function In(t){return!1===t||null==t?t:te.isArray(t)?t.map(In):String(t)}function Pr(t,i,n,a,c){if(te.isFunction(a))return a.call(this,i,n);if(c&&(i=n),te.isString(i)){if(te.isString(a))return-1!==i.indexOf(a);if(te.isRegExp(a))return a.test(i)}}var Tn=class{constructor(t){t&&this.set(t)}set(t,i,n){const a=this;function c(p,S,C){const b=Xi(S);if(!b)throw new Error("header name must be a non-empty string");const E=te.findKey(a,b);(!E||void 0===a[E]||!0===C||void 0===C&&!1!==a[E])&&(a[E||S]=In(p))}const u=(p,S)=>te.forEach(p,(C,b)=>c(C,b,S));if(te.isPlainObject(t)||t instanceof this.constructor)u(t,i);else if(te.isString(t)&&(t=t.trim())&&!(t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim()))(t))u((t=>{const i={};let n,a,c;return t&&t.split("\n").forEach(function(p){c=p.indexOf(":"),n=p.substring(0,c).trim().toLowerCase(),a=p.substring(c+1).trim(),!(!n||i[n]&&Il[n])&&("set-cookie"===n?i[n]?i[n].push(a):i[n]=[a]:i[n]=i[n]?i[n]+", "+a:a)}),i})(t),i);else if(te.isHeaders(t))for(const[p,S]of t.entries())c(S,p,n);else null!=t&&c(i,t,n);return this}get(t,i){if(t=Xi(t)){const n=te.findKey(this,t);if(n){const a=this[n];if(!i)return a;if(!0===i)return function Rl(t){const i=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=n.exec(t);)i[a[1]]=a[2];return i}(a);if(te.isFunction(i))return i.call(this,a,n);if(te.isRegExp(i))return i.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,i){if(t=Xi(t)){const n=te.findKey(this,t);return!(!n||void 0===this[n]||i&&!Pr(0,this[n],n,i))}return!1}delete(t,i){const n=this;let a=!1;function c(u){if(u=Xi(u)){const p=te.findKey(n,u);p&&(!i||Pr(0,n[p],p,i))&&(delete n[p],a=!0)}}return te.isArray(t)?t.forEach(c):c(t),a}clear(t){const i=Object.keys(this);let n=i.length,a=!1;for(;n--;){const c=i[n];(!t||Pr(0,this[c],c,t,!0))&&(delete this[c],a=!0)}return a}normalize(t){const i=this,n={};return te.forEach(this,(a,c)=>{const u=te.findKey(n,c);if(u)return i[u]=In(a),void delete i[c];const p=t?function Nl(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,n,a)=>n.toUpperCase()+a)}(c):String(c).trim();p!==c&&delete i[c],i[p]=In(a),n[p]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const i=Object.create(null);return te.forEach(this,(n,a)=>{null!=n&&!1!==n&&(i[a]=t&&te.isArray(n)?n.join(", "):n)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,i])=>t+": "+i).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...i){const n=new this(t);return i.forEach(a=>n.set(a)),n}static accessor(t){const n=(this[ha]=this[ha]={accessors:{}}).accessors,a=this.prototype;function c(u){const p=Xi(u);n[p]||(function Dl(t,i){const n=te.toCamelCase(" "+i);["get","set","has"].forEach(a=>{Object.defineProperty(t,a+n,{value:function(c,u,p){return this[a].call(this,i,c,u,p)},configurable:!0})})}(a,u),n[p]=!0)}return te.isArray(t)?t.forEach(c):c(t),this}};Tn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),te.reduceDescriptors(Tn.prototype,({value:t},i)=>{let n=i[0].toUpperCase()+i.slice(1);return{get:()=>t,set(a){this[n]=a}}}),te.freezeMethods(Tn);var Kt=Tn;function Fr(t,i){const n=this||Ar,a=i||n,c=Kt.from(a.headers);let u=a.data;return te.forEach(t,function(S){u=S.call(n,u,c.normalize(),i?i.status:void 0)}),c.normalize(),u}function da(t){return!(!t||!t.__CANCEL__)}function fa(t,i,n){Re.call(this,t??"canceled",Re.ERR_CANCELED,i,n),this.name="CanceledError"}U(),U(),te.inherits(fa,Re,{__CANCEL__:!0});var Qi=fa;function pa(t,i,n){const a=n.config.validateStatus;n.status&&a&&!a(n.status)?i(new Re("Request failed with status code "+n.status,[Re.ERR_BAD_REQUEST,Re.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}U(),U(),U(),U(),U(),U();U();var Rn=(t,i,n=3)=>{let a=0;const c=function Bl(t,i){t=t||10;const n=new Array(t),a=new Array(t);let p,c=0,u=0;return i=void 0!==i?i:1e3,function(C){const b=Date.now(),E=a[u];p||(p=b),n[c]=C,a[c]=b;let k=u,q=0;for(;k!==c;)q+=n[k++],k%=t;if(c=(c+1)%t,c===u&&(u=(u+1)%t),b-p<i)return;const V=E&&b-E;return V?Math.round(1e3*q/V):void 0}}(50,250);return function jl(t,i){let c,u,n=0,a=1e3/i;const p=(b,E=Date.now())=>{n=E,c=null,u&&(clearTimeout(u),u=null),t.apply(null,b)};return[(...b)=>{const E=Date.now(),k=E-n;k>=a?p(b,E):(c=b,u||(u=setTimeout(()=>{u=null,p(c)},a-k)))},()=>c&&p(c)]}(u=>{const p=u.loaded,S=u.lengthComputable?u.total:void 0,C=p-a,b=c(C);a=p,t({loaded:p,total:S,progress:S?p/S:void 0,bytes:C,rate:b||void 0,estimated:b&&S&&p<=S?(S-p)/b:void 0,event:u,lengthComputable:null!=S,[i?"download":"upload"]:!0})},n)},va=(t,i)=>{const n=null!=t;return[a=>i[0]({lengthComputable:n,total:t,loaded:a}),i[1]]},ga=t=>(...i)=>te.asap(()=>t(...i));U(),U();var Hl=At.hasStandardBrowserEnv?function(){const i=At.navigator&&/(msie|trident)/i.test(At.navigator.userAgent),n=document.createElement("a");let a;function c(u){let p=u;return i&&(n.setAttribute("href",p),p=n.href),n.setAttribute("href",p),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return a=c(window.location.href),function(p){const S=te.isString(p)?c(p):p;return S.protocol===a.protocol&&S.host===a.host}}():function(){return function(){return!0}}();U();var ql=At.hasStandardBrowserEnv?{write(t,i,n,a,c,u){const p=[t+"="+encodeURIComponent(i)];te.isNumber(n)&&p.push("expires="+new Date(n).toGMTString()),te.isString(a)&&p.push("path="+a),te.isString(c)&&p.push("domain="+c),!0===u&&p.push("secure"),document.cookie=p.join("; ")},read(t){const i=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function ma(t,i){return t&&!function Vl(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}(i)?function Ul(t,i){return i?t.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):t}(t,i):i}U(),U(),U(),U();var ba=t=>t instanceof Kt?re({},t):t;function Si(t,i){i=i||{};const n={};function a(b,E,k){return te.isPlainObject(b)&&te.isPlainObject(E)?te.merge.call({caseless:k},b,E):te.isPlainObject(E)?te.merge({},E):te.isArray(E)?E.slice():E}function c(b,E,k){return te.isUndefined(E)?te.isUndefined(b)?void 0:a(void 0,b,k):a(b,E,k)}function u(b,E){if(!te.isUndefined(E))return a(void 0,E)}function p(b,E){return te.isUndefined(E)?te.isUndefined(b)?void 0:a(void 0,b):a(void 0,E)}function S(b,E,k){return k in i?a(b,E):k in t?a(void 0,b):void 0}const C={url:u,method:u,data:u,baseURL:p,transformRequest:p,transformResponse:p,paramsSerializer:p,timeout:p,timeoutMessage:p,withCredentials:p,withXSRFToken:p,adapter:p,responseType:p,xsrfCookieName:p,xsrfHeaderName:p,onUploadProgress:p,onDownloadProgress:p,decompress:p,maxContentLength:p,maxBodyLength:p,beforeRedirect:p,transport:p,httpAgent:p,httpsAgent:p,cancelToken:p,socketPath:p,responseEncoding:p,validateStatus:S,headers:(b,E)=>c(ba(b),ba(E),!0)};return te.forEach(Object.keys(Object.assign({},t,i)),function(E){const k=C[E]||c,q=k(t[E],i[E],E);te.isUndefined(q)&&k!==S||(n[E]=q)}),n}var ya=t=>{const i=Si({},t);let C,{data:n,withXSRFToken:a,xsrfHeaderName:c,xsrfCookieName:u,headers:p,auth:S}=i;if(i.headers=p=Kt.from(p),i.url=aa(ma(i.baseURL,i.url),t.params,t.paramsSerializer),S&&p.set("Authorization","Basic "+btoa((S.username||"")+":"+(S.password?unescape(encodeURIComponent(S.password)):""))),te.isFormData(n))if(At.hasStandardBrowserEnv||At.hasStandardBrowserWebWorkerEnv)p.setContentType(void 0);else if(!1!==(C=p.getContentType())){const[b,...E]=C?C.split(";").map(k=>k.trim()).filter(Boolean):[];p.setContentType([b||"multipart/form-data",...E].join("; "))}if(At.hasStandardBrowserEnv&&(a&&te.isFunction(a)&&(a=a(i)),a||!1!==a&&Hl(i.url))){const b=c&&u&&ql.read(u);b&&p.set(c,b)}return i},Wl=typeof XMLHttpRequest<"u"&&function(t){return new Promise(function(n,a){const c=ya(t);let u=c.data;const p=Kt.from(c.headers).normalize();let E,k,q,V,F,{responseType:S,onUploadProgress:C,onDownloadProgress:b}=c;function O(){V&&V(),F&&F(),c.cancelToken&&c.cancelToken.unsubscribe(E),c.signal&&c.signal.removeEventListener("abort",E)}let G=new XMLHttpRequest;function se(){if(!G)return;const Z=Kt.from("getAllResponseHeaders"in G&&G.getAllResponseHeaders());pa(function(pe){n(pe),O()},function(pe){a(pe),O()},{data:S&&"text"!==S&&"json"!==S?G.response:G.responseText,status:G.status,statusText:G.statusText,headers:Z,config:t,request:G}),G=null}G.open(c.method.toUpperCase(),c.url,!0),G.timeout=c.timeout,"onloadend"in G?G.onloadend=se:G.onreadystatechange=function(){!G||4!==G.readyState||0===G.status&&(!G.responseURL||0!==G.responseURL.indexOf("file:"))||setTimeout(se)},G.onabort=function(){G&&(a(new Re("Request aborted",Re.ECONNABORTED,t,G)),G=null)},G.onerror=function(){a(new Re("Network Error",Re.ERR_NETWORK,t,G)),G=null},G.ontimeout=function(){let ie=c.timeout?"timeout of "+c.timeout+"ms exceeded":"timeout exceeded";c.timeoutErrorMessage&&(ie=c.timeoutErrorMessage),a(new Re(ie,(c.transitional||ca).clarifyTimeoutError?Re.ETIMEDOUT:Re.ECONNABORTED,t,G)),G=null},void 0===u&&p.setContentType(null),"setRequestHeader"in G&&te.forEach(p.toJSON(),function(ie,he){G.setRequestHeader(he,ie)}),te.isUndefined(c.withCredentials)||(G.withCredentials=!!c.withCredentials),S&&"json"!==S&&(G.responseType=c.responseType),b&&([q,F]=Rn(b,!0),G.addEventListener("progress",q)),C&&G.upload&&([k,V]=Rn(C),G.upload.addEventListener("progress",k),G.upload.addEventListener("loadend",V)),(c.cancelToken||c.signal)&&(E=Z=>{G&&(a(!Z||Z.type?new Qi(null,t,G):Z),G.abort(),G=null)},c.cancelToken&&c.cancelToken.subscribe(E),c.signal&&(c.signal.aborted?E():c.signal.addEventListener("abort",E)));const ce=function Ol(t){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return i&&i[1]||""}(c.url);ce&&-1===At.protocols.indexOf(ce)?a(new Re("Unsupported protocol "+ce+":",Re.ERR_BAD_REQUEST,t)):G.send(u||null)})};U(),U();var $l=(t,i)=>{const{length:n}=t=t?t.filter(Boolean):[];if(i||n){let c,a=new AbortController;const u=function(b){if(!c){c=!0,S();const E=b instanceof Error?b:this.reason;a.abort(E instanceof Re?E:new Qi(E instanceof Error?E.message:E))}};let p=i&&setTimeout(()=>{p=null,u(new Re(`timeout ${i} of ms exceeded`,Re.ETIMEDOUT))},i);const S=()=>{t&&(p&&clearTimeout(p),p=null,t.forEach(b=>{b.unsubscribe?b.unsubscribe(u):b.removeEventListener("abort",u)}),t=null)};t.forEach(b=>b.addEventListener("abort",u));const{signal:C}=a;return C.unsubscribe=()=>te.asap(S),C}};U();var Gl=function*(t,i){let n=t.byteLength;if(!i||n<i)return void(yield t);let c,a=0;for(;a<n;)c=a+i,yield t.slice(a,c),a=c},Xl=function(t){return Cs(this,null,function*(){if(t[Symbol.asyncIterator])return void(yield*As(t));const i=t.getReader();try{for(;;){const{done:n,value:a}=yield new Ri(i.read());if(n)break;yield a}}finally{yield new Ri(i.cancel())}})},Sa=(t,i,n,a)=>{const c=function(t,i){return Cs(this,null,function*(){try{for(var a,c,u,n=((t,i,n)=>(i=t[zi("asyncIterator")])?i.call(t):(t=t[zi("iterator")](),i={},(n=(a,c)=>(c=t[a])&&(i[a]=u=>new Promise((p,S,C)=>(u=c.call(t,u),C=u.done,Promise.resolve(u.value).then(b=>p({value:b,done:C}),S)))))("next"),n("return"),i))(Xl(t));a=!(c=yield new Ri(n.next())).done;a=!1){const p=c.value;yield*As(Gl(p,i))}}catch(p){u=[p]}finally{try{a&&(c=n.return)&&(yield new Ri(c.call(n)))}finally{if(u)throw u[0]}}})}(t,i);let p,u=0,S=C=>{p||(p=!0,a&&a(C))};return new ReadableStream({pull(C){return K(this,null,function*(){try{const{done:b,value:E}=yield c.next();if(b)return S(),void C.close();if(n){let q=u+=E.byteLength;n(q)}C.enqueue(new Uint8Array(E))}catch(b){throw S(b),b}})},cancel:C=>(S(C),c.return())},{highWaterMark:2})},kn="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,wa=kn&&"function"==typeof ReadableStream,Ql=kn&&("function"==typeof TextEncoder?(t=>i=>t.encode(i))(new TextEncoder):t=>K(void 0,null,function*(){return new Uint8Array(yield new Response(t).arrayBuffer())})),_a=(t,...i)=>{try{return!!t(...i)}catch{return!1}},Yl=wa&&_a(()=>{let t=!1;const i=new Request(At.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!i}),Ir=wa&&_a(()=>te.isReadableStream(new Response("").body)),Nn={stream:Ir&&(t=>t.body)};kn&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(i=>{!Nn[i]&&(Nn[i]=te.isFunction(t[i])?n=>n[i]():(n,a)=>{throw new Re(`Response type '${i}' is not supported`,Re.ERR_NOT_SUPPORT,a)})})})(new Response);var th=kn&&(t=>K(void 0,null,function*(){let{url:i,method:n,data:a,signal:c,cancelToken:u,timeout:p,onDownloadProgress:S,onUploadProgress:C,responseType:b,headers:E,withCredentials:k="same-origin",fetchOptions:q}=ya(t);b=b?(b+"").toLowerCase():"text";let F,V=$l([c,u&&u.toAbortSignal()],p);const O=V&&V.unsubscribe&&(()=>{V.unsubscribe()});let G;try{if(C&&Yl&&"get"!==n&&"head"!==n&&0!==(G=yield((t,i)=>K(void 0,null,function*(){return te.toFiniteNumber(t.getContentLength())??(t=>K(void 0,null,function*(){return null==t?0:te.isBlob(t)?t.size:te.isSpecCompliantForm(t)?(yield new Request(At.origin,{method:"POST",body:t}).arrayBuffer()).byteLength:te.isArrayBufferView(t)||te.isArrayBuffer(t)?t.byteLength:(te.isURLSearchParams(t)&&(t+=""),te.isString(t)?(yield Ql(t)).byteLength:void 0)}))(i)}))(E,a))){let fe,he=new Request(i,{method:"POST",body:a,duplex:"half"});if(te.isFormData(a)&&(fe=he.headers.get("content-type"))&&E.setContentType(fe),he.body){const[pe,me]=va(G,Rn(ga(C)));a=Sa(he.body,65536,pe,me)}}te.isString(k)||(k=k?"include":"omit");const se="credentials"in Request.prototype;F=new Request(i,ae(re({},q),{signal:V,method:n.toUpperCase(),headers:E.normalize().toJSON(),body:a,duplex:"half",credentials:se?k:void 0}));let ce=yield fetch(F);const Z=Ir&&("stream"===b||"response"===b);if(Ir&&(S||Z&&O)){const he={};["status","statusText","headers"].forEach(Ce=>{he[Ce]=ce[Ce]});const fe=te.toFiniteNumber(ce.headers.get("content-length")),[pe,me]=S&&va(fe,Rn(ga(S),!0))||[];ce=new Response(Sa(ce.body,65536,pe,()=>{me&&me(),O&&O()}),he)}b=b||"text";let ie=yield Nn[te.findKey(Nn,b)||"text"](ce,t);return!Z&&O&&O(),yield new Promise((he,fe)=>{pa(he,fe,{data:ie,headers:Kt.from(ce.headers),status:ce.status,statusText:ce.statusText,config:t,request:F})})}catch(se){throw O&&O(),se&&"TypeError"===se.name&&/fetch/i.test(se.message)?Object.assign(new Re("Network Error",Re.ERR_NETWORK,t,F),{cause:se.cause||se}):Re.from(se,se&&se.code,t,F)}})),Tr={http:null,xhr:Wl,fetch:th};te.forEach(Tr,(t,i)=>{if(t){try{Object.defineProperty(t,"name",{value:i})}catch{}Object.defineProperty(t,"adapterName",{value:i})}});var Ea=t=>`- ${t}`,ih=t=>te.isFunction(t)||null===t||!1===t,Ca_getAdapter=t=>{t=te.isArray(t)?t:[t];const{length:i}=t;let n,a;const c={};for(let u=0;u<i;u++){let p;if(n=t[u],a=n,!ih(n)&&(a=Tr[(p=String(n)).toLowerCase()],void 0===a))throw new Re(`Unknown adapter '${p}'`);if(a)break;c[p||"#"+u]=a}if(!a){const u=Object.entries(c).map(([S,C])=>`adapter ${S} `+(!1===C?"is not supported by the environment":"is not available in the build"));let p=i?u.length>1?"since :\n"+u.map(Ea).join("\n"):" "+Ea(u[0]):"as no adapter specified";throw new Re("There is no suitable adapter to dispatch the request "+p,"ERR_NOT_SUPPORT")}return a};function Rr(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Qi(null,t)}function Aa(t){return Rr(t),t.headers=Kt.from(t.headers),t.data=Fr.call(t,t.transformRequest),-1!==["post","put","patch"].indexOf(t.method)&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Ca_getAdapter(t.adapter||Ar.adapter)(t).then(function(a){return Rr(t),a.data=Fr.call(t,t.transformResponse,a),a.headers=Kt.from(a.headers),a},function(a){return da(a)||(Rr(t),a&&a.response&&(a.response.data=Fr.call(t,t.transformResponse,a.response),a.response.headers=Kt.from(a.response.headers))),Promise.reject(a)})}U(),U();var kr={};["object","boolean","number","function","string","symbol"].forEach((t,i)=>{kr[t]=function(a){return typeof a===t||"a"+(i<1?"n ":" ")+t}});var Fa={};kr.transitional=function(i,n,a){function c(u,p){return"[Axios v1.7.7] Transitional option '"+u+"'"+p+(a?". "+a:"")}return(u,p,S)=>{if(!1===i)throw new Re(c(p," has been removed"+(n?" in "+n:"")),Re.ERR_DEPRECATED);return n&&!Fa[p]&&(Fa[p]=!0,console.warn(c(p," has been deprecated since v"+n+" and will be removed in the near future"))),!i||i(u,p,S)}};var Nr={assertOptions:function nh(t,i,n){if("object"!=typeof t)throw new Re("options must be an object",Re.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let c=a.length;for(;c-- >0;){const u=a[c],p=i[u];if(p){const S=t[u],C=void 0===S||p(S,u,t);if(!0!==C)throw new Re("option "+u+" must be "+C,Re.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new Re("Unknown option "+u,Re.ERR_BAD_OPTION)}},validators:kr},di=Nr.validators,Dn=class{constructor(t){this.defaults=t,this.interceptors={request:new oa,response:new oa}}request(t,i){return K(this,null,function*(){try{return yield this._request(t,i)}catch(n){if(n instanceof Error){let a;Error.captureStackTrace?Error.captureStackTrace(a={}):a=new Error;const c=a.stack?a.stack.replace(/^.+\n/,""):"";try{n.stack?c&&!String(n.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+c):n.stack=c}catch{}}throw n}})}_request(t,i){"string"==typeof t?(i=i||{}).url=t:i=t||{},i=Si(this.defaults,i);const{transitional:n,paramsSerializer:a,headers:c}=i;void 0!==n&&Nr.assertOptions(n,{silentJSONParsing:di.transitional(di.boolean),forcedJSONParsing:di.transitional(di.boolean),clarifyTimeoutError:di.transitional(di.boolean)},!1),null!=a&&(te.isFunction(a)?i.paramsSerializer={serialize:a}:Nr.assertOptions(a,{encode:di.function,serialize:di.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let u=c&&te.merge(c.common,c[i.method]);c&&te.forEach(["delete","get","head","post","put","patch","common"],V=>{delete c[V]}),i.headers=Kt.concat(u,c);const p=[];let S=!0;this.interceptors.request.forEach(function(F){"function"==typeof F.runWhen&&!1===F.runWhen(i)||(S=S&&F.synchronous,p.unshift(F.fulfilled,F.rejected))});const C=[];this.interceptors.response.forEach(function(F){C.push(F.fulfilled,F.rejected)});let b,k,E=0;if(!S){const V=[Aa.bind(this),void 0];for(V.unshift.apply(V,p),V.push.apply(V,C),k=V.length,b=Promise.resolve(i);E<k;)b=b.then(V[E++],V[E++]);return b}k=p.length;let q=i;for(E=0;E<k;){const V=p[E++],F=p[E++];try{q=V(q)}catch(O){F.call(this,O);break}}try{b=Aa.call(this,q)}catch(V){return Promise.reject(V)}for(E=0,k=C.length;E<k;)b=b.then(C[E++],C[E++]);return b}getUri(t){return aa(ma((t=Si(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};te.forEach(["delete","get","head","options"],function(i){Dn.prototype[i]=function(n,a){return this.request(Si(a||{},{method:i,url:n,data:(a||{}).data}))}}),te.forEach(["post","put","patch"],function(i){function n(a){return function(u,p,S){return this.request(Si(S||{},{method:i,headers:a?{"Content-Type":"multipart/form-data"}:{},url:u,data:p}))}}Dn.prototype[i]=n(),Dn.prototype[i+"Form"]=n(!0)});var On=Dn;U();U(),U(),U();var Dr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Dr).forEach(([t,i])=>{Dr[i]=t});var ch=Dr,ot=function Ia(t){const i=new On(t),n=qs(On.prototype.request,i);return te.extend(n,On.prototype,i,{allOwnKeys:!0}),te.extend(n,i,null,{allOwnKeys:!0}),n.create=function(c){return Ia(Si(t,c))},n}(Ar);ot.Axios=On,ot.CanceledError=Qi,ot.CancelToken=class Lo{constructor(i){if("function"!=typeof i)throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(u){n=u});const a=this;this.promise.then(c=>{if(!a._listeners)return;let u=a._listeners.length;for(;u-- >0;)a._listeners[u](c);a._listeners=null}),this.promise.then=c=>{let u;const p=new Promise(S=>{a.subscribe(S),u=S}).then(c);return p.cancel=function(){a.unsubscribe(u)},p},i(function(u,p,S){a.reason||(a.reason=new Qi(u,p,S),n(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){this.reason?i(this.reason):this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const n=this._listeners.indexOf(i);-1!==n&&this._listeners.splice(n,1)}toAbortSignal(){const i=new AbortController,n=a=>{i.abort(a)};return this.subscribe(n),i.signal.unsubscribe=()=>this.unsubscribe(n),i.signal}static source(){let i;return{token:new Lo(function(c){i=c}),cancel:i}}},ot.isCancel=da,ot.VERSION="1.7.7",ot.toFormData=Fn,ot.AxiosError=Re,ot.Cancel=ot.CanceledError,ot.all=function(i){return Promise.all(i)},ot.spread=function ah(t){return function(n){return t.apply(null,n)}},ot.isAxiosError=function oh(t){return te.isObject(t)&&!0===t.isAxiosError},ot.mergeConfig=Si,ot.AxiosHeaders=Kt,ot.formToJSON=t=>la(te.isHTMLForm(t)?new FormData(t):t),ot.getAdapter=Ca_getAdapter,ot.HttpStatusCode=ch,ot.default=ot;var Oi=ot,Wt=new _e("packages/common/src/http.ts"),Ta=class{constructor(t){this.api=Oi.create({baseURL:t})}get(t,i){return K(this,null,function*(){const n=yield this.api.get(t,i).catch(a=>a);if(Oi.isAxiosError(n)){const a=ae(re({},n.response),{message:n.message});if(i?.retry){if(yield i.retry(a))return Wt.warn("retry get",{url:t}),this.get(t,i);throw Wt.warn("retry get failed",{url:t}),a}throw Wt.warn("response error",{error:a}),a}return n.data})}post(t,i,n){return K(this,null,function*(){var a,c,u;const p=yield this.api.post(t,i,n).catch(S=>S);if(Oi.isAxiosError(p)){const S={data:null==(a=p.response)?void 0:a.data,status:null==(c=p.response)?void 0:c.status,statusText:null==(u=p.response)?void 0:u.statusText,message:p.message};if(Wt.warn("error received",S),n?.retry){const C=yield n.retry(S);if(C)return Wt.warn("retry post",t,{data:i,error:S,needRetry:C}),this.post(t,i,n);throw S}throw S}return p.data})}put(t,i,n){return K(this,null,function*(){const a=yield this.api.put(t,i,n).catch(c=>c);if(Oi.isAxiosError(a)){const c=ae(re({},a.response),{message:a.message});if(n?.retry){if(yield n.retry(c))return Wt.warn("retry put",{url:t,data:i}),this.put(t,i,n);throw Wt.warn("retry put failed",{url:t,data:i}),c}throw Wt.warn("response error",{error:c}),c}return a.data})}delete(t,i){return K(this,null,function*(){const n=yield this.api.delete(t,i).catch(a=>a);if(Oi.isAxiosError(n)){const a=ae(re({},n.response),{message:n.message});if(i?.retry){if(yield i.retry(a))return Wt.warn("retry delete",{url:t}),this.delete(t,i);throw Wt.warn("retry delete failed",{url:t}),a}throw Wt.warn("response error",{error:a}),a}return n.data})}};U();var uh=new _e("packages/common/src/promise.ts"),wi=class{constructor(){this.id=Math.random().toString().slice(2),this.queue=[],this.running=!1,this.push=t=>new Promise((i,n)=>{this.queue.push({promise:t,done:i,failed:n}),this.running||this.run().catch(a=>{uh.error("push",a)})})}run(){return K(this,null,function*(){const t=this.queue.shift();if(t){this.running=!0;try{const i=yield t.promise();t.done(i)}catch(i){t.failed(i)}yield this.run()}else this.running=!1})}};U();var Yi=class{constructor(t={}){this.count=0,this.times=8,this.interval=100,this.jitter=0,Object.assign(this,t)}wait(){return K(this,null,function*(){if(this.exceeded)return!1;const t=this.timeout;return this.count++,yield new Promise(i=>setTimeout(i,t)),!0})}get timeout(){return ui(this.count,2)*this.interval+ui(this.count,2)*this.jitter*Math.random()}get exceeded(){return this.count>=this.times}reset(){this.count=0}};U();var de={internal:{name:"internal",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},missingProperty:{name:"missingProperty",detail:"",solution:""},notFound:{name:"notFound",detail:"",solution:""},invalidParameter:{name:"invalidParameter",detail:"",solution:""},invalidArgumentValue:{name:"invalidArgumentValue",detail:"\u5f15\u6570\u306e\u5024\u304c\u4e0d\u6b63\u3067\u3059",solution:"\u6b63\u3057\u3044\u5024\u3092\u5f15\u6570\u306b\u6e21\u3057\u3066\u304f\u3060\u3055\u3044"},invalidContentType:{name:"invalidContentType",detail:"contentType\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093",solution:"ContentType\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044"},localPersonNotJoinedChannel:{name:"localPersonNotJoinedChannel",detail:"\u64cd\u4f5c\u3057\u3088\u3046\u3068\u3057\u305fPerson\u304cChannel\u306b\u5c45\u306a\u3044\u306e\u3067\u3001\u64cd\u4f5c\u3067\u304d\u307e\u305b\u3093 The person who tried to operate is not in the channel, so the operation is not possible",solution:"Channel\u306b\u5c45\u306a\u3044Person\u3092\u64cd\u4f5c\u3057\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u306e\u3067\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044 Please check as you may be operating a person which is not in the channel"},alreadyLocalPersonExist:{name:"alreadyLocalPersonExist",detail:"Channel\u306b\u3059\u3067\u306bLocalPerson\u304c\u5b58\u5728\u3057\u307e\u3059\u3002\u4e00\u3064\u306eChannel\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u306fLocalPerson\u304c\u4e00\u3064\u3057\u304bJoin\u3067\u304d\u307e\u305b\u3093",solution:"\u8907\u6570\u306eLocalPerson\u3092\u7528\u610f\u3057\u305f\u3044\u5834\u5408\u306f\u500b\u5225\u306bChannel\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7528\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},alreadySameNameMemberExist:{name:"alreadySameNameMemberExist",detail:"Channel\u306b\u3059\u3067\u306b\u540c\u3058Name\u306eMember\u304c\u5b58\u5728\u3057\u307e\u3059",solution:"\u5225\u306eName\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044"},alreadyPublishedStream:{name:"alreadyPublishedStream",detail:"\u3059\u3067\u306bPublish\u3057\u305fStream\u3092\u518d\u5ea6Publish\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093 You cannot re-publish a stream that has already been published",solution:"\u305d\u306eStream\u3092Publish\u3057\u305fPublication\u3092Unpublish\u3059\u308b\u304b\u3001\u5225\u306e\u65b0\u3057\u3044Stream\u3092\u4f5c\u3063\u3066Publish\u3057\u3066\u304f\u3060\u3055\u3044 Unpublish the publication that published that stream, or create another new stream and publish it"},alreadySubscribedPublication:{name:"alreadySubscribedPublication",detail:"\u3059\u3067\u306bSubscribe\u3057\u305fPublication\u3092Subscribe\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093",solution:"\u3042\u308a\u307e\u305b\u3093"},invalidTrackKind:{name:"invalidTrackKind",detail:"Stream\u306e\u7a2e\u985e\u3068MediaStreamTrack\u306e\u7a2e\u985e\u304c\u4e00\u81f4\u3057\u307e\u305b\u3093",solution:"Stream\u306e\u7a2e\u985e\u3068\u540c\u3058MediaStreamTrack\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044"},cantMoveSameIdChannel:{name:"cantMoveSameIdChannel",detail:"moveChannel\u3067\u540c\u3058id\u306eChannel\u306b\u79fb\u52d5\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093",solution:"\u79fb\u52d5\u5148\u306eChannel\u304c\u6b63\u3057\u3044\u304b\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044"},alreadyChannelClosed:{name:"alreadyChannelClosed",detail:"Channel\u304c\u3059\u3067\u306bClose\u3055\u308c\u3066\u3044\u307e\u3059",solution:"\u3042\u308a\u307e\u305b\u3093"},disabledDataStream:{name:"disabledDataStream",detail:"\u95a2\u9023\u3059\u308bPublication\u304cDisable\u306aDataStream\u306b\u306f\u66f8\u304d\u8fbc\u307f\u3067\u304d\u307e\u305b\u3093",solution:"\u95a2\u9023\u3059\u308bPublication\u3092Enable\u3057\u3066\u304b\u3089\u66f8\u304d\u8fbc\u3093\u3067\u304f\u3060\u3055\u3044"},publicationNotExist:{name:"publicationNotExist",detail:"channel\u306b\u8a72\u5f53\u3059\u308bPublication\u304c\u5b58\u5728\u3057\u307e\u305b\u3093",solution:"publicationId\u304c\u6b63\u3057\u3044\u304b\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044"},subscriptionNotExist:{name:"subscriptionNotExist",detail:"channel\u306b\u8a72\u5f53\u3059\u308bSubscription\u304c\u5b58\u5728\u3057\u307e\u305b\u3093",solution:"subscriptionId\u304c\u6b63\u3057\u3044\u304b\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044"},unknownMemberType:{name:"unknownMemberType",detail:"\u5bfe\u8c61\u306eMember\u306eSubtype\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093",solution:"\u5bfe\u8c61\u306eMember\u306eSubtype\u306e\u30d7\u30e9\u30b0\u30a4\u30f3(SfuBot\u306a\u3069)\u3092SkyWayContext\u306b\u767b\u9332\u3057\u3066\u304f\u3060\u3055\u3044"},streamNotExistInSubscription:{name:"streamNotExistInSubscription",detail:"Subscription\u306bStream\u304c\u3042\u308a\u307e\u305b\u3093\u3002RemoteMember\u306eSubscription\u306eStream\u306b\u306f\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093",solution:"\u53c2\u7167\u3057\u3066\u3044\u308bSubscription\u304c\u76ee\u7684\u306e\u3082\u306e\u304b\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044\u3002"},streamNotExistInPublication:{name:"streamNotExistInPublication",detail:"Publication\u306bStream\u304c\u3042\u308a\u307e\u305b\u3093\u3002RemoteMember\u306ePublication\u306eStream\u306b\u306f\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093",solution:"\u53c2\u7167\u3057\u3066\u3044\u308bPublication\u304c\u76ee\u7684\u306e\u3082\u306e\u304b\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044\u3002"},dataStreamNotSupportEncoding:{name:"dataStreamNotSupportEncoding",detail:"dataStream\u306fEncode\u8a2d\u5b9a\u306e\u5909\u66f4\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u305b\u3093",solution:"\u3042\u308a\u307e\u305b\u3093"},correspondingEncodeNotExistForId:{name:"correspondingEncodeNotExistForId",detail:"\u6307\u5b9a\u3055\u308c\u305fID\u306b\u5bfe\u5fdc\u3059\u308bEncode\u8a2d\u5b9a\u304c\u5b58\u5728\u3057\u307e\u305b\u3093",solution:"\u6b63\u3057\u3044EncodingID\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044"},updateIceParamsFailed:{name:"updateIceParamsFailed",detail:"iceParams\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f",solution:"\u3042\u308a\u307e\u305b\u3093"},invalidElement:{name:"invalidElement",detail:"\u6e21\u3055\u308c\u305fHTML Element\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093",solution:"\u8981\u6c42\u3055\u308c\u305f\u6b63\u3057\u3044Element\u3092\u6e21\u3057\u3066\u304f\u3060\u3055\u3044"},connectRtcApiFailed:{name:"connectRtcApiFailed",detail:"RtcAPI\u3078\u306e\u63a5\u7d9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f",solution:"\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u63a5\u7d9a\u3067\u304d\u3066\u3044\u308b\u304b\u3001\u3082\u3057\u304f\u306fToken\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u6b63\u3057\u3044\u304b\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044"},rtcApiFatalError:{name:"rtcApiFatalError",detail:"RtcAPI\u306e\u56de\u5fa9\u4e0d\u80fd\u306a\u30a8\u30e9\u30fc\u3067\u3059\u3002\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u554f\u984c\u306e\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059",solution:"\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u63a5\u7d9a\u304c\u51fa\u6765\u3066\u3044\u308b\u304b\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044"},invalidExpireTokenValue:{name:"invalidExpireTokenValue",detail:"token\u306eExpire\u6642\u523b\u304c\u4e0d\u6b63\u3067\u3059",solution:"\u6b63\u3057\u3044\u6642\u523b\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044"},invalidRemindExpireTokenValue:{name:"invalidRemindExpireTokenValue",detail:"token\u306eExpire\u3092\u30ea\u30de\u30a4\u30f3\u30c9\u3059\u308b\u6642\u9593\u306e\u5024\u304c\u4e0d\u6b63\u3067\u3059",solution:"\u6b63\u3057\u3044\u6642\u9593\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044"},invalidTokenAppId:{name:"invalidTokenAppId",detail:"token\u306eappId\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093",solution:"\u6b63\u3057\u3044appId\u3092\u542b\u3080Token\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044"},mediaDevicesNotFound:{name:"mediaDevicesNotFound",detail:"navigator.mediaDevices\u304c\u307f\u3064\u304b\u308a\u307e\u305b\u3093",solution:"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092https,localhost,127.0.0.1\u306e\u3044\u305a\u308c\u304b\u306e\u74b0\u5883\u3067\u52d5\u4f5c\u3055\u305b\u3066\u304f\u3060\u3055\u3044"},canNotUseReplaceStream:{name:"canNotUseReplaceStream",detail:"remote\u306ePublication\u304b\u3089replaceStream\u3067\u304d\u307e\u305b\u3093",solution:"\u5bfe\u8c61\u306ePublication\u304cLocal\u306e\u3082\u306e\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044"},canNotEnableRemotePublication:{name:"canNotEnableRemotePublication",detail:"remote\u306ePublication\u3092enable\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093",solution:"\u5bfe\u8c61\u306ePublication\u304cLocal\u306e\u3082\u306e\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044"}};U(),U(),U();var hh=jt(ac()),fh=(jt(pr()),jt(uc()));function Bn(t){const i=[];return t.forEach(n=>{i.push(n)}),i}function je(t){return K(this,arguments,function*({operationName:i,channel:n}){const a={operationName:i,appId:n.appId,channelId:n.id};if(n.localPerson){const c=n.localPerson,u=yield Promise.all(c.publications.map(S=>K(this,null,function*(){var C,b,E;const k={id:S.id,contentType:S.contentType,state:S.state,stats:{},connectionStats:{}};if(S.stream)for(const{memberId:q,stats:V}of yield S.stream._getStatsAll()){const F=V.find(O=>O.type.includes("local-candidate"));k.stats[q]={transportType:null!=(C=F?.protocol)?C:"none",relayProtocol:null!=(b=F?.relayProtocol)?b:"none",callType:null==(E=S.subscriptions.find(O=>O.subscriber.id===q))?void 0:E.subscriber.subtype,outbound:V.find(O=>O.type.includes("outbound-rtp")),localCandidate:F}}if(S.stream)for(const{memberId:q,connectionState:V}of S.stream._getConnectionStateAll())k.connectionStats[q]=V;return k})));a.publishing=u;const p=yield Promise.all(c.subscriptions.map(S=>K(this,null,function*(){const C={id:S.id,contentType:S.contentType,stats:{}};if(C.callType=S.publication.publisher.subtype,S.stream){const b=yield S.stream.getStats();C.stats=b.find(k=>k.type.includes("inbound-rtp"));const E=b.find(k=>k.type.includes("local-candidate"));C.transportType=E?.protocol,C.relayProtocol=E?.relayProtocol}return S.stream&&(C.connectionState=S.stream.getConnectionState()),C})));a.subscribing=p}return a})}function ct({member:t,detail:i,channel:n,operationName:a,payload:c}){const u={operationName:a,payload:c,detail:i};return t&&(u.appId=t.channel.appId,u.channelId=t.channel.id,u.memberId=t.id),n&&(u.appId=n.appId,u.channelId=n.id),u}function le({operationName:t,context:i,info:n,error:a,path:c,payload:u,channel:p}){const S={operationName:t,payload:u};return p&&(S.appId=p.appId,S.channelId=p.id,p.localPerson&&(S.memberId=p.localPerson.id)),i&&(S.info=i.info,S.plugins=i.plugins.map(C=>C.subtype)),new li({error:a,info:n,payload:S,path:c})}new _e("packages/core/src/util.ts");var Or=(t,i)=>{var n,a;return Ra(null!=(a=null==(n=t.find(c=>c.payload===i))?void 0:n.config)?a:"")},Ra=t=>t.split(";").reduce((n,a)=>{const[c,u]=a.split("=");return c&&(n[c]=Number(u),"profile-level-id"===c&&(n[c]=u)),n},{});function ka(){var t,i,n,a,c,u,p,S;if("object"==typeof navigator&&"ReactNative"===navigator.product)return typeof RTCPeerConnection>"u"?void 0:typeof RTCRtpTransceiver<"u"?"ReactNativeUnifiedPlan":"ReactNative";if("object"!=typeof navigator||"string"!=typeof navigator.userAgent);else{const C=navigator.userAgent,b=new fh.UAParser(C),E=b.getBrowser(),k=null!=(i=null==(t=E.name)?void 0:t.toLowerCase())?i:"",q=parseInt(null!=(n=E.major)?n:"0"),F=null!=(c=null==(a=b.getEngine().name)?void 0:a.toLowerCase())?c:"",O=b.getOS(),G=null!=(p=null==(u=O.name)?void 0:u.toLowerCase())?p:"",se=parseFloat(null!=(S=O.version)?S:"0"),ce="ios"===G,Z=["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(k),ie=["firefox","mobile firefox","mobile focus"].includes(k),he=["safari","mobile safari"].includes(k),fe=["edge"].includes(k);if((Z||fe)&&!ce&&q>=111)return"Chrome111";if(Z&&!ce&&q>=74||fe&&!ce&&q>=88)return"Chrome74";if(Z&&!ce&&q>=70)return"Chrome70";if(Z&&!ce&&q>=67)return"Chrome67";if(Z&&!ce&&q>=55)return"Chrome55";if(ie&&!ce&&q>=60)return"Firefox60";if(ie&&ce&&se>=14.3)return"Safari12";if(he&&q>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(he&&q>=11)return"Safari11";if(fe&&!ce&&q>=11&&q<=18)return"Edge11";if("webkit"===F&&ce&&se>=14.3&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if("blink"===F){const pe=C.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(pe){const me=Number(pe[1]);return me>=111?"Chrome111":me>=74?"Chrome74":me>=70?"Chrome70":me>=67?"Chrome67":"Chrome55"}return"Chrome111"}}}var Br=new _e("packages/core/src/member/index.ts"),Mr=class{constructor(t){this._state="joined",this._events=new hi,this.onLeft=this._events.make(),this.onMetadataUpdated=this._events.make(),this.channel=t.channel,this.id=t.id,this.name=t.name,this._metadata=t.metadata,this.context=t.context}get metadata(){return this._metadata}get state(){return this._state}get publications(){return this.channel.publications.filter(t=>t.publisher.id===this.id)}get subscriptions(){return this.channel.subscriptions.filter(t=>t.subscriber.id===this.id)}toJSON(){return{id:this.id,name:this.name,type:this.type,subtype:this.subtype,metadata:this.metadata}}_left(){this._state="left",this.onLeft.emit(),this._events.dispose()}_metadataUpdated(t){this._metadata=t,this.onMetadataUpdated.emit(t)}updateMetadata(t){return K(this,null,function*(){yield this.channel._updateMemberMetadata(this.id,t)})}leave(){return K(this,null,function*(){const t=Br.info("[start] leave",yield je({operationName:"localPerson.leave",channel:this.channel}));if("left"===this.state)throw le({operationName:"localPerson.leave",info:de.localPersonNotJoinedChannel,path:Br.prefix,context:this.context,channel:this.channel});yield this.channel.leave(this),Br.elapsed(t,"[end] leave")})}};U(),U();var Mn=new _e("packages/core/src/plugin/internal/unknown/connection.ts"),gh=class{constructor(t,i){this.localPerson=t,this.remoteMember=i,this.type="unknown",this.onDisconnect=new Fe,this.onClose=new Fe,this.closed=!1}close(){this.closed=!0,this.onClose.emit()}startPublishing(t){return K(this,null,function*(){Mn.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{publication:t})})}stopPublishing(t){return K(this,null,function*(){Mn.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{publication:t})})}startSubscribing(t){return K(this,null,function*(){Mn.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{subscription:t})})}stopSubscribing(t){return K(this,null,function*(){Mn.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{subscription:t})})}},Na=class extends Mr{constructor(t){super(t),this.type="bot",this.side="remote",this._connections={},this.plugin=t.plugin,this.subtype=t.subtype}_getConnection(t){return this._connections[t]}_getOrCreateConnection(t){var i;return null!=(i=this._getConnection(t.id))?i:this._createConnection(t,this)}_createConnection(t,i){return new gh(t,i)}_dispose(){}};U(),U(),U(),U(),U(),U();var Da=new _e("packages/core/src/media/stream/base.ts");function Oa(t,i){var n;if(void 0===(null==(n=t??{})?void 0:n.srcObject))throw le({operationName:"attachElement",info:de.invalidElement,payload:{element:t},path:Da.prefix});if(t.srcObject){const a=t.srcObject,c=a.getTracks().find(p=>"ended"===p.readyState);c&&a.removeTrack(c);const u=a.getTracks().find(p=>p.kind===i.kind);u&&a.removeTrack(u),a.addTrack(i)}else t.srcObject=new MediaStream([i])}function Ba(t,i){var n;if(void 0===(null==(n=t??{})?void 0:n.srcObject))throw le({operationName:"attachElement",info:de.invalidElement,payload:{element:t},path:Da.prefix});const a=t.srcObject;a.getTracks().length>0&&a.removeTrack(i),0===a.getTracks().length&&(t.srcObject=null)}U(),U(),U(),U();var jn,mh=new Uint8Array(16);function bh(){if(!jn&&!(jn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return jn(mh)}U(),U(),U();var Ln,yh=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Ma=function Sh(t){return"string"==typeof t&&yh.test(t)},pt=[];for(Ln=0;Ln<256;++Ln)pt.push((Ln+256).toString(16).substr(1));U();var fi=function xh(t,i,n){var a=(t=t||{}).random||(t.rng||bh)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,i){n=n||0;for(var c=0;c<16;++c)i[n+c]=a[c];return i}return function wh(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(pt[t[i+0]]+pt[t[i+1]]+pt[t[i+2]]+pt[t[i+3]]+"-"+pt[t[i+4]]+pt[t[i+5]]+"-"+pt[t[i+6]]+pt[t[i+7]]+"-"+pt[t[i+8]]+pt[t[i+9]]+"-"+pt[t[i+10]]+pt[t[i+11]]+pt[t[i+12]]+pt[t[i+13]]+pt[t[i+14]]+pt[t[i+15]]).toLowerCase();if(!Ma(n))throw TypeError("Stringified UUID is invalid");return n}(a)};U();var Eh=jt(lc());function jr(t){this.message=t}U(),(jr.prototype=new Error).name="InvalidCharacterError";var ja=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(t){var i=String(t).replace(/=+$/,"");if(i.length%4==1)throw new jr("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,a,c=0,u=0,p="";a=i.charAt(u++);~a&&(n=c%4?64*n+a:a,c++%4)?p+=String.fromCharCode(255&n>>(-2*c&6)):0)a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a);return p};function Hn(t){this.message=t}(Hn.prototype=new Error).name="InvalidTokenError";var Fh=new _e("packages/token/src/encoder.ts"),Zi=class Ho{constructor(i){Object.assign(this,i)}static Decode(i){try{const n=function Ah(t,i){if("string"!=typeof t)throw new Hn("Invalid token specified");var n=!0===(i=i||{}).header?0:1;try{return JSON.parse(function Ch(t){var i=t.replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw"Illegal base64url string!"}try{return decodeURIComponent(ja(i).replace(/(.)/g,function(a,c){var u=c.charCodeAt(0).toString(16).toUpperCase();return u.length<2&&(u="0"+u),"%"+u}))}catch{return ja(i)}}(t.split(".")[n]))}catch(a){throw new Hn("Invalid token specified: "+a.message)}}(i),a=new Ho(n);return a.tokenString=i,a}catch(n){throw new li({path:Fh.prefix,info:Ih.invalidParameter,error:n})}}encode(i){const n={jti:this.jti,iat:this.iat,exp:this.exp,scope:this.scope,version:this.version};return this.tokenString=Eh.default.KJUR.jws.JWS.sign("HS256",JSON.stringify({alg:"HS256",typ:"JWT"}),JSON.stringify(n),i),this.tokenString}toJSON(){return{jti:this.jti,iat:this.iat,exp:this.exp,scope:this.scope,encoded:this.tokenString,version:this.version}}};U(),U(),U(),U();var Ih={invalidParameter:{name:"invalidParameter",detail:"failed to decode token",solution:"Use the correct token according to the specification"}};U();var Lr=fi,La=class{constructor(t){this.contentType=t,this.side="local",this.onConnectionStateChanged=new Fe,this._onConnectionStateChanged=new Fe,this.id=Lr(),this._label="",this.published=!1,this._getTransportCallbacks={},this._getStatsCallbacks={},this._connectionState={},this._onConnectionStateChanged.pipe(this.onConnectionStateChanged)}_setLabel(t){this._label=t}_unpublished(){this.published=!1,this._getTransportCallbacks={},this._getStatsCallbacks={}}_getTransport(t){var i,n;return null==(n=(i=this._getTransportCallbacks)["string"==typeof t?t:t.id])?void 0:n.call(i)}_setConnectionState(t,i){this._connectionState[t.id]!==i&&(this._connectionState[t.id]=i,this._onConnectionStateChanged.emit({remoteMember:t,state:i}))}getStats(t){return this._getStats(t)}_getStats(t){var i,n,a;return null!=(a=null==(n=(i=this._getStatsCallbacks)["string"==typeof t?t:t.id])?void 0:n.call(i))?a:[]}_getStatsAll(){return Promise.all(Object.entries(this._getStatsCallbacks).map(t=>K(this,[t],function*([i,n]){return{memberId:i,stats:yield n().catch(()=>[])}})))}getRTCPeerConnection(t){return this._getRTCPeerConnection(t)}_getRTCPeerConnection(t){var i;return null==(i=this._getTransport(t))?void 0:i.rtcPeerConnection}getConnectionState(t){return this._getConnectionState(t)}_getConnectionState(t){var i;return null!=(i=this._connectionState["string"==typeof t?t:t.id])?i:"new"}_getConnectionStateAll(){return Object.keys(this._getTransportCallbacks).map(t=>({memberId:t,connectionState:this._getConnectionState(t)}))}toJSON(){return{label:this._label,contentType:this.contentType,id:this.id,side:this.side}}},Th=new _e("packages/core/src/media/stream/local/media.ts"),Hr=class extends La{constructor(t,i,n={}){super(i),this.onTrackUpdated=new Fe,this.onDestroyed=new Fe,this._disposer=new si,this._trackConstraints={},this._replacingTrack=!1,this._onReplacingTrackDone=new Fe,this._onEnableChanged=new Fe,this._track=t,this._listenTrackEvent(),this._options=n,this._trackConstraints=re({},n)}get trackConstraints(){return this._trackConstraints}toJSON(){const t=super.toJSON();return ae(re({},t),{trackConstraints:this.trackConstraints,isEnabled:this.isEnabled,_options:this._options})}get track(){return this._track}attach(t){this._element=t,Oa(t,this._track)}detach(){this._element&&(Ba(this._element,this._track),this._element=void 0)}_disable(t){this._options.stopTrackWhenDisabled?(this._trackConstraints=re(re({},this.trackConstraints),this.track.getConstraints()),this.track.stop()):this._oldTrack=this.track;const i="video"===t?qa:Rh;i.enabled=!1,this._onEnableChanged.emit(i),this._updateTrack(i)}_updateTrack(t){this._track=t,this._element&&this.attach(this._element),this.onTrackUpdated.emit(t),this._listenTrackEvent()}_listenTrackEvent(){const t=()=>{Th.info("onDestroyed",this.toJSON()),this.onDestroyed.emit()};this._track.addEventListener("ended",t),this._disposer.push(()=>this._track.removeEventListener("ended",t))}release(){this._disposer.dispose(),this._track.stop()}},Ha=new RTCPeerConnection,Rh=Ha.addTransceiver("audio").receiver.track,qa=Ha.addTransceiver("video").receiver.track,qr=new _e("packages/core/src/media/stream/local/audio.ts"),Vr=class extends Hr{constructor(t,i={}){if(super(t,"audio",i),this.contentType="audio",this._isEnabled=!0,this._promiseQueue=new wi,"audio"!==t.kind)throw le({operationName:"LocalAudioStream.constructor",path:qr.prefix,info:de.invalidTrackKind,payload:{track:t}})}setEnabled(t){return K(this,null,function*(){yield this._promiseQueue.push(()=>K(this,null,function*(){if(!0===this._isEnabled&&!1===t)this._isEnabled=t,this._disable("audio"),qr.debug("stopped");else if(!1===this._isEnabled&&!0===t){if(this._isEnabled=t,this._options.stopTrackWhenDisabled){const i=!0===this._options.isDisplayMedia?yield this.enableDisplay():yield this.enableMic();this._updateTrack(i),this._onEnableChanged.emit(i)}else this._oldTrack&&(this._updateTrack(this._oldTrack),this._onEnableChanged.emit(this._oldTrack));qr.debug("resumed")}}))})}get isEnabled(){return this._isEnabled}enableMic(){return K(this,null,function*(){const[t]=(yield navigator.mediaDevices.getUserMedia({audio:this.trackConstraints})).getAudioTracks();return t})}enableDisplay(){return K(this,null,function*(){const[t]=(yield navigator.mediaDevices.getDisplayMedia({audio:this.trackConstraints})).getAudioTracks();return t})}};U();var kh=new _e("packages/core/src/media/stream/local/customVideo.ts"),Nh=class extends Hr{constructor(t={}){super(qa,"video",t),this.contentType="video",this._isEnabled=!0,this._promiseQueue=new wi,this._stream=null}setStream(t){return K(this,null,function*(){if(this._stream)throw new Error("ProcessedStream is already exists");this._stream=t,this._updateTrack(t.track)})}setEnabled(t){return K(this,null,function*(){yield this._promiseQueue.push(()=>K(this,null,function*(){var i;yield null==(i=this._stream)?void 0:i.setEnabled(t)}))})}updateTrack(t){return K(this,null,function*(){this._updateTrack(t),this._onEnableChanged.emit(t)})}get isEnabled(){return this._isEnabled}release(){var t;null==(t=this._stream)||t.dispose().catch(()=>{kh.error("release failed")})}};U();var qn=new _e("packages/core/src/media/stream/local/video.ts"),Ur=class extends Hr{constructor(t,i={}){if(super(t,"video",i),this.contentType="video",this._isEnabled=!0,this._promiseQueue=new wi,"video"!==t.kind)throw le({operationName:"LocalVideoStream.constructor",path:qn.prefix,info:de.invalidTrackKind,payload:{track:t}});qn.debug("LocalVideoStream spawned",this.toJSON())}setEnabled(t){return K(this,null,function*(){yield this._promiseQueue.push(()=>K(this,null,function*(){if(!0===this._isEnabled&&!1===t)this._isEnabled=t,this._disable("video"),qn.debug("stopped",this.toJSON());else if(!1===this._isEnabled&&!0===t){if(this._isEnabled=t,this._options.stopTrackWhenDisabled){const i=!0===this._options.isDisplayMedia?yield this.enableDisplay():yield this.enableCamera();this._updateTrack(i),this._onEnableChanged.emit(i)}else this._oldTrack&&(this._updateTrack(this._oldTrack),this._onEnableChanged.emit(this._oldTrack));qn.debug("resumed",this.toJSON())}}))})}get isEnabled(){return this._isEnabled}enableCamera(){return K(this,null,function*(){const[t]=(yield navigator.mediaDevices.getUserMedia({video:this.trackConstraints})).getVideoTracks();return t})}enableDisplay(){return K(this,null,function*(){const[t]=(yield navigator.mediaDevices.getDisplayMedia({video:this.trackConstraints})).getVideoTracks();return t})}},Dh=new _e("packages/core/src/media/stream/local/data.ts"),Va=class extends La{constructor(t={}){super("data"),this.options=t,this.contentType="data",this._onWriteData=new Fe,this._isEnabled=!0,this._setLabel("LocalDataStream")}get isEnabled(){return this._isEnabled}setIsEnabled(t){this._isEnabled=t}write(t){if(!this._isEnabled)throw le({operationName:"LocalDataStream.write",path:Dh.prefix,info:de.disabledDataStream});!ArrayBuffer.isView(t)&&"string"!=typeof t&&(t=Kr+JSON.stringify(t)),this._onWriteData.emit(t)}},Kr="skyway_object:";U();var tt=new _e("packages/core/src/publication/index.ts"),Ua=class{constructor(t){var i,n,a;this._codecCapabilities=[],this._encodings=[],this._state="enabled",this._events=new hi,this.onCanceled=this._events.make(),this.onSubscribed=this._events.make(),this.onUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onEnabled=this._events.make(),this.onDisabled=this._events.make(),this.onStateChanged=this._events.make(),this.onConnectionStateChanged=new Fe,this._onEncodingsChanged=this._events.make(),this._onReplaceStream=this._events.make(),this._onEnabled=this._events.make(),this.streamEventDisposer=new si,this.cancel=()=>new Promise((c,u)=>{let p=!1;this._channel._unpublish(this.id).catch(S=>{p=!0,u(S)}),this._setStream(void 0),this.onCanceled.asPromise(this._context.config.rtcApi.timeout).then(()=>c()).catch(S=>{p||u(S)})}),this.updateMetadata=c=>new Promise((u,p)=>K(this,null,function*(){const S=tt.info("[start] updateMetadata",yield je({operationName:"Publication.updateMetadata",channel:this._channel}),this);let C=!1;this._channel._updatePublicationMetadata(this.id,c).catch(b=>{C=!0,p(b)}),this.onMetadataUpdated.watch(b=>b.metadata===c,this._context.config.rtcApi.timeout).then(()=>K(this,null,function*(){u(),tt.elapsed(S,"[end] updateMetadata",yield je({operationName:"Publication.updateMetadata",channel:this._channel}),this)})).catch(b=>{if(!C)throw le({operationName:"PublicationImpl.updateMetadata",info:ae(re({},de.timeout),{detail:"publication onMetadataUpdated"}),path:tt.prefix,context:this._context,channel:this._channel,error:b})})})),this.disable=()=>new Promise((c,u)=>K(this,null,function*(){const p=tt.info("[start] disable",yield je({operationName:"Publication.disable",channel:this._channel}),this);yield this._disableStream();let S=!1;this._channel._disablePublication(this.id).catch(C=>{S=!0,u(C)}),this.onDisabled.asPromise(this._context.config.rtcApi.timeout).then(()=>K(this,null,function*(){c(),tt.elapsed(p,"[end] disable",yield je({operationName:"Publication.disable",channel:this._channel}),this)})).catch(C=>{S||u(C)})})),this.enable=()=>new Promise((c,u)=>K(this,null,function*(){if(null==this.stream)return void u(le({operationName:"Publication.enable",context:this._context,info:de.canNotEnableRemotePublication,path:tt.prefix}));const p=tt.info("[start] enable",yield je({operationName:"Publication.enable",channel:this._channel}),this);let S=!1;this._channel._enablePublication(this.id).catch(C=>{S=!0,u(C)}),this._onEnabled.asPromise(this._context.config.rtcApi.timeout).then(()=>K(this,null,function*(){yield this._enableStream(),this.onEnabled.emit(),this.onStateChanged.emit(),tt.elapsed(p,"[end] enable",yield je({operationName:"Publication.enable",channel:this._channel}),this),c()})).catch(C=>{S||u(C)})})),this.id=t.id,this._channel=t.channel,this._context=this._channel._context,this.publisher=t.publisher,this.contentType=t.contentType,this._metadata=t.metadata,this.origin=t.origin,this.setCodecCapabilities(null!=(i=t.codecCapabilities)?i:[]),this.setEncodings(Wr(null!=(n=t.encodings)?n:[])),this._state=t.isEnabled?"enabled":"disabled",t.stream&&this._setStream(t.stream),this._analytics=null==(a=this._channel.localPerson)?void 0:a._analytics,tt.debug("publication spawned",this.toJSON())}get codecCapabilities(){return this._codecCapabilities}setCodecCapabilities(t){this._codecCapabilities=t}get encodings(){return this._encodings}setEncodings(t){this._encodings=t}get stream(){return this._stream}_setStream(t){this._stream=t,t?t._onConnectionStateChanged.add(i=>{tt.debug("onConnectionStateChanged",this.id,i),this.onConnectionStateChanged.emit(i)}).disposer(this.streamEventDisposer):this.streamEventDisposer.dispose()}get metadata(){return this._metadata}get state(){return this._state}get deviceName(){if(!(this.stream instanceof Va))return this.stream.track.label}get subscriptions(){return this._channel.subscriptions.filter(t=>t.publication.id===this.id)}_updateMetadata(t){this._metadata=t,this.onMetadataUpdated.emit({metadata:t})}_disable(){return K(this,null,function*(){yield this._disableStream(),this.onDisabled.emit(),this.onStateChanged.emit()})}_enable(){this.stream?this._onEnabled.emit():(this._state="enabled",this.onEnabled.emit(),this.onStateChanged.emit())}_unpublished(){this._state="canceled",this.stream&&this.stream._unpublished(),this.onCanceled.emit(),this.onStateChanged.emit(),this._dispose()}_subscribed(t){this.onSubscribed.emit({subscription:t}),this.onSubscriptionListChanged.emit()}_unsubscribed(t){this.onUnsubscribed.emit({subscription:t}),this.onSubscriptionListChanged.emit()}updateEncodings(t){tt.info("updateEncodings",{encodings:t},this),this.setEncodings(Wr(Ka(t))),this._onEncodingsChanged.emit(t),this._analytics&&!this._analytics.isClosed()&&this._analytics.client.sendPublicationUpdateEncodingsReport({publicationId:this.id,encodings:this.encodings,updatedAt:Date.now()})}_disableStream(){return K(this,null,function*(){"disabled"!==this.state&&(this._state="disabled",this.stream&&("data"===this.stream.contentType?this.stream.setIsEnabled(!1):yield this.stream.setEnabled(!1).catch(t=>{tt.warn(ct({channel:this._channel,operationName:"Publication._disableStream",payload:t,detail:"setEnabled failed"}))}),je({operationName:"Publication._disableStream",channel:this._channel}).then(t=>tt.info("publication _disableStream",t,{publication:this})).catch(()=>{})))})}_enableStream(){return K(this,null,function*(){"enabled"!==this.state&&(this._state="enabled",this.stream&&(je({operationName:"Publication._enableStream",channel:this._channel}).then(t=>tt.info("publication _enableStream",t,{publication:this})).catch(()=>{}),"data"===this.stream.contentType?this.stream.setIsEnabled(!0):yield this.stream.setEnabled(!0).catch(t=>{tt.warn(ct({channel:this._channel,operationName:"Publication._disableStream",payload:t,detail:"setEnabled failed"}))})))})}replaceStream(t,i={}){var n;if(tt.info("replaceStream",{stream:t,options:i},this),!this.stream)throw le({operationName:"PublicationImpl.replaceStream",context:this._context,info:de.canNotUseReplaceStream,path:tt.prefix});if(t.contentType!==this.contentType)throw le({operationName:"PublicationImpl.replaceStream",context:this._context,info:de.invalidContentType,path:tt.prefix});(null==(n=i.releaseOldStream)||n)&&this.stream.release(),je({operationName:"PublicationImpl.replaceStream",channel:this._channel}).then(c=>tt.debug(c,{old:this.stream,new:t})).catch(c=>c),t.setEnabled(this.stream.isEnabled).catch(c=>{tt.error("replaceStream stream.setEnabled",c,this.toJSON())});const a=this._stream;this._setStream(t),this._onReplaceStream.emit({newStream:t,oldStream:a}),this._analytics&&!this._analytics.isClosed()&&this._analytics.client.sendMediaDeviceReport({publicationId:this.id,mediaDeviceName:this.deviceName,mediaDeviceTrigger:"replaceStream",updatedAt:Date.now()})}getStats(t){if(!this.stream)throw le({operationName:"PublicationImpl.getStats",context:this._context,info:de.streamNotExistInSubscription,path:tt.prefix});return this.stream._getStats(t)}getRTCPeerConnection(t){if(!this.stream)throw le({operationName:"PublicationImpl.getRTCPeerConnection",context:this._context,info:de.streamNotExistInSubscription,path:tt.prefix});return this.stream._getRTCPeerConnection(t)}getConnectionState(t){if(!this.stream)throw le({operationName:"PublicationImpl.getConnectionState",context:this._context,info:de.streamNotExistInSubscription,path:tt.prefix});return this.stream._getConnectionState(t)}toJSON(){var t;return{id:this.id,channelId:this._channel.id,publisherId:this.publisher.id,origin:null==(t=this.origin)?void 0:t.id,contentType:this.contentType,metadata:this.metadata,codecCapabilities:this.codecCapabilities,encodings:this.encodings,state:this.state,stream:this.stream}}_dispose(){this._events.dispose()}},Wr=t=>t.map((i,n)=>{var a;return ae(re({},i),{id:null!=(a=i.id)?a:n.toString()})}),Ka=t=>{const[i]=t;return i.maxBitrate?t.sort((n,a)=>n.maxBitrate-a.maxBitrate):i.scaleResolutionDownBy?t.sort((n,a)=>a.scaleResolutionDownBy-n.scaleResolutionDownBy):i.maxFramerate?t.sort((n,a)=>n.maxFramerate-a.maxFramerate):t};U(),U(),U();var Wa=new _e("packages/core/src/dataPlane/agent/publishing.ts"),Mh=class{constructor(t){this._localPerson=t,this.context=this._localPerson.context}startPublishing(t){return K(this,null,function*(){if(this.context.config.internal.disableDPlane)return void(yield new Promise(c=>setTimeout(c,500)));const i=t.publication,n=t.subscriber;i.stream||(yield this._localPerson.onStreamPublished.watch(c=>c.publication.id===i.id,this.context.config.rtcApi.timeout).catch(c=>{throw le({operationName:"PublishingAgent.startPublishing",context:this.context,channel:this._localPerson.channel,info:ae(re({},de.timeout),{detail:"PublishingAgent onStreamPublished"}),path:Wa.prefix,payload:{publication:i},error:c})}));const a=n._getOrCreateConnection(this._localPerson);a.startPublishing&&(yield a.startPublishing(i,t.id))})}stopPublishing(t,i){return K(this,null,function*(){const n=i._getConnection(this._localPerson.id);n?.stopPublishing&&n.stopPublishing(t).catch(a=>{Wa.error("stopPublishing failed",a)})})}};U();var jh=class{constructor(t){this._localPerson=t,this._disposers={},this._context=this._localPerson.context}startSubscribing(t){return K(this,null,function*(){if(this._context.config.internal.disableDPlane)return void(yield new Promise(a=>setTimeout(a,500)));const n=t.publication.publisher._getOrCreateConnection(this._localPerson);if(n.startSubscribing){yield n.startSubscribing(t);const{removeListener:a}=t._onChangeEncoding.add(()=>K(this,null,function*(){var c;yield null==(c=n.changePreferredEncoding)?void 0:c.call(n,t)}));this._disposers[t.id]=a}})}stopSubscribing(t){return K(this,null,function*(){var i,n;const c=t.publication.publisher._getConnection(this._localPerson.id);c?.stopSubscribing&&(yield c.stopSubscribing(t),null==(n=(i=this._disposers)[t.id])||n.call(i))})}};U();var za=class{constructor(t){this._impl=t,this._events=new hi,this.onLeft=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberStateChanged=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onFatalError=this._events.make(),this.apply(t)}get keepaliveIntervalSec(){return this._impl.keepaliveIntervalSec}get keepaliveIntervalGapSec(){return this._impl.keepaliveIntervalGapSec}get disableSignaling(){return this._impl.disableSignaling}get disableAnalytics(){return this._impl.disableAnalytics}get type(){return this._impl.type}get subtype(){return this._impl.subtype}get side(){return this._impl.side}get id(){return this._impl.id}get name(){return this._impl.name}get channel(){return this._impl.channel}get metadata(){return this._impl.metadata}get state(){return this._impl.state}get publications(){return this._impl.publications}get subscriptions(){return this._impl.subscriptions}apply(t){this._impl=t,t.onLeft.pipe(this.onLeft),t.onMetadataUpdated.pipe(this.onMetadataUpdated),t.onStreamPublished.pipe(this.onStreamPublished),t.onStreamUnpublished.pipe(this.onStreamUnpublished),t.onPublicationListChanged.pipe(this.onPublicationListChanged),t.onPublicationSubscribed.pipe(this.onPublicationSubscribed),t.onPublicationUnsubscribed.pipe(this.onPublicationUnsubscribed),t.onSubscriptionListChanged.pipe(this.onSubscriptionListChanged),t.onFatalError.pipe(this.onFatalError)}subscribe(t,i){return this._impl.subscribe(t,i)}unsubscribe(t){return this._impl.unsubscribe(t)}publish(t,i={}){return this._impl.publish(t,i)}unpublish(t){return this._impl.unpublish(t)}updateMetadata(t){return this._impl.updateMetadata(t)}leave(){return K(this,null,function*(){yield this._impl.leave()})}dispose(){this._impl.dispose()}};U(),U(),U(),U(),U(),U();var Bi=class{constructor(t,i){this.id=fi(),this.type=t,this.payload=i}toJSON(){return{id:this.id,type:this.type,payload:this.payload}}};function Hh(t){return!("object"!=typeof t||null===t||Array.isArray(t))}U();var Vh=["invalidPayload","unexpected"];function $a(t){return!(!t||"object"!=typeof t||"string"!=typeof t.eventId||"boolean"!=typeof t.ok||typeof t.reason<"u"&&("string"!=typeof t.reason||!Vh.includes(t.reason)))}U();var zr=jt(vr());U();var _i=class{constructor(){this._listeners=new Map,this._listenerIndex=0,this.emit=t=>{this._listeners.forEach(i=>i(t))},this.removeAllListeners=()=>{this._listeners.clear()},this.addListener=t=>{const i=this._listenerIndex;return this._listeners.set(i,t),this._listenerIndex++,{removeListener:()=>{this._listeners.delete(i)}}},this.addOneTimeListener=t=>{const i=this.addListener(n=>{i.removeListener(),t(n)});return i},this.asPromise=t=>new Promise((i,n)=>{let a=()=>{};const c=t&&setTimeout(()=>{n("Event asPromise timeout"),a()},t);a=this.addOneTimeListener(p=>{c&&clearTimeout(c),i(p)}).removeListener})}},Uh=["Open","Acknowledge"],Wh=class{constructor({channelId:t,channelName:i,memberId:n,memberName:a,sessionEndpoint:c,token:u,logger:p,sdkVersion:S}){this._isOpen=!1,this._isClosed=!1,this._reconnectCount=0,this.connectionState="connecting",this.onConnectionStateChanged=new _i,this.onOpened=new _i,this.onTokenExpired=new _i,this.onEventReceived=new _i,this.onConnectionFailed=new _i,this._resendClientEvents=[],this._sessionEndpoint=c,this._channelId=t,this._channelName=i,this._memberId=n,this._memberName=a,this._token=u,this._logger=p,this._sdkVersion=S,this._connect()}_setConnectionState(t){this.connectionState!==t&&(this._logger.debug(`connectionState changed : ${t}`),this.connectionState=t,this.onConnectionStateChanged.emit(t))}_connect(){let t;try{const i=`SkyWayAuthToken!${this._token}`,a=Object.entries({channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,sdkPlatform:"js",sdkVersion:this._sdkVersion}).filter(([u,p])=>void 0!==p).map(u=>u.join("=")).join("&");t=new zr.default(`${this._sessionEndpoint}?${a}`,i),this._logger.debug(`Connecting to analytics-logging-server: ${this._sessionEndpoint}`),t.onerror=u=>{this._logger.error("WebSocket error occurred",u.error),t.close(4202)}}catch(i){const n=i instanceof Error?i:new Error;return this._logger.error("Failed to create WebSocket instance",n),void this.reconnect()}t.onopen=()=>{this._logger.debug("Connected to analytics-logging-server")},t.onclose=i=>{const n="Close event fired: "+JSON.stringify({code:i.code,reason:i.reason,type:i.type});4100<=i.code&&i.code<=4199?this._logger.error(n,new Error):this._logger.debug(n),1e3===i.code||4e3<=i.code&&i.code<=4199?4e3!==i.code&&(this._logger.debug("Closed the connection to analytics-logging-server"),this.onConnectionFailed.emit(),this.close()):4200===i.code?this.onTokenExpired.emit():this.reconnect()},t.onmessage=i=>{this._messageHandler(i.data)},this._ws=t}updateAuthToken(t){this._token=t}reconnect(){if(void 0!==this._ws&&this._ws.close(4e3),this._ws=void 0,this._isOpen=!1,this._reconnectCount>=5)this.onConnectionFailed.emit(),this.close(),this._logger.error("Failed to reconnect for five times",new Error);else{this._setConnectionState("reconnecting");const t=(t=>1e3*(ui(2,this._reconnectCount)+Math.random()))();this._reconnectTimer=setTimeout(()=>{this._connect(),this._reconnectCount++,this._logger.debug(`Try to reconnect: count = ${this._reconnectCount}`)},t)}}close(){this._isClosed=!0,this.destroy()}destroy(){this._setConnectionState("closed"),this.onConnectionStateChanged.removeAllListeners(),this.onOpened.removeAllListeners(),this.onEventReceived.removeAllListeners(),this.onConnectionFailed.removeAllListeners(),this._reconnectTimer&&clearTimeout(this._reconnectTimer),void 0!==this._ws&&this._ws.close(1e3)}send(t){return K(this,null,function*(){if(void 0===this._ws||!this._isOpen||this._ws.readyState!==zr.default.OPEN)return this._logger.debug("Try to reconnect because connection is lost"),void this.resendAfterReconnect(t);const i=JSON.stringify(t.toJSON());this._ws.send(i,n=>{if(n)return this._logger.debug(`Try to reconnect because failed to send: ${n.message}`),void this.resendAfterReconnect(t)})})}resendAfterReconnect(t){this._resendClientEvents.some(n=>n.id===t.id)||this._resendClientEvents.push(t),"reconnecting"!==this.connectionState&&this.reconnect()}pushResendClientEventsQueue(t){this._resendClientEvents.push(t)}isClosed(){return this._isClosed}_messageHandler(t){if("string"!=typeof t)return void this._logger.error("Received invalid message: not string",new Error);let i;try{i=JSON.parse(t)}catch(n){const a=n instanceof Error?n:new Error;return void this._logger.error("Received invalid message: parse error",a)}if(function zh(t){return!(!t||"object"!=typeof t||"string"!=typeof t.type||!Uh.includes(t.type)||"string"!=typeof t.id||t.payload&&"object"!=typeof t.payload)}(i))if("Open"===i.type){if(!function qh(t){if(!(t&&"object"==typeof t&&t.statsRequest&&"object"==typeof t.statsRequest&&t.statsRequest.intervalSec&&"number"==typeof t.statsRequest.intervalSec&&t.statsRequest.types&&Array.isArray(t.statsRequest.types)))return!1;for(const i of t.statsRequest.types){if(!i.type||"string"!=typeof i.type||!i.properties||!Hh(i.properties))return!1;for(const n of Object.keys(i.properties))if(!("normalization"in i.properties[n])||"boolean"!=typeof i.properties[n].normalization||!i.properties[n].outputKey||"string"!=typeof i.properties[n].outputKey)return!1}return!0}(i.payload))return void this._logger.error(`Received invalid message: ${JSON.stringify(i.payload)}`,new Error);if(this._logger.debug("Received a open event"),this._isOpen=!0,this._setConnectionState("connected"),0!==this._reconnectCount&&(this._reconnectCount=0,this._logger.debug("Succeeded to reconnect")),this._resendClientEvents.length>0){for(const n of this._resendClientEvents){if(void 0===this._ws||!this._isOpen||this._ws.readyState!==zr.default.OPEN){this._logger.error(`Failed to resend event because connection lost after reconnect: ${n}`,new Error);continue}const a=JSON.stringify(n.toJSON());this._ws.send(a,c=>{c?this._logger.error(`Failed to resend event: ${n}`,c):this._logger.debug(`Succeed to resend ClientEvent: ${n}`)})}this._logger.debug("Process of resending ClientEvents is completed"),this._resendClientEvents=[]}this.onOpened.emit(i.payload)}else this._logger.debug(`Received the event: ${i.type}, payload: ${JSON.stringify(i.payload)}`),this.onEventReceived.emit(i);else this._logger.error(`Received invalid message: ${JSON.stringify(i)}`,new Error)}};U();var $h=class{constructor(t={}){this.count=0,this.times=8,this.interval=100,this.jitter=0,Object.assign(this,t)}wait(){return K(this,null,function*(){if(this.exceeded)return!1;const t=this.timeout;return this.count++,yield new Promise(i=>setTimeout(i,t)),!0})}get timeout(){return ui(this.count,2)*this.interval+ui(this.count,2)*this.jitter*Math.random()}get exceeded(){return this.count>=this.times}reset(){this.count=0}stop(){this.count=this.times}},Ga="analytics-logging.skyway.ntt.com",Xh=class{constructor({token:t,channelId:i,channelName:n,memberId:a,memberName:c,sdkVersion:u},p){this.onConnectionStateChanged=new _i,this.onConnectionFailed=new _i,this._isClosed=!1,this._responseCallbacks=new Map,this._acknowledgeCallbacks=new Map,this._mediaDeviceVersion=new Map,this._encodingsVersion=new Map,this._preferredEncodingVersion=new Map,this._previousSubscriptionStats=new Map,this._statsRequest={intervalSec:5,types:[]},this._token=t,this._newToken=void 0,this._channelId=i,this._channelName=n,this._memberId=a,this._memberName=c,this._sdkVersion=u,this._options=Object.assign({},{analyticsLoggingServerDomain:Ga,secure:!0,logger:{debug:(C,...b)=>{console.debug(C,...b)},warn:(C,...b)=>{console.warn(C,...b)},error:C=>{console.error(C)}}},p??{}),this._logger=this._options.logger,this._logger.debug(`Created instance with the options: ${this._options}`)}get connectionState(){var t,i;return null!=(i=null==(t=this._socket)?void 0:t.connectionState)?i:"closed"}connect(){return K(this,null,function*(){this._socket=new Wh({sessionEndpoint:`${this._options.secure?"wss":"ws"}://${this._options.analyticsLoggingServerDomain||Ga}/v1/client/ws`,channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,token:this._token,logger:this._logger,sdkVersion:this._sdkVersion}),this._socket.onEventReceived.addListener(a=>{try{this._eventReceivedHandler(a)}catch(c){this._logger.error("in _eventReceivedHandler",c)}}),this._socket.onConnectionFailed.addListener(()=>{this.onConnectionFailed.emit(),this._cleanupAnalyticsClientMaps()}),this._socket.onConnectionStateChanged.addListener(a=>{var c;"closed"===a&&!this.isClosed()&&null!=(c=this._socket)&&c.isClosed()&&(this._isClosed=!0,this.dispose()),this.onConnectionStateChanged.emit(a)}),this._socket.onTokenExpired.addListener(()=>{this._reconnectWithNewSkyWayAuthToken()});const n=yield this._socket.onOpened.asPromise();return void 0!==n?void(this._statsRequest=n.statsRequest):(this._logger.error("First time connection payload is undefined",new Error),void this.onConnectionFailed.emit())})}dispose(){this._disconnect(),this._cleanupAnalyticsClientMaps()}setNewSkyWayAuthToken(t){void 0!==this._socket&&(this._newToken=t,this._logger.debug("setNewSkyWayAuthToken is success"))}cleanupOnUnpublished(t){this._mediaDeviceVersion.delete(t),this._encodingsVersion.delete(t)}cleanupOnUnsubscribed(t){this._preferredEncodingVersion.delete(t),this._previousSubscriptionStats.delete(t)}_disconnect(){var t;null==(t=this._socket)||t.destroy(),this._socket=void 0,this._responseCallbacks.clear(),this._acknowledgeCallbacks.clear()}sendMediaDeviceReport(t){return K(this,null,function*(){let i=this._mediaDeviceVersion.get(t.publicationId);void 0===i?i=0:i++,this._mediaDeviceVersion.set(t.publicationId,i);const a=new Bi("MediaDeviceReport",{publicationId:t.publicationId,mediaDeviceName:t.mediaDeviceName,mediaDeviceVersion:i,mediaDeviceTrigger:t.mediaDeviceTrigger,updatedAt:t.updatedAt});yield this._sendClientEvent(a).catch(c=>{this._logger.warn("_sendClientEvent in sendMediaDeviceReport is failed",c)})})}sendBindingRtcPeerConnectionToSubscription(t){return K(this,null,function*(){const i=new Bi("BindingRtcPeerConnectionToSubscription",t);yield this._sendClientEvent(i).catch(n=>{this._logger.warn("_sendClientEvent in sendBindingRtcPeerConnectionToSubscription is failed",n)})})}filterStatsReport(t){const i=Array.from(t.values()).find(u=>"transport"===u.type&&"connected"===u.dtlsState),n=[];if(i){const u=Array.from(t.values()).find(p=>"candidate-pair"===p.type&&p.nominated&&p.id===i?.selectedCandidatePairId);n.push(u.id,u.localCandidateId,u.remoteCandidateId,u.transportId)}else{const u=Array.from(t.values()).find(p=>"candidate-pair"===p.type&&p.nominated&&p.selected);n.push(u.id,u.localCandidateId,u.remoteCandidateId,u.transportId)}const a=new Map,c=["candidate-pair","local-candidate","remote-candidate","transport"];for(const[u,p]of t.entries())c.includes(p.type)?n.includes(p.id)&&a.set(u,p):a.set(u,p);return a}bundleStatsReportByStatsType(t){const i={};for(const n of t.values())i[n.type]=n;return i}sendSubscriptionStatsReport(t,i){return K(this,null,function*(){var n;const a=this._previousSubscriptionStats.get(i.subscriptionId);if(this._previousSubscriptionStats.set(i.subscriptionId,{stats:t,createdAt:i.createdAt}),void 0===a)return;const c=this.filterStatsReport(a.stats),u=this.bundleStatsReportByStatsType(c),S=(i.createdAt-a.createdAt)/1e3;if(S<=0)throw new Error("duration must be greater than 0. also sendSubscriptionStatsReport was duplicated.");const C="data"===i.contentType,b=this._statsRequest.types.filter(O=>C&&["local-candidate","candidate-pair","data-channel"].includes(O.type)||!C&&"data-channel"!==O.type).map(O=>{switch(O.type){case"data-channel":if("sender"===i.role){const ce=dr(O.properties,["bytesReceived"]);return{type:O.type,properties:ce}}{const ce=dr(O.properties,["bytesSent"]);return{type:O.type,properties:ce}}case"candidate-pair":if(C){const ce=dr(O.properties,["availableOutgoingBitrate"]);return{type:O.type,properties:ce}}return O;default:return O}}),E=this.filterStatsReport(t),k=this.bundleStatsReportByStatsType(E),q={};for(const{type:O,properties:G}of b)for(const[se,{normalization:ce,outputKey:Z}]of Object.entries(G)){const ie=k[O];if(void 0!==ie&&void 0!==ie[se])if(ce){const he=null==(n=u[O])?void 0:n[se];if(void 0===he){this._logger.warn(`${O} in previous statsReport is undefined`);continue}const fe=(Number(ie[se])-Number(he))/S;q[O]=ae(re({},q[O]),{[Z]:String(fe)})}else q[O]=ae(re({},q[O]),{[Z]:String(ie[se])})}const F=new Bi("SubscriptionStatsReport",{subscriptionId:i.subscriptionId,stats:q,role:i.role,createdAt:i.createdAt});yield this._sendClientEvent(F).catch(O=>{this._logger.warn("_sendClientEvent in sendSubscriptionStatsReport is failed",O)})})}sendRtcPeerConnectionEventReport(t){return K(this,null,function*(){const i=new Bi("RtcPeerConnectionEventReport",t);yield this._sendClientEvent(i).catch(n=>{this._logger.warn("_sendClientEvent in sendRtcPeerConnectionEventReport is failed",n)})})}sendPublicationUpdateEncodingsReport(t){return K(this,null,function*(){let i=this._encodingsVersion.get(t.publicationId);void 0===i?i=0:i++,this._encodingsVersion.set(t.publicationId,i);const a=new Bi("PublicationUpdateEncodingsReport",{publicationId:t.publicationId,encodings:t.encodings,encodingsVersion:i,updatedAt:t.updatedAt});yield this._sendClientEvent(a).catch(c=>{this._logger.warn("_sendClientEvent in sendPublicationUpdateEncodingsReport is failed",c)})})}sendSubscriptionUpdatePreferredEncodingReport(t){return K(this,null,function*(){let i=this._preferredEncodingVersion.get(t.subscriptionId);void 0===i?i=0:i++,this._preferredEncodingVersion.set(t.subscriptionId,i);const a=new Bi("SubscriptionUpdatePreferredEncodingReport",{subscriptionId:t.subscriptionId,preferredEncodingIndex:t.preferredEncodingIndex,preferredEncodingVersion:i,updatedAt:t.updatedAt});yield this._sendClientEvent(a).catch(c=>{this._logger.warn("_sendClientEvent in sendSubscriptionUpdatePreferredEncodingReport is failed",c)})})}_sendClientEvent(t){return K(this,null,function*(){return new Promise((i,n)=>K(this,null,function*(){if(void 0===this._socket||"closed"===this._socket.connectionState)return void n(new Error("websocket is not connected"));if("connecting"===this._socket.connectionState)return this._socket.pushResendClientEventsQueue(t),this._setAcknowledgeCallback(t.id,c=>K(this,null,function*(){c.ok?(this._acknowledgeCallbacks.delete(t.id),i()):(this._acknowledgeCallbacks.delete(t.id),n(c))})),this._logger.debug(`pushResendClientEventsQueue and setAcknowledgeCallback. clientEvent.id: ${t.id}`),void n(new Error("websocket is connecting now"));const a=new $h({times:6,interval:500,jitter:100});for(;!a.exceeded;){const c=setTimeout(()=>K(this,null,function*(){if(void 0===this._socket)return this._acknowledgeCallbacks.delete(t.id),void n(new Error("Socket closed when trying to resend"));this._socket.resendAfterReconnect(t),n(new Error("Timeout to send data"))}),5e3);this._logger.debug(`send clientEvent, ${JSON.stringify(t)}`),this._socket.send(t).catch(p=>{this._acknowledgeCallbacks.delete(t.id),clearTimeout(c),n(p)});const u=yield this._waitForAcknowledge(t.id).catch(p=>p);if(clearTimeout(c),!$a(u))return void i();if("unexpected"!==u.reason)return void n(u);yield a.wait()}n(new Error("unexpected has occurred at server"))}))})}_waitForAcknowledge(t){return K(this,null,function*(){return new Promise((i,n)=>{this._setAcknowledgeCallback(t,a=>K(this,null,function*(){a.ok?(this._acknowledgeCallbacks.delete(t),i()):(this._acknowledgeCallbacks.delete(t),n(a))}))})})}_reconnectWithNewSkyWayAuthToken(){return K(this,null,function*(){this._disconnect(),void 0!==this._newToken?(this._token=this._newToken,this._newToken=void 0,yield this.connect()):this._logger.warn("new token is not set. so not reconnect.")})}_eventReceivedHandler(t){switch(t.type){case"Acknowledge":this._acknowledgeHandler(t.payload);break;case"Open":break;default:this._logger.warn(`Unknown event: ${t.type}`)}}_acknowledgeHandler(t){if(!$a(t))throw new Error("Invalid payload");const{eventId:i}=t;if(!this._acknowledgeCallbacks.has(i))throw new Error(`acknowledge event has unknown eventId: ${i}`);const n=this._acknowledgeCallbacks.get(i);n&&(this._acknowledgeCallbacks.delete(i),n(t))}_setAcknowledgeCallback(t,i){this._acknowledgeCallbacks.set(t,i)}_cleanupAnalyticsClientMaps(){this._mediaDeviceVersion.clear(),this._encodingsVersion.clear(),this._preferredEncodingVersion.clear(),this._previousSubscriptionStats.clear()}getIntervalSec(){return this._statsRequest.intervalSec}isConnectionEstablished(){return!(!this._socket||"connecting"===this._socket.connectionState||"closed"===this._socket.connectionState)}isClosed(){return this._isClosed}};U(),U(),U(),U(),U(),U(),U();U();var gt={timeout:{name:"timeout",detail:"",solution:""},internalError:{name:"internalError",detail:"",solution:""},invalidParameter:{name:"invalidParameter",detail:"",solution:""},connectionDisconnected:{name:"connectionDisconnected",detail:"",solution:""},websocketConnectionFailure:{name:"connectionFailure",detail:"\u30b5\u30fc\u30d0\u3078\u306e\u63a5\u7d9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f",solution:"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a5\u7d9a\u72b6\u6cc1\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044"},rpcResponseError:{name:"rpcResponseError",detail:"",solution:"",error:{}},onClosedWhileRequesting:{name:"onClosedWhileRequesting",detail:"request\u4e2d\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u7d42\u4e86\u3055\u308c\u307e\u3057\u305f",solution:"\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u5b8c\u4e86\u3092\u78ba\u8a8d\u3057\u3066\u304b\u3089\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u7d42\u4e86\u3055\u305b\u3066\u304f\u3060\u3055\u3044"},failedToConnectRtcAPI:{name:"failedToConnectRtcAPI",detail:"rtc-api server\u3078\u306e\u63a5\u7d9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f",solution:"\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u72b6\u6cc1\u3068Token\u306e\u5185\u5bb9\u304c\u6b63\u3057\u3044\u304b\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044"},failedToUpdateMemberTTL:{name:"failedToUpdateMemberTTL",detail:"updateMemberTTL\u3092\u518d\u8a66\u884c\u3057\u307e\u3057\u305f\u304c\u3001\u5931\u6557\u3057\u307e\u3057\u305f",solution:"\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u72b6\u6cc1\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044"}};U();var Zh=jt(vr());function Pt({operationName:t,info:i,error:n,path:a,payload:c,channelId:u,appId:p,memberId:S}){return new li({error:n,info:i,payload:{payload:c,operationName:t,channelId:u,appId:p,memberId:S},path:a})}function zt({appId:t,detail:i,channelId:n,operationName:a,payload:c,memberId:u}){return{operationName:a,payload:c,detail:i,appId:t,channelId:n,memberId:u}}U();var Xa,Qa,ut=new _e("packages/rtc-rpc-api-client/src/rpc.ts"),ed=class{constructor(){this._id=fi(),this.closed=!1,this.negotiated=!1,this._reconnecting=!1,this._pendingRequests=[],this._events=new hi,this._onMessage=this._events.make(),this.onNotify=this._events.make(),this.onFatalError=this._events.make(),this.onDisconnected=this._events.make(),this.onClosed=this._events.make(),this._send=t=>new Promise((i,n)=>K(this,null,function*(){yield new Promise(a=>setTimeout(a,0)),this._ws.readyState===this._ws.OPEN?(this._ws.send(JSON.stringify(t),a=>{if(a)throw n(Pt({operationName:"RPC._send",info:ae(re({},gt.internalError),{detail:"failed to send rpc message"}),path:ut.prefix,error:a}))}),i()):n(Pt({operationName:"RPC._send",info:ae(re({},gt.internalError),{detail:"wrong state"}),path:ut.prefix,payload:{request:t,wsReadyState:Ja[this._ws.readyState]}}))}))}set reconnecting(t){this._reconnecting=t}get reconnecting(){return this._reconnecting}connect(t){return K(this,arguments,function*({domain:i,token:n,secure:a}){this._ws=new Zh.default(`${a?"wss":"ws"}://${i}/ws`,n),this._ws.onmessage=p=>{this._onMessage.emit(JSON.parse(p.data))},this._ws.onclose=()=>K(this,null,function*(){ut.debug("websocket closed",{id:this._id}),this.onDisconnected.emit()}),this._onMessage.add(p=>{td(p)&&this.onNotify.emit(p)});const u=yield new Promise((p,S)=>{const C=setTimeout(()=>{S(Pt({operationName:"RPC.connect",info:ae(re({},gt.timeout),{detail:"ws.open"}),path:ut.prefix}))},5e3);this._ws.onerror=b=>{S(Pt({operationName:"RPC.connect",info:gt.websocketConnectionFailure,path:ut.prefix,error:b}))},this._ws.onopen=()=>{clearTimeout(C),p()}}).catch(p=>p);if(u)throw u;this.negotiated=!0})}close(){this.closed||(this.closed=!0,ut.debug("closed"),this._ws.close(),this.onClosed.emit(),this._events.dispose())}resolvePendingRequests(){ut.debug("resolve pendingRequests",[...this._pendingRequests]),this._pendingRequests.forEach(t=>K(this,null,function*(){yield this._send(t)})),this._pendingRequests=[]}request(t,i){return K(this,null,function*(){if(this.closed)throw Pt({operationName:"RPC.request",info:ae(re({},gt.internalError),{detail:"rpc closed"}),path:ut.prefix,payload:{method:t,params:i,id:this._id}});let n=!1;try{const a=$r(t,i),c=()=>K(this,null,function*(){return yield this._onMessage.watch(S=>S.id===a.id,2e4).catch(()=>{if(!n)throw Pt({operationName:"RPC.request",info:ae(re({},gt.timeout),{detail:"rpc request timeout"}),path:ut.prefix,payload:{rpcTimeout:2e4,method:t,params:i,wsReadyState:Ja[this._ws.readyState],id:this._id}})})}),u=()=>K(this,null,function*(){ut.warn("[start] reconnecting. pending request",zt({operationName:"RPC.request",detail:"[start] reconnecting. pending request",payload:{request:a,id:this._id}})),this._pendingRequests.push(a);const S=yield Promise.race([c(),this.onFatalError.asPromise(20100).then(C=>{throw n||ut.error("[failed] reconnecting. pending request",Pt({operationName:"RPC.request",info:ae(re({},gt.internalError),{detail:"onFatalError while request"}),path:ut.prefix}),C),C})]);return n=!0,ut.warn("[end] reconnecting. pending request",zt({operationName:"RPC.request",detail:"[end] reconnecting. pending request",payload:{request:a,id:this._id}})),S});let p;if(this._reconnecting?p=yield u():(this._send(a).catch(S=>{ut.error("send error",S)}),p=yield Promise.race([c(),K(this,null,function*(){if(yield this.onDisconnected.asPromise(20100),n)return{};try{const S=yield u();return ut.warn(zt({operationName:"request.pendingRequest",detail:"success to handle disconnected"})),S}catch(S){throw Pt({operationName:"RPC.request",info:gt.connectionDisconnected,path:ut.prefix,error:S})}}),this.onFatalError.asPromise(20100).then(S=>{if(n)return{};throw Pt({operationName:"RPC.request",info:ae(re({},gt.internalError),{detail:"onFatalError while requesting"}),path:ut.prefix,error:S})}),this.onClosed.asPromise(20100).then(()=>{if(n)return{};throw Pt({operationName:"RPC.request",info:gt.onClosedWhileRequesting,path:ut.prefix,payload:{method:t,params:i}})})]),n=!0),p.error)throw ut.warn("[failed] request ",{message:p,method:t,params:i}),Pt({operationName:"RPC.request",info:ae(re({},gt.rpcResponseError),{detail:t,error:p.error}),payload:{message:p,method:t,params:i},path:ut.prefix});return p.result}catch(a){throw n=!0,a}})}notify(t,i){return K(this,null,function*(){const n=$r(t,i,!0);yield this._send(n)})}batch(t){return K(this,null,function*(){const i=t.map(({method:a,params:c})=>$r(a,c));return this._send(i).catch(a=>{throw a}),yield Promise.all(i.map(a=>K(this,[a],function*({id:c}){return yield this._onMessage.watch(p=>p.id===c,2e4)})))})}},$r=(t,i,n)=>n?{jsonrpc:"2.0",method:t,params:i}:{jsonrpc:"2.0",method:t,params:i,id:fi()},td=t=>!(!t.method||null!=t.id),Ja=["CONNECTING","OPEN","CLOSING","CLOSED"],st=new _e("packages/rtc-rpc-api-client/src/client.ts"),id=class{constructor(t){var i,n,a,c;this.config=t,this.closed=!1,this._domain=null!=(Xa=this.config.domain)?Xa:"rtc-api.skyway.ntt.com",this._secure=null==(Qa=this.config.secure)||Qa,this._token=this.config.token,this._rpc=new ed,this._subscribingChannelEvents=new Set,this._subscribingChannelVersions={},this._httpClient=new Ta(`http${this.config.secure?"s":""}://${this.config.domain}`),this._reconnectCount=0,this._reconnectLimit=8,this._events=new hi,this.onEvent=this._events.make(),this.onFatalError=this._events.make(),this.onClose=this._events.make(),this.onReconnected=this._events.make(),_e.level=null!=(n=null==(i=t.log)?void 0:i.level)?n:_e.level,_e.format=null!=(c=null==(a=t.log)?void 0:a.format)?c:_e.format,st.debug("RtcRpcApiClient spawned",t),this._rpc.onNotify.add(u=>{if("channelEventNotification"===u.method){const p=u.params;this._subscribingChannelVersions[p.data.channel.id]=p.data.channel.version,this.onEvent.emit({channelId:p.data.channel.id,event:p})}}),this._rpc.onDisconnected.add(()=>K(this,null,function*(){this._rpc.negotiated&&!this._rpc.closed&&!this._rpc.reconnecting&&(yield this._reconnect())})),this._rpc.onFatalError.once(u=>{st.error("fatal error",u),this.onFatalError.emit(u),this.close()})}get token(){return this._token}_reconnect(){return K(this,null,function*(){if(this._reconnectCount>=this._reconnectLimit)return this._rpc.onFatalError.emit(Pt({operationName:"RtcRpcApiClient._reconnect",info:{name:"failed to reconnect",detail:"_reconnectLimit exceeded",solution:""},path:st.prefix})),void this.close();this._rpc.reconnecting=!0,st.warn("[start] reconnect",zt({operationName:"RtcRpcApiClient._reconnect",detail:"reconnect start",payload:{reconnectCount:this._reconnectCount,limit:this._reconnectLimit}})),this._reconnectCount++;const t=100*ui(this._reconnectCount,2)+100*ui(this._reconnectCount,2)*Math.random();yield new Promise(i=>setTimeout(i,t));try{yield this.connect().catch(i=>{throw st.warn("[failed] reconnect rtc api",zt({operationName:"RtcRpcApiClient._reconnect",detail:"connect rpc failed",payload:{reconnectCount:this._reconnectCount}}),i),i}),this._rpc.reconnecting=!1,this._reconnectCount=0,this._rpc.resolvePendingRequests(),yield Promise.all([...this._subscribingChannelEvents].map(i=>K(this,null,function*(){const[n,a]=i.split(":"),c=this._subscribingChannelVersions[a];yield this.subscribeChannelEvents({appId:n,channelId:a,offset:c})}))).catch(i=>{throw st.warn("subscribeChannelEvents failed",zt({operationName:"RtcRpcApiClient._reconnect",detail:"subscribeChannelEvents failed",payload:{reconnectCount:this._reconnectCount}}),i),i}),st.warn("[end] reconnect",zt({operationName:"RtcRpcApiClient._reconnect",detail:"reconnect finished",payload:{reconnectCount:this._reconnectCount}})),this.onReconnected.emit()}catch(i){st.warn("[failed] reconnect",zt({operationName:"RtcRpcApiClient._reconnect",detail:"reconnect failed",payload:{reconnectCount:this._reconnectCount}}),i),yield this._reconnect()}})}updateToken(t){return K(this,null,function*(){st.debug("token update",{token:t}),this._token=t,yield this._updateAuthToken()})}close(){this.closed||(this.closed=!0,st.debug("closed"),this._rpc.close(),this.onClose.emit(),this._events.dispose())}health(){return K(this,null,function*(){return yield this._httpClient.get("/health")})}connect(){return K(this,null,function*(){st.debug("connect to rtc api rpc",this._domain),yield this._rpc.connect({domain:this._domain,token:this.token,secure:this._secure}).catch(t=>{throw Pt({operationName:"RtcRpcApiClient.connect",info:gt.failedToConnectRtcAPI,error:t,path:st.prefix})})})}_channelSubscribed(t,i){this._subscribingChannelEvents.add(t+":"+i),st.debug("_channelSubscribed",{appId:t,channelId:i,_subscribingChannelEvents:[...this._subscribingChannelEvents]})}_isSubscribingChannel(t,i){return this._subscribingChannelEvents.has(t+":"+i)}createChannel(t){return K(this,arguments,function*({name:i,metadata:n,appId:a}){const{channel:c}=yield this._rpc.request("createChannel",{name:i,metadata:n,appId:a,authToken:this.token});return this._channelSubscribed(a,c.id),c})}findOrCreateChannel(t){return K(this,arguments,function*({name:i,metadata:n,appId:a}){const{channel:c}=yield this._rpc.request("findOrCreateChannel",{name:i,metadata:n,appId:a,authToken:this.token});return this._channelSubscribed(a,c.id),c})}getChannel(t){return K(this,arguments,function*({appId:i,id:n}){const a=yield this._rpc.request("getChannel",{id:n,appId:i,authToken:this.token});return this._isSubscribingChannel(i,n)||(this._channelSubscribed(i,n),yield this.subscribeChannelEvents({appId:i,channelId:n,offset:a.channel.version})),a.channel})}getChannelByName(t){return K(this,arguments,function*({name:i,appId:n}){const a=yield this._rpc.request("getChannelByName",{name:i,appId:n,authToken:this.token}),c=a.channel.id;return this._isSubscribingChannel(n,c)||(this._channelSubscribed(n,c),yield this.subscribeChannelEvents({appId:n,channelId:c,offset:a.channel.version})),a.channel})}deleteChannel(t){return K(this,arguments,function*({id:i,appId:n}){yield this._rpc.request("deleteChannel",{id:i,appId:n,authToken:this.token})})}updateChannelMetadata(t){return K(this,arguments,function*({id:i,metadata:n,appId:a}){yield this._rpc.request("updateChannelMetadata",{id:i,metadata:n,appId:a,authToken:this.token})})}addMember(t){return K(this,arguments,function*({channelId:i,name:n,metadata:a,subscribeChannelEvents:c,appId:u,ttlSec:p,subtype:S,type:C}){return yield this._rpc.request("addMember",{channelId:i,name:n,metadata:a,subscribeChannelEvents:c,appId:u,ttlSec:p&&parseInt(p.toString()),authToken:this.token,subtype:S,type:C})})}updateMemberTtl(t){return K(this,arguments,function*(i,n=new Yi({times:8})){const{appId:a,channelId:c,memberId:u,ttlSec:p}=i;try{yield this._rpc.request("updateMemberTtl",{appId:a,channelId:c,memberId:u,ttlSec:p&&parseInt(p.toString()),authToken:this.token})}catch(S){if(n.exceeded)throw new li({path:st.prefix,info:gt.failedToUpdateMemberTTL,error:S});st.warn("retry updateMemberTtl",zt({operationName:"RtcRpcApiClient.updateMemberTtl",detail:"retry updateMemberTtl",appId:a,channelId:c,memberId:u,payload:{backoff:n.count}}),S),yield n.wait(),yield this.updateMemberTtl(i,n)}})}updateMemberMetadata(t){return K(this,arguments,function*({channelId:i,memberId:n,metadata:a,appId:c}){yield this._rpc.request("updateMemberMetadata",{channelId:i,memberId:n,metadata:a,appId:c,authToken:this.token})})}leaveChannel(t){return K(this,arguments,function*({channelId:i,id:n,appId:a}){yield this._rpc.request("removeMember",{channelId:i,id:n,appId:a,authToken:this.token})})}publishStream(t){return K(this,arguments,function*({appId:i,channelId:n,publisherId:a,contentType:c,metadata:u,origin:p,codecCapabilities:S,encodings:C,isEnabled:b}){return{publicationId:(yield this._rpc.request("publishStream",{channelId:n,publisherId:a,contentType:c[0].toUpperCase()+c.slice(1),metadata:u,origin:p,codecCapabilities:S,encodings:C?.map(k=>({id:k.id})),isEnabled:b,appId:i,authToken:this.token})).id}})}disablePublication(t){return K(this,arguments,function*({channelId:i,publicationId:n,appId:a}){yield this._rpc.request("disablePublication",{channelId:i,appId:a,publicationId:n,authToken:this.token})})}enablePublication(t){return K(this,arguments,function*({channelId:i,publicationId:n,appId:a}){yield this._rpc.request("enablePublication",{channelId:i,appId:a,publicationId:n,authToken:this.token})})}updatePublicationMetadata(t){return K(this,arguments,function*({channelId:i,publicationId:n,appId:a,metadata:c}){yield this._rpc.request("updatePublicationMetadata",{channelId:i,publicationId:n,metadata:c,appId:a,authToken:this.token})})}unpublishStream(t){return K(this,arguments,function*({channelId:i,publicationId:n,appId:a}){yield this._rpc.request("unpublishStream",{channelId:i,publicationId:n,appId:a,authToken:this.token})})}subscribeStream(t){return K(this,arguments,function*({channelId:i,subscriberId:n,publicationId:a,appId:c}){return{subscriptionId:(yield this._rpc.request("subscribeStream",{channelId:i,subscriberId:n,publicationId:a,appId:c,authToken:this.token})).id}})}unsubscribeStream(t){return K(this,arguments,function*({channelId:i,subscriptionId:n,appId:a}){yield this._rpc.request("unsubscribeStream",{channelId:i,subscriptionId:n,appId:a,authToken:this.token})})}getServerUnixtime(t){return K(this,arguments,function*(i,n=new Yi({times:8})){const{appId:a}=i;try{return(yield this._rpc.request("getServerUnixtime",{appId:a,authToken:this.token})).unixtime}catch(c){if(n.exceeded)throw c;return st.warn(zt({operationName:"RtcRpcApiClient.getServerUnixtime",detail:"retry getServerUnixtime",appId:a,payload:{backoff:n.count}}),c),yield n.wait(),this.getServerUnixtime(i,n)}})}_updateAuthToken(){return K(this,null,function*(){yield this._rpc.request("updateAuthToken",{authToken:this.token})})}subscribeChannelEvents(t){return K(this,arguments,function*({appId:i,channelId:n,offset:a}){try{st.debug("[start] subscribeChannelEvents",{offset:a}),yield this._rpc.request("subscribeChannelEvents",{appId:i,authToken:this.token,channelId:n,offset:a}),st.debug("[end] subscribeChannelEvents",{offset:a})}catch(c){if(!(c instanceof li&&c.info.name===gt.connectionDisconnected.name))throw st.error("[failed] subscribeChannelEvents",Pt({operationName:"RtcRpcApiClient.subscribeChannelEvents",info:ae(re({},gt.internalError),{detail:"subscribeChannelEvents failed"}),path:st.prefix,error:c,payload:{offset:a},appId:i,channelId:n})),c;st.warn("reconnect happened while subscribeChannelEvents. retry",zt({operationName:"RtcRpcApiClient.subscribeChannelEvents",detail:"reconnect happened while subscribeChannelEvents. retry",appId:i,channelId:n,payload:{offset:a}}),c),yield this.subscribeChannelEvents({appId:i,channelId:n,offset:a})}})}};U(),U();var nd=jt(Fs()),rd=class{constructor(t={}){this.rtcApi={domain:"rtc-api.skyway.ntt.com",timeout:3e4,secure:!0,eventSubscribeTimeout:5e3},this.log={level:"error",format:"object"},Object.assign(this,(0,nd.default)(this,t))}};U(),U();var ve=ae(re({},gt),{invalidParameter:{name:"invalidParameter",detail:"",solution:""},notFound:{name:"notFound",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},internalError:{name:"internalError",detail:"",solution:""},invalidRequestParameter:{name:"invalidRequestParameter",detail:"\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093",solution:"API\u4ed5\u69d8\u3092\u78ba\u8a8d\u3057\u6b63\u3057\u3044\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"},insufficientPermissions:{name:"insufficientPermissions",detail:"token\u306e\u6a29\u9650\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059 Token permissions are insufficient",solution:"Token\u306b\u5fc5\u8981\u306a\u6a29\u9650\u3092\u52a0\u3048\u3066\u304f\u3060\u3055\u3044 Add the necessary permissions to the Token"},publicationNestedTooMuch:{name:"publicationNestedTooMuch",detail:"origin\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308bPublication\u3092Publication\u306eorigin\u306b\u6307\u5b9a\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093 It is not possible to specify the origin of a publication for which Origin has been set",solution:"\u4ed5\u69d8\u4e0a\u306e\u5236\u7d04\u306a\u306e\u3067\u89e3\u6c7a\u6cd5\u306f\u3042\u308a\u307e\u305b\u3093 There is no solution because it is a specification limitation"},channelNotFound:{name:"channelNotFound",detail:"\u53c2\u7167\u3057\u3088\u3046\u3068\u3057\u305fchannel\u306f\u5b58\u5728\u3057\u307e\u305b\u3093 The channel you tried to reference does not exist.",solution:"channelId\u3084channelName\u304c\u6b63\u3057\u3044\u304b\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044 Make sure that the Channel id and channel name are correct."},memberNotFound:{name:"memberNotFound",detail:"\u53c2\u7167\u3057\u3088\u3046\u3068\u3057\u305fMember\u306f\u5b58\u5728\u3057\u307e\u305b\u3093 The member you tried to reference does not exist.",solution:"memberId\u3084memberName\u304c\u6b63\u3057\u3044\u304b\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044 Make sure that the member id and member name is correct."},publicationNotFound:{name:"publicationNotFound",detail:"\u53c2\u7167\u3057\u3088\u3046\u3068\u3057\u305fPublication\u306f\u5b58\u5728\u3057\u307e\u305b\u3093 The Publication you tried to reference does not exist.",solution:"publicationId\u304c\u6b63\u3057\u3044\u304b\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044 Make sure that the publication id is correct."},subscriptionNotFound:{name:"subscriptionNotFound",detail:"\u53c2\u7167\u3057\u3088\u3046\u3068\u3057\u305fSubscription\u306f\u5b58\u5728\u3057\u307e\u305b\u3093 The Subscription you tried to reference does not exist.",solution:"subscriptionId\u304c\u6b63\u3057\u3044\u304b\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044 Make sure that the subscription id is correct."},operationConflicted:{name:"operationConflicted",detail:"\u4e0e\u3048\u3089\u308c\u305f\u540d\u524d\u306e\u30c1\u30e3\u30cd\u30eb\u306f\u3001\u4eca\u307e\u3067\u306e\u7af6\u5408\u3059\u308b\u8981\u6c42\u306b\u3088\u3063\u3066\u3001\u3059\u3067\u306b\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059 The channel with the given name has already been created by a conflicting request up to now",solution:"\u5225\u306e\u540d\u524d\u3092\u4f7f\u3063\u3066channel\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044"},channelNameDuplicated:{name:"channelNameDuplicated",detail:"\u305d\u306e\u540d\u524d\u306eChannel\u306f\u3059\u3067\u306b\u5b58\u5728\u3057\u307e\u3059 A channel with that name already exists",solution:"\u5225\u306e\u540d\u524d\u3092\u4f7f\u3063\u3066channel\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044"},memberNameDuplicated:{name:"memberNameDuplicated",detail:"\u305d\u306e\u540d\u524d\u306eMember\u306f\u3059\u3067\u306b\u5b58\u5728\u3057\u307e\u3059 A member with that name already exists",solution:"\u5225\u306e\u540d\u524d\u3092\u4f7f\u3063\u3066member\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044"},subscriptionAlreadyExists:{name:"subscriptionAlreadyExists",detail:"Publication\u306f\u3059\u3067\u306bSubscribe\u3055\u308c\u3066\u3044\u307e\u3059",solution:"publicationId\u304c\u6b63\u3057\u3044\u304b\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044"},rateLimitExceeded:{name:"rateLimitExceeded",detail:"\u30ea\u30bd\u30fc\u30b9\u3092\u898f\u5b9a\u4ed5\u69d8\u4ee5\u4e0a\u306b\u6d88\u8cbb\u3057\u3066\u3044\u307e\u3059",solution:"\u30ea\u30bd\u30fc\u30b9\u306e\u6d88\u8cbb\u91cf\u3092\u6e1b\u3089\u3057\u3066\u304f\u3060\u3055\u3044"},authTokenExpired:{name:"authTokenExpired",detail:"AuthToken\u304c\u671f\u9650\u5207\u308c\u3067\u3059",solution:"\u9069\u5207\u306aExp\u3092\u8a2d\u5b9a\u3057\u305fAuthToken\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044"},serverBusy:{name:"serverBusy",detail:"\u30b5\u30fc\u30d3\u30b9\u5074\u306e\u554f\u984c\u3067\u3059",solution:"\u3057\u3070\u3089\u304f\u6642\u9593\u3092\u7f6e\u3044\u3066\u518d\u8a66\u884c\u3057\u3066\u304f\u3060\u3055\u3044"}});function Ya({appId:t,detail:i,channelId:n,operationName:a,payload:c}){return{operationName:a,payload:c,detail:i,appId:t,channelId:n}}function ge({operationName:t,info:i,error:n,path:a,channelId:c,appId:u,payload:p}){return new li({error:n,info:i,payload:{payload:p,operationName:t,channelId:c,appId:u},path:a})}Object.keys(ve),U();var Ae=new _e("packages/rtc-api-client/src/infrastructure/api.ts"),sd=class{constructor(t){this._client=t,this.closed=!1,this.onClose=new Fe,this.onFatalError=new Fe,this._token=Zi.Decode(this._client.token),t.onClose.once(()=>{this.close()}),t.onFatalError.add(i=>{this.onFatalError.emit(i)})}connect(){return K(this,null,function*(){yield this._client.connect()})}updateAuthToken(t){return K(this,null,function*(){this._token=Zi.Decode(t),yield this._client.updateToken(t)})}close(){this.closed||(this.closed=!0,Ae.debug("closed"),this._client.close(),this.onClose.emit(),this.onClose.removeAllListeners())}_commonError(t,i,n){switch(i){case-32602:return ge({operationName:t,info:ve.invalidRequestParameter,path:Ae.prefix,error:n});case-32603:return ge({operationName:t,info:ve.internalError,path:Ae.prefix,error:n});case 403:case 4030:return ge({operationName:t,info:ve.insufficientPermissions,path:Ae.prefix,error:n})}}createChannel(t,i){return K(this,null,function*(){const{id:n}=yield this._client.createChannel({appId:t,name:i.name,metadata:i.metadata}).catch(c=>{var u,p,S;const{info:C}=c,b=this._commonError("RtcApiImpl.createChannel",null!=(p=null==(u=C?.error)?void 0:u.code)?p:-1,c);if(b)throw b;switch(null==(S=C?.error)?void 0:S.code){case 404:throw ge({operationName:"RtcApiImpl.createChannel",path:Ae.prefix,info:ve.channelNotFound,error:c});case 409:throw ge({operationName:"RtcApiImpl.createChannel",path:Ae.prefix,info:ve.channelNameDuplicated,error:c});default:throw ge({operationName:"RtcApiImpl.createChannel",path:Ae.prefix,info:ve.internalError,error:c})}});return yield this.getChannel(t,{id:n})})}getChannel(t,i){return K(this,arguments,function*(n,{name:a,id:c}){if(c)return yield this._client.getChannel({appId:n,id:c}).catch(u=>{var p,S,C;const{info:b}=u,E=this._commonError("RtcApiImpl.getChannel",null!=(S=null==(p=b?.error)?void 0:p.code)?S:-1,u);if(E)throw E;if(404===(null==(C=b?.error)?void 0:C.code))throw ge({operationName:"RtcApiImpl.getChannel",path:Ae.prefix,info:ve.channelNotFound,error:u});throw ge({operationName:"RtcApiImpl.getChannel",path:Ae.prefix,info:ve.internalError,error:u})});if(a)return yield this._client.getChannelByName({appId:n,name:a}).catch(u=>{var p,S,C;const{info:b}=u,E=this._commonError("RtcApiImpl.getChannel",null!=(S=null==(p=b?.error)?void 0:p.code)?S:-1,u);if(E)throw E;if(404===(null==(C=b?.error)?void 0:C.code))throw ge({operationName:"getChannel",path:Ae.prefix,info:ve.channelNotFound,error:u});throw ge({operationName:"getChannel",path:Ae.prefix,info:ve.internalError,error:u})});throw ge({operationName:"RtcApiImpl.createChannel",path:Ae.prefix,info:ve.invalidRequestParameter})})}findOrCreateChannel(t,i){return K(this,null,function*(){return this._client.findOrCreateChannel(ae(re({},i),{appId:t})).catch(n=>{var a,c,u,p;const{info:S}=n,C=this._commonError("RtcApiImpl.findOrCreateChannel",null!=(c=null==(a=S?.error)?void 0:a.code)?c:-1,n);if(C)throw C;if(i.name&&409===(null==(u=S?.error)?void 0:u.code))return this.getChannel(t,{name:i.name});switch(null==(p=S?.error)?void 0:p.code){case 404:throw ge({operationName:"RtcApiImpl.findOrCreateChannel",path:Ae.prefix,info:ve.channelNotFound,error:n});case 409:throw ge({operationName:"RtcApiImpl.findOrCreateChannel",path:Ae.prefix,info:ve.channelNameDuplicated,error:n});default:throw ge({operationName:"RtcApiImpl.findOrCreateChannel",path:Ae.prefix,info:ve.internalError,error:n})}})})}deleteChannel(t,i){return K(this,null,function*(){yield this._client.deleteChannel({appId:t,id:i}).catch(n=>{var a,c,u;const{info:p}=n,S=this._commonError("RtcApiImpl.deleteChannel",null!=(c=null==(a=p?.error)?void 0:a.code)?c:-1,n);if(S)throw S;if(404===(null==(u=p?.error)?void 0:u.code))throw ge({operationName:"RtcApiImpl.deleteChannel",path:Ae.prefix,info:ve.channelNotFound,error:n});throw ge({operationName:"RtcApiImpl.deleteChannel",path:Ae.prefix,info:ve.internalError,error:n})})})}updateChannelMetadata(t,i,n){return K(this,null,function*(){yield this._client.updateChannelMetadata({appId:t,id:i,metadata:n}).catch(a=>{var c,u,p;const{info:S}=a,C=this._commonError("RtcApiImpl.updateChannelMetadata",null!=(u=null==(c=S?.error)?void 0:c.code)?u:-1,a);if(C)throw C;if(404===(null==(p=S?.error)?void 0:p.code))throw ge({operationName:"RtcApiImpl.updateChannelMetadata",path:Ae.prefix,info:ve.channelNotFound,error:a});throw ge({operationName:"RtcApiImpl.updateChannelMetadata",path:Ae.prefix,info:ve.internalError,error:a})})})}join(t,i,n){return K(this,null,function*(){const{memberId:a}=yield this._client.addMember({appId:t,channelId:i,name:n.name,metadata:n.metadata,ttlSec:n.ttlSec,type:n.type,subtype:n.subtype}).catch(u=>{var p,S,C;const{info:b}=u,E=this._commonError("RtcApiImpl.addMember",null!=(S=null==(p=b?.error)?void 0:p.code)?S:-1,u);if(E)throw E;switch(null==(C=b?.error)?void 0:C.code){case 404:throw ge({operationName:"RtcApiImpl.addMember",path:Ae.prefix,info:ve.channelNotFound,error:u});case 409:throw ge({operationName:"RtcApiImpl.addMember",path:Ae.prefix,info:ve.memberNameDuplicated,error:u});default:throw ge({operationName:"RtcApiImpl.addMember",path:Ae.prefix,info:ve.internalError,error:u})}});return{id:a,name:n.name,type:n.type,subtype:n.subtype,metadata:n.metadata}})}updateMemberTtl(t,i,n,a){return K(this,null,function*(){yield this._client.updateMemberTtl({appId:t,channelId:i,memberId:n,ttlSec:a}).catch(c=>{var u,p,S;const{info:C}=c,b=this._commonError("RtcApiImpl.updateMemberTtl",null!=(p=null==(u=C?.error)?void 0:u.code)?p:-1,c);if(b)throw b;if(404===(null==(S=C?.error)?void 0:S.code))throw ge({operationName:"RtcApiImpl.updateMemberTtl",path:Ae.prefix,info:ve.memberNotFound,error:c});throw ge({operationName:"RtcApiImpl.updateMemberTtl",path:Ae.prefix,info:ve.internalError,error:c})})})}getServerUnixtime(t){return K(this,null,function*(){return yield this._client.getServerUnixtime({appId:t}).catch(i=>{var n,a;const{info:c}=i;throw this._commonError("RtcApiImpl.getServerUnixtime",null!=(a=null==(n=c?.error)?void 0:n.code)?a:-1,i)||ge({operationName:"RtcApiImpl.getServerUnixtime",path:Ae.prefix,info:ve.internalError,error:i})})})}updateMemberMetadata(t,i,n,a){return K(this,null,function*(){yield this._client.updateMemberMetadata({appId:t,channelId:i,memberId:n,metadata:a}).catch(c=>{var u,p,S;const{info:C}=c,b=this._commonError("RtcApiImpl.updateMemberMetadata",null!=(p=null==(u=C?.error)?void 0:u.code)?p:-1,c);if(b)throw b;if(404===(null==(S=C?.error)?void 0:S.code))throw ge({operationName:"RtcApiImpl.updateMemberMetadata",path:Ae.prefix,info:ve.memberNotFound,error:c});throw ge({operationName:"RtcApiImpl.updateMemberMetadata",path:Ae.prefix,info:ve.internalError,error:c})})})}leave(t,i,n){return K(this,null,function*(){yield this._client.leaveChannel({channelId:i,id:n,appId:t}).catch(a=>{var c,u,p;const{info:S}=a,C=this._commonError("RtcApiImpl.leaveChannel",null!=(u=null==(c=S?.error)?void 0:c.code)?u:-1,a);if(C)throw C;if(404===(null==(p=S?.error)?void 0:p.code))throw ge({operationName:"RtcApiImpl.leaveChannel",path:Ae.prefix,info:ve.memberNotFound,error:a});throw ge({operationName:"RtcApiImpl.leaveChannel",path:Ae.prefix,info:ve.internalError,error:a})})})}publish(t,i){return K(this,null,function*(){const{publicationId:n}=yield this._client.publishStream({channelId:i.channel,publisherId:i.publisher,contentType:i.contentType,metadata:i.metadata,origin:i.origin,codecCapabilities:i.codecCapabilities,encodings:i.encodings,isEnabled:i.isEnabled,appId:t}).catch(a=>{var c,u;const{info:S}=a,C=this._commonError("RtcApiImpl.publish",null!=(u=null==(c=S?.error)?void 0:c.code)?u:-1,a);if(C)throw C;throw ge({operationName:"RtcApiImpl.publish",path:Ae.prefix,info:ve.internalError,error:a})});return n})}updatePublicationMetadata(t,i,n,a){return K(this,null,function*(){yield this._client.updatePublicationMetadata({channelId:i,publicationId:n,metadata:a,appId:t}).catch(c=>{var u,p,S;const{info:C}=c,b=this._commonError("RtcApiImpl.updatePublicationMetadata",null!=(p=null==(u=C?.error)?void 0:u.code)?p:-1,c);if(b)throw b;if(404===(null==(S=C?.error)?void 0:S.code))throw ge({operationName:"RtcApiImpl.updatePublicationMetadata",path:Ae.prefix,info:ve.publicationNotFound,error:c});throw ge({operationName:"RtcApiImpl.updatePublicationMetadata",path:Ae.prefix,info:ve.internalError,error:c})})})}disablePublication(t,i,n){return K(this,null,function*(){yield this._client.disablePublication({channelId:i,publicationId:n,appId:t}).catch(a=>{var c,u,p;const{info:S}=a,C=this._commonError("RtcApiImpl.disablePublication",null!=(u=null==(c=S?.error)?void 0:c.code)?u:-1,a);if(C)throw C;if(404===(null==(p=S?.error)?void 0:p.code))throw ge({operationName:"RtcApiImpl.disablePublication",path:Ae.prefix,info:ve.publicationNotFound,error:a});throw ge({operationName:"RtcApiImpl.disablePublication",path:Ae.prefix,info:ve.internalError,error:a})})})}enablePublication(t,i,n){return K(this,null,function*(){yield this._client.enablePublication({channelId:i,publicationId:n,appId:t}).catch(a=>{var c,u,p;const{info:S}=a,C=this._commonError("RtcApiImpl.enablePublication",null!=(u=null==(c=S?.error)?void 0:c.code)?u:-1,a);if(C)throw C;if(404===(null==(p=S?.error)?void 0:p.code))throw ge({operationName:"RtcApiImpl.enablePublication",path:Ae.prefix,info:ve.publicationNotFound,error:a});throw ge({operationName:"RtcApiImpl.enablePublication",path:Ae.prefix,info:ve.internalError,error:a})})})}unpublish(t,i,n){return K(this,null,function*(){yield this._client.unpublishStream({channelId:i,publicationId:n,appId:t}).catch(a=>{var c,u,p;const{info:S}=a,C=this._commonError("RtcApiImpl.unpublishStream",null!=(u=null==(c=S?.error)?void 0:c.code)?u:-1,a);if(C)throw C;if(404===(null==(p=S?.error)?void 0:p.code))throw ge({operationName:"RtcApiImpl.unpublishStream",path:Ae.prefix,info:ve.publicationNotFound,error:a});throw ge({operationName:"RtcApiImpl.unpublishStream",path:Ae.prefix,info:ve.internalError,error:a})})})}subscribe(t,i){return K(this,null,function*(){const{subscriptionId:n}=yield this._client.subscribeStream({channelId:i.channel.id,subscriberId:i.subscriber.id,publicationId:i.publication.id,appId:t}).catch(a=>{var c,u,p;const{info:S}=a,C=this._commonError("RtcApiImpl.subscribeStream",null!=(u=null==(c=S?.error)?void 0:c.code)?u:-1,a);if(C)throw C;switch(null==(p=S?.error)?void 0:p.code){case 404:throw ge({operationName:"RtcApiImpl.subscribeStream",path:Ae.prefix,info:ve.publicationNotFound,error:a});case 409:throw ge({operationName:"RtcApiImpl.subscribeStream",path:Ae.prefix,info:ve.subscriptionAlreadyExists,error:a});default:throw ge({operationName:"RtcApiImpl.subscribeStream",path:Ae.prefix,info:ve.internalError,error:a})}});return n})}unsubscribe(t,i,n){return K(this,null,function*(){yield this._client.unsubscribeStream({appId:t,channelId:i,subscriptionId:n}).catch(a=>{var c,u,p;const{info:S}=a,C=this._commonError("RtcApiImpl.unsubscribeStream",null!=(u=null==(c=S?.error)?void 0:c.code)?u:-1,a);if(C)throw C;if(404===(null==(p=S?.error)?void 0:p.code))throw ge({operationName:"RtcApiImpl.unsubscribeStream",path:Ae.prefix,info:ve.publicationNotFound,error:a});throw ge({operationName:"RtcApiImpl.unsubscribeStream",path:Ae.prefix,info:ve.internalError,error:a})})})}};U();var Ei=new _e("packages/rtc-api-client/src/infrastructure/eventObserver.ts"),ad=class{constructor(t,i,n,a){this.onEvent=new Fe,this._disposer=[];const c=new od(n.version,u=>K(this,null,function*(){yield i.subscribeChannelEvents({appId:t,channelId:n.id,offset:u}),yield new Promise(p=>setTimeout(p,a.eventSubscribeTimeout)),c.packetLostHappened&&Ei.error(ge({operationName:"EventObserverImpl.eventJitterBuffer",info:ae(re({},ve.internalError),{detail:"failed to resolve event lost"}),channelId:n.id,appId:t,path:Ei.prefix}))}));this._disposer=[i.onEvent.add(u=>K(this,[u],function*({channelId:p,event:S}){p===n.id&&c.push({event:S,version:S.data.channel.version})})).removeListener,c.onEvent.add(u=>{this.onEvent.emit(u)}).removeListener]}dispose(){this._disposer.forEach(t=>t()),this.onEvent.removeAllListeners()}},od=class{constructor(t,i,n=1e3){this.presentVersion=t,this.onPacketLost=i,this.packetLifetime=n,this.onEvent=new Fe,this.eventBuffer={},this.packetLostHappened=!1}get expectNextVersion(){return this.presentVersion+1}push(t){const i=t.version;if(!(i<this.expectNextVersion))return i>this.expectNextVersion?(Ei.debug("maybe miss order event received",ae(re({},t),{presentVersion:this.presentVersion})),this.eventBuffer[i]=t,void this.handlePacketLifetime()):(this.packetLostHappened&&(Ei.warn("event packetLost resolved",Ya({operationName:"EventJitterBuffer.push",detail:"event packetLost resolved",payload:{eventFrame:t}})),this.packetLostHappened=!1),this.eventBuffer[i]=t,void this.resolveEvents());Ei.debug("duplicate event",ae(re({},t),{presentVersion:this.presentVersion}))}handlePacketLifetime(){const[t]=Object.keys(this.eventBuffer).sort().map(i=>this.eventBuffer[Number(i)]);null==this.packetLifeTimer&&t&&(Ei.debug("set event packetLost timer",ae(re({},t),{presentVersion:this.presentVersion})),this.packetLifeTimer=setTimeout(()=>K(this,null,function*(){if(this.presentVersion<t.version){if(Ei.warn("event packetLost",Ya({operationName:"EventJitterBuffer.handlePacketLifetime",detail:"eventPacket lost",payload:{oldestBufferedEvent:t,eventBufferLength:Object.keys(this.eventBuffer).length,presentVersion:this.presentVersion}})),this.packetLostHappened)return;this.packetLostHappened=!0,yield this.onPacketLost(this.expectNextVersion)}this.packetLifeTimer=void 0,this.handlePacketLifetime()}),this.packetLifetime))}resolveEvents(){const t=[];for(let i=this.expectNextVersion;;i++){const n=this.eventBuffer[i];if(!n)break;t.push(n),delete this.eventBuffer[i]}t.length>0&&(this.presentVersion=t.slice(-1)[0].version,t.forEach(i=>{this.onEvent.emit(i.event)}))}},$t=new _e("packages/rtc-api-client/src/client.ts"),cd=class qo{constructor(i,n,a,c){this.appId=i,this.config=n,this.apiClient=a,this._eventObserverFactory=c,this.closed=!1,this.onFatalError=new Fe,this.apiClient.onFatalError.pipe(this.onFatalError)}static Create(i){return K(this,null,function*(){const n=new rd(i);n.log&&(_e.level=n.log.level,_e.format=n.log.format),$t.debug("RtcApiClient spawned",n);const a=new id(ae(re({},n.rtcApi),{token:i.token,log:n.log})),c=new sd(a);return yield c.connect(),new qo(i.appId,n,c,(p,S)=>new ad(p,a,S,n.rtcApi))})}updateAuthToken(i){return K(this,null,function*(){yield this.apiClient.updateAuthToken(i)})}getServerUnixtimeInMs(){return K(this,null,function*(){return this.apiClient.getServerUnixtime(this.appId)})}getServerUnixtimeInSec(){return K(this,null,function*(){return Math.floor((yield this.getServerUnixtimeInMs())/1e3)})}createChannel(){return K(this,arguments,function*(i={}){$t.debug("[start] apiClient.createChannel",{init:i});const n=yield this.apiClient.createChannel(this.appId,i).catch(c=>{throw $t.debug("[failed] apiClient.createChannel",{init:i,e:c}),c});return $t.debug("[end] apiClient.createChannel",{init:i,channelDto:n}),Gr(this.appId,this._eventObserverFactory(this.appId,n),this.apiClient,n,this.config)})}findChannel(i){return K(this,null,function*(){$t.debug("[start] apiClient.getChannel",{query:i});const n=yield this.apiClient.getChannel(this.appId,i).catch(c=>{throw $t.debug("[failed] apiClient.getChannel",{query:i,e:c}),c}),a=Gr(this.appId,this._eventObserverFactory(this.appId,n),this.apiClient,n,this.config);return $t.debug("[end] apiClient.getChannel",{channelId:a.id}),a})}findOrCreateChannel(i){return K(this,null,function*(){$t.debug("[start] apiClient.findOrCreateChannel",{query:i});const n=yield this.apiClient.findOrCreateChannel(this.appId,i).catch(c=>{throw $t.debug("[failed] apiClient.findOrCreateChannel",{query:i,e:c}),c});return $t.debug("[end] apiClient.findOrCreateChannel",{query:i}),Gr(this.appId,this._eventObserverFactory(this.appId,n),this.apiClient,n,this.config)})}deleteChannel(i){return this.apiClient.deleteChannel(this.appId,i)}close(){this.closed||(this.closed=!0,$t.debug("closed",{appid:this.appId}),this.apiClient.close())}};U(),U();var ud={};U();var Le=new _e("packages/rtc-api-client/src/domain/channel.ts"),ld=class{constructor(t,{id:i,name:n,members:a,metadata:c,publications:u,subscriptions:p,version:S},C,b,E){this.appId=t,this.eventObserver=C,this.apiClient=b,this.config=E,this.disposed=!1,this._events=new hi,this.onClosed=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberListChanged=this._events.make(),this.onMemberJoined=this._events.make(),this.onMemberLeft=this._events.make(),this.onMemberMetadataUpdated=this._events.make(),this.onPublicationDisabled=this._events.make(),this.onPublicationEnabled=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationMetadataUpdated=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.updateChannelMetadata=k=>new Promise((q,V)=>{let F=!1;this.apiClient.updateChannelMetadata(this.appId,this.id,k).catch(O=>{F=!0,V(O)}),this.onMetadataUpdated.watch(O=>O.channel.metadata===k).then(()=>q()).catch(O=>{F||V(ge({operationName:"ChannelImpl.updateChannelMetadata",info:ae(re({},ve.timeout),{detail:"onMetadataUpdated"}),path:Le.prefix,error:O,appId:this.appId,channelId:this.id}))})}),this.leave=(k,q)=>new Promise((V,F)=>{let O=!1;this.apiClient.leave(this.appId,k,q).catch(G=>{O=!0,F(G)}),this.onMemberLeft.watch(G=>G.member.id===q,this.config.rtcApi.timeout).then(()=>V()).catch(G=>{O||F(ge({operationName:"ChannelImpl.leave",info:ae(re({},ve.timeout),{detail:"onMemberLeft"}),path:Le.prefix,error:G,appId:this.appId,channelId:this.id}))})}),this.updateMemberMetadata=(k,q)=>new Promise((V,F)=>{let O=!1;this.apiClient.updateMemberMetadata(this.appId,this.id,k,q).catch(G=>{O=!0,F(G)}),this.onMemberMetadataUpdated.watch(G=>G.member.id===k&&G.member.metadata===q).then(()=>V()).catch(G=>{O||F(ge({operationName:"ChannelImpl.updateMemberMetadata",info:ae(re({},ve.timeout),{detail:"onMemberMetadataUpdated"}),path:Le.prefix,error:G,appId:this.appId,channelId:this.id}))})}),this.unpublish=k=>new Promise((q,V)=>{let F=!1;this.apiClient.unpublish(this.appId,this.id,k).catch(O=>{F=!0,V(O)}),this.onStreamUnpublished.watch(O=>O.publication.id===k).then(()=>q()).catch(O=>{F||V(ge({operationName:"ChannelImpl.unpublish",info:ae(re({},ve.timeout),{detail:"onStreamUnpublished"}),path:Le.prefix,error:O,payload:{publicationId:k},appId:this.appId,channelId:this.id}))})}),this.updatePublicationMetadata=(k,q)=>new Promise((V,F)=>{let O=!1;this.apiClient.updatePublicationMetadata(this.appId,this.id,k,q).catch(G=>{O=!0,F(G)}),this.onPublicationMetadataUpdated.watch(G=>G.publication.id===k&&G.publication.metadata===q).then(()=>V()).catch(G=>{O||F(ge({operationName:"ChannelImpl.updatePublicationMetadata",info:ae(re({},ve.timeout),{detail:"onPublicationMetadataUpdated"}),path:Le.prefix,error:G,payload:{publicationId:k},appId:this.appId,channelId:this.id}))})}),this.disablePublication=k=>new Promise((q,V)=>{let F=!1;this.apiClient.disablePublication(this.appId,this.id,k).catch(O=>{F=!0,V(O)}),this.onPublicationDisabled.watch(O=>O.publication.id===k).then(()=>q()).catch(O=>{F||V(ge({operationName:"ChannelImpl.disablePublication",info:ae(re({},ve.timeout),{detail:"onPublicationDisabled"}),path:Le.prefix,error:O,payload:{publicationId:k},appId:this.appId,channelId:this.id}))})}),this.enablePublication=k=>new Promise((q,V)=>{let F=!1;this.apiClient.enablePublication(this.appId,this.id,k).catch(O=>{F=!0,V(O)}),this.onPublicationEnabled.watch(O=>O.publication.id===k).then(()=>q()).catch(O=>{F||V(ge({operationName:"ChannelImpl.enablePublication",info:ae(re({},ve.timeout),{detail:"onPublicationEnabled"}),path:Le.prefix,error:O,payload:{publicationId:k},appId:this.appId,channelId:this.id}))})}),this.unsubscribe=k=>new Promise((q,V)=>{let F=!1;this.apiClient.unsubscribe(this.appId,this.id,k).catch(O=>{F=!0,V(O)}),this.onPublicationUnsubscribed.watch(O=>O.subscription.id===k).then(()=>q()).catch(O=>{F||V(ge({operationName:"ChannelImpl.unsubscribe",info:ae(re({},ve.timeout),{detail:"onPublicationUnsubscribed"}),path:Le.prefix,error:O,payload:{subscriptionId:k},appId:this.appId,channelId:this.id}))})}),this.id=i,this.name=n,this.metadata=c,this.members=a,this.publications=u,this.subscriptions=p,this.version=S,C.onEvent.add(k=>{Le.debug("received event: ",k),this.version=k.data.channel.version;try{switch(k.type){case"ChannelDeleted":this._channelClosed();break;case"ChannelMetadataUpdated":this._channelMetadataUpdated(k.data);break;case"MemberAdded":this._memberJoined(k.data);break;case"MemberRemoved":this._memberLeft(k.data);break;case"MemberMetadataUpdated":this._memberMetadataUpdated(k.data);break;case"StreamPublished":this._streamPublished(k.data);break;case"StreamUnpublished":this._streamUnpublished(k.data);break;case"PublicationMetadataUpdated":this._publicationMetadataUpdated(k.data);break;case"PublicationDisabled":this._publicationDisabled(k.data);break;case"PublicationEnabled":this._publicationEnabled(k.data);break;case"StreamSubscribed":this._streamSubscribed(k.data);break;case"StreamUnsubscribed":this._streamUnsubscribed(k.data)}}catch(q){Le.error(q)}}),b.onClose.once(()=>{this.dispose()})}getMember(t){return this.members.find(i=>i.id===t)}addMember(t){return this.getMember(t.id)||(this.members.push(t),t)}deleteMember(t){this.members=this.members.filter(i=>i.id!==t)}getPublication(t){return this.publications.find(i=>i.id===t)}addPublication(t){var i,n;const a=this.getPublication(t.id);if(a)return a;const c=ae(re({},t),{channelId:this.id,codecCapabilities:null!=(i=t.codecCapabilities)?i:[],encodings:null!=(n=t.encodings)?n:[]});return this.publications.push(c),c}deletePublication(t){this.publications=this.publications.filter(i=>i.id!==t)}getSubscription(t){return this.subscriptions.find(i=>i.id===t)}addSubscription(t){const i=this.getSubscription(t.id);if(i)return i;const n=this.getPublication(t.publicationId),a=ae(re({},t),{channelId:this.id,publisherId:n.publisherId,contentType:n.contentType});return this.subscriptions.push(a),a}deleteSubscription(t){this.subscriptions=this.subscriptions.filter(i=>i.id!==t)}_channelClosed(){this.onClosed.emit({})}_channelMetadataUpdated(t){this.metadata=t.channel.metadata,this.onMetadataUpdated.emit(t)}_memberJoined(t){this.addMember(t.member),this.onMemberJoined.emit(t),this.onMemberListChanged.emit({})}_memberLeft(t){const i=this.getMember(t.member.id);if(!i)throw ge({operationName:"ChannelImpl._memberLeft",info:ve.memberNotFound,path:Le.prefix,payload:{event:t},appId:this.appId,channelId:this.id});this.deleteMember(i.id),this.onMemberLeft.emit({member:i}),this.onMemberListChanged.emit({})}_memberMetadataUpdated(t){const i=this.getMember(t.member.id);if(!i)throw ge({operationName:"ChannelImpl._memberMetadataUpdated",info:ve.memberNotFound,path:Le.prefix,payload:{event:t},appId:this.appId,channelId:this.id});i.metadata=t.member.metadata,this.onMemberMetadataUpdated.emit(t)}_streamPublished(t){const i=this.addPublication(t.publication),n=ae(re({},t),{publication:i});this.onStreamPublished.emit(n),this.onPublicationListChanged.emit({})}_streamUnpublished(t){const i=this.getPublication(t.publication.id);if(!i)throw ge({operationName:"ChannelImpl._streamUnpublished",info:ve.publicationNotFound,path:Le.prefix,payload:{event:t},appId:this.appId,channelId:this.id});this.deletePublication(i.id);const n=ae(re({},t),{publication:i});this.onStreamUnpublished.emit(n),this.onPublicationListChanged.emit({})}_publicationMetadataUpdated(t){const i=this.getPublication(t.publication.id);if(!i)throw ge({operationName:"ChannelImpl._publicationMetadataUpdated",info:ve.publicationNotFound,path:Le.prefix,payload:{event:t},appId:this.appId,channelId:this.id});i.metadata=t.publication.metadata;const n=ae(re({},t),{publication:i});this.onPublicationMetadataUpdated.emit(n)}_publicationDisabled(t){const i=this.getPublication(t.publication.id);if(!i)throw ge({operationName:"ChannelImpl._publicationDisabled",info:ve.publicationNotFound,path:Le.prefix,payload:{event:t},appId:this.appId,channelId:this.id});i.isEnabled=t.publication.isEnabled,this.onPublicationDisabled.emit({publication:i})}_publicationEnabled(t){const i=this.getPublication(t.publication.id);if(!i)throw ge({operationName:"ChannelImpl._publicationEnabled",info:ve.publicationNotFound,path:Le.prefix,payload:{event:ud},appId:this.appId,channelId:this.id});i.isEnabled=t.publication.isEnabled,this.onPublicationEnabled.emit({publication:i})}_streamSubscribed(t){const i=this.addSubscription(t.subscription),n=ae(re({},t),{subscription:i});this.onPublicationSubscribed.emit(n),this.onSubscriptionListChanged.emit({})}_streamUnsubscribed(t){const i=this.getSubscription(t.subscription.id);if(!i)throw ge({operationName:"ChannelImpl._streamUnsubscribed",info:ve.subscriptionNotFound,path:Le.prefix,payload:{event:t},appId:this.appId,channelId:this.id});this.deleteSubscription(i.id);const n=ae(re({},t),{subscription:i});this.onPublicationUnsubscribed.emit(n),this.onSubscriptionListChanged.emit({})}joinChannel(t){return K(this,null,function*(){var i;t.type&&(t.type=t.type[0].toUpperCase()+t.type.slice(1)),t.subtype&&(t.subtype=t.subtype[0].toUpperCase()+t.subtype.slice(1)),Le.debug("[start] joinChannel",{memberInit:t});const n=yield this.apiClient.join(this.appId,this.id,re({},t)),a=null!=(i=this.getMember(n.id))?i:(yield this.onMemberJoined.watch(c=>c.member.id===n.id,this.config.rtcApi.timeout).catch(c=>{throw ge({operationName:"ChannelImpl.joinChannel",info:ae(re({},ve.timeout),{detail:"onMemberJoined"}),path:Le.prefix,error:c,appId:this.appId,channelId:this.id})})).member;return Le.debug("[end] joinChannel",{member:a}),a})}updateMemberTtl(t,i){return this.apiClient.updateMemberTtl(this.appId,this.id,t,i)}publish(t){return K(this,null,function*(){var i,n,a;const c=Le.debug("[start] apiClient.publish",{init:t}),u=this.id,p=yield this.apiClient.publish(this.appId,ae(re({},t),{channel:u})),S={id:p,channelId:u,publisherId:t.publisher,origin:t.origin,contentType:t.contentType,metadata:t.metadata,codecCapabilities:null!=(i=t.codecCapabilities)?i:[],encodings:null!=(n=t.encodings)?n:[],isEnabled:null==(a=t.isEnabled)||a};Le.elapsed(c,"[ongoing] apiClient.publish",{publicationDto:S});const C=this.getPublication(p);if(C)return C;const{publication:b}=yield this.onStreamPublished.watch(E=>E.publication.id===p,this.config.rtcApi.timeout).catch(E=>{throw ge({operationName:"ChannelImpl.publish",info:ae(re({},ve.timeout),{detail:"onStreamPublished"}),path:Le.prefix,error:E,payload:{publicationDto:S},appId:this.appId,channelId:this.id})});return Le.elapsed(c,"[end] apiClient.publish",{publicationDto:S}),b})}subscribe(t){return K(this,null,function*(){const i=Le.debug("[start] apiClient.subscribe",{init:t}),n=yield this.apiClient.subscribe(this.appId,ae(re({},t),{channel:this})),a={id:n,publicationId:t.publication.id,channelId:this.id,publisherId:t.publication.publisherId,subscriberId:t.subscriber.id,contentType:t.publication.contentType};Le.elapsed(i,"[ongoing] apiClient.subscribe",{subscriptionDto:a});const c=this.getSubscription(n);if(c)return Le.elapsed(i,"[end] apiClient.subscribe",{subscriptionDto:a}),c;const{subscription:u}=yield this.onPublicationSubscribed.watch(p=>p.subscription.id===n,this.config.rtcApi.timeout).catch(p=>{throw Le.elapsed(i,"[fail] apiClient.subscribe",p),ge({operationName:"ChannelImpl.subscribe",info:ae(re({},ve.timeout),{detail:"onPublicationSubscribed"}),path:Le.prefix,error:p,payload:{subscriptionDto:a}})});return Le.elapsed(i,"[end] apiClient.subscribe",{subscriptionDto:a}),u})}close(){return this.apiClient.deleteChannel(this.appId,this.id)}dispose(){this.disposed||(this.disposed=!0,Le.debug("disposed",{id:this.id}),this.eventObserver.dispose(),this._events.dispose())}};function Gr(t,i,n,a,c){return new ld(t,a,i,n,c)}U();var hd=jt(Fs()),dd=class{constructor(t={}){this.rtcApi={domain:"rtc-api.skyway.ntt.com",timeout:3e4,secure:!0,eventSubscribeTimeout:5e3},this.iceParamServer={domain:"ice-params.skyway.ntt.com",version:1,secure:!0},this.signalingService={domain:"signaling.skyway.ntt.com",secure:!0},this.analyticsService={domain:"analytics-logging.skyway.ntt.com",secure:!0},this.rtcConfig={timeout:3e4,turnPolicy:"enable",turnProtocol:"all",encodedInsertableStreams:!1,iceDisconnectBufferTimeout:5e3},this.token={updateReminderSec:30},this.log={level:"error",format:"string"},this.internal={disableDPlane:!1},this.member={keepaliveIntervalGapSec:30,keepaliveIntervalSec:30},Object.assign(this,(0,hd.default)(this,t))}};U(),U();var Za=class{constructor(){this._onContextAttached=new Fe}_attachContext(t){this._context=t,this._onContextAttached.emit(t)}};U();var fd=new _e("packages/core/src/plugin/internal/person/connection/messageBuffer.ts"),pd=class{constructor(t){this.signaling=t,this._indicateMessageBuffer={},this._excludeConnectionIndicateBuffering=new Set,this._disposer=new si,this.signaling.onMessage.add(i=>{const n=i.src.id+i.src.name;this._excludeConnectionIndicateBuffering.has(n)||(this._indicateMessageBuffer[n]||(this._indicateMessageBuffer[n]=[]),this._indicateMessageBuffer[n].push(i))}).disposer(this._disposer)}resolveMessagingBuffer({id:t,name:i}){const n=t+i,a=this._indicateMessageBuffer[n];a?.length>0&&(fd.debug("resolveMessagingBuffer",{length:a.length}),a.forEach(c=>{this.signaling.onMessage.emit(c)}),delete this._indicateMessageBuffer[n]),this._excludeConnectionIndicateBuffering.add(n)}close(){this._disposer.dispose(),this._indicateMessageBuffer={},this._excludeConnectionIndicateBuffering=new Set}};U(),U(),U();var en=jt(pr());U(),U(),U(),U();var eo=class{constructor(t,i){this.id=t,this.contentType=i,this.side="remote",this.onConnectionStateChanged=new Fe,this._onConnectionStateChanged=new Fe,this._connectionState="new",this._getTransport=()=>{},this.getStats=()=>this._getStats(),this._getStats=()=>K(this,null,function*(){return[]}),this._onConnectionStateChanged.pipe(this.onConnectionStateChanged)}_setConnectionState(t){this._connectionState!==t&&(this._connectionState=t,this._onConnectionStateChanged.emit(t))}getRTCPeerConnection(){return this._getRTCPeerConnection()}_getRTCPeerConnection(){var t;return null==(t=this._getTransport())?void 0:t.rtcPeerConnection}getConnectionState(){return this._getConnectionState()}_getConnectionState(){return this._connectionState}toJSON(){return{contentType:this.contentType,id:this.id,codec:this.codec,side:this.side}}},to=class extends eo{constructor(t,i,n){super(t,i),this.id=t,this.contentType=i,this.track=n}get isEnabled(){return this.track.enabled}setIsEnabled(t){this.track.enabled=t}attach(t){this._element=t,Oa(t,this.track)}detach(){this._element&&(Ba(this._element,this.track),this._element=void 0)}},vd=class extends to{constructor(t,i){super(t,"audio",i),this.track=i,this.contentType="audio"}};U();var gd=class extends eo{constructor(t,i){super(t,"data"),this._datachannel=i,this._isEnabled=!0,this.contentType="data",this.onData=new Fe,i.onmessage=({data:n})=>{this.isEnabled&&("string"==typeof n&&n.includes(Kr)&&(n=JSON.parse(n.slice(Kr.length))),this.onData.emit(n))}}get isEnabled(){return this._isEnabled}setIsEnabled(t){this._isEnabled=t}};U();var md=class extends to{constructor(t,i){super(t,"video",i),this.track=i,this.contentType="video"}},bd=new _e("packages/core/src/media/stream/remote/factory.ts"),io=(t,i,n)=>{if(i instanceof RTCDataChannel){const a=new gd(t,i);return a.codec=n,a}if("audio"===i.kind){const a=new vd(t,i);return a.codec=n,a}if("video"===i.kind){const a=new md(t,i);return a.codec=n,a}throw le({operationName:"createRemoteStream",path:bd.prefix,info:ae(re({},de.invalidArgumentValue),{detail:"invalid stream type"})})};U();var yd=new _e("packages/core/src/plugin/internal/person/util.ts"),Jr=(t,i)=>K(void 0,null,function*(){const n=yd.createBlock({label:"setEncodingParams"}),a=t.getParameters();n.debug("getParameters",{params:a,newEncodings:i}),null==a.encodings&&(a.encodings=[]),a.encodings=i.map((c,u)=>re(re({},a.encodings[u]||{}),c)),yield t.setParameters(a)});function wd(t){switch(t){case"closed":case"disconnected":case"failed":return"disconnected";case"connected":return"connected";case"connecting":return"connecting";case"new":return"new";case"reconnecting":return"reconnecting"}}var _d=t=>{const i=[];return t.forEach(n=>{i.push(JSON.parse(JSON.stringify(n)))}),i};U();var no=class Vo{constructor(i,n){this.publicationId=i,this.streamId=n}static fromLabel(i){const{p:n,s:a}=JSON.parse(i);return new Vo(n,a)}toLabel(){return JSON.stringify({p:this.publicationId,s:this.streamId})}};U();var Gt=new _e("packages/core/src/plugin/internal/person/connection/peer.ts"),ro=class{constructor(t,i,n,a,c,u,p){var S;this._context=t,this._iceManager=i,this.signaling=n,this.analytics=a,this.localPerson=c,this.endpoint=u,this.role=p,this._pendingCandidates=[],this.pc=new RTCPeerConnection(ae(re({},this._context.config.rtcConfig),{iceTransportPolicy:"turnOnly"===this._context.config.rtcConfig.turnPolicy?"relay":void 0,iceServers:this._iceManager.iceServers})),this.onSignalingStateChanged=new Fe,this.onPeerConnectionStateChanged=new Fe,this.onDisconnect=new Fe,this.connected=!1,this.disconnected=!1,this.rtcPeerConnectionId=Lr(),this._onICECandidate=b=>K(this,null,function*(){if(null==b.candidate||""===b.candidate||"closed"===this.pc.connectionState)return;const E={kind:"iceCandidateMessage",payload:{candidate:b.candidate,role:this.role}};Gt.debug("[start] send candidate",{message:E,localPerson:this.localPerson}),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceCandidate",data:{candidate:JSON.stringify(b.candidate)},createdAt:Date.now()});try{yield this.signaling.send(this.endpoint,E),Gt.debug("[end] send candidate",{message:E,localPerson:this.localPerson})}catch(k){Gt.warn("[failed] send candidate",ct({operationName:"Peer._onICECandidate",channel:this.localPerson.channel,detail:"[failed] send candidate",payload:{message:E}}),k)}}),this._onICECandidateError=b=>K(this,null,function*(){this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceCandidateError",data:{event:JSON.stringify(b)},createdAt:Date.now()})}),this._onIceGatheringStateChange=b=>K(this,null,function*(){this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceGatheringStateChange",data:{event:this.pc.iceGatheringState},createdAt:Date.now()})}),this._onConnectionStateChange=()=>K(this,null,function*(){const b=this.pc.connectionState;"connected"===(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"connectionStateChange",data:{connectionState:b},createdAt:Date.now()}),b)&&(this.connected=!0,this._pendingCandidates=[]),this.onPeerConnectionStateChanged.emit(this.pc.connectionState)}),this._onIceConnectionStateChange=()=>K(this,null,function*(){this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceConnectionStateChange",data:{iceConnectionState:this.pc.iceConnectionState},createdAt:Date.now()})}),this._onSignalingStateChange=()=>K(this,null,function*(){this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"signalingStateChange",data:{signalingState:this.pc.signalingState},createdAt:Date.now()})}),this.waitForSignalingState=(b,E=1e4)=>K(this,null,function*(){this.pc.signalingState!==b&&(yield this.onSignalingStateChanged.watch(()=>this.pc.signalingState===b,E).catch(k=>{throw le({operationName:"Peer.waitForSignalingState",info:ae(re({},de.timeout),{detail:"waitForSignalingState timeout"}),path:Gt.prefix,context:this._context,channel:this.localPerson.channel,error:k})}))}),this.waitForConnectionState=(b,E=1e4)=>K(this,null,function*(){b!==this.pc.connectionState&&(yield this.onPeerConnectionStateChanged.watch(()=>b===this.pc.connectionState,E).catch(k=>{throw le({operationName:"Peer.waitForConnectionState",info:ae(re({},de.timeout),{detail:"waitForConnectionState timeout"}),path:Gt.prefix,context:this._context,channel:this.localPerson.channel,error:k})}))}),this.waitForStats=b=>K(this,[b],function*({track:E,cb:k,interval:q,timeout:V,logging:F}){q??(q=100),V??(V=1e4);for(let O=0;;O+=q){if(O>=V)throw le({operationName:"Peer.waitForStats",info:ae(re({},de.timeout),{detail:"waitForStats timeout"}),path:Gt.prefix,context:this._context,channel:this.localPerson.channel});const G=yield this.pc.getStats(E),se=_d(G);if(F&&Gt.debug("Peer.waitForStats",se),k(se))break;yield new Promise(ce=>setTimeout(ce,q))}}),Gt.debug("peerConfig",this.pc.getConfiguration()),this.setPeerConnectionListener();const C=null==(S=this.pc)?void 0:S.peerIdentity;C&&C.catch(b=>{Gt.debug("firefox peerIdentity",b)})}setPeerConnectionListener(){this.pc.onicecandidate=this._onICECandidate,this.pc.onicecandidateerror=this._onICECandidateError,this.pc.onicegatheringstatechange=this._onIceGatheringStateChange,this.pc.onconnectionstatechange=this._onConnectionStateChange,this.pc.oniceconnectionstatechange=this._onIceConnectionStateChange,this.pc.onsignalingstatechange=()=>{this._onSignalingStateChange(),this.onSignalingStateChanged.emit(this.pc.signalingState)}}unSetPeerConnectionListener(){this.pc.onicecandidate=null,this.pc.onicecandidateerror=null,this.pc.onicegatheringstatechange=null,this.pc.onconnectionstatechange=null,this.pc.oniceconnectionstatechange=null,this.pc.onsignalingstatechange=null}handleCandidate(t){return K(this,null,function*(){this._pendingCandidates.push(t),this.pc.remoteDescription&&(yield this.resolveCandidates())})}resolveCandidates(){return K(this,null,function*(){const t=[...this._pendingCandidates];this._pendingCandidates=[],Gt.debug("addIceCandidates",t),yield Promise.all(t.map(i=>{"closed"!==this.pc.signalingState&&this.pc.addIceCandidate(i).catch(n=>{Gt.warn("[failed] add ice candidate",ct({operationName:"Peer.resolveCandidates",channel:this.localPerson.channel,detail:"[failed] send candidate",payload:{endpointId:this.endpoint.id}}),n)})}))})}},pi=new _e("packages/core/src/plugin/internal/person/connection/receiver.ts"),xd=class extends ro{constructor(t,i,n,a,c,u){super(t,i,n,a,c,u,"receiver"),this.id=fi(),this.onConnectionStateChanged=new Fe,this.onStreamAdded=new Fe,this.onError=new Fe,this._connectionState="new",this._publicationInfo={},this.streams={},this._subscriptions={},this._promiseQueue=new wi,this._disposer=new si,this._log=pi.createBlock({localPersonId:this.localPerson.id,id:this.id}),this._log.debug("spawned"),this.signaling.onMessage.add(p=>K(this,[p],function*({src:S,data:C}){if(S.id!==u.id||S.name!==u.name)return;const b=C;switch(b.kind){case"senderProduceMessage":this._promiseQueue.push(()=>this._handleSenderProduce(b.payload)).catch(E=>this._log.error("handle senderProduceMessage failed",E,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}));break;case"senderUnproduceMessage":this._promiseQueue.push(()=>this._handleSenderUnproduce(b.payload)).catch(E=>this._log.error("handle handleSenderUnproduce",E,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}));break;case"senderRestartIceMessage":this._promiseQueue.push(()=>this._handleSenderRestartIce(b.payload)).catch(E=>this._log.error("_handleSenderRestartIce",E,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}));break;case"iceCandidateMessage":{const{role:E,candidate:k}=b.payload;"sender"===E&&(yield this.handleCandidate(k))}}})).disposer(this._disposer),this.pc.ontrack=p=>K(this,[p],function*({track:S,transceiver:C}){if(!C.mid)throw le({operationName:"Receiver.pc.ontrack",info:ae(re({},de.missingProperty),{detail:"mid missing"}),path:pi.prefix,context:this._context,channel:this.localPerson.channel});const b=Object.values(this._publicationInfo).find(V=>{var F;return V.mid===(null==(F=C.mid)?void 0:F.toString())});if(!b){const V=le({operationName:"Receiver.pc.ontrack",info:ae(re({},de.notFound),{detail:"publicationInfo not found"}),path:pi.prefix,context:this._context,channel:c.channel,payload:{endpointId:this.endpoint.id,publicationInfo:this._publicationInfo,mid:C.mid}});return this.onError.emit(V),void this._log.error(V)}const E=en.parse(this.pc.remoteDescription.sdp),k=this._getCodecFromSdp(E,C,S.kind),q=io(b.streamId,S,k);q.codec=k,this._setupTransportAccessForStream(q),this.streams[b.publicationId]=q,this._log.debug("MediaStreamTrack added",b,S,k),this.onStreamAdded.emit({publicationId:b.publicationId,stream:q})}),this.pc.ondatachannel=p=>K(this,[p],function*({channel:S}){const{publicationId:C,streamId:b}=no.fromLabel(S.label),E={mimeType:"datachannel"},k=io(b,S,E);this._setupTransportAccessForStream(k),this.streams[C]=k,this._log.debug("DataChannel added",C,S,E),this.onStreamAdded.emit({publicationId:C,stream:k})}),this.onPeerConnectionStateChanged.add(p=>{switch(p){case"connecting":case"connected":this._setConnectionState(p);break;case"failed":case"closed":this._setConnectionState("disconnected")}}).disposer(this._disposer)}_setConnectionState(t){this._connectionState!==t&&(this._log.debug("onConnectionStateChanged",this.id,this._connectionState,t),this._connectionState=t,this.onConnectionStateChanged.emit(t))}_setupTransportAccessForStream(t){t._getTransport=()=>({rtcPeerConnection:this.pc,connectionState:wd(this.pc.connectionState)}),t._getStats=()=>K(this,null,function*(){return Bn("data"===t.contentType?yield this.pc.getStats():yield this.pc.getStats(t.track))}),this._disposer.push(()=>{t._getTransport=()=>{}}),this.onConnectionStateChanged.add(i=>{t._setConnectionState(i),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"skywayConnectionStateChange",data:{skywayConnectionState:i},createdAt:Date.now()})}).disposer(this._disposer)}_getCodecFromSdp(t,i,n){const a=t.media.find(E=>{var k,q;return(null==(k=E.mid)?void 0:k.toString())===(null==(q=i.mid)?void 0:q.toString())});if(!a)throw le({operationName:"Receiver._getCodecFromSdp",info:ae(re({},de.notFound),{detail:"m-line not exist"}),path:pi.prefix,context:this._context,channel:this.localPerson.channel});const c=a.payloads.split(" ")[0],p=`${n}/${a.rtp.find(E=>E.payload.toString()===c).codec}`.toLowerCase();let S={};const C=a.fmtp.find(E=>E.payload.toString()===c);return C?.config&&(S=Ra(C.config)),{mimeType:p,parameters:S}}get hasMedia(){const t=Object.values(this.streams).length;return this._log.debug("hasMedia",{count:t}),t>0}close(){this._log.debug("closed"),this.unSetPeerConnectionListener(),this.pc.close(),this._setConnectionState("disconnected"),this._disposer.dispose()}add(t){this._subscriptions[t.id]=t}remove(t){const i=this._subscriptions[t];if(!i)return;delete this._subscriptions[i.id];const n=i.publication.id;this.streams[n]&&delete this.streams[n]}_validateRemoteOffer(t){const i=en.parse(t);this._log.debug("_validateRemoteOffer",{sdpObject:i});for(const n of i.media)if("inactive"!==n.direction&&!Object.values(this._publicationInfo).find(c=>{var u;return(null==(u=n.mid)?void 0:u.toString())===c.mid})){const c=le({operationName:"Receiver._validateRemoteOffer",info:ae(re({},de.notFound),{detail:"mismatch between sdp and state"}),path:pi.prefix,context:this._context,channel:this.localPerson.channel,payload:{sdpMedia:i.media,sdpMediaLine:n,info:this._publicationInfo}});throw this.onError.emit(c),c}}get isWrongSignalingState(){return"have-local-offer"===this.pc.signalingState&&this.pc.remoteDescription||"have-remote-offer"===this.pc.signalingState}_handleSenderProduce(t){return K(this,arguments,function*({sdp:i,publicationId:n,info:a}){if("closed"!==this.pc.signalingState){if("stable"!==this.pc.signalingState){if(this.isWrongSignalingState)return this._log.warn("_handleSenderProduce wait for be stable",ct({operationName:"Receiver._handleSenderProduce",channel:this.localPerson.channel,detail:"_handleSenderProduce wait for be stable",payload:{signalingState:this.pc.signalingState}})),yield this.waitForSignalingState("stable"),void(yield this._handleSenderProduce({sdp:i,publicationId:n,info:a}));throw le({operationName:"Receiver._handleSenderProduce",context:this._context,channel:this.localPerson.channel,info:ae(re({},de.internal),{detail:"wrong signalingState"}),payload:{signalingState:this.pc.signalingState},path:pi.prefix})}this._log.debug("_handleSenderProduce",{info:a,publicationId:n,publicationInfo:Object.values(this._publicationInfo)}),this._publicationInfo[a.publicationId]=a,this._validateRemoteOffer(i.sdp),yield this.sendAnswer(i),yield this.resolveCandidates()}})}_handleSenderUnproduce(t){return K(this,arguments,function*({sdp:i,publicationId:n}){if("closed"!==this.pc.signalingState){if(this._log.debug("<handleSenderUnproduce> start",{sdp:i,publicationId:n}),"stable"!==this.pc.signalingState){if(this.isWrongSignalingState)return this._log.warn("signalingState is not stable",ct({channel:this.localPerson.channel,detail:"signalingState is not stable",operationName:"Receiver._handleSenderUnproduce",payload:{signalingState:this.pc.signalingState}})),yield this.waitForSignalingState("stable"),void(yield this._handleSenderUnproduce({sdp:i,publicationId:n}));throw le({operationName:"Receiver._handleSenderProduce",context:this._context,channel:this.localPerson.channel,info:ae(re({},de.internal),{detail:"wrong signalingState"}),payload:{signalingState:this.pc.signalingState},path:pi.prefix})}delete this._publicationInfo[n],yield this.sendAnswer(i),yield this.resolveCandidates(),this._log.debug("<handleSenderUnproduce> end",{publicationId:n})}else this._log.warn("signalingState closed",ct({channel:this.localPerson.channel,detail:"signalingState closed",operationName:"Receiver._handleSenderUnproduce"}))})}_handleSenderRestartIce(t){return K(this,arguments,function*({sdp:i}){if("closed"!==this.pc.signalingState){if("stable"!==this.pc.signalingState){if(this.isWrongSignalingState)return this._log.warn("signalingState is not stable",ct({channel:this.localPerson.channel,detail:"signalingState is not stable",operationName:"Receiver._handleSenderRestartIce",payload:{signalingState:this.pc.signalingState}})),yield this.waitForSignalingState("stable"),void(yield this._handleSenderRestartIce({sdp:i}));throw le({operationName:"Receiver._handleSenderRestartIce",context:this._context,channel:this.localPerson.channel,info:ae(re({},de.internal),{detail:"wrong signalingState"}),payload:{signalingState:this.pc.signalingState},path:pi.prefix})}this._setConnectionState("reconnecting"),yield this.sendAnswer(i),yield this.resolveCandidates(),"connected"===this.pc.connectionState&&this._setConnectionState("connected")}})}sendAnswer(t){return K(this,null,function*(){this._log.debug("[receiver] start: sendAnswer"),yield this.pc.setRemoteDescription(t);const i=yield this.pc.createAnswer();this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"answer",data:{answer:JSON.stringify(i)},createdAt:Date.now()});const n=en.parse(this.pc.remoteDescription.sdp),a=en.parse(i.sdp);n.media.forEach((p,S)=>{const C=a.media[S];C.fmtp=(t=>JSON.parse(JSON.stringify(t)))(C.fmtp).map(b=>p.fmtp.find(k=>k.payload===b.payload)||b)});const c=en.write(a);yield this.pc.setLocalDescription({type:"answer",sdp:c});const u={kind:"receiverAnswerMessage",payload:{sdp:this.pc.localDescription}};yield this.signaling.send(this.endpoint,u).catch(p=>this._log.error("failed to send answer",p,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id})),this._log.debug("[receiver] end: sendAnswer")})}get subscriptions(){return this._subscriptions}};U();var Ed=jt(Eu()),so=jt(pr()),St=new _e("packages/core/src/plugin/internal/person/connection/sender.ts"),Cd=class extends ro{constructor(t,i,n,a,c,u){super(t,i,n,a,c,u,"sender"),this.id=fi(),this.onConnectionStateChanged=new Fe,this.publications={},this.transceivers={},this.datachannels={},this._pendingPublications=[],this._isNegotiating=!1,this.promiseQueue=new wi,this._disposer=new si,this._ms=new MediaStream,this._backoffIceRestarted=new Yi({times:8,interval:100,jitter:100}),this._connectionState="new",this._log=St.createBlock({localPersonId:this.localPerson.id,id:this.id}),this._unsubscribeStreamEnableChange={},this._cleanupStreamCallbacks={},this.restartIce=()=>K(this,null,function*(){if(this._backoffIceRestarted.exceeded)return this._log.error(le({operationName:"Sender.restartIce",context:this._context,channel:this.localPerson.channel,info:ae(re({},de.internal),{detail:"restartIce limit exceeded"}),path:St.prefix})),void this._setConnectionState("disconnected");this._log.warn("[start] restartIce",ct({operationName:"Sender.restartIce",detail:"start restartIce",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}}));const p=()=>"left"===this.endpoint.state?(this._log.warn("endpointMemberLeft",ct({operationName:"restartIce",detail:"endpointMemberLeft",channel:this.localPerson.channel,payload:{endpointId:this.endpoint.id}})),this._setConnectionState("disconnected"),!0):"connected"===this.pc.connectionState?(this._log.warn("[end] restartIce",ct({operationName:"restartIce",detail:"reconnected",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}})),this._backoffIceRestarted.reset(),this._setConnectionState("connected"),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"restartIce",data:void 0,createdAt:Date.now()}),!0):void 0;if(this._setConnectionState("reconnecting"),yield this._backoffIceRestarted.wait(),p())return;let S=yield this._iceManager.updateIceParams().catch(E=>E);if(S)return this._log.warn("[failed] restartIce",ct({operationName:"restartIce",detail:"update IceParams failed",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}}),S),void(yield this.restartIce());if(this.pc.setConfiguration&&(this.pc.setConfiguration(ae(re({},this.pc.getConfiguration()),{iceServers:this._iceManager.iceServers})),this._log.debug("<restartIce> setConfiguration",{iceServers:this._iceManager.iceServers})),p())return;if("connected"!==this.signaling.connectionState){if(this._log.warn("<restartIce> reconnect signaling service",ct({operationName:"restartIce",detail:"reconnect signaling service",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}})),S=yield this.signaling.onConnectionStateChanged.watch(E=>"connected"===E,1e4).catch(E=>E).then(()=>{}),S instanceof li)return void(yield this.restartIce());if(p())return}const C=yield this.pc.createOffer({iceRestart:!0});this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"offer",data:{offer:JSON.stringify(C)},createdAt:Date.now()}),yield this.pc.setLocalDescription(C);const b={kind:"senderRestartIceMessage",payload:{sdp:this.pc.localDescription}};if(S=yield this.signaling.send(this.endpoint,b,1e4).catch(E=>E),S)return this._log.warn("<restartIce> [failed]",ct({operationName:"restartIce",detail:"timeout send signaling message",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}}),S),void(yield this.restartIce());S=yield this.waitForConnectionState("connected",this._context.config.rtcConfig.iceDisconnectBufferTimeout).catch(E=>E),(S||!p())&&(yield this.restartIce())}),this._log.debug("spawned"),this.signaling.onMessage.add(p=>K(this,[p],function*({src:S,data:C}){if(S.id!==u.id||S.name!==u.name)return;const b=C;switch(b.kind){case"receiverAnswerMessage":this.promiseQueue.push(()=>this._handleReceiverAnswer(b.payload)).catch(E=>this._log.error("handle receiverAnswerMessage",{localPersonId:this.localPerson.id,endpointId:this.endpoint.id,err:E}));break;case"iceCandidateMessage":{const{role:E,candidate:k}=b.payload;"receiver"===E&&(yield this.handleCandidate(k))}}})).disposer(this._disposer),this.onPeerConnectionStateChanged.add(p=>K(this,null,function*(){try{switch(St.debug("onPeerConnectionStateChanged",{state:p}),p){case"disconnected":case"failed":(yield this.waitForConnectionState("connected",t.config.rtcConfig.iceDisconnectBufferTimeout).catch(C=>C))&&"reconnecting"!==this._connectionState&&(yield this.restartIce());break;case"connecting":case"connected":this._setConnectionState(p);break;case"closed":this._setConnectionState("disconnected")}}catch(S){St.error("onPeerConnectionStateChanged",S,this.id)}})).disposer(this._disposer)}_setConnectionState(t){this._connectionState!==t&&(this._log.debug("onConnectionStateChanged",this.id,this._connectionState,t),this._connectionState=t,this.onConnectionStateChanged.emit(t))}get hasMedia(){const t=Object.keys(this.publications).length;return this._log.debug("hasMedia",{count:t}),t>0}_getMid(t,i){if("data"===t.contentType){const n=i.media.find(a=>"application"===a.type);if(null==n?.mid)throw le({operationName:"Sender._getMid",info:ae(re({},de.missingProperty),{detail:"datachannel mid undefined"}),path:St.prefix,context:this._context,channel:this.localPerson.channel});return n.mid.toString()}{const a=this.transceivers[t.id].mid;if(null==a)throw le({operationName:"Sender._getMid",info:ae(re({},de.missingProperty),{detail:"media mid undefined"}),path:St.prefix,context:this._context,channel:this.localPerson.channel});return a.toString()}}_listenStreamEnableChange(t,i){this._unsubscribeStreamEnableChange[i]&&this._unsubscribeStreamEnableChange[i]();const{removeListener:n}=t._onEnableChanged.add(a=>K(this,null,function*(){yield this._replaceTrack(i,a).catch(c=>{St.warn(ct({member:this.localPerson,detail:"_replaceTrack failed",operationName:"Sender._listenStreamEnableChange",payload:c}))})}));this._unsubscribeStreamEnableChange[i]=n}add(t){return K(this,null,function*(){var i,n;if(this._isNegotiating||"stable"!==this.pc.signalingState)return this._pendingPublications.push(t),void this._log.debug("<add> isNegotiating",{publication:t,isNegotiating:this._isNegotiating,signalingState:this.pc.signalingState,pendingPublications:this._pendingPublications.length});this._isNegotiating=!0,this._log.debug("<add> add publication",{publication:t}),this.publications[t.id]=t;const a=t.stream;if(!a)throw le({operationName:"Sender.add",info:ae(re({},de.missingProperty),{detail:"<add> stream not found"}),path:St.prefix,context:this._context,channel:this.localPerson.channel});if(this._cleanupStreamCallbacks[a.id]=this._setupTransportAccessForStream(a),"data"===a.contentType){const C=this.pc.createDataChannel(new no(t.id,a.id).toLabel(),a.options);a._onWriteData.add(b=>{"open"===C.readyState&&C.send(b)}).disposer(this._disposer),this.datachannels[t.id]=C}else{t._onReplaceStream.add(b=>K(this,[b],function*({newStream:E,oldStream:k}){E._replacingTrack=!0,this._listenStreamEnableChange(E,t.id),this._cleanupStreamCallbacks[k.id]&&this._cleanupStreamCallbacks[k.id](),this._cleanupStreamCallbacks[E.id]=this._setupTransportAccessForStream(E),yield this._replaceTrack(t.id,E.track),E._replacingTrack=!1,E._onReplacingTrackDone.emit()})).disposer(this._disposer),this._listenStreamEnableChange(a,t.id);const C=this.pc.addTransceiver(a.track,{direction:"sendonly",streams:[this._ms]});t._onEncodingsChanged.add(b=>K(this,null,function*(){yield Jr(C.sender,b).catch(E=>{this._log.error("_onEncodingsChanged failed",E)})})).disposer(this._disposer),this.transceivers[t.id]=C}const c=yield this.pc.createOffer().catch(C=>{throw le({operationName:"Sender.add",info:ae(re({},de.internal),{detail:"can't create offer"}),path:St.prefix,context:this._context,channel:this.localPerson.channel,error:C})});this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"offer",data:{offer:JSON.stringify(c)},createdAt:Date.now()}),yield this.pc.setLocalDescription(c);const u=so.parse(this.pc.localDescription.sdp);this._log.debug("<add> create offer base",u);const p=this._getMid(t,u);if("data"!==t.contentType){!function Ad(t,i,n){var a,c;const u=n.media.find(b=>{var E;return(null==(E=b.mid)?void 0:E.toString())===i});if(!u)throw le({operationName:"applyCodecCapabilities",info:ae(re({},de.notFound),{detail:"media not found"}),path:St.prefix});t.forEach(b=>{var E;if(b.parameters)for(const[k,q]of Object.entries(null!=(E=b.parameters)?E:{})){if(!1===q||!b.parameters[k])return;"usedtx"===k&&q&&(b.parameters[k]=1)}});const p=(b,E,k)=>{var q;const V=E.map(G=>ae(re({},G),{parameters:Or(k,G.payload)})),F=ao(b.mimeType);return F&&null!=(q=V.find(G=>{var se,ce;return G.codec.toLowerCase()===F.toLowerCase()&&(0===Object.keys(null!=(se=b.parameters)?se:{}).length||"audio"===Pd(b.mimeType)||(0,Ed.default)(G.parameters,null!=(ce=b.parameters)?ce:{}))}))?q:void 0},S=t.map(b=>p(b,u.rtp,u.fmtp)).filter(b=>null!=b),C=[...S,...u.rtp.filter(b=>!S.find(E=>E.payload===b.payload))];for(const b of u.fmtp){const E=b.payload,k=C.find(F=>F.payload===E);if(k){const F=t.find(O=>p(O,[k],u.fmtp));F&&F.parameters&&Object.keys(F.parameters).length>0&&(b.config="",Object.entries(F.parameters).forEach(([O,G])=>{!1===G||b.config.includes(O)||(b.config.length>0?b.config+=`;${O}=${G}`:b.config=`${O}=${G}`)}))}const q=C.find(F=>"opus"===F.codec.toLowerCase()),V=null==(c=null==(a=t.find(F=>"opus"===ao(F.mimeType).toLowerCase()))?void 0:a.parameters)?void 0:c.usedtx;q&&!1!==V&&b.payload===q.payload&&!b.config.includes("usedtx")&&(b.config.length>0?b.config+=";usedtx=1":b.config="usedtx=1")}u.payloads=C.map(b=>b.payload.toString()).join(" ")}(null!=(i=t.codecCapabilities)?i:[],p,u);const C=so.write(u);if(yield this.pc.setLocalDescription({type:"offer",sdp:C}),this._log.debug("<add> create offer",this.pc.localDescription),(null==(n=t.encodings)?void 0:n.length)>0)if("Safari12"===ka()||"Safari11"===ka())this._safariSetupEncoding(t);else{const b=this.transceivers[t.id];yield Jr(b.sender,[t.encodings[0]])}}const S={kind:"senderProduceMessage",payload:{sdp:this.pc.localDescription,publicationId:t.id,info:{publicationId:t.id,streamId:a.id,mid:p}}};this._log.debug("[start] send message",S),yield this.signaling.send(this.endpoint,S).catch(C=>{throw this._log.error("[failed] send message :",C,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}),C}),this._log.debug("[end] send message",S)})}_setupTransportAccessForStream(t){t._getTransportCallbacks[this.endpoint.id]=()=>({rtcPeerConnection:this.pc,connectionState:this._connectionState}),t._getStatsCallbacks[this.endpoint.id]=()=>K(this,null,function*(){return"data"===t.contentType?Bn(yield this.pc.getStats()):(t._replacingTrack&&(yield t._onReplacingTrackDone.asPromise(200)),Bn(yield this.pc.getStats(t.track)))});const i=()=>{delete t._getTransportCallbacks[this.endpoint.id],delete t._getStatsCallbacks[this.endpoint.id]};return this._disposer.push(()=>{i()}),this.onConnectionStateChanged.add(n=>{t._setConnectionState(this.endpoint,n),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"skywayConnectionStateChange",data:{skywayConnectionState:n},createdAt:Date.now()})}).disposer(this._disposer),i}remove(t){return K(this,null,function*(){const i=this.publications[t];if(!i)return void this._log.warn("<remove> publication not found",ct({operationName:"Sender.remove",detail:"publication already removed",channel:this.localPerson.channel,payload:{publicationId:t}}));if(delete this.publications[t],this._isNegotiating||"stable"!==this.pc.signalingState)return this._pendingPublications.push(t),void this._log.debug("<remove> isNegotiating",{publicationId:t,_isNegotiating:this._isNegotiating,signalingState:this.pc.signalingState});this._isNegotiating=!0,this._log.debug("<remove> [start]",{publicationId:t});const n=i.stream;if(!n)throw le({operationName:"Sender.remove",info:ae(re({},de.missingProperty),{detail:"<remove> publication not have stream"}),path:St.prefix,context:this._context,channel:this.localPerson.channel,payload:{publication:i}});"data"===n.contentType?(this.datachannels[t].close(),delete this.datachannels[t]):(this.transceivers[t].stop(),delete this.transceivers[t]);const a=yield this.pc.createOffer().catch(u=>{throw le({operationName:"Sender.remove",info:ae(re({},de.internal),{detail:"<remove> can't create offer"}),path:St.prefix,context:this._context,channel:this.localPerson.channel,error:u})});this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"offer",data:{offer:JSON.stringify(a)},createdAt:Date.now()}),yield this.pc.setLocalDescription(a);const c={kind:"senderUnproduceMessage",payload:{sdp:this.pc.localDescription,publicationId:t}};this._log.debug("<remove> send message",{message:c}),yield this.signaling.send(this.endpoint,c).catch(u=>{throw this._log.error("<remove> in remote error :",u,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}),u}),this._log.debug("<remove> [end]",{publicationId:t})})}_replaceTrack(t,i){return K(this,null,function*(){const n=this.transceivers[t];n?yield n.sender.replaceTrack(i).catch(a=>{throw le({operationName:"Sender._replaceTrack",context:this._context,info:de.internal,error:a,path:St.prefix,channel:this.localPerson.channel})}):this._log.warn("can't replace track, transceiver not found",ct({operationName:"Sender._replaceTrack",detail:"transceiver already removed",channel:this.localPerson.channel,payload:{publicationId:t}}))})}_handleReceiverAnswer(t){return K(this,arguments,function*({sdp:i}){"closed"!==this.pc.signalingState&&(this._log.debug("<handleReceiverAnswer> [start]"),yield this.pc.setRemoteDescription(new RTCSessionDescription(i)).catch(n=>{const a=le({operationName:"Sender._handleReceiverAnswer",context:this._context,info:ae(re({},de.internal),{detail:"failed to setRemoteDescription"}),path:St.prefix,payload:{sdp:i},channel:this.localPerson.channel,error:n});throw this._log.error(a),a}),this._log.debug("<handleReceiverAnswer> sRD"),yield this.resolveCandidates(),this._log.debug("<handleReceiverAnswer> resolveCandidates"),yield this.waitForSignalingState("stable"),this._log.debug("<handleReceiverAnswer> waitForSignalingState"),this._isNegotiating=!1,yield this._resolvePendingSender(),this._log.debug("<handleReceiverAnswer> _resolvePendingSender",this._pendingPublications.length),this._log.debug("<handleReceiverAnswer> [end]"))})}_safariSetupEncoding(t){const i=this.transceivers[t.id];this.waitForStats({track:t.stream.track,cb:a=>{const c=a.find(u=>u.id.includes("RTCOutboundRTP")||u.type.includes("outbound-rtp"));return c?.keyFramesEncoded>0},interval:10,timeout:this._context.config.rtcConfig.timeout}).then(()=>{St.debug("safari wait for stats resolved, setEncodingParams"),Jr(i.sender,[t.encodings[0]]).catch(a=>{this._log.error("setEncodingParams failed",a)})}).catch(a=>{this._log.error("waitForStats",a)})}_resolvePendingSender(){return K(this,null,function*(){const t=this._pendingPublications.shift();t&&(this._log.debug("resolve pending sender",{publication:t}),"string"==typeof t?yield this.remove(t):yield this.add(t))})}close(){this._log.debug("closed"),this.unSetPeerConnectionListener(),Object.values(this._unsubscribeStreamEnableChange).forEach(t=>t()),this.pc.close(),this._setConnectionState("disconnected"),this._disposer.dispose()}},ao=t=>t.split("/")[1],Pd=t=>t.split("/")[0],Vn=new _e("packages/core/src/plugin/internal/person/connection/index.ts"),Fd=class{constructor(t,i,n,a,c,u,p){this._iceManager=t,this._signaling=i,this._analytics=n,this._context=a,this.channelId=c,this.localPerson=u,this.remoteMember=p,this.id=fi(),this.type="p2p",this.onDisconnect=new Fe,this.onClose=new Fe,this.closed=!1,this.disconnected=!1,this._log=Vn.createBlock({id:this.id,localPersonId:this.localPerson.id}),this._pubsubQueue=new wi,this.sendSubscriptionStatsReportTimers=new Map,this._waitingSendSubscriptionStatsReportsFromPublish=new Map,this._waitingSendSubscriptionStatsReportsFromSubscribe=[],this.sender=new Cd(this._context,this._iceManager,this._signaling,this._analytics,this.localPerson,this.remoteMember),this.receiver=new xd(this._context,this._iceManager,this._signaling,this._analytics,this.localPerson,this.remoteMember),this.sender.onDisconnect.once(()=>{this.disconnected=!0,this.onDisconnect.emit()}),this.receiver.onDisconnect.once(()=>{this.disconnected=!0,this.onDisconnect.emit()}),this._analytics&&this._analytics.onConnectionStateChanged.add(S=>{if("connected"===S){if(this._waitingSendSubscriptionStatsReportsFromPublish.size>0){for(const[C,b]of this._waitingSendSubscriptionStatsReportsFromPublish){const E=this.sender.publications[b];E&&this.startSendSubscriptionStatsReportTimer(E,C)}this._waitingSendSubscriptionStatsReportsFromPublish.clear()}if(this._waitingSendSubscriptionStatsReportsFromSubscribe.length>0){for(const C of this._waitingSendSubscriptionStatsReportsFromSubscribe){const b=this.receiver.subscriptions[C];b&&this.startSendSubscriptionStatsReportTimer(b,C)}this._waitingSendSubscriptionStatsReportsFromSubscribe=[]}}})}startPublishing(t,i){return K(this,null,function*(){yield this._pubsubQueue.push(()=>K(this,null,function*(){this._log.debug("startPublishing",{publication:t}),yield this.sender.add(t)})),this._analytics&&!this._analytics.isClosed()&&(this._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:i,role:"sender",rtcPeerConnectionId:this.sender.rtcPeerConnectionId}),this._analytics.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer(t,i):this._waitingSendSubscriptionStatsReportsFromPublish.set(i,t.id))})}stopPublishing(t){return K(this,null,function*(){yield this._pubsubQueue.push(()=>K(this,null,function*(){this._log.debug("<stopPublishing> start",{publication:t}),this.sender.remove(t.id).then(()=>{this._log.debug("<stopPublishing> removed",{publication:t})}).catch(n=>{this._log.error("<stopPublishing> remove failed",n,{publication:t})}),this._closeIfNeeded(),this._log.debug("<stopPublishing> end",{publication:t})}));const i=this.sendSubscriptionStatsReportTimers.get(t.id);i&&(clearInterval(i),this.sendSubscriptionStatsReportTimers.delete(t.id))})}startSubscribing(t){return K(this,null,function*(){yield this._pubsubQueue.push(()=>K(this,null,function*(){this._log.debug("startSubscribing",{subscription:t}),this.receiver.add(t);const i=t.publication.id;let n=this.receiver.streams[i];n||(yield this.receiver.onStreamAdded.watch(a=>a.publicationId===i,this._context.config.rtcConfig.timeout).catch(()=>{throw le({operationName:"P2PConnection.startSubscribing",info:ae(re({},de.timeout),{detail:"onStreamAdded"}),path:Vn.prefix,context:this._context,channel:this.localPerson.channel,payload:{subscription:t}})}),n=this.receiver.streams[i]),n.setIsEnabled("enabled"===t.publication.state),t.codec=n.codec,t._setStream(n),this._analytics&&!this._analytics.isClosed()&&(this._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:t.id,role:"receiver",rtcPeerConnectionId:this.receiver.rtcPeerConnectionId}),this._analytics.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer(t,t.id):this._waitingSendSubscriptionStatsReportsFromSubscribe.push(t.id))}))})}stopSubscribing(t){return K(this,null,function*(){yield this._pubsubQueue.push(()=>K(this,null,function*(){this._log.debug("stopSubscribing",{subscription:t}),this.receiver.remove(t.id),this._closeIfNeeded()}));const i=this.sendSubscriptionStatsReportTimers.get(t.id);i&&(clearInterval(i),this.sendSubscriptionStatsReportTimers.delete(t.id))})}_closeIfNeeded(){this.sender.hasMedia||this.receiver.hasMedia||this.close({reason:"no media"})}getStats(t){return K(this,null,function*(){const i=t.stream;if(!i)throw le({operationName:"P2PConnection.getStats",info:ae(re({},de.invalidArgumentValue),{detail:"Subscription or Publication must has stream"}),path:Vn.prefix,context:this._context,channel:this.localPerson.channel});return"local"===i.side?"data"===i.contentType?this.sender.pc.getStats():this.sender.pc.getStats(i.track):"data"===i.contentType?this.receiver.pc.getStats():this.receiver.pc.getStats(i.track)})}close({reason:t}={}){this.closed||(this.closed=!0,this._log.debug("closed",{endpointId:this.remoteMember.id,reason:t,sender:this.sender.id,receiver:this.receiver.id,id:this.id}),this.sender.close(),this.receiver.close(),this.onClose.emit())}startSendSubscriptionStatsReportTimer(t,i){if(this._analytics){const n=t instanceof Ua?"sender":"receiver",a=this._analytics.client.getIntervalSec();this.sendSubscriptionStatsReportTimers.set(t.id,setInterval(()=>K(this,null,function*(){if(!this._analytics)throw le({operationName:"P2PConnection.sendSubscriptionStatsReportTimer",info:ae(re({},de.missingProperty),{detail:"AnalyticsSession not exist"}),path:Vn.prefix,context:this._context,channel:this.localPerson.channel});if(this._analytics.isClosed()){const u=this.sendSubscriptionStatsReportTimers.get(t.id);return void(u&&(clearInterval(u),this.sendSubscriptionStatsReportTimers.delete(t.id)))}const c=yield this.getStats(t);c&&this._analytics.client.sendSubscriptionStatsReport(c,{subscriptionId:i,role:n,contentType:t.contentType,createdAt:Date.now()})}),1e3*a))}}},tn=new _e("packages/core/src/plugin/internal/person/member.ts"),Id=class extends Mr{constructor(t){super(t),this.args=t,this.type="person",this.subtype="person",this.side="remote",this._connections={},this._context=this.args.channel._context,this._disposer=new si,this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.subscribe=i=>new Promise((n,a)=>{let c=!1;this.channel._subscribe(this.id,i).catch(u=>{c=!0,a(u)}),this.onPublicationSubscribed.watch(({subscription:u})=>u.publication.id===i,this._context.config.rtcApi.timeout).then(({subscription:u})=>{n({subscription:u})}).catch(()=>{c||a(le({operationName:"RemotePersonImpl.subscribe",info:ae(re({},de.timeout),{detail:"onPublicationSubscribed"}),path:tn.prefix,context:this._context,channel:this.channel}))})}),this.plugin=t.plugin,this.channel.onPublicationUnsubscribed.add(({subscription:i})=>{i.subscriber.id===this.id&&(this.onPublicationUnsubscribed.emit({subscription:i}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this.channel.onPublicationSubscribed.add(({subscription:i})=>{i.subscriber.id===this.id&&(this.onPublicationSubscribed.emit({subscription:i}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this.channel.onStreamPublished.add(({publication:i})=>{i.publisher.id===this.id&&this.onPublicationListChanged.emit()}).disposer(this._disposer),this.channel.onStreamUnpublished.add(({publication:i})=>{i.publisher.id===this.id&&this.onPublicationListChanged.emit()}).disposer(this._disposer),this.onLeft.once(()=>{tn.debug("RemotePerson left: ",this.toJSON()),Object.values(this._connections).forEach(i=>{i.close({reason:"remote person left"})}),this._connections={}})}_getConnection(t){return this._connections[t]}_getOrCreateConnection(t){var i;return null!=(i=this._getConnection(t.id))?i:this._createConnection(this.channel,t,this)}_createConnection(t,i,n){if("local"!==i.side)throw le({operationName:"RemotePersonImpl._createConnection",info:ae(re({},de.invalidArgumentValue),{detail:"wrong localPerson type"}),path:tn.prefix,context:this._context,channel:this.channel});if(!i._signaling)throw le({operationName:"RemotePersonImpl._createConnection",info:ae(re({},de.missingProperty),{detail:"signalingSession not exist"}),path:tn.prefix,context:this._context,channel:this.channel});const a=new Fd(i.iceManager,i._signaling,i._analytics,this._context,t.id,i,n);return this.plugin._messageBuffers[i.id].resolveMessagingBuffer(n),a.onClose.once(()=>{tn.debug("connection closed",this.toJSON(),{connectionId:a.id}),delete this._connections[i.id]}),this._connections[i.id]=a,a}unsubscribe(t){return K(this,null,function*(){yield this.channel._unsubscribe(t)})}_dispose(){this._disposer.dispose()}},Td=class extends Za{constructor(){super(...arguments),this.subtype="person",this._messageBuffers={},this._whenCreateLocalPerson=t=>K(this,null,function*(){t._signaling&&(this._messageBuffers[t.id]=new pd(t._signaling))}),this._whenDisposeLocalPerson=t=>K(this,null,function*(){const i=this._messageBuffers[t.id];i&&(i.close(),delete this._messageBuffers[t.id])}),this._createRemoteMember=(t,i)=>new Id(ae(re({},this._context),{context:this._context,channel:t,metadata:i.metadata,id:i.id,name:i.name,plugin:this}))}};U();var kd=class extends Za{constructor(){super(...arguments),this.subtype="unknown",this._createRemoteMember=(t,i)=>new Na(ae(re({},this._context),{context:this._context,channel:t,metadata:i.metadata,id:i.id,name:i.name,plugin:this,subtype:i.subtype}))}};U();var Dt=new _e("packages/core/src/context.ts"),oo=class Uo{constructor(i,n,a,c){this.config=n,this.authToken=a,this.info=c,this.disposed=!1,this.plugins=[],this._unknownPlugin=new kd,this._reminderSec=this.config.token.updateReminderSec,this._events=new hi,this.onTokenUpdateReminder=this._events.make(),this.onTokenExpired=this._events.make(),this.onFatalError=this._events.make(),this._onTokenUpdated=this._events.make(),this._onDisposed=this._events.make(),this._authTokenString=a.tokenString,this.appId=this.authToken.scope.app.id,(t=>{const i=new Td;t.registerPlugin(i)})(this),this._api=i,this._api.onFatalError.once(u=>{Dt.error("onFatalError",{appId:this.appId,error:u}),this.onFatalError.emit(le({operationName:"SkyWayContext._api.onFatalError",context:this,info:de.rtcApiFatalError,error:u,path:Dt.prefix})),this.dispose()})}static Create(i){return K(this,arguments,function*(n,a={}){const c=new dd(a);_e.level=c.log.level,_e.format=c.log.format;const u=Zi.Decode(n),{osName:p,osVersion:S,browserName:C,browserVersion:b}=(({isNotBrowser:t}={})=>{if(t)return t;const i=hh.default.getParser(window.navigator.userAgent),n=i.getOSName(),a=i.getOSVersion();return{browserName:i.getBrowserName(),browserVersion:i.getBrowserVersion(),osName:n,osVersion:a}})(),E={sdkName:"core",sdkVersion:this.version,osName:p,osVersion:S,browserName:C,browserVersion:b},k={rapi:c.rtcApi.domain,signaling:c.signalingService.domain,ice:c.iceParamServer.domain};Dt.info("core sdk spawned",{operationName:"SkyWayContext.Create",runtime:E,endpoint:k,config:c,token:u});try{const q=yield cd.Create({appId:u.scope.app.id,token:n,log:c.log,rtcApi:c.rtcApi}),V=new Uo(q,c,u,{endpoint:k,runtime:E});return yield V._setTokenExpireTimer(),V}catch(q){throw le({operationName:"SkyWayContext.Create",info:de.connectRtcApiFailed,error:q,path:Dt.prefix})}})}get authTokenString(){return this._authTokenString}_setTokenExpireTimer(){return K(this,null,function*(){const i=yield this._api.getServerUnixtimeInSec(),n=this.authToken.exp-i;if(n<0)throw le({operationName:"SkyWayContext._setTokenExpireTimer",context:this,info:de.invalidExpireTokenValue,path:Dt.prefix,payload:{exp:this.authToken.exp,now:i}});this.tokenUpdateReminderTimer&&clearTimeout(this.tokenUpdateReminderTimer);const a=n-this._reminderSec;if(a<0)throw le({operationName:"SkyWayContext._setTokenExpireTimer",context:this,info:de.invalidRemindExpireTokenValue,path:Dt.prefix,payload:{expiresInSec:n,reminderSec:this._reminderSec}});Dt.debug("_setTokenExpireTimer",{expiresInSec:n,tokenExpireReminderTimeSec:a}),this.tokenUpdateReminderTimer=setTimeout(()=>{Dt.debug("tokenUpdateReminder",{appid:this.appId}),this.onTokenUpdateReminder.emit()},1e3*a),this.tokenExpiredTimer&&clearTimeout(this.tokenExpiredTimer),this.tokenExpiredTimer=setTimeout(()=>{Dt.debug("tokenExpired",{appid:this.appId}),this.onTokenExpired.emit()},1e3*n)})}updateAuthToken(i){return K(this,null,function*(){const n=Zi.Decode(i);if(Dt.info({operationName:"SkyWayContext.updateAuthToken"},{oldToken:this.authToken,newToken:n}),n.scope.app.id!==this.appId)throw le({operationName:"SkyWayContext.updateAuthToken",context:this,info:de.invalidTokenAppId,path:Dt.prefix,payload:{invalid:this.authToken.scope.app.id,expect:this.appId}});this._authTokenString=i,this.authToken=n,this._onTokenUpdated.emit(i),yield this._setTokenExpireTimer(),yield this._api.updateAuthToken(i)})}registerPlugin(i){this.plugins.find(n=>n.subtype===i.subtype)||(i._attachContext(this),this.plugins.push(i))}_createRemoteMember(i,n){const a=i._getMember(n.id);if(a)return a;Dt.debug("createRemoteMember",{memberDto:n}),n.type=n.type.toLowerCase(),n.subtype=n.subtype.toLowerCase();let c=this.plugins.find(p=>p.subtype===n.subtype);return c||(c=this._unknownPlugin),c._createRemoteMember(i,n)}dispose(){this.disposed||(this.disposed=!0,Dt.debug("disposed",{appid:this.appId}),clearTimeout(this.tokenUpdateReminderTimer),this._onDisposed.emit(),this._events.dispose(),this._api.close())}};oo.version="1.9.2";var co=oo,Lt=new _e("packages/core/src/external/analytics.ts"),Od=class{constructor(t,i){this.client=t,this.context=i,this.onConnectionFailed=new Fe,this.onConnectionStateChanged=new Fe,this.onMessage=new Fe,this._isClosed=!1,this._listen(),i._onTokenUpdated.add(n=>{this.client.setNewSkyWayAuthToken(n)})}_listen(){this.client.onConnectionFailed.addOneTimeListener(()=>{this.onConnectionFailed.emit({})}),this.client.onConnectionStateChanged.addListener(t=>{"closed"===t&&!this.isClosed()&&this.client.isClosed()&&this.close(),this.onConnectionStateChanged.emit(t)})}get connectionState(){return this.client.connectionState}_connect(){return K(this,null,function*(){Lt.debug("[start] connect analyticsService"),yield this.client.connect().then(()=>{Lt.debug("[end] connect analyticsService")}).catch(t=>{this.close(),Lt.debug("[end] failed connect analyticsService: also unreachable to server"),Lt.error(`AnalyticsClient error: ${t.message}`,le({operationName:"AnalyticsClient.logger",info:ae(re({},de.internal),{detail:"AnalyticsClient error"}),error:t,path:Lt.prefix})),this.onConnectionFailed.emit({})})})}connectWithTimeout(){return K(this,null,function*(){let t;const i=new Promise((n,a)=>{t=setTimeout(()=>{Lt.debug("[end] failed connect analyticsService: no initial response from the server"),a(new Error("failed connect analyticsService"))},3e4)});return Promise.race([this._connect(),i]).finally(()=>{clearTimeout(t)})})}close(){this._isClosed=!0,this.onConnectionFailed.removeAllListeners(),this.onConnectionStateChanged.removeAllListeners(),this.onMessage.removeAllListeners()}isClosed(){return this._isClosed}};U();var uo=new _e("packages/core/src/external/ice.ts"),Bd=class{constructor(t){this.args=t,this.domain=this.args.domain,this.version=this.args.version,this.secure=this.args.secure,this.memberId=this.args.memberId,this.channelId=this.args.channelId,this.ttl=this.args.ttl,this.context=this.args.context,this._stunServers=[],this._turnServers=[],this._endpoint=`http${this.secure?"s":""}://${this.domain}/v${this.version}`,this.http=new Ta(this._endpoint)}updateIceParams(){return K(this,null,function*(){const t={memberId:this.memberId,channelId:this.channelId,ttl:this.ttl};uo.debug("[start] fetch iceParams");const i=new Yi({times:6,interval:500,jitter:100}),{turn:n,stun:a}=yield this.http.post("/ice-params",t,{headers:{authorization:`Bearer ${this.context.authTokenString}`},retry:()=>i.wait()});n&&(this._turnServers=[{credential:n.credential,urls:`turn:${n.domain}:${n.port}?transport=tcp`,username:n.username},{credential:n.credential,urls:`turn:${n.domain}:${n.port}?transport=udp`,username:n.username},{credential:n.credential,urls:`turns:${n.domain}:${n.port}?transport=tcp`,username:n.username}]),this._stunServers=[{urls:`stun:${a.domain}:${a.port}`}],uo.debug("[end] fetch iceParams",{turn:n,stun:a})})}get iceServers(){let t=[...this._stunServers];const i=this._turnServers.filter(n=>{const a=n.urls;switch(this.context.config.rtcConfig.turnProtocol){case"all":return!0;case"udp":return a.endsWith("udp");case"tcp":return!a.startsWith("turns")&&a.endsWith("tcp");case"tls":return a.startsWith("turns")}});return"disable"!==this.context.config.rtcConfig.turnPolicy&&(t=[...t,...i]),t}};U(),U(),U(),U();var Un=class{constructor(t,i={}){if(this.event=t,this.payload=i,this.eventId=fi(),this.data=JSON.stringify({event:this.event,eventId:this.eventId,payload:this.payload}),this.data.length>20480)throw new Error("payload size exceeds the upper limit")}};U();var jd=["rateLimitExceeded","targetNotFound","payloadLengthExceeded","invalidPayload","unknown","parameterError","permissionError"];function lo(t){return!(!t||"object"!=typeof t||!ho(t.src)||!t.data||"object"!=typeof t.data)}function ho(t){return!(void 0===t||Array.isArray(t)||"object"!=typeof t||"string"!=typeof t.id||typeof t.name<"u"&&"string"!=typeof t.name)}U();var fo=jt(vr());U();var Ci=class{constructor(){this._listeners=new Map,this._listenerIndex=0,this.emit=t=>{this._listeners.forEach(i=>i(t))},this.removeAllListeners=()=>{this._listeners.clear()},this.addListener=t=>{const i=this._listenerIndex;return this._listeners.set(i,t),this._listenerIndex++,{removeListener:()=>{this._listeners.delete(i)}}},this.addOneTimeListener=t=>{const i=this.addListener(n=>{i.removeListener(),t(n)});return i},this.asPromise=t=>new Promise((i,n)=>{let a=()=>{};const c=t&&setTimeout(()=>{n("Event asPromise timeout"),a()},t);a=this.addOneTimeListener(p=>{c&&clearTimeout(c),i(p)}).removeListener})}};U();var qd=["open","sendRequestSignalingMessage","sendResponseSignalingMessage","acknowledge"],Ud=class{constructor({channelId:t,channelName:i,memberId:n,memberName:a,sessionEndpoint:c,token:u,logger:p}){this._isOpen=!1,this._isDestroyed=!1,this._reconnectCount=0,this.connectionState="closed",this.onConnectionStateChanged=new Ci,this.onOpened=new Ci,this.onEventReceived=new Ci,this.onConnectionFailed=new Ci,this._sessionEndpoint=c,this._channelId=t,this._channelName=i,this._memberId=n,this._memberName=a,this._token=u,this._logger=p,this._connect()}_setConnectionState(t){this._logger.debug(`connectionState changed : ${t}`),this.connectionState=t,this.onConnectionStateChanged.emit(t)}_connect(){let t;try{const i=`SkyWayAuthToken!${this._token}`,a=Object.entries({channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,platform:"javascript",version:"1.0.4"}).filter(([u,p])=>void 0!==p).map(u=>u.join("=")).join("&");t=new fo.default(`${this._sessionEndpoint}?${a}`,i),this._logger.debug(`Connecting to signaling-server: ${this._sessionEndpoint}`),t.onerror=u=>{this._logger.error("WebSocket error occurred",u.error),t.close(4202)}}catch(i){const n=i instanceof Error?i:new Error;return this._logger.error("Failed to create WebSocket instance",n),void this.reconnect()}t.onopen=()=>{this._logger.debug("Connected to signaling-server")},t.onclose=i=>{const n="Close event fired: "+JSON.stringify({code:i.code,reason:i.reason,type:i.type});4100<=i.code&&i.code<=4199?this._logger.error(n,new Error):this._logger.debug(n),1e3===i.code||4e3<=i.code&&i.code<=4199?4e3!==i.code&&(this._logger.debug("Closed the connection to signaling-server"),this.onConnectionFailed.emit(),this.destroy()):this.reconnect()},t.onmessage=i=>{this._messageHandler(i.data)},this._ws=t}updateAuthToken(t){this._token=t}reconnect(){if(void 0!==this._ws&&this._ws.close(4e3),this._ws=void 0,this._isOpen=!1,this._reconnectCount>=8)this.onConnectionFailed.emit(),this.destroy(),this._logger.error("Failed to reconnect for eight times",new Error);else{this._setConnectionState("reconnecting");const t=(t=>1e3*(ui(2,this._reconnectCount)+Math.random()))();this._reconnectTimer=setTimeout(()=>{this._connect(),this._reconnectCount++,this._logger.debug(`Try to reconnect: count = ${this._reconnectCount}`)},t)}}destroy(){this._isDestroyed=!0,this._setConnectionState("closed"),this.onConnectionStateChanged.removeAllListeners(),this.onOpened.removeAllListeners(),this.onEventReceived.removeAllListeners(),this.onConnectionFailed.removeAllListeners(),this._reconnectTimer&&clearTimeout(this._reconnectTimer),void 0!==this._ws&&this._ws.close(1e3)}send(t){return new Promise((i,n)=>{const a=()=>{this.onOpened.addOneTimeListener(()=>{this.send(t).then(()=>{i()}).catch(c=>{n(c)})}),this.onConnectionFailed.addOneTimeListener(()=>{n(new Error("Connection failed"))})};if(!this._isDestroyed)return void 0!==this._ws&&this._isOpen?(this._logger.debug(`Send the event: ${t.data}`),void this._ws.send(t.data,c=>{if(c){if(void 0===this._ws||!this._isOpen||this._ws.readyState!==fo.default.OPEN)return this._logger.debug("Retry send the client event when connected because WebSocket.send failed"),void a();n(c)}else i()})):(this._logger.debug("Retry send the client event when connected because WebSocket is undefined or isOpen = false"),void a());n(new Error("The socket is already destroyed"))})}_messageHandler(t){if("string"!=typeof t)return void this._logger.error("Received invalid message: not string",new Error);let i;try{i=JSON.parse(t)}catch(n){const a=n instanceof Error?n:new Error;return void this._logger.error("Received invalid message: parse error",a)}!function Kd(t){return!(!t||"object"!=typeof t||"string"!=typeof t.event||!qd.includes(t.event)||"string"!=typeof t.eventId||t.payload&&"object"!=typeof t.payload)}(i)?this._logger.error(`Received invalid message: ${i}`,new Error):"open"===i.event?(this._logger.debug("Received a open event"),this._isOpen=!0,this._setConnectionState("connected"),0!==this._reconnectCount&&(this._reconnectCount=0,this._logger.debug("Succeeded to reconnect")),this.onOpened.emit()):(this._logger.debug(`Received the event: ${i.event}, payload: ${JSON.stringify(i.payload)}`),this.onEventReceived.emit(i))}},po="signaling.skyway.ntt.com",zd=class{constructor({token:t,channelId:i,channelName:n,memberId:a,memberName:c},u){this.onConnectionStateChanged=new Ci,this.onConnectionFailed=new Ci,this.onRequested=new Ci,this._connectivityCheckTimers=new Map,this._responseCallbacks=new Map,this._acknowledgeCallbacks=new Map,this._token=t,this._channelId=i,this._channelName=n,this._memberId=a,this._memberName=c,this._options=Object.assign({},{connectivityCheckIntervalSec:30,signalingServerDomain:po,secure:!0,logger:{debug:S=>{console.debug(S)},error:S=>{console.error(S)}}},u??{}),this._logger=this._options.logger,this._logger.debug(`Created instance with the options: ${this._options}`)}get connectionState(){var t,i;return null!=(i=null==(t=this._socket)?void 0:t.connectionState)?i:"closed"}connect(){return K(this,null,function*(){this._socket=new Ud({sessionEndpoint:`${this._options.secure?"wss":"ws"}://${this._options.signalingServerDomain||po}/v1/ws`,channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,token:this._token,logger:this._logger}),this._socket.onEventReceived.addListener(n=>{try{this._eventReceivedHandler(n)}catch(a){this._logger.error("in _eventReceivedHandler",a)}}),this._socket.onConnectionFailed.addListener(()=>{this.onConnectionFailed.emit()}),this._socket.onConnectionStateChanged.addListener(n=>{this.onConnectionStateChanged.emit(n)}),yield this._socket.onOpened.asPromise(15e3),this._startConnectivityCheck()})}disconnect(){var t;this._stopConnectivityCheck(),null==(t=this._socket)||t.destroy(),this._socket=void 0,this._responseCallbacks.clear(),this._acknowledgeCallbacks.clear()}_startConnectivityCheck(){this._connectivityCheckInterval?this._logger.debug("connectivity check timer is already set"):(this._connectivityCheckInterval=setInterval(()=>{var t;const i=new Un("checkConnectivity");null==(t=this._socket)||t.send(i).catch(()=>{this._acknowledgeCallbacks.delete(i.eventId)}),this._connectivityCheckTimers.set(i.eventId,setTimeout(()=>{var n;this._acknowledgeCallbacks.delete(i.eventId),null==(n=this._socket)||n.reconnect(),this._logger.debug("connectivity check timer is expired")},5e3)),this._setAcknowledgeCallback(i.eventId,n=>{var a;const c=this._connectivityCheckTimers.get(i.eventId);c&&(clearTimeout(c),this._connectivityCheckTimers.delete(i.eventId)),n.ok||(null==(a=this._socket)||a.reconnect(),this._logger.debug("connectivity check response from server was not ok"))})},1e3*this._options.connectivityCheckIntervalSec),this._logger.debug("Started connectivity check timer"))}_stopConnectivityCheck(){if(this._connectivityCheckInterval){clearInterval(this._connectivityCheckInterval),this._connectivityCheckInterval=void 0,this._logger.debug("Stopped connectivity check timer");for(const[t,i]of this._connectivityCheckTimers)clearTimeout(i);this._connectivityCheckTimers.clear()}else this._logger.debug("connectivity check timer is not set")}request(t,i,n=10){return function $d(t){if(!ho(t))throw new Error("the type of target must be {id: string, name: string}");if(!Ma(t.id))throw new Error("the type of target.id must be uuid format")}(t),vo(i),new Promise((a,c)=>{if(void 0===this._socket)return void c(new Error("websocket is not connected"));const p=new Un("sendRequestSignalingMessage",{dst:t,data:i}),S=setTimeout(()=>{this._acknowledgeCallbacks.delete(p.eventId),c(new Error("request timeout"))},1e3*n);this._setResponseCallback(p.eventId,C=>{clearTimeout(S),a(C)}),this._setAcknowledgeCallback(p.eventId,C=>{C.ok||(clearTimeout(S),c(C))}),this._socket.send(p).catch(C=>{this._acknowledgeCallbacks.delete(p.eventId),clearTimeout(S),c(C)})})}_response(t,i,n,a){return new Promise((c,u)=>{if(vo(n),void 0===this._socket)return void u(new Error("websocket is not connected"));const S=new Un("sendResponseSignalingMessage",{dst:t,requestEventId:i,data:n}),C=setTimeout(()=>{this._acknowledgeCallbacks.delete(S.eventId),u(new Error("response timeout"))},1e3*a);this._setAcknowledgeCallback(S.eventId,b=>{clearTimeout(C),b.ok?c():u(b)}),this._socket.send(S).catch(b=>{this._acknowledgeCallbacks.delete(S.eventId),clearTimeout(C),u(b)})})}updateSkyWayAuthToken(t,i=10){return new Promise((n,a)=>{if(void 0===this._socket)return void a(new Error("websocket is not connected"));const u=new Un("updateSkyWayAuthToken",{token:t}),p=setTimeout(()=>{this._acknowledgeCallbacks.delete(u.eventId),a(new Error("updateSkyWayAuthToken timeout"))},1e3*i);this._setAcknowledgeCallback(u.eventId,S=>{if(clearTimeout(p),S.ok){if(void 0===this._socket)return void a(new Error("websocket is not connected"));this._socket.updateAuthToken(t),n()}else a(S)}),this._socket.send(u).catch(S=>{this._acknowledgeCallbacks.delete(u.eventId),clearTimeout(p),a(S)})})}_eventReceivedHandler(t){switch(t.event){case"acknowledge":this._acknowledgeHandler(t.payload);break;case"sendRequestSignalingMessage":this._eventMessageRequestHandler(t.payload);break;case"sendResponseSignalingMessage":this._eventMessageResponseHandler(t.payload);break;case"open":break;default:this._logger.debug(`Unknown event: ${t.event}`)}}_acknowledgeHandler(t){if(!function Ld(t){return!(!t||"object"!=typeof t||"string"!=typeof t.eventId||"boolean"!=typeof t.ok||typeof t.reason<"u"&&("string"!=typeof t.reason||!jd.includes(t.reason)))}(t))throw new Error("Invalid payload");const{eventId:i}=t;if(!this._acknowledgeCallbacks.has(i))throw new Error(`acknowledge event has unknown eventId: ${i}`);const n=this._acknowledgeCallbacks.get(i);n&&(this._acknowledgeCallbacks.delete(i),n(t))}_eventMessageRequestHandler(t){if(!lo(t))throw new Error("Invalid payload");if(!t.requestEventId)throw new Error("Invalid payload");const i=t.src,n=t.requestEventId;this.onRequested.emit({data:t.data,reply:(c,u=10)=>K(this,null,function*(){yield this._response(i,n,c,u)}),requestEventId:t.requestEventId,src:t.src})}_eventMessageResponseHandler(t){if(!lo(t))throw new Error("Invalid payload");if(!t.requestEventId||!this._responseCallbacks.has(t.requestEventId))throw new Error(`received response has unknown eventId: ${t.requestEventId}`);const i=this._responseCallbacks.get(t.requestEventId);i&&(this._responseCallbacks.delete(t.requestEventId),i(t.data))}_setResponseCallback(t,i){this._responseCallbacks.set(t,i)}_setAcknowledgeCallback(t,i){this._acknowledgeCallbacks.set(t,i)}};function vo(t){if(!t||"object"!=typeof t)throw new Error("the type of data must be object")}U();var Ht=new _e("packages/core/src/external/signaling.ts"),Jd=class{constructor(t,i){this._client=t,this.context=i,this.onConnectionFailed=new Fe,this.onConnectionStateChanged=new Fe,this.onMessage=new Fe,this.closed=!1,this._chunkedMessageBuffer={},this._backoffUpdateSkyWayAuthToken=new Yi({times:8,interval:100,jitter:100}),this._disposer=new si,this._listen(),i._onTokenUpdated.add(n=>K(this,null,function*(){yield this._updateSkyWayAuthToken(n)})).disposer(this._disposer)}updateClient(t){this._client=t,this._listen()}_listen(){this._client.onConnectionFailed.addOneTimeListener(()=>{this.onConnectionFailed.emit({})}),this._client.onConnectionStateChanged.addListener(t=>{Ht.debug("signalingClient onConnectionStateChanged",t),this.onConnectionStateChanged.emit(t)}),this._client.onRequested.addListener(t=>K(this,[t],function*({data:i,src:n,reply:a}){var c;const u=i,{chunk:p,length:S,offset:C,id:b,type:E}=u;if(E===Xr){if(0===S)this.onMessage.emit({src:n,data:JSON.parse(p)});else if(this._chunkedMessageBuffer[b]=[...null!=(c=this._chunkedMessageBuffer[b])?c:[],u.chunk],S===C){const k=this._chunkedMessageBuffer[b].join("");delete this._chunkedMessageBuffer[b],this.onMessage.emit({src:n,data:JSON.parse(k)})}yield a({}).catch(k=>{this.closed||Ht.warn("failed to reply",ct({operationName:"SignalingSession.reply",detail:"SignalingClient failed to reply"}),k)})}}))}_updateSkyWayAuthToken(t){return K(this,null,function*(){if(this._backoffUpdateSkyWayAuthToken.exceeded)return void Ht.error("[failed] updateSkyWayAuthToken");yield this._backoffUpdateSkyWayAuthToken.wait(),Ht.debug("[start] updateSkyWayAuthToken",{count:this._backoffUpdateSkyWayAuthToken.count});const i=yield this._client.updateSkyWayAuthToken(t).catch(n=>n);if(i)return Ht.warn("[retry] updateSkyWayAuthToken",ct({operationName:"SignalingSession._updateSkyWayAuthToken",detail:"[retry] updateSkyWayAuthToken"}),i),void(yield this._updateSkyWayAuthToken(t));Ht.debug("[end] updateSkyWayAuthToken"),this._backoffUpdateSkyWayAuthToken.reset()})}get connectionState(){return this._client.connectionState}connect(){return K(this,null,function*(){Ht.debug("[start] connect signalingService"),yield this._client.connect().catch(t=>{throw le({operationName:"signalingSession.connect",path:Ht.prefix,info:ae(re({},de.internal),{detail:"signalingClient failed to connect Server"}),context:this.context,error:t})}),Ht.debug("[end] connect signalingService")})}close(){this.closed=!0,this._disposer.dispose(),this._client.disconnect()}send(t,i,n=1e4){return K(this,null,function*(){var a;try{const c=JSON.stringify(i),u=Lr();if(c.length>20480){const p=null!=(a=c.match(/.{1,20480}/g))?a:[];let S=0;for(const C of p){const b={type:Xr,length:p.length-1,offset:S++,chunk:C,id:u};yield this._client.request(t,b,n/1e3)}}else{const p={type:Xr,length:0,offset:0,chunk:c,id:u};yield this._client.request(t,p,n/1e3)}}catch(c){if(this.closed||"joined"!==t.state)return;throw le({operationName:"SignalingSession.send",context:this.context,info:ae(re({},de.internal),{detail:"signalingClient"}),error:c,path:Ht.prefix,payload:{target:t,data:i}})}})}},Xr="signalingMessage",go=new _e("packages/core/src/member/person/local/factory.ts");var xe=new _e("packages/core/src/member/localPerson/index.ts"),Qd=class Ko extends Mr{constructor(i){super(i),this.args=i,this.type="person",this.subtype="person",this.side="local",this.keepaliveIntervalSec=this.args.keepaliveIntervalSec,this.keepaliveIntervalGapSec=this.args.keepaliveIntervalGapSec,this.disableSignaling=this.args.disableSignaling,this.disableAnalytics=this.args.disableAnalytics,this.config=this.context.config,this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onFatalError=this._events.make(),this._onStreamSubscribeFailed=this._events.make(),this._onDisposed=this._events.make(),this._disposer=new si,this._subscribing={},this._requestQueue=new wi,this.iceManager=this.args.iceManager,this._disposed=!1,this._publishingAgent=new Mh(this),this._subscribingAgent=new jh(this),this._signaling=i.signaling,this._analytics=i.analytics,this._listenChannelEvent(),this._listenBeforeUnload()}static Create(...i){return K(this,null,function*(){const n=new Ko(...i);return yield n._setupTtlTimer(),n})}_listenChannelEvent(){this.channel.onPublicationSubscribed.add(i=>K(this,[i],function*({subscription:n}){yield this._handleOnPublicationSubscribe(n).catch(a=>xe.error("_handleOnStreamSubscribe",a))})).disposer(this._disposer),this.channel.onPublicationUnsubscribed.add(i=>K(this,[i],function*({subscription:n}){yield this._handleOnPublicationUnsubscribe(n).catch(a=>xe.error("_handleOnStreamUnsubscribe",a))})).disposer(this._disposer),this.channel._onDisposed.once(()=>{this.dispose()}),this.onLeft.once(()=>{this.dispose()})}_setupTtlTimer(){return K(this,null,function*(){const{keepaliveIntervalSec:i,keepaliveIntervalGapSec:n}=this;if(null==i||(xe.debug("_setupTtlTimer",this.toJSON(),{keepaliveIntervalSec:i,keepaliveIntervalGapSec:n}),-1===i))return;const a=()=>K(this,null,function*(){if(this._disposed)return;const c=yield this.context._api.getServerUnixtimeInSec();this.ttlSec=Math.floor(c+i+(n??0));try{yield this.channel._updateMemberTtl(this.id,this.ttlSec),xe.debug("updateTtl",this.toJSON(),{now:c,ttlSec:this.ttlSec,keepaliveIntervalSec:i??0,keepaliveIntervalGapSec:n??0,diff:this.ttlSec-c})}catch(u){if(this._disposed)return;throw u}});yield a(),this.ttlInterval=setInterval(()=>K(this,null,function*(){yield a().catch(c=>{this._disposed||(this.onFatalError.emit(le({operationName:"localPerson._setupTtlTimer",path:xe.prefix,info:ae(re({},de.internal),{detail:"updateMemberTtl failed"}),channel:this.channel,context:this.context,error:c})),this.dispose())})}),1e3*i)})}_listenBeforeUnload(){if(window){const i=()=>K(this,null,function*(){window.removeEventListener("beforeunload",i),"joined"===this.state&&(xe.debug("leave by beforeunload",this.toJSON()),yield this.leave())});window.addEventListener("beforeunload",i)}}_handleOnPublicationSubscribe(i){return K(this,null,function*(){var n;if(i.subscriber.id===this.id)try{const a=xe.info("[start] startSubscribing",yield je({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:i}),c=null==(n=this._subscribing[i.publication.id])?void 0:n.options;c&&(i.preferredEncoding=c.preferredEncodingId),yield this._subscribingAgent.startSubscribing(i),this.onPublicationSubscribed.emit({subscription:i,stream:i.stream}),this.onSubscriptionListChanged.emit(),xe.elapsed(a,"[end] startSubscribing",yield je({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:i})}catch(a){throw this._onStreamSubscribeFailed.emit({error:a,subscription:i}),a}if(i.publication.publisher.id===this.id){if(i.subscriber.id===this.id)throw le({operationName:"localPerson._handleOnStreamSubscribe",path:xe.prefix,info:ae(re({},de.internal),{detail:"can not subscribe own Publication"}),channel:this.channel,context:this.context});const a=xe.info("[start] startPublishing",yield je({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:i});yield this._publishingAgent.startPublishing(i).catch(c=>{throw xe.error("[failed] startPublishing",c,{subscription:i}),c}),xe.elapsed(a,"[end] startPublishing",yield je({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:i})}})}_handleOnPublicationUnsubscribe(i){return K(this,null,function*(){if(i.publication.publisher.id===this.id){const n=xe.info("[start] stopPublishing",yield je({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:i});yield this._publishingAgent.stopPublishing(i.publication,i.subscriber).catch(a=>{throw xe.error("[failed] stopPublishing",a,{subscription:i}),a}),xe.elapsed(n,"[end] stopPublishing",yield je({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:i})}if(i.subscriber.id===this.id){const n=xe.info("[start] stopSubscribing",yield je({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:i});yield this._subscribingAgent.stopSubscribing(i).catch(a=>{throw xe.error("[failed] stopSubscribing",{subscription:i},a),a}),this.onPublicationUnsubscribed.emit({subscription:i}),this.onSubscriptionListChanged.emit(),xe.elapsed(n,"[end] stopSubscribing",yield je({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:i})}})}publish(i){return K(this,arguments,function*(n,a={}){var c,u,p,S;const C=xe.info("[start] publish",yield je({operationName:"localPerson.publish",channel:this.channel}),{options:a});if("joined"!==this.state)throw le({operationName:"localPerson.publish",info:de.localPersonNotJoinedChannel,path:xe.prefix,channel:this.channel,context:this.context});if(n.published)throw le({operationName:"localPerson.publish",channel:this.channel,context:this.context,info:de.alreadyPublishedStream,path:xe.prefix});n.published=!0,a.codecCapabilities&&(a.codecCapabilities=a.codecCapabilities.filter(q=>null!=q));const b={metadata:a.metadata,publisher:this.id,channel:this.channel.id,contentType:n.contentType,codecCapabilities:null!=(c=a.codecCapabilities)?c:[],isEnabled:a.isEnabled};"video"===n.contentType&&0===b.codecCapabilities.length&&(b.codecCapabilities=[{mimeType:"video/vp8"}]),a.encodings&&a.encodings.length>0&&(b.encodings=Wr(Ka(a.encodings)));const E=yield this._requestQueue.push(()=>this.channel._publish(b).catch(q=>{throw le({operationName:"localPerson.publish",context:this.context,channel:this.channel,info:q.info,path:xe.prefix,error:q})}));"data"===n.contentType?n.setIsEnabled(E.isEnabled):yield n.setEnabled(E.isEnabled);const k=this.channel._addPublication(E);if(k._setStream(n),null!=(u=b.codecCapabilities)&&u.length&&k.setCodecCapabilities(b.codecCapabilities),null!=(p=b.encodings)&&p.length&&k.setEncodings(b.encodings),yield this._handleOnStreamPublish(k),xe.elapsed(C,"[end] publish",yield je({operationName:"localPerson.publish",channel:this.channel}),{publication:k}),["video","audio"].includes(k.contentType)&&this._analytics&&!this._analytics.isClosed()){this._analytics.client.sendMediaDeviceReport({publicationId:k.id,mediaDeviceName:k.deviceName,mediaDeviceTrigger:"publish",updatedAt:Date.now()});const q=null!=(S=b.encodings)?S:[];this._analytics.client.sendPublicationUpdateEncodingsReport({publicationId:k.id,encodings:q,updatedAt:Date.now()})}return k})}_handleOnStreamPublish(i){return K(this,null,function*(){xe.info("onStreamPublished",yield je({operationName:"onStreamPublished",channel:this.channel})),this.onStreamPublished.emit({publication:i}),this.onPublicationListChanged.emit()})}unpublish(i){return K(this,null,function*(){const n=xe.info("[start] unpublish",yield je({operationName:"localPerson.unpublish",channel:this.channel})),a="string"==typeof i?i:i.id;if("joined"!==this.state)throw le({operationName:"localPerson.unpublish",info:de.localPersonNotJoinedChannel,path:xe.prefix,context:this.context,channel:this.channel});const c=this.channel._getPublication(a);if(!c)throw le({operationName:"localPerson.unpublish",info:de.publicationNotExist,path:xe.prefix,context:this.context,channel:this.channel,payload:{publicationId:a}});c.stream&&c.stream._unpublished(),yield this._requestQueue.push(()=>this.channel._unpublish(a)),c.subscriptions.map(u=>u.subscriber).forEach(u=>{(function Bh(t){return null!=t&&"remote"===t.side})(u)&&this._publishingAgent.stopPublishing(c,u).catch(p=>{xe.error("[failed] stopPublishing",p,{publication:c})})}),yield this._handleOnStreamUnpublished(c),xe.elapsed(n,"[end] unpublish",yield je({operationName:"localPerson.unpublish",channel:this.channel}),{publication:c})})}_handleOnStreamUnpublished(i){return K(this,null,function*(){xe.info("onStreamUnpublished",yield je({operationName:"onStreamUnpublished",channel:this.channel})),this.onStreamUnpublished.emit({publication:i}),this.onPublicationListChanged.emit()})}subscribe(i){return K(this,arguments,function*(n,a={}){const c=xe.info("[start] subscribe",yield je({operationName:"localPerson.subscribe",channel:this.channel}),{target:n}),u="string"==typeof n?n:n.id;if("joined"!==this.state)throw le({operationName:"localPerson.subscribe",info:de.localPersonNotJoinedChannel,path:xe.prefix,context:this.context,channel:this.channel,payload:{target:n}});const p=this.channel._getPublication(u);if(null==p)throw le({operationName:"localPerson.subscribe",info:de.publicationNotExist,path:xe.prefix,context:this.context,channel:this.channel,payload:p});this._validatePublicationForSubscribe(p),this._subscribing[p.id]={options:a,processing:!0};const S=this._subscribing[p.id];try{const C=yield this._requestQueue.push(()=>this.channel._subscribe(this.id,u));xe.elapsed(c,"[elapsed] subscribe / subscriptionDto received",{subscriptionDto:C});const b=this.channel._addSubscription(C);return b.stream||(yield Promise.race([new Promise((E,k)=>{this.onPublicationSubscribed.watch(({subscription:q})=>q.publication.id===u,this.context.config.rtcApi.timeout).then(E).catch(q=>K(this,null,function*(){S.processing&&k(le({operationName:"localPerson.subscribe",info:ae(re({},de.timeout),{detail:"failed to subscribe publication. maybe publisher already left room"}),path:xe.prefix,context:this.context,channel:this.channel,payload:{subscription:b,publication:p},error:q}))}))}),new Promise((E,k)=>{this.channel.onMemberLeft.watch(q=>q.member.id===p.publisher.id,this.context.config.rtcApi.timeout+1e3).then(()=>{S.processing&&k(le({operationName:"localPerson.subscribe",info:ae(re({},de.internal),{detail:"failed to subscribe publication. publisher already left room"}),path:xe.prefix,context:this.context,channel:this.channel,payload:{subscription:b,publication:p}}))}).catch(E)}),new Promise((E,k)=>{this._onStreamSubscribeFailed.watch(q=>q.subscription.publication.id===p.id,this.context.config.rtcApi.timeout+1e3).then(q=>{var V,F;if(S.processing){const O=null!=(F=null==(V=q?.error)?void 0:V.info)?F:ae(re({},de.internal),{detail:"subscribe _onStreamSubscribeFailed"});k(le({operationName:"localPerson.subscribe",info:O,path:xe.prefix,context:this.context,channel:this.channel,error:q.error,payload:{subscription:b,publication:p}}))}}).catch(E)})])),S.processing=!1,xe.elapsed(c,"[end] subscribe",yield je({operationName:"localPerson.subscribe",channel:this.channel}),{subscription:b,publication:p}),{subscription:b,stream:b.stream}}catch(C){throw S.processing=!1,xe.warn("[failed] subscribe",C,{publication:p}),C}})}_validatePublicationForSubscribe(i){if(i.publisher.id===this.id)throw le({operationName:"localPerson._validatePublicationForSubscribe",info:de.publicationNotExist,path:xe.prefix,context:this.context,channel:this.channel,payload:{publication:i}});if(i.publisher instanceof Na)throw le({operationName:"localPerson._validatePublicationForSubscribe",info:de.unknownMemberType,path:xe.prefix,context:this.context,channel:this.channel,payload:{publication:i}});if(this.subscriptions.find(n=>n.publication.id===i.id))throw le({operationName:"localPerson._validatePublicationForSubscribe",info:de.alreadySubscribedPublication,path:xe.prefix,context:this.context,channel:this.channel,payload:{publication:i}})}unsubscribe(i){return K(this,null,function*(){const n=xe.info("[start] unsubscribe",yield je({operationName:"localPerson.unsubscribe",channel:this.channel})),a="string"==typeof i?i:i.id;if("joined"!==this.state)throw le({operationName:"localPerson.unsubscribe",info:de.localPersonNotJoinedChannel,path:xe.prefix,context:this.context,channel:this.channel});const c=this.subscriptions.find(u=>u.id===a);if(!c)throw le({operationName:"localPerson.unsubscribe",info:de.subscriptionNotExist,path:xe.prefix,context:this.context,channel:this.channel,payload:{subscriptionId:a}});delete this._subscribing[c.publication.id],yield this._requestQueue.push(()=>this.channel._unsubscribe(a)),xe.elapsed(n,"[end] unsubscribe",yield je({operationName:"localPerson.unsubscribe",channel:this.channel}),{subscription:c})})}_getConnections(){return this.channel.members.map(a=>a._getConnection(this.id)).filter(a=>!1===a?.closed)}dispose(){this._disposed||(this._disposed=!0,xe.debug("disposed",this.toJSON()),clearInterval(this.ttlInterval),this._signaling&&this._signaling.close(),this._analytics&&this._analytics.close(),this._getConnections().forEach(i=>i.close({reason:"localPerson disposed"})),this._onDisposed.emit(),this._events.dispose(),this._disposer.dispose())}};U(),U();var Yt=new _e("packages/core/src/subscription/index.ts"),Yd=class{constructor(t){this._disposer=new si,this._state="enabled",this.onCanceled=new Fe,this.onStreamAttached=new Fe,this.onConnectionStateChanged=new Fe,this._onChangeEncoding=new Fe,this.cancel=()=>new Promise((i,n)=>{let a=!1;this._channel._unsubscribe(this.id).catch(c=>{a=!0,n(c)}),this.onCanceled.asPromise(this._context.config.rtcApi.timeout).then(()=>i()).catch(c=>{a||n(c)})}),this._channel=t.channel,this._context=this._channel._context,this.id=t.id,this.contentType=t.contentType,this.subscriber=t.subscriber,this.publication=t.publication,Yt.debug("subscription spawned",this.toJSON()),this._handlePublicationEnabled()}get state(){return this._state}_handlePublicationEnabled(){this.publication.onDisabled.add(()=>{this.stream&&(Yt.debug("disabled",this),this.stream.setIsEnabled(!1))}).disposer(this._disposer),this.publication.onEnabled.add(()=>{this.stream&&(Yt.debug("enabled",this),this.stream.setIsEnabled(!0))}).disposer(this._disposer),this.stream&&this.stream.setIsEnabled("enabled"===this.publication.state)}_setStream(t){this._stream=t,this.onStreamAttached.emit(),t._onConnectionStateChanged.add(i=>{Yt.debug("onConnectionStateChanged",this.id,i),this.onConnectionStateChanged.emit(i)})}get stream(){return this._stream}toJSON(){return{id:this.id,contentType:this.contentType,subscriber:this.subscriber,publication:this.publication,channelId:this._channel.id,state:this.state,stream:this.stream}}_canceled(){this._state="canceled",this.onCanceled.emit(),this._disposer.dispose()}changePreferredEncoding(t){if(!this.stream)throw le({operationName:"SubscriptionImpl.changePreferredEncoding",info:de.streamNotExistInSubscription,path:Yt.prefix,context:this._context,channel:this._channel});if("data"===this.stream.contentType)throw le({operationName:"SubscriptionImpl.changePreferredEncoding",info:de.dataStreamNotSupportEncoding,path:Yt.prefix,context:this._context,channel:this._channel});if(!this.publication.encodings.map(i=>i.id).includes(t))throw le({operationName:"SubscriptionImpl.changePreferredEncoding",info:de.correspondingEncodeNotExistForId,path:Yt.prefix,context:this._context,channel:this._channel});this.preferredEncoding=t,this._onChangeEncoding.emit()}getStats(){if(!this.stream)throw le({operationName:"SubscriptionImpl.getStats",info:de.streamNotExistInSubscription,path:Yt.prefix,context:this._context,channel:this._channel});return this.stream._getStats()}getRTCPeerConnection(){if(!this.stream)throw le({operationName:"SubscriptionImpl.getRTCPeerConnection",info:de.streamNotExistInSubscription,path:Yt.prefix,context:this._context,channel:this._channel});return this.stream._getRTCPeerConnection()}getConnectionState(){if(!this.stream)throw le({operationName:"SubscriptionImpl.getConnectionState",info:de.streamNotExistInSubscription,path:Yt.prefix,context:this._context,channel:this._channel});return this.stream._getConnectionState()}},We=new _e("packages/core/src/channel/index.ts"),Qr=class{constructor(t,i){this._context=t,this._channelImpl=i,this.id=this._channelImpl.id,this.name=this._channelImpl.name,this.appId=this._context.appId,this.disposed=!1,this.config=this._context.config,this._state="opened",this._api=this._context._api,this._members={},this._getMember=n=>this._members[n],this._publications={},this._getPublication=n=>this._publications[n],this._subscriptions={},this._getSubscription=n=>this._subscriptions[n],this._events=new hi,this.onClosed=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberListChanged=this._events.make(),this.onMemberJoined=this._events.make(),this.onMemberLeft=this._events.make(),this.onMemberMetadataUpdated=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationMetadataUpdated=this._events.make(),this.onPublicationEnabled=this._events.make(),this.onPublicationDisabled=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this._onDisposed=this._events.make(),this.leave=n=>K(this,null,function*(){return this._channelImpl.leave(this.id,n.id)}),this.updateMetadata=n=>this._channelImpl.updateChannelMetadata(n),this.close=()=>new Promise((n,a)=>K(this,null,function*(){if("closed"===this.state)return void a(le({operationName:"SkyWayChannelImpl.close",path:We.prefix,info:de.alreadyChannelClosed,channel:this,context:this._context,payload:this.toJSON()}));const c=We.info("[start] close channel",yield je({operationName:"SkyWayChannelImpl.close",channel:this}));try{yield this._channelImpl.close().catch(u=>{throw le({operationName:"SkyWayChannelImpl.close",context:this._context,info:ae(re({},de.internal),{detail:"_api.deleteChannel failed"}),error:u,path:We.prefix,channel:this})}),"closed"!==this._state&&(yield this.onClosed.asPromise(this._context.config.rtcApi.timeout).catch(u=>{throw le({operationName:"SkyWayChannelImpl.close",context:this._context,info:ae(re({},de.timeout),{detail:"channel.onClosed"}),error:u,path:We.prefix,channel:this})}))}catch(u){We.error(u.message,u),a(u)}We.elapsed(c,"[end] close channel",yield je({operationName:"SkyWayChannelImpl.close",channel:this})),n()})),this._updateMemberTtl=(n,a)=>this._channelImpl.updateMemberTtl(n,a),this._updateMemberMetadata=(n,a)=>this._channelImpl.updateMemberMetadata(n,a),this._publish=n=>this._channelImpl.publish(n),this._unpublish=n=>K(this,null,function*(){return this._channelImpl.unpublish(n)}),this._subscribe=(n,a)=>{const c=this._getPublication(a),u=this._getMember(n);if(null==u)throw le({operationName:"SkyWayChannelImpl._subscribe",path:We.prefix,info:ae(re({},de.internal),{detail:"subscriber not found"}),channel:this,context:this._context,payload:{subscriberId:n,publicationId:a}});return this._channelImpl.subscribe({publication:c.toJSON(),subscriber:u.toJSON()})},this._unsubscribe=n=>K(this,null,function*(){if(!this._getSubscription(n))throw le({operationName:"SkyWayChannelImpl._unsubscribe",path:We.prefix,info:ae(re({},de.internal),{detail:"can't unsubscribe not exist subscription"}),channel:this,context:this._context,payload:{subscriptionId:n}});yield this._channelImpl.unsubscribe(n)}),this._updatePublicationMetadata=(n,a)=>this._channelImpl.updatePublicationMetadata(n,a),this._disablePublication=n=>this._channelImpl.disablePublication(n),this._enablePublication=n=>this._channelImpl.enablePublication(n),this._setupPropertiesFromChannel(),this._setupListenChannelEvent(),t._onDisposed.once(()=>{this.dispose()}),We.debug("channel spawned",this.toJSON())}_addMember(t){const i=this._getMember(t.id);if(i)return i;const n=this._context._createRemoteMember(this,t);return this._members[n.id]=n,n}_removeMember(t){delete this._members[t]}_addPublication(t){const i=this._getPublication(t.id);if(i)return i;const n=function Oh(t,{publisherId:i,stream:n,origin:a,metadata:c,codecCapabilities:u,encodings:p,contentType:S,id:C,isEnabled:b}){const E=t._getPublication(C);if(E)return E;S=S.toLowerCase();const k=a?t._getPublication(a):void 0;return k&&0===p.length&&(p=k.encodings),new Ua({id:C,channel:t,publisher:t._getMember(i),contentType:S,metadata:c,origin:k,stream:n,codecCapabilities:u??[],encodings:p,isEnabled:b})}(this,t);return this._publications[t.id]=n,n}_removePublication(t){delete this._publications[t]}_addSubscription(t){const i=this._getSubscription(t.id);if(i)return i;const n=function Zd(t,{subscriberId:i,publicationId:n,id:a}){const c=t._getSubscription(a);if(c)return c;const p=t._getPublication(n).contentType;return new Yd({channel:t,id:a,subscriber:t._getMember(i),publication:t._getPublication(n),contentType:p})}(this,t);return this._subscriptions[t.id]=n,n}_removeSubscription(t){delete this._subscriptions[t]}get localPerson(){return this._localPerson}get members(){return Object.values(this._members)}get bots(){return this.members.filter(t=>"bot"===t.type)}get publications(){return Object.values(this._publications)}get subscriptions(){return Object.values(this._subscriptions)}get metadata(){return this._channelImpl.metadata}get state(){return this._state}toJSON(){return{id:this.id,name:this.name,appId:this.appId,metadata:this.metadata,members:this.members,publications:this.publications,subscriptions:this.subscriptions}}_setupPropertiesFromChannel(){this._channelImpl.members.forEach(t=>{this._addMember(t)}),this._channelImpl.publications.forEach(t=>{this._addPublication(t)}),this._channelImpl.subscriptions.forEach(t=>{this._addSubscription(t)})}_setupListenChannelEvent(){this._channelImpl.onClosed.add(()=>this._handleOnChannelClose()),this._channelImpl.onMetadataUpdated.add(({channel:t})=>this._handleOnChannelMetadataUpdate(t.metadata)),this._channelImpl.onMemberJoined.add(({member:t})=>{this._handleOnMemberJoin(t)}),this._channelImpl.onMemberLeft.add(({member:t})=>{this._handleOnMemberLeft(t)}),this._channelImpl.onMemberListChanged.pipe(this.onMemberListChanged),this._channelImpl.onMemberMetadataUpdated.add(({member:t})=>{this._handleOnMemberMetadataUpdate(t,t.metadata)}),this._channelImpl.onStreamPublished.add(({publication:t})=>{this._handleOnStreamPublish(t)}),this._channelImpl.onStreamUnpublished.add(({publication:t})=>{this._handleOnStreamUnpublish(t)}),this._channelImpl.onPublicationListChanged.pipe(this.onPublicationListChanged),this._channelImpl.onPublicationMetadataUpdated.add(({publication:t})=>{this._handleOnPublicationMetadataUpdate(t,t.metadata)}),this._channelImpl.onPublicationEnabled.add(t=>K(this,[t],function*({publication:i}){return yield this._handleOnPublicationEnabled(i)})),this._channelImpl.onPublicationDisabled.add(t=>K(this,[t],function*({publication:i}){return yield this._handleOnPublicationDisabled(i)})),this._channelImpl.onPublicationSubscribed.add(({subscription:t})=>{this._handleOnStreamSubscribe(t)}),this._channelImpl.onPublicationUnsubscribed.add(({subscription:t})=>{this._handleOnStreamUnsubscribe(t)}),this._channelImpl.onSubscriptionListChanged.pipe(this.onSubscriptionListChanged)}_handleOnChannelClose(){this._state="closed",this.onClosed.emit({}),this.dispose()}_handleOnChannelMetadataUpdate(t){this.onMetadataUpdated.emit({metadata:t})}_handleOnMemberJoin(t){const i=this._addMember(t);this.onMemberJoined.emit({member:i})}_handleOnMemberLeft(t){var i;const n=this._getMember(t.id);this._removeMember(n.id),n._left(),(null==(i=this.localPerson)?void 0:i.id)===t.id&&(this.localPerson._left(),this._localPerson=void 0),this.onMemberLeft.emit({member:n})}_handleOnMemberMetadataUpdate(t,i){var n;const a=this._getMember(t.id);a._metadataUpdated(i),(null==(n=this.localPerson)?void 0:n.id)===t.id&&this.localPerson._metadataUpdated(i),this.onMemberMetadataUpdated.emit({member:a,metadata:i})}_handleOnStreamPublish(t){const i=this._addPublication(t);this.onStreamPublished.emit({publication:i})}_handleOnStreamUnpublish(t){const i=this._getPublication(t.id);this._removePublication(i.id),i._unpublished(),this.onStreamUnpublished.emit({publication:i})}_handleOnPublicationMetadataUpdate(t,i){const n=this._getPublication(t.id);n._updateMetadata(i),this.onPublicationMetadataUpdated.emit({publication:n,metadata:i})}_handleOnPublicationEnabled(t){return K(this,null,function*(){const i=this._getPublication(t.id);i._enable(),this.onPublicationEnabled.emit({publication:i})})}_handleOnPublicationDisabled(t){return K(this,null,function*(){const i=this._getPublication(t.id);yield i._disable(),this.onPublicationDisabled.emit({publication:i})})}_handleOnStreamSubscribe(t){const i=this._addSubscription(t);this._getPublication(i.publication.id)._subscribed(i),this.onPublicationSubscribed.emit({subscription:i})}_handleOnStreamUnsubscribe(t){const i=this._getSubscription(t.id);this._removeSubscription(i.id),i._canceled(),this._getPublication(i.publication.id)._unsubscribed(i),this.onPublicationUnsubscribed.emit({subscription:i})}join(){return K(this,arguments,function*(t={}){const a=We.info("[start] join",yield je({operationName:"SkyWayChannelImpl.join",channel:this}));if(this._localPerson)throw le({operationName:"SkyWayChannelImpl.join",path:We.prefix,info:de.alreadyLocalPersonExist,channel:this,context:this._context});if(null!=t.name&&this.members.find(b=>b.name===t.name))throw le({operationName:"SkyWayChannelImpl.join",path:We.prefix,info:de.alreadySameNameMemberExist,channel:this,context:this._context,payload:t});null!=t.keepaliveIntervalSec||(t.keepaliveIntervalSec=this.config.member.keepaliveIntervalSec),null!=t.keepaliveIntervalGapSec||(t.keepaliveIntervalGapSec=this.config.member.keepaliveIntervalGapSec);const c=ae(re({},t),{type:"person",subtype:"person"});null!==t.keepaliveIntervalSec&&(c.ttlSec=(yield this._context._api.getServerUnixtimeInSec())+t.keepaliveIntervalSec);const u=yield this._channelImpl.joinChannel(c).catch(C=>{throw We.error("[failed] join",C),C});We.elapsed(a,"[elapsed] join / channelImpl.joinChannel",{member:u});const p=yield this._createLocalPerson(u,t),S=new za(p);return We.elapsed(a,"[end] join",{person:p}),S})}moveChannel(t){return K(this,null,function*(){if(this._localPerson)throw le({operationName:"SkyWayChannelImpl.moveChannel",path:We.prefix,info:de.alreadyLocalPersonExist,channel:this,context:this._context});if(!(t instanceof za))throw le({operationName:"SkyWayChannelImpl.moveChannel",path:We.prefix,info:de.invalidArgumentValue,channel:this,context:this._context});const i=t.channel;if(this.id===i.id)throw le({operationName:"SkyWayChannelImpl.moveChannel",path:We.prefix,info:de.cantMoveSameIdChannel,channel:this,context:this._context});yield i.leave(t);const n={name:t.name,type:t.type,subtype:t.subtype,metadata:t.metadata};null!=t.keepaliveIntervalSec&&(n.ttlSec=(yield this._context._api.getServerUnixtimeInSec())+t.keepaliveIntervalSec);const a=yield this._channelImpl.joinChannel(n),c=yield this._createLocalPerson(a,{keepaliveIntervalSec:t.keepaliveIntervalSec,keepaliveIntervalGapSec:t.keepaliveIntervalGapSec,disableSignaling:t.disableSignaling,disableAnalytics:t.disableAnalytics});t.apply(c)})}_createLocalPerson(t,i){return K(this,null,function*(){const n=yield function Xd(t,i,n){return K(this,arguments,function*(a,c,u,{keepaliveIntervalSec:p,keepaliveIntervalGapSec:S,disableSignaling:C,disableAnalytics:b}={}){var E,k;go.debug("createLocalPerson",{channel:c,memberDto:u,keepaliveIntervalSec:p,keepaliveIntervalGapSec:S});const{iceParamServer:q}=a.config,V=!0===C?void 0:yield function Gd(t,i,n){return K(this,null,function*(){const{signalingService:a}=t.config,c=new zd({token:t.authTokenString,channelId:i.id,channelName:i.name,memberId:n.id,memberName:n.name},{logger:{error:p=>K(this,null,function*(){Ht.error("SignalingClient error",le({operationName:"SignalingClient.logger",context:t,info:ae(re({},de.internal),{detail:"signalingClient error"}),error:p,path:Ht.prefix,channel:i}))}),debug:p=>{}},signalingServerDomain:a.domain,secure:a.secure}),u=new Jd(c,t);return yield u.connect(),u})}(a,c,u),O=null!=(E=Zi.Decode(a.authTokenString).scope.app.analytics)&&E,G=!0!==b&&O?yield function Dd(t,i,n){return K(this,null,function*(){const{analyticsService:a}=t.config,c=new Xh({token:t.authTokenString,channelId:i.id,channelName:i.name,memberId:n.id,memberName:n.name,sdkVersion:co.version},{logger:{error:(p,S)=>K(this,null,function*(){Lt.error(`AnalyticsClient error: ${p}`,le({operationName:"AnalyticsClient.logger",context:t,info:ae(re({},de.internal),{detail:"AnalyticsClient error"}),error:S,path:Lt.prefix,channel:i}))}),debug:(p,...S)=>{Lt.debug("[analytics]:",p,...S)},warn:(p,...S)=>{Lt.warn("[analytics]:",p,...S)}},analyticsLoggingServerDomain:a.domain,secure:a.secure}),u=new Od(c,t);return u.connectWithTimeout().catch(p=>{u.close(),Lt.error(`AnalyticsClient error: ${p.message}`,le({operationName:"AnalyticsClient.logger",context:t,info:ae(re({},de.internal),{detail:"AnalyticsClient error"}),error:p,path:Lt.prefix,channel:i})),u.onConnectionFailed.emit({})}),u})}(a,c,u):void 0,se=new Bd(ae(re({},q),{memberId:u.id,channelId:c.id,ttl:86400,context:a}));yield se.updateIceParams().catch(Z=>{throw le({operationName:"createLocalPerson",context:a,channel:c,info:ae(re({},de.internal),{detail:"updateIceParams failed"}),path:go.prefix,error:Z})});const ce=yield Qd.Create({iceManager:se,channel:c,signaling:V,analytics:G,metadata:u.metadata,name:u.name,id:u.id,keepaliveIntervalSec:p,keepaliveIntervalGapSec:S,context:a});for(const Z of a.plugins)yield null==(k=Z._whenCreateLocalPerson)?void 0:k.call(Z,ce),ce._onDisposed.once(()=>K(this,null,function*(){var ie;yield null==(ie=Z._whenDisposeLocalPerson)?void 0:ie.call(Z,ce)}));return ce})}(this._context,this,t,i);return this._localPerson=n,n})}dispose(){this.disposed||(this.disposed=!0,We.debug("disposed",this.toJSON()),this._channelImpl.dispose(),this._onDisposed.emit(),this._events.dispose())}},Yr=class{static Create(t){return K(this,arguments,function*(i,n={}){const a=We.info("[start] createChannel",{operationName:"SkyWayChannel.Create"}),c=yield i._api.createChannel(n).catch(p=>{throw We.error("[failed] createChannel",p),p}),u=new Qr(i,c);return We.elapsed(a,"[end] createChannel"),u})}static Find(t,i){return K(this,null,function*(){const n=We.info("[start] findChannel",{operationName:"SkyWayChannel.Find"}),a=yield t._api.findChannel(i).catch(u=>{throw We.error("[failed] findChannel",u),u}),c=new Qr(t,a);return We.elapsed(n,"[end] findChannel"),c})}static FindOrCreate(t,i){return K(this,null,function*(){const n=We.info("[start] findOrCreateChannel",{operationName:"SkyWayChannel.FindOrCreate"}),a=yield t._api.findOrCreateChannel(i).catch(u=>{throw We.error("[failed] findOrCreateChannel",u),u}),c=new Qr(t,a);return We.elapsed(n,"[end] findOrCreateChannel"),c})}constructor(){}};U(),U(),U();var Zr=new _e("packages/core/src/media/factory.ts"),tf=new class{constructor(){if(this.onDeviceChange=new Fe,this._devices=[],!navigator?.mediaDevices)throw le({operationName:"StreamFactory.constructor",info:de.mediaDevicesNotFound,path:Zr.prefix});navigator.mediaDevices.addEventListener("devicechange",()=>K(this,null,function*(){const t=yield this._enumerateDevicesArray(),i=[];this._devices.forEach(a=>{t.map(c=>c.id).includes(a.id)||i.push(a)});const n=[];t.map(a=>a.id).forEach(a=>{this._devices.map(c=>c.id).includes(a)||n.push(t.find(c=>c.id===a))}),Zr.debug("device changed",{added:n,removed:i}),i.forEach(a=>{this.onDeviceChange.emit({state:"removed",device:a})}),n.forEach(a=>{this.onDeviceChange.emit({state:"added",device:a})}),this._devices=t}))}_enumerateDevicesArray(){return K(this,null,function*(){return(yield navigator.mediaDevices.enumerateDevices()).map(i=>new nf(i)).filter(i=>i.id.length>0)})}_enumerateDevicesWithAuth(){return K(this,arguments,function*({video:t,audio:i}={audio:!0,video:!0}){let n=[];return(t||i)&&(n=(yield navigator.mediaDevices.getUserMedia({video:t,audio:i})).getTracks()),this._devices=yield this._enumerateDevicesArray(),n.forEach(a=>a.stop()),this._devices})}enumerateDevices(){return K(this,null,function*(){return yield this._enumerateDevicesWithAuth()})}enumerateInputVideoDevices(){return K(this,null,function*(){return(yield this._enumerateDevicesWithAuth({video:!0})).filter(i=>"videoinput"===i.kind)})}enumerateInputAudioDevices(){return K(this,null,function*(){return(yield this._enumerateDevicesWithAuth({audio:!0})).filter(i=>"audioinput"===i.kind)})}enumerateOutputAudioDevices(){return K(this,null,function*(){return(yield this._enumerateDevicesWithAuth({audio:!0})).filter(i=>"audiooutput"===i.kind)})}createCameraVideoStream(){return K(this,arguments,function*(t={}){var i;t.stopTrackWhenDisabled=null==(i=t.stopTrackWhenDisabled)||i;const[n]=(yield navigator.mediaDevices.getUserMedia({video:t})).getTracks(),a=new Ur(n,t);return a._setLabel("camera"),a})}createMicrophoneAudioStream(){return K(this,arguments,function*(t={}){var i;t.stopTrackWhenDisabled=null==(i=t.stopTrackWhenDisabled)||i;const[n]=(yield navigator.mediaDevices.getUserMedia({audio:t})).getTracks(),a=new Vr(n,t);return a._setLabel("microphone"),a})}createDisplayStreams(){return K(this,arguments,function*(t={}){var i;const c=null!=(i=t.video)?i:{};null!=c.stopTrackWhenDisabled||(c.stopTrackWhenDisabled=!0);let u=t.audio;u&&(u="boolean"==typeof u?{}:u,null!=u.stopTrackWhenDisabled||(u.stopTrackWhenDisabled=!0)),t={audio:u,video:c};const p=yield navigator.mediaDevices.getDisplayMedia(t),[S]=p.getVideoTracks(),[C]=p.getAudioTracks();t.audio&&!C&&Zr.warn(ct({operationName:"StreamFactory.createDisplayStreams",detail:"This client does not support device audio capture"}));const b=new Ur(S,ae(re({},c),{isDisplayMedia:!0}));b._setLabel("displayVideo");const E=C?new Vr(C,ae(re({},u),{isDisplayMedia:!0})):void 0;return E&&E._setLabel("displayAudio"),{video:b,audio:E}})}createDataStream(){return K(this,arguments,function*(t={}){return new Va(t)})}createMicrophoneAudioAndCameraStream(){return K(this,arguments,function*({audio:t,video:i}={}){var n,a;const c=yield navigator.mediaDevices.getUserMedia({audio:t??!0,video:i??!0}),[u]=c.getAudioTracks(),[p]=c.getVideoTracks();(t=t??{}).stopTrackWhenDisabled=null==(n=t.stopTrackWhenDisabled)||n;const S=new Vr(u,t);S._setLabel("microphone"),(i=i??{}).stopTrackWhenDisabled=null==(a=i.stopTrackWhenDisabled)||a;const C=new Ur(p,i);return C._setLabel("camera"),{audio:S,video:C}})}createCustomVideoStream(t){return K(this,arguments,function*(i,n={}){var a,c;n.stopTrackWhenDisabled=null==(a=n.stopTrackWhenDisabled)||a;const u=new Nh(n),p=yield i.createProcessedStream({constraints:null!=(c=n.constraints)?c:{},stopTrackWhenDisabled:n.stopTrackWhenDisabled,onUpdateTrack:S=>u.updateTrack(S)});return yield u.setStream(p),u})}},nf=class{constructor(t){this.id=t.deviceId,this.label=t.label,this.kind=t.kind}};U(),U(),U(),U();var mo=vt(4232);class rf{constructor(i){this.url=i}alive(){var i=this;return(0,Be.A)(function*(){return function sf(t){return es.apply(this,arguments)}(i.url)})()}createSkyWayAuthToken(i,n){var a=this;return(0,Be.A)(function*(){return function af(t,i,n){return ts.apply(this,arguments)}(a.url,i,n)})()}}function es(){return es=(0,Be.A)(function*(t){try{let i=new URL("/v1/status",t);return 200===(yield fetch(i)).status}catch(i){return console.error(i),!1}}),es.apply(this,arguments)}function ts(){return ts=(0,Be.A)(function*(t,i,n){try{let a=new URL("/v1/skyway2023/token",t),c=JSON.stringify({formatVersion:1,channelName:i,peerId:n}),u=yield fetch(a,{method:"POST",body:c});return 200!==u.status?"":(yield u.json()).token??""}catch(a){return console.error(a),""}}),ts.apply(this,arguments)}class of{constructor(){this.url="",this.peer=Mt.y.parse("???"),this.isDestroyed=!1}get isOpen(){return this.peer.isOpen}open(i){var n=this;return(0,Be.A)(function*(){n.isOpen&&(yield n.close());try{console.log("SkyWayFacade open..."),n.peer=Mt.y.parse(i.peerId),n.peer.userId=i.userId,n.peer.password=i.password,n.isDestroyed=!1,yield n.createContext(),yield n.joinRoom(),yield n.joinLobby(),n.peer.isOpen=!0,console.log("SkyWayFacade open ok"),n.onOpen&&n.onOpen(n.peer)}catch(a){console.error(a),n.onFatalError&&n.onFatalError(n.peer,a.name,a.message,a)}})()}close(){var i=this;return(0,Be.A)(function*(){try{console.log("SkyWayFacade close..."),i.peer=Mt.y.parse("???"),i.isDestroyed=!0,yield i.leaveLobby(),yield i.leaveRoom(),yield i.disposeContext(),console.log("SkyWayFacade close ok")}catch(n){console.error(n)}})()}createContext(){var i=this;return(0,Be.A)(function*(){if(yield i.disposeContext(),i.isDestroyed)return;let n=new rf(i.url),a=mo.M.sha256Base64Url(i.peer.roomId+i.peer.roomName+i.peer.password),c=yield n.createSkyWayAuthToken(a,i.peer.peerId);if(c.length<1){let p=`API\u30d0\u30c3\u30af\u30a8\u30f3\u30c9< ${n.url} >\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002SkyWay\u306e\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u3092\u767a\u884c\u3059\u308b\u30b5\u30fc\u30d0\u304c\u5fc5\u8981\u3067\u3059\u3002`;return void(i.onFatalError&&i.onFatalError(i.peer,"server-error",p,new Error(p)))}let u=yield co.Create(c);u.onTokenUpdateReminder.add((0,Be.A)(function*(){console.log(`skyWay onTokenUpdateReminder ${(new Date).toISOString()}`);let p=yield n.createSkyWayAuthToken(a,i.peer.peerId);if(p.length<1){let S=`API\u30d0\u30c3\u30af\u30a8\u30f3\u30c9< ${n.url} >\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002`;i.onFatalError&&i.onFatalError(i.peer,"server-error",S,new Error(S))}else u.updateAuthToken(p)})),u.onTokenExpired.add(()=>{console.error("skyWay onTokenExpired"),i.isOpen&&(i.close(),i.onClose&&i.onClose(i.peer));let p="SkyWay\u306e\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u306e\u6709\u52b9\u671f\u9650\u304c\u5207\u308c\u307e\u3057\u305f\u3002";i.onFatalError&&i.onFatalError(i.peer,"token-expired",p,new Error(p))}),u.onFatalError.add(p=>{console.error("skyWay onFatalError",p),i.isOpen&&(i.close(),i.onClose&&i.onClose(i.peer)),i.onFatalError&&i.onFatalError(i.peer,p.name,p.message,p)}),i.context=u})()}joinLobby(){var i=this;return(0,Be.A)(function*(){yield i.joinLobbyChannel(),yield i.joinLobbyPerson()})()}joinLobbyChannel(){var i=this;return(0,Be.A)(function*(){if(yield i.leaveLobbyChannel(),i.isDestroyed||!i.peer.isRoom||!i.context||i.context?.disposed)return;let n=[];for(let u of i.getLobbyNames()){let p=yield Yr.FindOrCreate(i.context,{name:u});if(console.log(`FindOrCreate<${u}>`),n.push(p),p.members.length<300)break}let a=9999,c=null;n.forEach(u=>{a<=u.members.length||(a=u.members.length,c=u)}),n.forEach(u=>{u!==c&&u.dispose()}),c.onClosed.add(()=>{console.log(`lobby<${c.name}> onClosed`),i.joinLobby()}),i.lobby=c})()}joinLobbyPerson(){var i=this;return(0,Be.A)(function*(){if(yield i.leaveLobbyPerson(),i.isDestroyed||!i.peer.isRoom||!i.context||i.context?.disposed||null==i.lobby)return;let n=yield i.lobby.join({name:i.peer.peerId});console.log(`lobbyPerson join <${i.lobby.name}>`),n.onLeft.add(()=>{console.log("lobbyPerson onClosed")}),n.onFatalError.add(a=>{console.error("lobbyPerson onFatalError",a)}),i.lobbyPerson=n})()}joinRoom(){var i=this;return(0,Be.A)(function*(){yield i.joinRoomChannel(),yield i.joinRoomPerson(),yield i.createRoomDataStream()})()}joinRoomChannel(){var i=this;return(0,Be.A)(function*(){if(yield i.leaveRoomChannel(),i.isDestroyed||!i.peer.isRoom||!i.context||i.context?.disposed)return;let n=mo.M.sha256Base64Url(i.peer.roomId+i.peer.roomName+i.peer.password);console.log(`roomName: ${n}`);let a=yield Yr.FindOrCreate(i.context,{name:n});console.log(`FindOrCreate<${n}>`),a.onClosed.add((0,Be.A)(function*(){console.log(`room<${a.name}> onClosed`),yield i.joinRoom(),console.log(`room<${a.name}> onRoomRestore`),i.onRoomRestore&&i.onRoomRestore(i.peer)})),i.room=a})()}joinRoomPerson(){var i=this;return(0,Be.A)(function*(){if(yield i.leaveRoomPerson(),i.isDestroyed||!i.peer.isRoom||!i.context||i.context?.disposed||null==i.room)return;let n=yield i.room.join({name:i.peer.peerId});console.log(`roomPerson join <${i.room.name}>`),n.onFatalError.add(a=>{console.error("roomPerson onFatalError",a),i.isOpen&&(i.close(),i.onClose&&i.onClose(i.peer)),i.onFatalError&&i.onFatalError(i.peer,a.name,a.message,a)}),i.roomPerson=n})()}createRoomDataStream(){var i=this;return(0,Be.A)(function*(){if(i.isDestroyed||!i.peer.isRoom||!i.context||i.context?.disposed||null==i.roomPerson)return;let n=yield tf.createDataStream(),a=yield i.roomPerson.publish(n,{metadata:"udonarium-data-stream"});a.onSubscribed.add(c=>{if(console.log(`publication onSubscribed ${c.subscription.subscriber.name}`),null==c.subscription.subscriber.name)return void c.subscription.cancel();let p=Mt.y.parse(c.subscription.subscriber.name);i.onSubscribed&&i.onSubscribed(p,c.subscription)}),i.publication=a})()}disposeContext(){var i=this;return(0,Be.A)(function*(){let n=i.context;i.context=null,n&&(console.log("disposeContext"),n.dispose())})()}leaveLobby(){var i=this;return(0,Be.A)(function*(){yield i.leaveLobbyPerson(),yield i.leaveLobbyChannel()})()}leaveLobbyChannel(){var i=this;return(0,Be.A)(function*(){let n=i.lobby;i.lobby=null,n&&(console.log("leaveLobbyChannel"),n.dispose())})()}leaveLobbyPerson(){var i=this;return(0,Be.A)(function*(){let n=i.lobbyPerson;i.lobbyPerson=null,n&&"left"!==n.state&&(console.log("leaveLobbyPerson"),n.onLeft.removeAllListeners(),n.onFatalError.removeAllListeners(),yield n.leave())})()}leaveRoom(){var i=this;return(0,Be.A)(function*(){yield i.closeRoomDataStream(),yield i.leaveRoomPerson(),yield i.leaveRoomChannel()})()}leaveRoomChannel(){var i=this;return(0,Be.A)(function*(){let n=i.room;i.room=null,n&&(console.log("leaveRoomChannel"),n.onMemberJoined.removeAllListeners(),n.onMemberLeft.removeAllListeners(),n.onMemberListChanged.removeAllListeners(),n.onStreamPublished.removeAllListeners(),n.onClosed.removeAllListeners(),n.dispose())})()}leaveRoomPerson(){var i=this;return(0,Be.A)(function*(){let n=i.roomPerson;i.roomPerson=null,n&&"left"!==n.state&&(console.log("leaveRoomPerson"),n.onLeft.removeAllListeners(),n.onFatalError.removeAllListeners(),yield n.leave())})()}closeRoomDataStream(){var i=this;return(0,Be.A)(function*(){let n=i.publication;i.publication=null,n&&(yield n.cancel())})()}listAllPeers(){var i=this;return(0,Be.A)(function*(){if(i.isDestroyed||!i.isOpen)return[];let n=[];for(let c of i.getLobbyNames()){let u=_e.level;_e.level="disable";try{let p=i.lobby?.name===c?i.lobby:yield Yr.Find(i.context,{name:c});n.push(p)}catch(p){p instanceof li?"channelNotFound"!=p.name&&console.error(`${p.name} ${p.message}`):console.error(p)}_e.level=u}let a=n.flatMap(c=>c.members.map(u=>u.name??"???"));return n.forEach(c=>{c.name!==i.lobby?.name&&c.dispose()}),a})()}getLobbyNames(){try{let i=this.context?.authToken.scope.app.channels?.find(u=>u.name.startsWith("udonarium-lobby-"))?.name??"",n=/of-(\d+)$/.exec(i),a=Number(n[1]);return isNaN(a)&&(a=0),[...Array(a)].map((u,p)=>`udonarium-lobby-${p+1}-of-${a}`)}catch(i){console.warn(i)}return[]}}class cf{constructor(){this.callback=new zo.U,this.bandwidthUsage=0,this.skyWay=new of,this.streams=new Xo,this.listAllPeersCache=[],this.httpRequestInterval=performance.now()+500,this.outboundQueue=Promise.resolve(),this.inboundQueue=Promise.resolve(),this.trustedPeerIds=new Set,this.relayingPeerIds=new Map,this.maybeUnavailablePeerIds=new Set}get userIds(){return this.peers.map(i=>i.userId).filter(i=>0<i.length).concat([this.peer.userId])}get peerId(){return this.peer.peerId}get peerIds(){return this.streams.peerIds}get peer(){return this.skyWay.peer}get peers(){return this.streams.peers}configure(i){this.skyWay.url=i?.backend?.url??""}open(...i){let n;console.log("open",i),n=0===i.length?Mt.y.create(Mt.y.generateId()):1===i.length?Mt.y.create(i[0]):Mt.y.create(i[0],i[1],i[2],i[3]),this.trustedPeerIds.clear(),this.openSkyWay(n)}close(){this.disconnectAll(),this.skyWay.close()}connect(i){return this.peer.isRoom?!!this.shouldConnect(i.peerId)&&(console.log(`connect() ${i.peerId}`),this.connectStream(Wi.createSubscription(this.skyWay,i)),!0):(console.warn("connect() is Fail. \u30eb\u30fc\u30e0\u63a5\u7d9a\u306e\u307f\u53ef\u80fd"),this.callback.onError&&this.callback.onError(this.peer,"udonarium-unsupported","\u73fe\u5728\u306e\u30e6\u30c9\u30ca\u30ea\u30a6\u30e0\u3067SkyWay(2023)\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u63a5\u7d9a\u306f\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\u30eb\u30fc\u30e0\u63a5\u7d9a\u6a5f\u80fd\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002",{}),!1)}shouldConnect(i){return this.skyWay.isOpen?this.peerId===i?(console.log("connect() is Fail. "+i+" is me."),!1):this.peerIds.includes(i)?(console.log("connect() is Fail. <"+i+"> is already connecting."),!1):this.peer.verifyPeer(i)?this.skyWay?.room?.members.find(n=>n.name===i)?!(!i||!i.length||i===this.peerId):(console.log("connect() is Fail.  <"+i+"> is not found."),!1):(console.log("connect() is Fail. <"+i+"> is invalid."),!1):(console.log("connect() is Fail. ID\u304c\u5272\u308a\u632f\u3089\u308c\u308b\u307e\u3067\u5f85\u3066\u3084"),!1)}disconnect(i){let n=this.streams.find(i.peerId);return!!n&&(this.disconnectStream(n),!0)}disconnectAll(){for(let i of this.peers)this.disconnect(i)}send(i,n){var a=this;if(this.peers.length<1)return;let c={data:ni.$.encode(i),ttl:1},u=c.data.byteLength;this.bandwidthUsage+=u,this.outboundQueue=this.outboundQueue.then(()=>new Promise((p,S)=>{(0,ur.W)((0,Be.A)(function*(){if(1024<c.data.byteLength&&Array.isArray(i)&&1<i.length){let C=yield(0,ws.D)(c.data);C.byteLength<c.data.byteLength&&(c.data=C,c.isCompressed=!0)}return n?a.sendUnicast(c,n):a.sendBroadcast(c),a.bandwidthUsage-=u,p()}))}))}sendUnicast(i,n){i.ttl=0;let a=this.streams.find(n);a&&a.open&&a.send(i)}sendBroadcast(i){for(let n of this.streams)n.open&&n.send(i)}listAllPeers(){var i=this;return(0,Be.A)(function*(){let n=performance.now();return n<i.httpRequestInterval?console.warn("httpRequestInterval... "+(i.httpRequestInterval-n)):(i.httpRequestInterval=n+1e4,i.listAllPeersCache=yield i.skyWay.listAllPeers()),i.listAllPeersCache})()}listAllRooms(){var i=this;return(0,Be.A)(function*(){let n=yield i.listAllPeers();return $o.G.listFrom(n)})()}openSkyWay(i){var n=this;return(0,Be.A)(function*(){n.skyWay.context&&(console.warn("It is already opened."),yield n.skyWay.close()),n.skyWay.onOpen=a=>{console.log("skyWay onOpen",a),console.log("My peer Context",n.peer),n.callback.onOpen&&n.callback.onOpen(n.peer)},n.skyWay.onClose=a=>{console.log("skyWay onClose",a),n.peer.isOpen&&n.close(),n.callback.onClose&&n.callback.onClose(n.peer)},n.skyWay.onFatalError=(a,c,u,p)=>{console.error("skyWay onFatalError",p),n.peer.isOpen&&(n.close(),n.callback.onClose&&n.callback.onClose(n.peer)),n.callback.onError&&n.callback.onError(n.peer,c,u,p)},n.skyWay.onSubscribed=(a,c)=>{console.log(`skyWay onSubscribed ${a.peerId}`);let u=Wi.createPublication(n.skyWay,a);if(!n.peer.verifyPeer(u.peer.peerId))return console.warn("stream is closing. <"+u.peer.peerId+"> is invalid."),u.reject(),void u.connect();n.connectStream(u)},n.skyWay.onRoomRestore=a=>{console.log(`skyWay onRoomRestore ${a.peerId}`);for(let c of n.trustedPeerIds){let u=Mt.y.parse(c);n.disconnect(u),n.connect(u)}},yield n.skyWay.open(i)})()}connectStream(i){null!=this.streams.add(i)&&(console.log(`openStream ${i.peer.peerId}`),this.trustedPeerIds.delete(i.peer.peerId),this.maybeUnavailablePeerIds.add(i.peer.peerId),i.on("data",n=>{this.onData(i,n)}),i.on("open",()=>{this.trustedPeerIds.add(i.peer.peerId),this.maybeUnavailablePeerIds.delete(i.peer.peerId),this.notifyUserList(),this.callback.onConnect&&this.callback.onConnect(i.peer)}),i.on("close",()=>{this.disconnectStream(i)}),i.on("error",()=>{this.disconnectStream(i)}),i.on("stats",(0,Be.A)(function*(){})),i.connect())}disconnectStream(i){i.disconnect();let n=this.streams.remove(i);this.relayingPeerIds.delete(i.peer.peerId),this.relayingPeerIds.forEach(a=>{let c=a.indexOf(i.peer.peerId);0<=c&&a.splice(c,1)}),this.notifyUserList(),n&&this.callback.onDisconnect&&this.callback.onDisconnect(n.peer)}onData(i,n){var a=this;if(n.users&&0<n.users.length&&this.onUpdateUserIds(i,n.users),0<n.ttl&&this.onRelay(i,n),!this.callback.onData)return;let c=n.data.byteLength;this.bandwidthUsage+=c,this.inboundQueue=this.inboundQueue.then(()=>new Promise((u,p)=>{(0,ur.W)((0,Be.A)(function*(){if(!a.callback.onData)return;let S=n.isCompressed?yield(0,ws.S)(n.data):n.data;return a.callback.onData(i.peer,ni.$.decode(S)),a.bandwidthUsage-=c,u()}))}))}onRelay(i,n){n.ttl--;let a=this.relayingPeerIds.get(i.peer.peerId);if(null!=a){n.users&&0<n.users.length&&(n.users=this.userIds);for(let c of a){let u=this.streams.find(c);u&&u.open&&(console.log("<"+c+"> \u8ee2\u9001\u3057\u306a\u304d\u3083\u30fb\u30fb\u30fb"),u.send(n))}}}onUpdateUserIds(i,n){let a=!1;n.forEach(S=>{let C=this.makeFriendPeer(S),b=this.streams.find(C.peerId);b&&b.peer.userId!==S&&(b.peer.userId=S,a=!0)});let c=Wo._.diff(this.userIds,n),p=c.diff2;if(this.relayingPeerIds.set(i.peer.peerId,c.diff1.map(S=>this.makeFriendPeer(S).peerId)),p.length)for(let S of p){let C=this.makeFriendPeer(S);!this.maybeUnavailablePeerIds.has(C.peerId)&&this.connect(C)&&console.log("auto connect to unknown Peer <"+C.peerId+">")}a&&this.notifyUserList()}notifyUserList(){if(this.streams.refresh(),this.streams.length<1)return;let i={data:ni.$.encode([]),users:this.userIds,ttl:1};this.sendBroadcast(i)}makeFriendPeer(i){return this.peer.isRoom?Mt.y.create(i,this.peer.roomId,this.peer.roomName,this.peer.password):Mt.y.create(i)}}}}]);